<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Applied Statistics</title>
  <meta name="description" content="Course notes for Applied Statistics courses at CSU Chico" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Applied Statistics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Course notes for Applied Statistics courses at CSU Chico" />
  <meta name="github-repo" content="norcalbiostat/AppliedStatistics_notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Applied Statistics" />
  
  <meta name="twitter:description" content="Course notes for Applied Statistics courses at CSU Chico" />
  

<meta name="author" content="Robin Donatello, Edward Roualdes" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Applied Statistics</h1>
<p class="author"><em>Robin Donatello, Edward Roualdes</em></p>
<p class="date"><em>Last Updated 2023-02-05</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#preface" id="toc-preface">Preface</a></li>
<li><a href="#part-preparing-data-for-analysis" id="toc-part-preparing-data-for-analysis">(PART) Preparing Data for Analysis</a></li>
<li><a href="#data_prep" id="toc-data_prep"><span class="toc-section-number">1</span> Workflow and Data Cleaning</a>
<ul>
<li><a href="#generating-a-reproducible-workflows" id="toc-generating-a-reproducible-workflows"><span class="toc-section-number">1.1</span> Generating a reproducible workflows</a>
<ul>
<li><a href="#literate-programming" id="toc-literate-programming"><span class="toc-section-number">1.1.1</span> Literate programming</a></li>
<li><a href="#reproducible-research-literate-programming" id="toc-reproducible-research-literate-programming"><span class="toc-section-number">1.1.2</span> Reproducible Research + Literate Programming</a></li>
</ul></li>
<li><a href="#import-data" id="toc-import-data"><span class="toc-section-number">1.2</span> Import data</a>
<ul>
<li><a href="#renaming-variable-names-for-sanity-sake" id="toc-renaming-variable-names-for-sanity-sake"><span class="toc-section-number">1.2.1</span> Renaming variable names for sanity sake</a></li>
</ul></li>
<li><a href="#data-management" id="toc-data-management"><span class="toc-section-number">1.3</span> Data Management</a>
<ul>
<li><a href="#missing-data" id="toc-missing-data"><span class="toc-section-number">1.3.1</span> Missing data</a></li>
<li><a href="#identifying-variable-types" id="toc-identifying-variable-types"><span class="toc-section-number">1.3.2</span> Identifying Variable Types</a></li>
<li><a href="#outliers" id="toc-outliers"><span class="toc-section-number">1.3.3</span> Outliers</a></li>
<li><a href="#creating-secondary-variables" id="toc-creating-secondary-variables"><span class="toc-section-number">1.3.4</span> Creating secondary variables</a></li>
</ul></li>
<li><a href="#saving-your-changes" id="toc-saving-your-changes"><span class="toc-section-number">1.4</span> Saving your changes</a></li>
<li><a href="#wide-long" id="toc-wide-long"><span class="toc-section-number">1.5</span> Wide vs. Long data</a></li>
<li><a href="#dealing-with-missing-data-post-analysis" id="toc-dealing-with-missing-data-post-analysis"><span class="toc-section-number">1.6</span> Dealing with missing data post-analysis</a></li>
</ul></li>
<li><a href="#data_viz" id="toc-data_viz"><span class="toc-section-number">2</span> Visualizing Data</a>
<ul>
<li><a href="#the-syntax-of-ggplot" id="toc-the-syntax-of-ggplot"><span class="toc-section-number">2.1</span> The syntax of <code>ggplot</code></a>
<ul>
<li><a href="#required-arguments" id="toc-required-arguments"><span class="toc-section-number">2.1.1</span> Required arguments</a></li>
<li><a href="#optional-but-helpful-arguments" id="toc-optional-but-helpful-arguments"><span class="toc-section-number">2.1.2</span> Optional but helpful arguments</a></li>
</ul></li>
<li><a href="#the-data" id="toc-the-data"><span class="toc-section-number">2.2</span> The Data</a></li>
<li><a href="#univariate-visualizations" id="toc-univariate-visualizations"><span class="toc-section-number">2.3</span> Univariate Visualizations</a>
<ul>
<li><a href="#categorical-variables" id="toc-categorical-variables"><span class="toc-section-number">2.3.1</span> Categorical variables</a></li>
<li><a href="#continuous-measures" id="toc-continuous-measures"><span class="toc-section-number">2.3.2</span> Continuous Measures</a></li>
</ul></li>
<li><a href="#bivariate-visualizations" id="toc-bivariate-visualizations"><span class="toc-section-number">2.4</span> Bivariate Visualizations</a>
<ul>
<li><a href="#categorical-v.-categorical" id="toc-categorical-v.-categorical"><span class="toc-section-number">2.4.1</span> Categorical v. Categorical</a></li>
<li><a href="#grouped-bar-charts-with-percentages" id="toc-grouped-bar-charts-with-percentages"><span class="toc-section-number">2.4.2</span> Grouped bar charts with percentages</a></li>
<li><a href="#continuous-v.-continuous" id="toc-continuous-v.-continuous"><span class="toc-section-number">2.4.3</span> Continuous v. Continuous</a></li>
<li><a href="#continuous-v.-categorical" id="toc-continuous-v.-categorical"><span class="toc-section-number">2.4.4</span> Continuous v. Categorical</a></li>
<li><a href="#joy-plots-ridgelines" id="toc-joy-plots-ridgelines"><span class="toc-section-number">2.4.5</span> Joy plots / Ridgelines</a></li>
</ul></li>
<li><a href="#faceting-paneling" id="toc-faceting-paneling"><span class="toc-section-number">2.5</span> Faceting / paneling</a></li>
<li><a href="#multiple-plots-per-window" id="toc-multiple-plots-per-window"><span class="toc-section-number">2.6</span> Multiple plots per window</a></li>
<li><a href="#multivariate-3-variables" id="toc-multivariate-3-variables"><span class="toc-section-number">2.7</span> Multivariate (3+ variables)</a>
<ul>
<li><a href="#three-continuous" id="toc-three-continuous"><span class="toc-section-number">2.7.1</span> Three continuous</a></li>
<li><a href="#scatterplot-matrix" id="toc-scatterplot-matrix"><span class="toc-section-number">2.7.2</span> Scatterplot matrix</a></li>
<li><a href="#two-categorical-and-one-continuous" id="toc-two-categorical-and-one-continuous"><span class="toc-section-number">2.7.3</span> Two categorical and one continuous</a></li>
<li><a href="#two-continuous-and-one-categorical" id="toc-two-continuous-and-one-categorical"><span class="toc-section-number">2.7.4</span> Two continuous and one categorical</a></li>
</ul></li>
<li><a href="#paneling-on-two-variables" id="toc-paneling-on-two-variables"><span class="toc-section-number">2.8</span> Paneling on two variables</a></li>
<li><a href="#troubleshooting" id="toc-troubleshooting"><span class="toc-section-number">2.9</span> Troubleshooting</a></li>
<li><a href="#but-what-about" id="toc-but-what-about"><span class="toc-section-number">2.10</span> But what about…</a>
<ul>
<li><a href="#other-plots-not-mentioned" id="toc-other-plots-not-mentioned"><span class="toc-section-number">2.10.1</span> Other plots not mentioned</a></li>
</ul></li>
<li><a href="#additional-resources" id="toc-additional-resources"><span class="toc-section-number">2.11</span> Additional Resources</a></li>
</ul></li>
<li><a href="#select_analysis" id="toc-select_analysis"><span class="toc-section-number">3</span> Selecting Appropriate Analyses</a></li>
<li><a href="#part-statistical-inference" id="toc-part-statistical-inference">(PART) Statistical Inference</a></li>
<li><a href="#bv-intro" id="toc-bv-intro"><span class="toc-section-number">4</span> Foundations for Inference</a></li>
<li><a href="#bivariate-analysis" id="toc-bivariate-analysis"><span class="toc-section-number">5</span> Bivariate Analysis</a>
<ul>
<li><a href="#assumption-of-independent-observations" id="toc-assumption-of-independent-observations"><span class="toc-section-number">5.1</span> Assumption of Independent Observations</a></li>
<li><a href="#choosing-appropriate-bivariate-analysis" id="toc-choosing-appropriate-bivariate-analysis"><span class="toc-section-number">5.2</span> Choosing appropriate bivariate analysis</a></li>
<li><a href="#bv-ttest" id="toc-bv-ttest"><span class="toc-section-number">5.3</span> (Q~B) Two means: T-Test</a>
<ul>
<li><a href="#assumptions" id="toc-assumptions"><span class="toc-section-number">5.3.1</span> Assumptions</a></li>
<li><a href="#sampling-distribution-for-the-difference" id="toc-sampling-distribution-for-the-difference"><span class="toc-section-number">5.3.2</span> Sampling Distribution for the difference</a></li>
<li><a href="#example-smoking-and-bmi" id="toc-example-smoking-and-bmi"><span class="toc-section-number">5.3.3</span> Example: Smoking and BMI</a></li>
</ul></li>
<li><a href="#bv-anova" id="toc-bv-anova"><span class="toc-section-number">5.4</span> (Q~C) Multiple means: ANOVA</a>
<ul>
<li><a href="#formulation-of-the-one-way-anova-model" id="toc-formulation-of-the-one-way-anova-model"><span class="toc-section-number">5.4.1</span> Formulation of the One-way ANOVA model</a></li>
<li><a href="#analysis-of-variance-table" id="toc-analysis-of-variance-table"><span class="toc-section-number">5.4.2</span> Analysis of Variance Table*:</a></li>
<li><a href="#the-f-distribution" id="toc-the-f-distribution"><span class="toc-section-number">5.4.3</span> The F-distribution</a></li>
<li><a href="#assumptions-1" id="toc-assumptions-1"><span class="toc-section-number">5.4.4</span> Assumptions</a></li>
<li><a href="#example-a-comparison-of-plant-species-under-low-water-conditions" id="toc-example-a-comparison-of-plant-species-under-low-water-conditions"><span class="toc-section-number">5.4.5</span> Example: A comparison of plant species under low water conditions</a></li>
<li><a href="#coefficient-of-determination-r2" id="toc-coefficient-of-determination-r2"><span class="toc-section-number">5.4.6</span> Coefficient of determination <span class="math inline">\(R^{2}\)</span></a></li>
<li><a href="#multiple-comparisons" id="toc-multiple-comparisons"><span class="toc-section-number">5.4.7</span> Multiple Comparisons</a></li>
</ul></li>
<li><a href="#bv-chisq" id="toc-bv-chisq"><span class="toc-section-number">5.5</span> (C~C) Multiple Proportions: <span class="math inline">\(\chi^{2}\)</span></a>
<ul>
<li><a href="#conditions-for-the-sampling-distribution-to-be-normal." id="toc-conditions-for-the-sampling-distribution-to-be-normal."><span class="toc-section-number">5.5.1</span> Conditions for the sampling distribution to be normal.</a></li>
<li><a href="#example-are-mammograms-effective" id="toc-example-are-mammograms-effective"><span class="toc-section-number">5.5.2</span> Example: Are Mammograms effective?</a></li>
<li><a href="#example-smoking-and-general-health" id="toc-example-smoking-and-general-health"><span class="toc-section-number">5.5.3</span> Example: Smoking and General Health</a></li>
<li><a href="#multiple-comparisons-1" id="toc-multiple-comparisons-1"><span class="toc-section-number">5.5.4</span> Multiple Comparisons</a></li>
</ul></li>
<li><a href="#bv-corr" id="toc-bv-corr"><span class="toc-section-number">5.6</span> (Q~Q) Correlation</a>
<ul>
<li><a href="#strength-of-the-correlation" id="toc-strength-of-the-correlation"><span class="toc-section-number">5.6.1</span> Strength of the correlation</a></li>
<li><a href="#example-federal-spending-per-capita-and-poverty-rate" id="toc-example-federal-spending-per-capita-and-poverty-rate"><span class="toc-section-number">5.6.2</span> Example: Federal spending per capita and poverty rate</a></li>
</ul></li>
</ul></li>
<li><a href="#part-regression-modeling" id="toc-part-regression-modeling">(PART) Regression Modeling</a></li>
<li><a href="#reg-intro" id="toc-reg-intro"><span class="toc-section-number">6</span> Introduction</a>
<ul>
<li><a href="#opening-remarks" id="toc-opening-remarks"><span class="toc-section-number">6.1</span> Opening Remarks</a></li>
</ul></li>
<li><a href="#slr" id="toc-slr"><span class="toc-section-number">7</span> Simple Linear Regression</a>
<ul>
<li><a href="#example" id="toc-example"><span class="toc-section-number">7.1</span> Example</a>
<ul>
<li><a href="#caution-on-out-of-range-predictions" id="toc-caution-on-out-of-range-predictions"><span class="toc-section-number">7.1.1</span> Caution on out of range predictions</a></li>
</ul></li>
<li><a href="#mathematical-model" id="toc-mathematical-model"><span class="toc-section-number">7.2</span> Mathematical Model</a>
<ul>
<li><a href="#unifying-model-framework" id="toc-unifying-model-framework"><span class="toc-section-number">7.2.1</span> Unifying model framework</a></li>
</ul></li>
<li><a href="#parameter-estimates" id="toc-parameter-estimates"><span class="toc-section-number">7.3</span> Parameter Estimates</a>
<ul>
<li><a href="#sum-of-squares" id="toc-sum-of-squares"><span class="toc-section-number">7.3.1</span> Sum of Squares</a></li>
</ul></li>
<li><a href="#assumptions-2" id="toc-assumptions-2"><span class="toc-section-number">7.4</span> Assumptions</a></li>
<li><a href="#slr-fev" id="toc-slr-fev"><span class="toc-section-number">7.5</span> Example</a></li>
<li><a href="#model-diagnostics" id="toc-model-diagnostics"><span class="toc-section-number">7.6</span> Model Diagnostics</a></li>
<li><a href="#prediction" id="toc-prediction"><span class="toc-section-number">7.7</span> Prediction</a>
<ul>
<li><a href="#predict-the-average-value-of-y-haty-based-on-the-model" id="toc-predict-the-average-value-of-y-haty-based-on-the-model"><span class="toc-section-number">7.7.1</span> Predict the <em>average</em> value of Y (<span class="math inline">\(\hat{y}\)</span>) based on the model</a></li>
<li><a href="#confidence-intervals-for-the-predicted-mean" id="toc-confidence-intervals-for-the-predicted-mean"><span class="toc-section-number">7.7.2</span> Confidence intervals for the predicted mean</a></li>
<li><a href="#predict-the-average-value-of-y-haty_i-for-a-certain-value-of-x" id="toc-predict-the-average-value-of-y-haty_i-for-a-certain-value-of-x"><span class="toc-section-number">7.7.3</span> Predict the <em>average</em> value of Y <span class="math inline">\((\hat{y_{i}})\)</span> for a certain value of <span class="math inline">\(x^{*}\)</span></a></li>
<li><a href="#predict-a-new-value-of-y-haty_i-for-a-certain-value-of-x" id="toc-predict-a-new-value-of-y-haty_i-for-a-certain-value-of-x"><span class="toc-section-number">7.7.4</span> Predict a <em>new</em> value of Y <span class="math inline">\(\hat{y_{i}}\)</span> for a certain value of <span class="math inline">\(x^{*}\)</span></a></li>
</ul></li>
<li><a href="#anova-for-regression" id="toc-anova-for-regression"><span class="toc-section-number">7.8</span> ANOVA for regression</a></li>
<li><a href="#correlation-coefficient" id="toc-correlation-coefficient"><span class="toc-section-number">7.9</span> Correlation Coefficient</a></li>
</ul></li>
<li><a href="#mod-strat" id="toc-mod-strat"><span class="toc-section-number">8</span> Moderation and Stratification</a>
<ul>
<li><a href="#moderation" id="toc-moderation"><span class="toc-section-number">8.1</span> Moderation</a>
<ul>
<li><a href="#example-1-simpsons-paradox" id="toc-example-1-simpsons-paradox"><span class="toc-section-number">8.1.1</span> Example 1: Simpson’s Paradox</a></li>
<li><a href="#example-2-sepal-vs-petal-length-in-iris-flowers" id="toc-example-2-sepal-vs-petal-length-in-iris-flowers"><span class="toc-section-number">8.1.2</span> Example 2: Sepal vs Petal Length in Iris flowers</a></li>
</ul></li>
<li><a href="#stratification" id="toc-stratification"><span class="toc-section-number">8.2</span> Stratification</a></li>
<li><a href="#identifying-a-moderator" id="toc-identifying-a-moderator"><span class="toc-section-number">8.3</span> Identifying a moderator</a>
<ul>
<li><a href="#what-to-look-for-in-each-type-of-analysis" id="toc-what-to-look-for-in-each-type-of-analysis"><span class="toc-section-number">8.3.1</span> What to look for in each type of analysis</a></li>
</ul></li>
<li><a href="#example-2-cont.-correlation-regression" id="toc-example-2-cont.-correlation-regression"><span class="toc-section-number">8.4</span> Example 2 (cont.) Correlation &amp; Regression</a></li>
<li><a href="#example-3-anova" id="toc-example-3-anova"><span class="toc-section-number">8.5</span> Example 3: ANOVA</a></li>
<li><a href="#example-4-chi-squared" id="toc-example-4-chi-squared"><span class="toc-section-number">8.6</span> Example 4: Chi-Squared</a></li>
</ul></li>
<li><a href="#mlr" id="toc-mlr"><span class="toc-section-number">9</span> Multiple Linear Regression</a>
<ul>
<li><a href="#mlr-math-model" id="toc-mlr-math-model"><span class="toc-section-number">9.1</span> Mathematical Model</a></li>
<li><a href="#parameter-estimation" id="toc-parameter-estimation"><span class="toc-section-number">9.2</span> Parameter Estimation</a></li>
<li><a href="#fitting-the-model" id="toc-fitting-the-model"><span class="toc-section-number">9.3</span> Fitting the model</a></li>
<li><a href="#interpreting-coefficients" id="toc-interpreting-coefficients"><span class="toc-section-number">9.4</span> Interpreting Coefficients</a>
<ul>
<li><a href="#continuous-predictors" id="toc-continuous-predictors"><span class="toc-section-number">9.4.1</span> Continuous predictors</a></li>
<li><a href="#binary-predictors" id="toc-binary-predictors"><span class="toc-section-number">9.4.2</span> Binary predictors</a></li>
<li><a href="#cat-predictors" id="toc-cat-predictors"><span class="toc-section-number">9.4.3</span> Categorical Predictors</a></li>
</ul></li>
<li><a href="#presenting-results" id="toc-presenting-results"><span class="toc-section-number">9.5</span> Presenting results</a></li>
<li><a href="#confounding" id="toc-confounding"><span class="toc-section-number">9.6</span> Confounding</a></li>
<li><a href="#model-diagnostics-1" id="toc-model-diagnostics-1"><span class="toc-section-number">9.7</span> Model Diagnostics</a></li>
<li><a href="#what-to-watch-out-for" id="toc-what-to-watch-out-for"><span class="toc-section-number">9.8</span> What to watch out for</a></li>
</ul></li>
<li><a href="#model-building" id="toc-model-building"><span class="toc-section-number">10</span> Model Building</a>
<ul>
<li><a href="#interactions" id="toc-interactions"><span class="toc-section-number">10.1</span> Interactions</a>
<ul>
<li><a href="#fitting-interaction-models-interpreting-coefficients" id="toc-fitting-interaction-models-interpreting-coefficients"><span class="toc-section-number">10.1.1</span> Fitting interaction models &amp; interpreting coefficients</a></li>
<li><a href="#interactions-catvars" id="toc-interactions-catvars"><span class="toc-section-number">10.1.2</span> Categorical Interaction variables</a></li>
<li><a href="#example-2" id="toc-example-2"><span class="toc-section-number">10.1.3</span> Example 2</a></li>
<li><a href="#example-3" id="toc-example-3"><span class="toc-section-number">10.1.4</span> Example 3:</a></li>
</ul></li>
<li><a href="#wald-test" id="toc-wald-test"><span class="toc-section-number">10.2</span> Wald test</a>
<ul>
<li><a href="#example-modeling-depression-score" id="toc-example-modeling-depression-score"><span class="toc-section-number">10.2.1</span> Example: Modeling depression score</a></li>
<li><a href="#testing-for-a-moderation-effect-in-a-multiple-regression-model." id="toc-testing-for-a-moderation-effect-in-a-multiple-regression-model."><span class="toc-section-number">10.2.2</span> Testing for a moderation effect in a multiple regression model.</a></li>
</ul></li>
<li><a href="#multicollinearity" id="toc-multicollinearity"><span class="toc-section-number">10.3</span> Multicollinearity</a></li>
<li><a href="#variable-selection-process" id="toc-variable-selection-process"><span class="toc-section-number">10.4</span> Variable Selection Process</a>
<ul>
<li><a href="#automated-selection-procedures" id="toc-automated-selection-procedures"><span class="toc-section-number">10.4.1</span> Automated selection procedures</a></li>
<li><a href="#implementation-in-r" id="toc-implementation-in-r"><span class="toc-section-number">10.4.2</span> Implementation in R</a></li>
<li><a href="#lasso" id="toc-lasso"><span class="toc-section-number">10.4.3</span> Lasso</a></li>
</ul></li>
<li><a href="#model-fit-criteria" id="toc-model-fit-criteria"><span class="toc-section-number">10.5</span> Comparing between models</a>
<ul>
<li><a href="#rss-residual-sum-of-squares" id="toc-rss-residual-sum-of-squares"><span class="toc-section-number">10.5.1</span> RSS: Residual Sum of Squares</a></li>
<li><a href="#likelihood-function" id="toc-likelihood-function"><span class="toc-section-number">10.5.2</span> Likelihood function</a></li>
<li><a href="#general-F" id="toc-general-F"><span class="toc-section-number">10.5.3</span> General F Test</a></li>
<li><a href="#multiple-r2" id="toc-multiple-r2"><span class="toc-section-number">10.5.4</span> Multiple <span class="math inline">\(R^{2}\)</span></a></li>
<li><a href="#adjusted-r2" id="toc-adjusted-r2"><span class="toc-section-number">10.5.5</span> Adjusted <span class="math inline">\(R^{2}\)</span></a></li>
<li><a href="#mallows-c_p" id="toc-mallows-c_p"><span class="toc-section-number">10.5.6</span> Mallows <span class="math inline">\(C_{p}\)</span></a></li>
<li><a href="#akaike-information-criterion-aic" id="toc-akaike-information-criterion-aic"><span class="toc-section-number">10.5.7</span> Akaike Information Criterion (AIC)</a></li>
<li><a href="#bayesian-information-criterion-bic" id="toc-bayesian-information-criterion-bic"><span class="toc-section-number">10.5.8</span> Bayesian Information Criterion (BIC)</a></li>
<li><a href="#aic-vs-bic" id="toc-aic-vs-bic"><span class="toc-section-number">10.5.9</span> AIC vs BIC</a></li>
</ul></li>
<li><a href="#model-diagnostics" id="toc-model-diagnostics"><span class="toc-section-number">10.6</span> Model Diagnostics</a>
<ul>
<li><a href="#linearity" id="toc-linearity"><span class="toc-section-number">10.6.1</span> Linearity</a></li>
<li><a href="#normality-of-residuals." id="toc-normality-of-residuals."><span class="toc-section-number">10.6.2</span> Normality of residuals.</a></li>
<li><a href="#homogeneity-of-variance" id="toc-homogeneity-of-variance"><span class="toc-section-number">10.6.3</span> Homogeneity of variance</a></li>
<li><a href="#posterior-predictions" id="toc-posterior-predictions"><span class="toc-section-number">10.6.4</span> Posterior Predictions</a></li>
</ul></li>
<li><a href="#general-advice" id="toc-general-advice"><span class="toc-section-number">10.7</span> General Advice</a></li>
<li><a href="#what-to-watch-out-for-1" id="toc-what-to-watch-out-for-1"><span class="toc-section-number">10.8</span> What to watch out for</a></li>
</ul></li>
<li><a href="#glm" id="toc-glm"><span class="toc-section-number">11</span> Generalized Linear Models</a>
<ul>
<li><a href="#fitting-glms" id="toc-fitting-glms"><span class="toc-section-number">11.1</span> Fitting GLMs</a>
<ul>
<li><a href="#r" id="toc-r"><span class="toc-section-number">11.1.1</span> R</a></li>
<li><a href="#spss" id="toc-spss"><span class="toc-section-number">11.1.2</span> SPSS</a></li>
<li><a href="#stata" id="toc-stata"><span class="toc-section-number">11.1.3</span> Stata</a></li>
</ul></li>
<li><a href="#binary-outcome-data" id="toc-binary-outcome-data"><span class="toc-section-number">11.2</span> Binary outcome data</a></li>
<li><a href="#logreg" id="toc-logreg"><span class="toc-section-number">11.3</span> Logistic Regression</a>
<ul>
<li><a href="#interpreting-odds-ratios" id="toc-interpreting-odds-ratios"><span class="toc-section-number">11.3.1</span> Interpreting Odds Ratios</a></li>
<li><a href="#or-ci" id="toc-or-ci"><span class="toc-section-number">11.3.2</span> Confidence Intervals</a></li>
<li><a href="#logreg-dep-ex" id="toc-logreg-dep-ex"><span class="toc-section-number">11.3.3</span> Example: The effect of gender on Depression</a></li>
<li><a href="#mlogreg" id="toc-mlogreg"><span class="toc-section-number">11.3.4</span> Multiple Logistic Regression</a></li>
<li><a href="#effect-of-a-k-unit-change" id="toc-effect-of-a-k-unit-change"><span class="toc-section-number">11.3.5</span> Effect of a k unit change</a></li>
<li><a href="#example-predictors-of-smoking-status" id="toc-example-predictors-of-smoking-status"><span class="toc-section-number">11.3.6</span> Example: Predictors of smoking status</a></li>
<li><a href="#model-fit" id="toc-model-fit"><span class="toc-section-number">11.3.7</span> Model Fit</a></li>
</ul></li>
<li><a href="#log-linear" id="toc-log-linear"><span class="toc-section-number">11.4</span> Log-linear models</a>
<ul>
<li><a href="#example-1" id="toc-example-1"><span class="toc-section-number">11.4.1</span> Example</a></li>
</ul></li>
<li><a href="#poisson-reg" id="toc-poisson-reg"><span class="toc-section-number">11.5</span> Count outcome data</a></li>
<li><a href="#multinomial-reg" id="toc-multinomial-reg"><span class="toc-section-number">11.6</span> Categorical outcome data</a></li>
</ul></li>
<li><a href="#binary-classification" id="toc-binary-classification"><span class="toc-section-number">12</span> Classification of Binary outcomes</a>
<ul>
<li><a href="#predicted-probabilities" id="toc-predicted-probabilities"><span class="toc-section-number">12.1</span> Predicted Probabilities</a></li>
<li><a href="#predicted-class-outcome" id="toc-predicted-class-outcome"><span class="toc-section-number">12.2</span> Predicted Class (outcome)</a></li>
<li><a href="#confusion-matrix" id="toc-confusion-matrix"><span class="toc-section-number">12.3</span> Confusion Matrix</a></li>
<li><a href="#vocabulary-terms" id="toc-vocabulary-terms"><span class="toc-section-number">12.4</span> Vocabulary terms</a></li>
<li><a href="#roc-curves" id="toc-roc-curves"><span class="toc-section-number">12.5</span> ROC Curves</a></li>
<li><a href="#model-performance" id="toc-model-performance"><span class="toc-section-number">12.6</span> Model Performance</a></li>
</ul></li>
<li><a href="#part-multivariate-analysis" id="toc-part-multivariate-analysis">(PART) Multivariate Analysis</a></li>
<li><a href="#mv-intro" id="toc-mv-intro"><span class="toc-section-number">13</span> Introduction</a></li>
<li><a href="#fa" id="toc-fa"><span class="toc-section-number">14</span> Factor Analysis</a>
<ul>
<li><a href="#introduction" id="toc-introduction"><span class="toc-section-number">14.1</span> Introduction</a>
<ul>
<li><a href="#latent-constructs" id="toc-latent-constructs"><span class="toc-section-number">14.1.1</span> Latent Constructs</a></li>
<li><a href="#comparison-with-pca" id="toc-comparison-with-pca"><span class="toc-section-number">14.1.2</span> Comparison with PCA</a></li>
<li><a href="#efa-vs-cfa" id="toc-efa-vs-cfa"><span class="toc-section-number">14.1.3</span> EFA vs CFA</a></li>
</ul></li>
<li><a href="#factor-model" id="toc-factor-model"><span class="toc-section-number">14.2</span> Factor Model</a>
<ul>
<li><a href="#components-of-variance" id="toc-components-of-variance"><span class="toc-section-number">14.2.1</span> Components of Variance</a></li>
<li><a href="#two-big-steps" id="toc-two-big-steps"><span class="toc-section-number">14.2.2</span> Two big steps</a></li>
</ul></li>
<li><a href="#fa-example" id="toc-fa-example"><span class="toc-section-number">14.3</span> Example data setup</a></li>
<li><a href="#fa-extract" id="toc-fa-extract"><span class="toc-section-number">14.4</span> Factor Extraction Methods</a>
<ul>
<li><a href="#principal-components-pc-factor-model" id="toc-principal-components-pc-factor-model"><span class="toc-section-number">14.4.1</span> Principal components (PC Factor model)</a></li>
<li><a href="#iterated-components" id="toc-iterated-components"><span class="toc-section-number">14.4.2</span> Iterated components</a></li>
<li><a href="#maximum-likelihood" id="toc-maximum-likelihood"><span class="toc-section-number">14.4.3</span> Maximum Likelihood</a></li>
<li><a href="#uniqueness" id="toc-uniqueness"><span class="toc-section-number">14.4.4</span> Uniqueness</a></li>
<li><a href="#resulting-factors" id="toc-resulting-factors"><span class="toc-section-number">14.4.5</span> Resulting factors</a></li>
</ul></li>
<li><a href="#rotating-factors" id="toc-rotating-factors"><span class="toc-section-number">14.5</span> Rotating Factors</a>
<ul>
<li><a href="#varimax-rotation" id="toc-varimax-rotation"><span class="toc-section-number">14.5.1</span> Varimax Rotation</a></li>
<li><a href="#oblique-rotation" id="toc-oblique-rotation"><span class="toc-section-number">14.5.2</span> Oblique rotation</a></li>
</ul></li>
<li><a href="#factor-scores" id="toc-factor-scores"><span class="toc-section-number">14.6</span> Factor Scores</a></li>
<li><a href="#what-to-watch-out-for-2" id="toc-what-to-watch-out-for-2"><span class="toc-section-number">14.7</span> What to watch out for</a></li>
<li><a href="#help" id="toc-help"><span class="toc-section-number">14.8</span> Additional Resources</a></li>
</ul></li>
<li><a href="#part-multi-level-modeling" id="toc-part-multi-level-modeling">(PART) Multi-level Modeling</a></li>
<li><a href="#introduction-1" id="toc-introduction-1"><span class="toc-section-number">15</span> Introduction</a>
<ul>
<li><a href="#example-school-data" id="toc-example-school-data"><span class="toc-section-number">15.1</span> Example School Data</a></li>
<li><a href="#multi-level-models" id="toc-multi-level-models"><span class="toc-section-number">15.2</span> Multi-level models</a></li>
</ul></li>
<li><a href="#RI" id="toc-RI"><span class="toc-section-number">16</span> Random Intercept Models</a>
<ul>
<li><a href="#pooling" id="toc-pooling"><span class="toc-section-number">16.1</span> Pooling</a></li>
<li><a href="#mathri" id="toc-mathri"><span class="toc-section-number">16.2</span> Mathematical Models</a>
<ul>
<li><a href="#complete-pooling" id="toc-complete-pooling"><span class="toc-section-number">16.2.1</span> Complete Pooling</a></li>
<li><a href="#no-pooling" id="toc-no-pooling"><span class="toc-section-number">16.2.2</span> No Pooling</a></li>
<li><a href="#partial-pooling-ri" id="toc-partial-pooling-ri"><span class="toc-section-number">16.2.3</span> Partial Pooling (RI)</a></li>
</ul></li>
<li><a href="#components-of-variance-1" id="toc-components-of-variance-1"><span class="toc-section-number">16.3</span> Components of Variance</a></li>
<li><a href="#fitri" id="toc-fitri"><span class="toc-section-number">16.4</span> Fitting models in R</a>
<ul>
<li><a href="#comparison-of-estimates" id="toc-comparison-of-estimates"><span class="toc-section-number">16.4.1</span> Comparison of estimates</a></li>
</ul></li>
<li><a href="#estimation-methods" id="toc-estimation-methods"><span class="toc-section-number">16.5</span> Estimation Methods</a></li>
<li><a href="#including-covariates" id="toc-including-covariates"><span class="toc-section-number">16.6</span> Including Covariates</a></li>
<li><a href="#more-random-effects" id="toc-more-random-effects"><span class="toc-section-number">16.7</span> More Random Effects</a></li>
<li><a href="#centering-terms" id="toc-centering-terms"><span class="toc-section-number">16.8</span> Centering terms</a>
<ul>
<li><a href="#a-generic-dplyr-approach-to-centering." id="toc-a-generic-dplyr-approach-to-centering."><span class="toc-section-number">16.8.1</span> A generic <code>dplyr</code> approach to centering.</a></li>
</ul></li>
<li><a href="#specifying-correlation-structures" id="toc-specifying-correlation-structures"><span class="toc-section-number">16.9</span> Specifying Correlation Structures</a>
<ul>
<li><a href="#changing-covariance-structures-in-r" id="toc-changing-covariance-structures-in-r"><span class="toc-section-number">16.9.1</span> Changing covariance structures in R</a></li>
</ul></li>
<li><a href="#additional-references" id="toc-additional-references"><span class="toc-section-number">16.10</span> Additional References</a>
<ul>
<li><a href="#lecture-notes-from-other-classes-found-on-the-interwebs" id="toc-lecture-notes-from-other-classes-found-on-the-interwebs"><span class="toc-section-number">16.10.1</span> Lecture notes from other classes found on the interwebs</a></li>
<li><a href="#package-vignettes" id="toc-package-vignettes"><span class="toc-section-number">16.10.2</span> Package Vignettes</a></li>
</ul></li>
</ul></li>
<li><a href="#part-other-topics" id="toc-part-other-topics">(PART) Other Topics</a></li>
<li><a href="#mda" id="toc-mda"><span class="toc-section-number">17</span> Missing Data</a>
<ul>
<li><a href="#identifying-missing-data" id="toc-identifying-missing-data"><span class="toc-section-number">17.1</span> Identifying missing data</a>
<ul>
<li><a href="#visualize-missing-patterns" id="toc-visualize-missing-patterns"><span class="toc-section-number">17.1.1</span> Visualize missing patterns</a></li>
</ul></li>
<li><a href="#effects-of-nonresponse" id="toc-effects-of-nonresponse"><span class="toc-section-number">17.2</span> Effects of Nonresponse</a></li>
<li><a href="#missing-data-mechanisms" id="toc-missing-data-mechanisms"><span class="toc-section-number">17.3</span> Missing Data Mechanisms</a>
<ul>
<li><a href="#demonstration-via-simulation" id="toc-demonstration-via-simulation"><span class="toc-section-number">17.3.1</span> Demonstration via Simulation</a></li>
</ul></li>
<li><a href="#general-strategies" id="toc-general-strategies"><span class="toc-section-number">17.4</span> General strategies</a>
<ul>
<li><a href="#complete-cases-analysis" id="toc-complete-cases-analysis"><span class="toc-section-number">17.4.1</span> Complete cases analysis</a></li>
<li><a href="#available-case-analysis" id="toc-available-case-analysis"><span class="toc-section-number">17.4.2</span> Available-case analysis</a></li>
<li><a href="#imputation" id="toc-imputation"><span class="toc-section-number">17.4.3</span> Imputation</a></li>
</ul></li>
<li><a href="#imputation-methods" id="toc-imputation-methods"><span class="toc-section-number">17.5</span> Imputation Methods</a></li>
<li><a href="#multiple-imputation-mi" id="toc-multiple-imputation-mi"><span class="toc-section-number">17.6</span> Multiple Imputation (MI)</a>
<ul>
<li><a href="#goals" id="toc-goals"><span class="toc-section-number">17.6.1</span> Goals</a></li>
<li><a href="#technique" id="toc-technique"><span class="toc-section-number">17.6.2</span> Technique</a></li>
<li><a href="#mi-as-a-paradigm" id="toc-mi-as-a-paradigm"><span class="toc-section-number">17.6.3</span> MI as a paradigm</a></li>
<li><a href="#inference-on-mi" id="toc-inference-on-mi"><span class="toc-section-number">17.6.4</span> Inference on MI</a></li>
</ul></li>
<li><a href="#multiple-imputation-using-chained-equations-mice" id="toc-multiple-imputation-using-chained-equations-mice"><span class="toc-section-number">17.7</span> Multiple Imputation using Chained Equations (MICE)</a>
<ul>
<li><a href="#overview" id="toc-overview"><span class="toc-section-number">17.7.1</span> Overview</a></li>
<li><a href="#process-algorithm" id="toc-process-algorithm"><span class="toc-section-number">17.7.2</span> Process / Algorithm</a></li>
<li><a href="#convergence" id="toc-convergence"><span class="toc-section-number">17.7.3</span> Convergence</a></li>
<li><a href="#imputation-methods-1" id="toc-imputation-methods-1"><span class="toc-section-number">17.7.4</span> Imputation Methods</a></li>
</ul></li>
<li><a href="#diagnostics" id="toc-diagnostics"><span class="toc-section-number">17.8</span> Diagnostics</a></li>
<li><a href="#example-prescribed-amount-of-missing." id="toc-example-prescribed-amount-of-missing."><span class="toc-section-number">17.9</span> Example: Prescribed amount of missing.</a>
<ul>
<li><a href="#multiply-impute-the-missing-data-using-mice" id="toc-multiply-impute-the-missing-data-using-mice"><span class="toc-section-number">17.9.1</span> Multiply impute the missing data using <code>mice()</code></a></li>
<li><a href="#check-the-imputation-method-used-on-each-variable." id="toc-check-the-imputation-method-used-on-each-variable."><span class="toc-section-number">17.9.2</span> Check the imputation method used on each variable.</a></li>
<li><a href="#check-convergence" id="toc-check-convergence"><span class="toc-section-number">17.9.3</span> Check Convergence</a></li>
<li><a href="#look-at-the-values-generated-for-imputation" id="toc-look-at-the-values-generated-for-imputation"><span class="toc-section-number">17.9.4</span> Look at the values generated for imputation</a></li>
<li><a href="#create-a-complete-data-set-by-filling-in-the-missing-data-using-the-imputations" id="toc-create-a-complete-data-set-by-filling-in-the-missing-data-using-the-imputations"><span class="toc-section-number">17.9.5</span> Create a complete data set by filling in the missing data using the imputations</a></li>
<li><a href="#visualize-imputations" id="toc-visualize-imputations"><span class="toc-section-number">17.9.6</span> Visualize Imputations</a></li>
<li><a href="#calculating-bias" id="toc-calculating-bias"><span class="toc-section-number">17.9.7</span> Calculating bias</a></li>
</ul></li>
<li><a href="#final-thoughts" id="toc-final-thoughts"><span class="toc-section-number">17.10</span> Final thoughts</a></li>
<li><a href="#additional-references-1" id="toc-additional-references-1"><span class="toc-section-number">17.11</span> Additional References</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="preface" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Preface<a href="#preface" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAADAFBMVEX////iu8jQkKPBb4ivR2WbIkCQACcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACfk036AAAAAXRSTlMAQObYZgAAIKtJREFUeNrsfdty40qubCZQ+v8PFgt5HoC6kKJst+3uPSdiaSZW2G1bIli4JhIg8N/rv9d/r/9e/71OL/JffIr9/fe1tn3914TyvyRHg8aBONfXD8b/Byey6ZDBxzs74fUDtv1I7H9WEG/jKmkYV09b5+7cPrA1/s/aCMe1Wd5+AGgAYAYgD2mcTjP8rwpCDkloGJLUdTsAy3PhkON/TBCz3URSkjIWs/n+dNA399Js/2z+gpb9XJBm+1uxcbnCxqFIsPklreSYzsEev6AXP3a/TkvvWldKE+eb+rrpvm66fPyC0kcA0k+vo/3UMAA4u9b9ZdNnSmDbH9MNv2EuPz5UDt2Y10L76meSYGnZ/5EgS3mGM/XvZFSkPYiTIO7/VLXo1uN0BX7NogQJOh1d/u/200kBgPm3U5jvCSKwRdd+KzdbliRA93pIkG9Oj27/2tgJwKzHy8VKCuiDG4CU3q7CUK+H+s+8llvX/tmKj4Q4ydNBcr9wmvPHTudbWXpd0vz7UPxxLKC9HkIc/yAgvnpYjrPob8VIHbo3C0W8/CRmLqC/JQibl+qcQ0X0rlfH6nUhDwsAjboPlZLOapFpgjX/s2jf/tBXKS63/uUfSIbc4vU6aDgA2vkPpLi6q++4rz81drrHdv+vYtBIBCCsX9LSTLMALECPPV7o4BZQhxj6e4KkaZvNi3ixDBOsd0DgUJLSMIHo7hIl0ASz/YYc4/K/m9J/y/3asI1djKYO9JnmunhcpOSh5gcFGAI09cupnNOuv3kip2+266QAmgKAxExQTlKW4oSMEGAzfXHFesOfxJLvJgXqT23ejICQSqG6aA1bNuYRGIAj3dfysbZ75jj6zV37WjrqX/G6I9dbXjd6rJDc1AUyzCPtRKAzKhDIjGZdSH9q6HALgSaxHUJrK2Io1mX38fZfSiTbl07NFdqSWfU41exp8vF8tEMQLKCwEXP0NOJQ/VZ3AZZJl9C6QINa9KlfI5EXCKN91Vi+EhBJ0MxsnMgycqMQ4QyAJsFMoCMAhab2K0OKxjd0dYAOUwCNzxBWVFRU3mKeaeTJJ/wsshdUUIBJ7ytr5FImE0RjID7UBKkkozM6wJaFC5eCpZWt/Pj3BDn90hHrn+uanZGpkfClukgCQI8OwC1oAh5b0RUnH6T4Nfe7Jeu707XKQhTGVI0XLeCIC68Ji54ZxnUkwNrD2nMG2i0s6tfiiLZkfY8O4Q9AXejWni+5VapGBhWKCPF8UYkF4YA66Oogl3Ydjb8vyHqrfrrjnQaQz7zd2+cZJVp1E/JnQ+N10b4OjwAcMrMQOH3dAP6+mAR/FGzm/Rl1VL/TnHYEeBLDhk1fS3pl7qXTxZn3sBawUIf7SkNLkqy0CPJDq28fBUIIkqDSrRc58m7vQAMNoCCCQunWOZORQHD7o5DY0F1HCeWlviOiMNGKj+X4SJBMLpaNDHe1p61G7lYz4hfT+LkBDoDNMxYNmKWxoK4tttumdieUPL5rI+MteZID3PCTTY4E7VLLJQLBs3r3VfNKBEwcnrVPoS3U5yn2k+P/GBNoX/NWwMpKwlZ11XfL0LDrvKoNRtUIDGU5BKj6/3h/I5SOHG51106S6PsBcSvNd/tgdJqfDTwr9OWdwHEPWZYk5ddE4XcSsBJ3hbXI2OSrftSW+vYfRHa/ylGdg4gw46ZrpmWXE0nktJNxOeuMB3yvFdBlRGOHuw6Md1zZ8MeZzyeCDNhpJKeeXWeDEDNzoDsxW2554y+uajnyIaZt0FI1WBB0HLKmA8AAYUYKif4D1Zrp7rE+VOWU5qW6QREzwRUhycyM5TjH+dCWhCsjJDRvvyJgDZkFjU59+c7PcmD/wo819UrhBgG+AkfeubowScw4KOlkomRWICVS1sYzi1mGwAeeympuwhZeWnnS2y9Fdl/+ngCqqDU/BDb2jlYKO1kNEjLKwRmRqjS8Aes/2tNIbWAcIQ7VoaGnPIdGZLQ2f/U+Lr8VpNld3k6zlGTBs87lVCUgtQdCpBfmSFM2VeRm9NoTzM0IrOGIZVnn7s9TXxbkhC1tqLJ5j3n4gHN3QwGr+DAMZY8juwfg8FnaHBg3EDzlANBKuMce0PofJI3bLdDzJGF0kEOvKrOtQslsxr0gWHgQ3yFKrx2uzU5SDmt11XzcFkSfR/ZYghzjY9PInCMvKkMaaa4zbTyhUQBsWg2TYSfj8rmU6jVAqJdr94kpdf8sUWlvUKvxh3W265ZMt7mwhYwFlEQEyBhFFU09KnVdGnbK+sWbeqPPRC720ufDzPFNrjWOZHhedR9BUTNdxwAV3Zj2nZngyNVnhniT/c/78UGcc4hkHkG3T8LiG0FGMj0Nq8vOxZMEIah0cuV+JbMQhysGjtXIJYcL1XTNH2KIzTYMonTkPRDx9q0eXB6LVPZxN6RLGy+u4SgPIDjEACgC1iOzFp4sXeeK8k12lGiRzhfU+x8KQrhND8FGPAX6OFj3hB2H06JXFemHmmgRhgAMx+v7zhy47P/dlVm7dBMzLKoilj5RrYxowzrLQ1hH8wM6ZiIXL76B7BmToaBgAYey2q3IjZM25YFmSXxvpde4F7EAb+310b0gfrq+ygoPdXJaTKZ43IJCqJv3Ujay0uWSIxtY1Cum8XH1+qKA3baDffHZ7Ubsixc0tkNuC1LDSgk3CIIi6UdSGwyBvX2wX9IpV7kDmtPRmdkpGO/B5CYXvnqtvpLL4SEO84c6wPrjm9CaCsQFS4aM1Iz03DJHboJEv2p23gHrF8z/XJrceeH2EgrbtbRUj0aryy/dW460FCTxn7zWDgQ8UYhz1LiGkpd+sCkyAbhDkTUTjptq8SWOxDjAzWXr6f5Iz2cWI7sSt4CgdS4RfoU7dYMI83qpBgkio956NYqHJo0juSuyXgNir98eFuJQV492LnrnXd3b/QpJZINOPMeqdlmqNZStX4WTPFh3Z3aOMzlKhRhHchfeb+JI/mkZWjNxw7R8Az9PN5oe3aIwQYmSQacgwevRnK7GrIOADEGKqswEfCC66BmS8tJuo2J7lzFGeaynaN5mkRgbRrqnLEGRbdzugVi9ve5XXxUUEcYO71vAM/QO6GgWM3PS13Itbh6ePAT1ePhRxqI310E4JkicOiXKzgkj3/W6jZFJKAlTGDSKKpY9lK51y8QidBWnnT+IHMDJbqbqo0N7e0lGgtmtkmdhyIzZDb1z977DYMDnWa+YOKuCTDspykTY2Wso386Sp6dbQZyvsF4RYILDf+y2WeWEQGB0fVnlbxUhe7t5hdFLKKT1TI1lKjfBq7+La8lHnrld7RYgnTUE26HZZHPTLEk1q1Oh9yIDVf5kAhCgIY5bjb6ED4uKmVKWZamhtACkUbenToTjPrxv/77fvFlQmientIDsHhFarw0OFmgO2Yab6kvdJnomwwNCkmV2MFk5xT9t0o6+Xqv33UaO9tKK6HD3gcDEBz5HtImD6F0iNQcAdvDH0kWoEPpukFHT82VLfqN5zGs8p0rtNtEq4S3Uw+tDq3lzIsbWHSODGCekVf1RXPzkyjwKjJx9T0PILJRqS7jJ2ASDK6/VjVi9IN3LcRZk9lJjGCFMw6Da3n/a2p8aeSKwUZT1LnJeiiImVwKUaAnzrsyHfuR5d5vqMIrw48N6RMdj+2Dr4IAtC0DTm9C2E18n3nrJ9t80XANevJNxqlM1rSBSIXx1ri99p/uAqGfj0iyCq+VyfHZFN3XFa5n7Cvcn/4OJw8w4lwANvQ8HaWGJuITjNf+/SeM1BYHYVsuSpwiyY9IgrL9WTWJ59DHucnMr2CgKBmhDTHOkzLQTOeVewS3DlMdHkR1m3KDyJ432yLCzgZY40S5fMvQYhapOv3EHYNERJCuaMj33sK1UMgqAmW080BTEL7zQU0A0np2vOmhOCrDYuEo6NQpm5K/obTMa76nWjbWYJbUDAZG0TAvQmZyvxTFw7ldd1k732Hgja3JwBfaMNMVRBL7AiCYFtOiECwPjZvAjYg/dxEF9pBNKtDLrllEj6ygu57qSXTlWSt+2CH7OT+hAKL7GBdEqOKrtTG5n86Z1QYVEkAZF9SWqM9GrKTc1hKTxqekIrmVsO7EMdi3QQTN4ng93l6MXn7vpkNZwBVf1SF5shI3JjDejpIhEZ4ISrEqT5cPOtruRlY5XG9kkGb+PTjKvcQZKLjPR6qQxtqEYLhNfLcIrEmdEdAwqB2FAFJQMwUhlqm7ehfSe8YIA3Ge/Xe3FLlXVKic1szDPAE+tGSa0oQVfkxDf98aDTFy4xhUUVbdQxRLYuto6Tnme7npXbQcpG2+SbOguGpof5zqW0UudMpfaSBC3RnVYYj/GM6dhoH179oPIkBSnhOdcurfXVEt7/o8W/R4rb0+eG2lk32gnpLQTMK4NHdIUaeXJaS5iAS9EL23NQK8ES3yF785J4/OxzdFlxaEYbbZxkyiZiXTjMbEH2SgjtbMduDJfO6PrjYJR4RR5SiovIguzTJ8gyE2n5BLZd1vnQuSNJ58USIYyqrabP6kyb2QvVHArVvfrTdgoKtGdSRZxGqXTkNKiC4iWWKoI2KPrXWFltgkSkVCEAODYw7gZ1BOzjjD2S4lCaiYZWh1pQvCl/Bn98qK2om86bImVtXgXWHXYsSci7aRd7SrGbcNYZyiuZl0AM5DHKUQFqByrqJNc/duAByzP1KqwlC6NWgrUQRDHdoNCNzX/SZS2EoZ7BDBZVVtBlDc8OSgW4eaxDU8ULmwhkUWUNRxJ7IjiSJCmTlCZm59sJ8rubaCr6QgT1rLLFbLNdKtdxThXC47nxBZKlDBLEIpgHBTJE+BVKAqpovrZgYaD3mVZ5loUUk2Rdju7yGkqafp6h15Ph9M+SAR9YARbG4xQGGk0saCPfkX90mflwYkWaDogeAS9i+ktLAAGFLTLBGNwZTxWBVHnmxR6Mqp96CB58mts7uxrTKR+0VtGOrPECykrJShcwiYEahBJt7DWe2LtWUNB1ZEoP6urccJUyAVtuiZz95mEzmxqTc60aU3XETou3MgpmuWoBLISIqBDhI35iVMqFUUXCCCczxzPUM8mvJI4ywmLdF7IyZGmxWrfz54u7Yw97wR33zA528uq0CpQHDSU6kMw9cCgnrDICRwsFDKhX5C0iIaeFHNCoglGgcoj5UJm/IJqZ4M+ahEDH3H0CObMULXN+hukceC0Mbs24zCLgBYhWdHfSgQ3VpaFSbUpOIcAO1r00QU2SnAGTbCZJFbpkuFp8zIRCs3qofojYbNUQpwBIT+7PjsBilEe6JGTNQFrNciSNV1OQFMCmbTL0WIUaETAe3Y0pgmGJxjHnUtnBBiLq9p8oH2stGuafx68v/YR/exueUFGB32sEqZG9ByTNgdIHAJBNzPSSTKZh2akoZsfsDIXM8kFhJngVH0LF8tehHAT6MaQRlaRd2BMIJeiOV6GkndBavdPea06xMwjjCi2cTL+rDyQxtKAIxQRCEEdSv6G2QFHdRtiNBuClMyCFAnKQMjqxNxp7J0LeKisIiFs222EJ7NqOxhwjeiAZL1SchjVW/UMauIw2+mJGlcPJlKT2dH0pEvsMENXInFUdFrAmI7LKmceg5hkz4EZBiufTCi7SbjWy759306clTc9DKl6/xSNEaANPDPkFEKOgKy8l0DA1ckgQDqII7tRaHYIj3mSa0dKwqOiCAtAGMSqIuH7DcHAbG/Tln2tVsfqvoDZSnPBDDJTpLelWfHck0vK5HOtqp0tG/aS0SVa5ImM3tgYZNcYXioO4IWDztl+UmiG5y2CTktpE9O4UuhaB5BTmeYWZQ7pf9RhrFyFVCAQzOyqsiP14HBXSZ1d+fvGnODk4THdYpa6SfOM7FffZOBvu7rqL2lCbyZwdCFoMtQESx+wf2UcCARa720bqqq+Q9oTq4mjUf6ppjNE1b8O7ZrDtC8e9Q2GMY2kTVbQFKWadU+3URhrzkSDUFR91wOAJwvGO9ldo8tDwbLWgAwK3yjLHF1ICyAYhecJ3Jl/O5isd02MPUVpG8HpfCo6Tq3VyCCnI9uvmXAx0VpZhJm0p+Sq0mVUyrJFlR3d7JGh8UKCOhda+vQ0rnBQifI6AKjnUBomd9GMOEQ3QJ0iIgkvFEQx2VtVgslEYlEWiu1PrLEH8cVhjrYi7raUEK9E5namnb3ZqKYtZ7EId0BKDxGALMx6mIlhYwiHvSp2QhGidb8irjJQPbOwRZm7TmbeUO/4KYXj3dIbL42nBDPkQVhWsjwMalQXqLYP3A4dNwVan6gE54hoCO7JFOyZPuqDOZHGffFSMQDucy2/gxoLmMgMtbnlQAsHNpJ5bCL/DFst3UhGCEy5uoMsThly2U7eeMviY4xLD1CjRqndt4LDK7bNDOUtHOR+abLZHK8b8DJzoEKrgVF0N894Fj665tRkj3Xy1FtOnRvxcbaqJdYvWks4wxxrA0b48F/jAttekGyOagb3uYNtbZA0WgVCaXTBIiLjW+yErI2IJvMkfLnUPFczzmG5BBo1+2S64IS1p3JrPz2PfjGRfa5knciiPXDDc2c8LGfbi8kLRQCWlZ4G3jyg45F7B01PY2frMhwwQ6U+2rq3EmXa++vpMU6jXFto513W2LbGy0UQHXMeUB2iMQG/RN1I10Yb4NbpVVGtGRrbHUJEEKY+gV5VF0F1X6gtIuf4huKzpv4ie7cbf3Uz+SeXujPCXAMSGOlXDehWUZWpRhBQmB1qOPxxxCO6eXR7RMxpEkEaO3qG/8jx2TL7pBi/4lRbvHhJ43vQZsp51/6kQT0UNUcZNFufMmsHVaNmCMQkaViW35wdsI0rlTV7ZY+UvACVpain1t4273TqT7elgcGxLoc3Ex+EBJOObMYqZAk/J1QtWuccU6q7FiZFJvCiBFMfmRwEobxwsWyqmdZKFwzEaMU6n5eZJqm/j+xSpA+x145ZNCgdTXL+yIOdlqgPGnKOiCPxqBxxb4NrH30nKESmMxz3vhTKaGFAxCROEdp2WdlLnnVxv2nVcZ8CSCBCRktswcgx0DpcLmNgHz3IbaAeW5I+gawQEwKYFnlkjI8jYDATQt4GwLtI0ZcJ2dvIPlzz3Y4bY851ZWVFQLknhZFpPcmA6Mr1KHPmYmOb29wVM3l/VsJyFgwmyKJn37C8a0MHmvby0K5O4CLIqNxL0XlqAnYN5iWKVEYSCENkVFPtq0nKhWWrp7OoZggZA1ZVMqs4SM5kr5FlkEkuj0WzI0MQfU4/Zrfvw6SxvrU+ESEV9TakDPA7q2yMuCSL0NFzAjcic5jB4OTGDcwMZqpjpexJuLUQzHrPHR6TLZgNlJ5p4gz1HyWNk+VRuiUp0OYAZTnhKpoCJkimIJXliERDwiw1xsOZH0iEQXTPInO0Si3RSkvaTs4rJB4Ln1Py5eO1Aw+0t4Lwsh5GSrC2j5xzVCA115bts2z5U0wBpB4EGbWsgoshY5B5YYVrNpyE+lAus7kxyQZEz4dvYMCahDiHu3Yvx2CS5bB0idaUbZ59pUwaswtd6sU/yaVmNoLa8EuM2q+wsOkxOB1SH9TjnByhc2CedphxTszaXX5yFsReiYlz+jeVFNnbG+ww7dtibfSoYKNUTawaXk0DJQNJnNROmz1B9eokIECXkvZU/PwebrAkoe/T0Hhbs68sZZh7ypE96OR3cqjFdXR1K/zqAyMT9byNNk6GA0chLcLKJ6DZ6JXZhXNnj8ATnvRMn9Cn3kZ2QTHWG5RuqUeCwqFF57bqzKYJ2wYGVkoegiFM1fMULfMQGsbkERE0AhHmpHX4qP5YF+IjLYhuBg1DZTJM9UnNXtB5YxHTD5UYNb1lkZBHgThiEZwG9kkOlQt1I3q2bnvCYWYKZYJZfZUA1BOmP6r+rd1aOmZ+0wOtRd5Lf0crvEXzct12dRcadYTKb1hdcm3S8ES3JEQPMdf4CoKJDXLBTWT2qQQ4KzurHmWIrVpcgW19KxVDc9gscnCgDxfwGtXftKfTJrPSd4swi+olqY/VRoJBNCnc0NVHeTFDpNF65AYHS90Y4K8v3CddcuMxl1hxJfAzM2oHdJTzGcss9YUTmV4410d2Oq2mV1Gt34EhRGRAczNrFgGz6uFU67c6Q8XkoCMmgY0Z0SILq8bMu6UQN6aXoct8GNAg8pFfGN+bEad6nmxx2BjdQrYKZmlbuDxJ4EATzSJ3l9n0GpEtwg0jRHVHi0AoWMRsvgBgj+m5spFh3k/B0F4LDb9XrJWnPHhAwli7yBoQ0c7LRggdbuXBgk21uAVl2OkCHMkeJ0tJgo25UCGqsR0hGBen392iR7UTt6j+6WToNnWcYqfVNcvJbvRg8ML4TQTLti6quherAOp7VWJFcK5Bq7R9E2zYnif+NxJCPcl2RDedIzb9+ESQfS2qB+YiTh14aKB/g5gsbqXnsYEDQ+92hu6IctEI6gk0yyURszynQPgGUHtIorVMYE5rn0vZ3gpiG1e3YsnabzdAokzpK5SzsnFyproHXzGPTRUOmB8gDpNb76AzAoZQRyOiTz6W+1PQUQsBbNEkboaeXsbAB2uVrCNBiy5xLhZR2MwaJ9NRA/ycHCsuahwvFbMi4K4jzBHMEdxKs7gjPBAfvQ+KK71Kky/uRdGkQwL0XlgPT8LavvFhkUwnnpvb12Rb5ZWixwFrjOIyAsHHGFLTWNllc4iXXc3H2Db87bAAPuzTNY56UnQ/bVNmG7jVTB9JMyNzJ3ayHyIAI7osSCgSDTKQNJdRxacd4yNBNwT33d9CwCr6VZh+uzL3nSBjQ3VKcpnMGgmEtHgeUkREJEvFCCpZkl2Q12oDgpm6BzxXXhhy4kXFc6PxzOeVKraMWPhOEL6fJbihO88pZh9s1jMDnYO5krFcBA8RLd+HDz3ZMuctGgRXj6284Msm/1TiCbG/2/T/hgo4XfZpBIiNOfyrngS3M1238OdE6EZR4ipkJ63PoJwL23eEbY7t9Tp1pgi8W/D/5kQed5MNbOwxEHqz2bXeiZmpP70oMFBUrmomwUL+4lm0O7c393uvwt/8yv2JbGFxRR4+0DuKxFarVsjtIJJ7OsSAtYjB4CeC9TAoDay+EuYq7GF+vmu2sQP3MP3mSG4FOW1HGZxeawispYbqSXkTDRFD1wnOEUGrzic5J5QH9sgZ0FZPRP00peG2phjOdMv2/LIgdpraSf/HhiOsIfrIqrKNo0LW0+0altcJ0nMX6GlJDWeyMEC6qpzfbmI0z34732aM72yEZy+c6x9cUVfxmNCKFwzFjafb99mM2DCTEydiNisGr8UYVwc55r/TQJ4fk2o+WS7/uNnD92Afp85G9ODu6vYwQE/wcWD5mfNbzVbsDG7a6HcY+73j6T9ZAWq+MQln07T3YuZVS9nSNskrIxJy47YIdPRCRkFLwijSlmHNwuelScufbM50noiBlcUfaLNkTC5vLf6Ml1xoa9QmjMgTKsty1zvhxE+3bbWg+TFh6+Ptsu1CcQTcQ81t0+dBHq9a6SpJEfoMMKPNhz9xEmxpZ3XkSQH2Vnp8W5Cdcle9waZudkTQm29T/JyLQF+ToeptQZqT5Nl7HOMIk6ef7Oy+0Ud3piW/L8gpDg02h1oE2Ax90sCVdNeCpC8aoIhKZkaRWF+VJOs4zI2Caa3gPTNGP9StD7eUP07fjm01LQ48EqR/bA+9MBTk2uP2aLXAiqpSBn+iqlHhQeCgYqy7Sznmg5U+fDLURyfiqRERSSgesJiHzFVZcGyUWvLd9q8xh1sV5FwNN3drj8fXdrqN8auSQz1U7O/4lJz55tXPz51rR1R4nFMS29oPSZb9Eb/x+Im7FyQmEti35rTk74bp6T4qq7ltfYJ6+uaJrM0yowE5M6QE6+kIeFvcR6naZ7fvlkMXtfZT+3ZzY2Szs4XGT5a/+tJDIr722A5fGcj+RbMQGruZduF1L0ntHlbE3ttwM0aYwyXIJr9zMar1i4K8lDVygM105OrcUzTW+0+Wro+Ea9Z70j1Tb32s1bI7VuNPBdnc8LjZcmuMnlztDPRf++gzp8RrdlnGXgTCNPO9Dfil1QB/KsikEobUAzAP5VyjNYhffggT01G14TXkVBtuyc8M9y8J0r70oROa46IS1mNdcBT/sI1K5vO1LqThSCBzroOJ0UOc8x/HgL+/9PinLwmSmxdjpHwLNEucidZhdjRAhzUJx0c3JTf1q7YVTFy/D+OxLfUJGGuo6zdUyxk9Q9fgc/m+XKAxZN4zYHJ7gIQPSgBya4Nb8GEByyen0mJA/m5z5LqddyMqJPyWjUyq2lp5NkfUJGN0az2JQTtd0l0CWpO5YLQcSWc9/4WCMQRzcD271bYF6ZO/+WsPG7pbyD2e4godANuqi6QrghF4tGdnihiWqf1gRHa5rYTrhDL82XPfvv/w073IXs8mWWHYejXITosaav9a5Gy/BWLOlN49QfRvC5JN9fmU4NpNzr1tZTzKSpnrj8b8NafOx05dnmLETvL+S4KsZ1+MiaZYEE70PSjSZ7+m7czKogd74LySfj1UN4Lm/+JETk+lNFtD/h0b0cUUa/LOj83SrENrOv5VqQj1SGhef+9E1F+eu3V6HuqEV+3A2MkUvfrkxeOlcJzXNJ5sI4vHoP9F1dKxHjmzJy0eLyBhboPNlmSMZeAZr0+E9/kovNfP+rPn6n7TT0x3P1sbcZOZDHQ0pyl4Qw5fUsxbc8Q/9Frz0/uIFnRId1NFc4zvZTfa6Sx0oP3o4dM/EUTRd+CeNIS+9BztyxO0U8yn//s4svztC47vHzyefQClvN2RjR7f8bs/FWS43fUkFW65MvSycJ9YnHK8WEbRqOLbz5pv3xWjzzp8eKP2kvpv+O+bQz1O1G9Ah+mfCtIvGaUOUfxjxyjEcYkX8c0TMfzwVb3YnR3y2RPnY9/vXzso9NPr+LEgANAPbfey3z9FR9uvx1Zx6OhffgzlXz6RZ98Lod6X4m27epZ40gh64y+OX7iZ/tM34KKp2HzUyeA29fl0Bawvu0bDZ3aL4ucn8mNBNuukza0MNi55tKh6jO10WbmK3PumP5bjd2xkiVTI/5hQmv5NfXxfx6Aev3H5f0eQ1cFQYBxO3vY+lWpu9On6TTl+QbVOYXKr6CfJMZdkDsh4873/w4Ls0MT2iLgNsbP+q5f/lwQ54bXbw8P2U/hLcvyTF4n/Xv+9/nv99/ql1/8bAJquka2Xe0B4AAAAAElFTkSuQmCC" alt="logo" style="position:absolute; top:0; right:0; padding:10px;width: 10%"/>
<p>This document is a set of course notes for several Applied Statistics courses at California State University, Chico. This is not a textbook replacement, and topics covered will vary depending on the instructor. To make this clear we use the term <em>notebook</em> to refer to this document so as not to be confused with a traditional textbook.</p>
<p>Some data and examples in this notebook are drawn from <em><a href="https://www.crcpress.com/Practical-Multivariate-Analysis/Afifi-May-Donatello-Clark/p/book/9781138702226">Practical Multivariate Analysis, 6tth ed, Afifi, May, Donatello, Clark</a></em> and used with permission by the authors.</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
<p><img src="images/rmarkdown.png" height="120px" width="110px" /><img src="images/bookdown.png" height="120px" width="100px" /><img src="images/rstudio.png" height="120px" width="110px" /><img src="images/github.png" height="120px" width="120px" />
<img src="images/ggplot2.png" height="120px" width="110px" /><img src="images/magrittr.png" height="120px" width="110px" /></p>
<!--chapter:end:index.Rmd-->
</div>
<div id="part-preparing-data-for-analysis" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART) Preparing Data for Analysis<a href="#part-preparing-data-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="data_prep" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Workflow and Data Cleaning<a href="#data_prep" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Once the data are available from a study there are still a number of steps that must be undertaken to get them into shape for analysis.</p>
<p>One of the most misunderstood parts of the analysis process is the data preparation stage. To say that 70% of any analysis is spent on the data management stage is not an understatement.</p>
<p>This chapter provides information on topics related to data processing and corresponds to :book: PMA6 Chapter 3.</p>
<div id="generating-a-reproducible-workflows" class="section level2 hasAnchor" number="1.1">
<h2 class="hasAnchor"><span class="header-section-number">1.1</span> Generating a reproducible workflows<a href="#generating-a-reproducible-workflows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Reproducibility is the ability for any researcher to take the same data set and run the same
set of software program instructions as another researcher and achieve the same results.</p>
<p>The goal is to create an exact record of what was done to a data set to produce a specific result. To achieve
reproducibility, we believe that three things must be present:</p>
<ol style="list-style-type: decimal">
<li>The un-processed data are connected directly to software code file(s) that perform data preparation techniques.</li>
<li>The processed data are connected directly to other software code file(s) that perform the analyses.</li>
<li>All data and code files are self-contained such that they could be given to another researcher to execute the code commands on a separate computer and achieve the same results as the original author.</li>
</ol>
<div class="figure">
<img src="images/Afifi_Fig3_1.png" alt="" />
<p class="caption">PrepareData</p>
</div>
<p><img src="images/q.png" alt="q" /> Why do we need a codebook?</p>
<ul>
<li>You are your own collaborator 6 months from now. Make sure you will be able to understand what you were doing.</li>
<li>Investing the time to do things clearly and in a reproducible manner will make your future self happy.</li>
<li>Comment your code with explanations and instructions.
<ul>
<li>How did you get from point A to B?</li>
<li>Why did you recode this variable in this manner?</li>
</ul></li>
<li>We need to record those steps (not just for posterity).</li>
<li>This means your code must be saved in a script file.
<ul>
<li>Include sufficient notes to yourself describing what you are doing and why.</li>
<li>For R, this can be in a <code>.R</code> or <code>.RMD</code> file. I always prefer the latter.</li>
<li>For SPSS you can specify to <code>paste the syntax</code> and copy into a <code>.sps</code> script file.</li>
<li>For SAS you’ll use a <code>.sas</code> file</li>
<li>For STATA this will be a <code>.do</code> file</li>
</ul></li>
</ul>
<div class="figure">
<img src="images/pipeline.PNG" alt="" />
<p class="caption">Repro</p>
</div>
<p>Figure Credits: <a href="http://www.biostat.jhsph.edu/~rpeng/">Roger Peng</a></p>
<div id="literate-programming" class="section level3 hasAnchor" number="1.1.1">
<h3 class="hasAnchor"><span class="header-section-number">1.1.1</span> Literate programming<a href="#literate-programming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Programming paradigm introduced by Knuth (1984)</li>
<li>Explain the logic of the program or analysis process in a natural language,</li>
<li>Small code snippets included at each step act as a full set of instructions that can be executed to reproduce the result/analysis being discussed.</li>
</ul>
<p>Literate programming tools are integrated into most common statistical packages</p>
<ul>
<li>Markdown (R, Stata)</li>
<li><span class="math inline">\(\LaTeX\)</span> (R, SAS, Stata)</li>
</ul>
</div>
<div id="reproducible-research-literate-programming" class="section level3 hasAnchor" number="1.1.2">
<h3 class="hasAnchor"><span class="header-section-number">1.1.2</span> Reproducible Research + Literate Programming<a href="#reproducible-research-literate-programming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Practicing reproducible research techniques using literate programming tools allows such major updates to
be a simple matter of re-compiling all coded instructions using the updated data set.</p>
<p>The effort then is reduced to a careful review and update of any written results.</p>
<p>Using literate programming tools create formatted documents</p>
<ul>
<li>section headers</li>
<li>bold and italicized words</li>
<li>tables and graphics with built-in captions</li>
</ul>
<p>in a streamlined manner that is fully synchronized with the code itself.</p>
<p>The author writes the text explanations, interpretations, and code in the statistical software program itself, and the program will execute all commands and combine the text, code and output all together into a final dynamic document.</p>
<p><img src="images/q.png" alt="q" /> What stages of the pipeline shown above can we conduct using literate programming tools?</p>
</div>
</div>
<div id="import-data" class="section level2 hasAnchor" number="1.2">
<h2 class="hasAnchor"><span class="header-section-number">1.2</span> Import data<a href="#import-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section uses the raw <code>depression</code> data set from the Afifi et.al. textbook.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>depress <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://norcalbiostat.netlify.com/data/Depress.txt&quot;</span>, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)  </span></code></pre></div>
<p>SPSS syntax will look similar like this:</p>
<pre><code>GET DATA /TYPE=XLSX 
  /FILE=&#39;C:\path\to\file.xlsx&#39; 
  /SHEET=name &#39;Name-of-Sheet&#39; 
  /CELLRANGE=full
  /READNAMES=on
  /ASSUMEDSTRWIDTH=32767.
EXECUTE. 
DATASET NAME DataSetExcel WINDOW=FRONT.</code></pre>
<p>Reference on importing data into SPSS: <a href="https://libguides.library.kent.edu/SPSS/ImportData" class="uri">https://libguides.library.kent.edu/SPSS/ImportData</a>.</p>
<p>The absolute first thing you should do is to look at your raw data table. Are the column headers variable names? Did all the rows get read in? Are there any extra columns or rows included?</p>
<div id="renaming-variable-names-for-sanity-sake" class="section level3 hasAnchor" number="1.2.1">
<h3 class="hasAnchor"><span class="header-section-number">1.2.1</span> Renaming variable names for sanity sake<a href="#renaming-variable-names-for-sanity-sake" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Turn all variable names to lower case. This is especially frustrating for R and STATA users where syntax is case sensitive. <strong>This is completely optional but helpful</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(depress) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(depress))</span></code></pre></div>
<p>You should also rename any variable that has spaces or special characters in the name.</p>
</div>
</div>
<div id="data-management" class="section level2 hasAnchor" number="1.3">
<h2 class="hasAnchor"><span class="header-section-number">1.3</span> Data Management<a href="#data-management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Questions to ask yourself (and the data) while reviewing the codebook to choose variables to be used in an analysis.</p>
<ol style="list-style-type: decimal">
<li>Do you need to code out missing data?
<ul>
<li>Missing values sometimes are recorded as something like <em>MISSING</em> or <em>-99</em>?</li>
</ul></li>
<li>Do you need to make response codes more logical?
<ul>
<li>Some systems will record 1=YES and 2=NO. This should be changed to 0=NO.</li>
</ul></li>
<li>Do you need to recode numerical variables to categorical?
<ul>
<li>Sometimes categorical data will be recorded as 1, 2, 3 etc when those numbers represent named categories.</li>
</ul></li>
<li>Do you need to create secondary variables?
<ul>
<li>Such as an average across measures to create a score.</li>
</ul></li>
</ol>
<p>Some of these answers will come only after you look at your data. This can be looking at the raw data itself but also looking at tables and charts generated from the data. Often when you try to create a plot or table you will encounter an error or something odd looking that will be the notification that something has to be adjusted.</p>
<p>Let’s look at a few of the common data management processes.</p>
<div id="missing-data" class="section level3 hasAnchor" number="1.3.1">
<h3 class="hasAnchor"><span class="header-section-number">1.3.1</span> Missing data<a href="#missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Excel, missing data can show up as a blank cell. In SPSS it is represented as a <code>.</code> period. R displays missing data as <code>NA</code> values.</p>
<p>Missing Data in SPSS: <a href="https://stats.idre.ucla.edu/spss/modules/missing-data/" class="uri">https://stats.idre.ucla.edu/spss/modules/missing-data/</a></p>
<p>Why would data be missing? Other than the obvious data entry errors, tech glitches or just non-cooperative plants or people, sometimes values are out of range and you would rather delete them than change their value (data edit).</p>
<p>Lets look at the religion variable in the depression data set.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>relig, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    1    2    3    4    6 &lt;NA&gt; </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  155   51   30   56    2    0</span></span></code></pre></div>
<p>Looking at the codebook, there is no category <code>6</code> for religion. Let’s change all values to <code>NA</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>relig[depress<span class="sc">$</span>relig<span class="sc">==</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>This code says take all rows where <code>relig</code> is equal to 6, and change them to <code>NA</code>.</p>
<p>Confirm recode.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>relig, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    1    2    3    4 &lt;NA&gt; </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  155   51   30   56    2</span></span></code></pre></div>
<p>Notice the use of the <code>useNA="always"</code> argument. If we just looked at the base table without this argument, we would have never known there was missing data!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>relig)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   1   2   3   4 </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 155  51  30  56</span></span></code></pre></div>
<p>What about continuous variables? Well there happens to be no other missing data in this data set, so let’s make up a set of 7 data points stored in a variable named <code>y</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="cn">NA</span>, <span class="dv">6</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  1  2  3 NA  4 NA  6</span></span></code></pre></div>
<p>The #1 way to identify missing data in a continuous variable is by looking at the <code>summary()</code> values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] NA</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(y)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     1.0     2.0     3.0     3.2     4.0     6.0       2</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3.2</span></span></code></pre></div>
<p>In R, any arithmetic function (like addition, multiplication) on missing data results in a missing value. The <code>na.rm=TRUE</code> toggle tells R to calculate the <em>complete case</em> mean. This is a biased measure of the mean, but missing data is a topic worthy of it’s own course.</p>
</div>
<div id="identifying-variable-types" class="section level3 hasAnchor" number="1.3.2">
<h3 class="hasAnchor"><span class="header-section-number">1.3.2</span> Identifying Variable Types<a href="#identifying-variable-types" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>str</code> function is short for <em>structure</em>. This shows you the variable names, what data types R thinks each variable are, and some of the raw data. You can also use the <code>view()</code> function to open the data as a similar spreadsheet format, or <code>head()</code> to see the top 6 rows of the data. The latter is sometimes less than helpful for a very large data set.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(depress)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## &#39;data.frame&#39;:    294 obs. of  37 variables:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ id      : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ sex     : int  2 1 2 2 2 1 2 1 2 1 ...</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ age     : int  68 58 45 50 33 24 58 22 47 30 ...</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ marital : int  5 3 2 3 4 2 2 1 2 2 ...</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ educat  : int  2 4 3 3 3 3 2 3 3 2 ...</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ employ  : int  4 1 1 3 1 1 5 1 4 1 ...</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ income  : int  4 15 28 9 35 11 11 9 23 35 ...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ relig   : int  1 1 1 1 1 1 1 1 2 4 ...</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c1      : int  0 0 0 0 0 0 2 0 0 0 ...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c2      : int  0 0 0 0 0 0 1 1 1 0 ...</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c3      : int  0 1 0 0 0 0 1 2 1 0 ...</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c4      : int  0 0 0 0 0 0 2 0 0 0 ...</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c5      : int  0 0 1 1 0 0 1 2 0 0 ...</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c6      : int  0 0 0 1 0 0 0 1 3 0 ...</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c7      : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c8      : int  0 0 0 3 3 0 2 0 0 0 ...</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c9      : int  0 0 0 0 3 1 2 0 0 0 ...</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c10     : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c11     : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c12     : int  0 1 0 0 0 1 0 0 3 0 ...</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c13     : int  0 0 0 0 0 2 0 0 0 0 ...</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c14     : int  0 0 1 0 0 0 0 0 3 0 ...</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c15     : int  0 1 1 0 0 0 3 0 2 0 ...</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c16     : int  0 0 1 0 0 2 0 1 3 0 ...</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c17     : int  0 1 0 0 0 1 0 1 0 0 ...</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c18     : int  0 0 0 0 0 0 0 1 0 0 ...</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c19     : int  0 0 0 0 0 0 0 1 0 0 ...</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ c20     : int  0 0 0 0 0 0 1 0 0 0 ...</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ cesd    : int  0 4 4 5 6 7 15 10 16 0 ...</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ cases   : int  0 0 0 0 0 0 0 0 1 0 ...</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ drink   : int  2 1 1 2 1 1 2 2 1 1 ...</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ health  : int  2 1 2 1 1 1 3 1 4 1 ...</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ regdoc  : int  1 1 1 1 1 1 1 2 1 1 ...</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ treat   : int  1 1 1 2 1 1 1 2 1 2 ...</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ beddays : int  0 0 0 0 1 0 0 0 1 0 ...</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ acuteill: int  0 0 0 0 1 1 1 1 0 0 ...</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ chronill: int  1 1 0 1 0 1 1 0 1 0 ...</span></span></code></pre></div>
<p>Right away this tells me that <strong>R</strong> thinks all variables are numeric integers, not categorical variables. This will have to be changed. We’ll get to that in a moment.</p>
<p>In SPSS you’ll the following set of icons to tell you what data types the program thinks each column is:</p>
<p><img src="images/spss_icons.PNG" /></p>
<p>Consider the variable that measures marital status.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>marital)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   1   2   3   4   5 </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  73 127  43  13  38</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(depress<span class="sc">$</span>marital)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  int [1:294] 5 3 2 3 4 2 2 1 2 2 ...</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(depress<span class="sc">$</span>marital)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;integer&quot;</span></span></code></pre></div>
<p><img src="images/q.png" alt="q" /> What data type does R see this variable as?</p>
<p>When variables have numerical levels it is necessary to ensure that the program knows it is a factor variable.</p>
<p>The following code uses the <code>factor()</code> function to take the marital status variable and convert it into a factor variable with specified labels that match the codebook.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>marital <span class="ot">&lt;-</span> <span class="fu">factor</span>(depress<span class="sc">$</span>marital, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Never Married&quot;</span>, <span class="st">&quot;Married&quot;</span>, <span class="st">&quot;Divorced&quot;</span>, <span class="st">&quot;Separated&quot;</span>, <span class="st">&quot;Widowed&quot;</span>))</span></code></pre></div>
<p>It is important to confirm the recode worked. If it did not you will have to re-read in the raw data set again since the variable <code>marital</code> was replaced.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>marital)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Never Married       Married      Divorced     Separated       Widowed </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">##            73           127            43            13            38</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(depress<span class="sc">$</span>marital)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;factor&quot;</span></span></code></pre></div>
</div>
<div id="outliers" class="section level3 hasAnchor" number="1.3.3">
<h3 class="hasAnchor"><span class="header-section-number">1.3.3</span> Outliers<a href="#outliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s look at the age variable in the depression data set.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(depress<span class="sc">$</span>age)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(depress<span class="sc">$</span>age)</span></code></pre></div>
<p><img src="data_prep_files/figure-html/unnamed-chunk-5-1.png" width="960" /></p>
<p>Just looking at the data graphically raises no red flags. The boxplot shows no outlying values and the histogram does not look wildly skewed. This is where knowledge about the data set is essential. The codebook does not provide a valid range for the data, but the description of the data starting on page 3 in the textbook clarifies that this data set is on adults. In the research world, this specifies 18 years or older.</p>
<p>Now look back at the graphics. See anything odd? It appears as if the data go pretty far below 20, possibly below 18. Let’s check the numerical summary to get more details.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(depress<span class="sc">$</span>age)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    9.00   28.00   42.50   44.38   59.00   89.00</span></span></code></pre></div>
<p>The minimum value is a 9, which is outside the range of valid values for this variable. This is where you, as a statistician, data analyst or researcher goes back to the PI and asks for advice. Should this data be set to missing, or edited in a way that changes this data point into a valid piece of data.</p>
<p>Another visual way to look for outliers in a continuous measurement is to create a boxplot.
Here we look at boxplots of income across marital status category.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(depress, <span class="fu">aes</span>(<span class="at">y=</span>income, <span class="at">x=</span>marital)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="data_prep_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>While there are a few potential outliers (denoted by the dots), there are none so far away from the rest of the group (or at values such as 99 or -99 that may indicate missing codes) that we need to be concerned about.</p>
<p>As an example of a common data entry error, and for demonstration purposes, I went in and changed a 19 to a 9. So the correct thing to do here is to change that 9, back to a 19. This is a very good use of the <code>ifelse()</code> function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(depress<span class="sc">$</span>age<span class="sc">==</span><span class="dv">9</span>, <span class="dv">19</span>, depress<span class="sc">$</span>age)</span></code></pre></div>
<p>The logical statement is <code>depress$age9</code>. Wherever this is true, replace the value of <code>depress$age</code> with 19, wherever this is false then keep the value of <code>depress$age</code> unchanged (by “replacing” the new value with the same old value).</p>
<p>Alternatively, you can change that one value using bracket notation. Here you are specifying that you only want the rows where <code>age==9</code>, and directly assign a value of 19 to those rows.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>age[depress<span class="sc">$</span>age<span class="sc">==</span><span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="dv">19</span></span></code></pre></div>
<p>Confirm the recode.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(depress<span class="sc">$</span>age)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   18.00   28.00   42.50   44.41   59.00   89.00</span></span></code></pre></div>
<p>Looks like it worked.</p>
</div>
<div id="creating-secondary-variables" class="section level3 hasAnchor" number="1.3.4">
<h3 class="hasAnchor"><span class="header-section-number">1.3.4</span> Creating secondary variables<a href="#creating-secondary-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="collapsing-categorical-variables-into-fewer-categories" class="section level4 hasAnchor" number="1.3.4.1">
<h4 class="hasAnchor"><span class="header-section-number">1.3.4.1</span> Collapsing categorical variables into fewer categories<a href="#collapsing-categorical-variables-into-fewer-categories" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For unbiased and accurate results of a statistical analysis, sufficient data has to be present. Often times once you start slicing and dicing the data to only look at certain groups, or if you are interested in the behavior of certain variables across levels of another variable, sometimes you start to run into small sample size problems.</p>
<p>For example, consider marital status again. There are only 13 people who report being separated. This could potentially be too small of a group size for valid statistical analysis.</p>
<p>One way to deal with insufficient data within a certain category is to collapse categories. The following code uses the <code>recode()</code> function from the <code>car</code> package to create a new variable that I am calling <code>marital2</code> that combines the <code>Divorced</code> and <code>Separated</code> levels.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>marital2 <span class="ot">&lt;-</span> <span class="fu">recode</span>(depress<span class="sc">$</span>marital, <span class="st">&quot;&#39;Divorced&#39; = &#39;Sep/Div&#39;; &#39;Separated&#39; = &#39;Sep/Div&#39;&quot;</span>)</span></code></pre></div>
<p>Always confirm your recodes.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>marital, marital2, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                marital2</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                 Married Never Married Sep/Div Widowed &lt;NA&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Never Married       0            73       0       0    0</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Married           127             0       0       0    0</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Divorced            0             0      43       0    0</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Separated           0             0      13       0    0</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Widowed             0             0       0      38    0</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;NA&gt;                0             0       0       0    0</span></span></code></pre></div>
<p>This confirms that records where <code>marital</code> (rows) is <code>Divorced</code> or <code>Separated</code> have the value of <code>Sep/Div</code> for <code>marital2</code> (columns). And that no missing data crept up in the process. Now I can drop the temporary <code>marital2</code> variable and actually fix <code>marital</code>. (keeping it clean)</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>marital <span class="ot">&lt;-</span> <span class="fu">recode</span>(depress<span class="sc">$</span>marital, <span class="st">&quot;&#39;Divorced&#39; = &#39;Sep/Div&#39;; &#39;Separated&#39; = &#39;Sep/Div&#39;&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(marital2)</span></code></pre></div>
</div>
<div id="binning-a-continuous-variable-into-categorical-ranges." class="section level4 hasAnchor" number="1.3.4.2">
<h4 class="hasAnchor"><span class="header-section-number">1.3.4.2</span> Binning a continuous variable into categorical ranges.<a href="#binning-a-continuous-variable-into-categorical-ranges." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s create a new variable that categorizes income into the following ranges: &lt;30, [30, 40), [40,50), [50, 60), 60+.<br />
The easiest way is to use the <code>cut2</code> function in the package <code>Hmisc</code>. Note you don’t have to load the package fully to use a function from within that package. Useful for times when you only need to use a function once or twice.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>inc_cut <span class="ot">&lt;-</span> Hmisc<span class="sc">::</span><span class="fu">cut2</span>(depress<span class="sc">$</span>income, <span class="at">cuts=</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>inc_cut)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [ 2,30) [30,40) [40,50) [50,60) [60,65] </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     231      28      16       9      10</span></span></code></pre></div>
</div>
<div id="dichotomizing-a-measure-into-2-categories" class="section level4 hasAnchor" number="1.3.4.3">
<h4 class="hasAnchor"><span class="header-section-number">1.3.4.3</span> Dichotomizing a measure into 2 categories<a href="#dichotomizing-a-measure-into-2-categories" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Dichotomous variables tend to be binary indicator variables where a code of <code>1</code> is the level you’re interested in.</p>
<p>For example, gender is coded as 2=Female and 1=Male. This is in the right direction but it needs to be 0/1.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>sex <span class="ot">&lt;-</span> depress<span class="sc">$</span>sex <span class="sc">-</span><span class="dv">1</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>sex)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   0   1 </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 111 183</span></span></code></pre></div>
<p>0/1 binary coding is mandatory for many analyses. One simple reason is that now you can calculate the mean and interpret it as a proportion.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(depress<span class="sc">$</span>sex)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.622449</span></span></code></pre></div>
<p>62% of individuals in this data set are female.</p>
<p>Sometimes the data is recorded as 1/2 (Yes/No), so just subtracting from 1 doesn’t create a positive indicator of the variable. For example, <code>drink=1</code> if they are a regular drinker, and <code>drink=2</code> if they are not. We want not drinking to be coded as <code>0</code>, not <code>2</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>drink)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   1   2 </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 234  60</span></span></code></pre></div>
<p>The <code>ifelse()</code> function says that if <code>depress$DRINK</code> has a value equal to 2 <code>==2</code>, then change the value to 0. Otherwise leave it alone.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>drink <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(depress<span class="sc">$</span>drink<span class="sc">==</span><span class="dv">2</span>, <span class="dv">0</span>, depress<span class="sc">$</span>drink)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>drink)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   0   1 </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  60 234</span></span></code></pre></div>
</div>
<div id="sum-or-average-values-across-multiple-variables" class="section level4 hasAnchor" number="1.3.4.4">
<h4 class="hasAnchor"><span class="header-section-number">1.3.4.4</span> Sum or Average values across multiple variables<a href="#sum-or-average-values-across-multiple-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Center for Epidemiological Studies Depression Scale (CESD) is series of questions asked to a person to measure their level of depression. <code>CESD</code> is calculated as the sum of all 20 component variables, and is already on this data set. Let’s create a new variable named <code>sleep</code> as subscale for sleep quality by adding up question numbers 5, 11, and 19.</p>
<p>Reference: <a href="http://cesd-r.com/cesdr/" class="uri">http://cesd-r.com/cesdr/</a></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>sleep <span class="ot">&lt;-</span> depress<span class="sc">$</span>c5 <span class="sc">+</span> depress<span class="sc">$</span>c11 <span class="sc">+</span> depress<span class="sc">$</span>c19</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # depress &lt;- depress %&gt;% mutate(sleep = c5+c11+c19) # Not run. dplyr example</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(depress<span class="sc">$</span>sleep)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   0.000   0.000   1.000   1.167   2.000   7.000</span></span></code></pre></div>
</div>
<div id="transformations-for-normality" class="section level4 hasAnchor" number="1.3.4.5">
<h4 class="hasAnchor"><span class="header-section-number">1.3.4.5</span> Transformations for Normality<a href="#transformations-for-normality" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s look at assessing normal distributions using the <strong>cleaned</strong> depression data set.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(depress) <span class="co"># remove the current version that was used in the previous part of this markdown file</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>depress <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://norcalbiostat.netlify.com/data/depress_081217.txt&quot;</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(depress<span class="sc">$</span>income, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">xlab=</span><span class="st">&quot;Annual income (in thousands)&quot;</span>, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Histogram and Density curve of Income&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(depress<span class="sc">$</span>income), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data_prep_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(depress<span class="sc">$</span>income)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    2.00    9.00   15.00   20.57   28.00   65.00</span></span></code></pre></div>
<p>The distribution of annual income is slightly skewed right with a mean of $20.5k per year and a median of $15k per year income. The range of values goes from $2k to $65k. Reported income above $40k appear to have been rounded to the nearest $10k, because there are noticeable peaks at $40k, $50k, and $60k.</p>
<p>In general, transformations are more effective when the the standard deviation is large relative to the mean. One rule of thumb is if the sd/mean ratio is less than 1/4, a transformation may not be necessary.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(depress<span class="sc">$</span>income) <span class="sc">/</span> <span class="fu">mean</span>(depress<span class="sc">$</span>income)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.743147</span></span></code></pre></div>
<p>Alternatively Hoaglin, Mosteller and Tukey (1985) showed that if the largest observation divided by the smallest observation is over 2, then the data may not be sufficiently variable for the transformation to be decisive.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(depress<span class="sc">$</span>income) <span class="sc">/</span> (<span class="fu">min</span>(depress<span class="sc">$</span>income)<span class="sc">+</span>.<span class="dv">1</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 30.95238</span></span></code></pre></div>
<p>Note these rules are not meaningful for data without a natural zero.</p>
<p>Another common method of assessing normality is to create a normal probability (or normal quantile) plot.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(depress<span class="sc">$</span>income);<span class="fu">qqline</span>(depress<span class="sc">$</span>income, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data_prep_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The points on the normal probability plot do not follow the red reference line very well. The dots show a more curved, or <code>U</code> shaped form rather than following a linear line. This is another indication that the data is skewed and a transformation for normality should be created.</p>
<ul>
<li>Create three new variables: <code>log10inc</code> as the log base 10 of Income, <code>loginc</code> as the natural log of Income, and <code>xincome</code> which is equal to the negative of one divided by the cubic root of income.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>log10inc <span class="ot">&lt;-</span> <span class="fu">log10</span>(depress<span class="sc">$</span>income)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>loginc   <span class="ot">&lt;-</span> <span class="fu">log</span>(depress<span class="sc">$</span>income)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>xincome  <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span>(depress<span class="sc">$</span>income)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code></pre></div>
<ul>
<li>Create a single plot that display normal probability plots for the original, and each of the three transformations of income. Use the base graphics grid organizer <code>par(mfrow=c(r,c))</code> where <code>r</code> is the number of rows and <code>c</code> is the number of columns. Which transformation does a better job of normalizing the distribution of Income?</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># Try (4,1) and (1,4) to see how this works. </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(depress<span class="sc">$</span>income, <span class="at">main=</span><span class="st">&quot;Income&quot;</span>); <span class="fu">qqline</span>(depress<span class="sc">$</span>income,<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(log10inc, <span class="at">main=</span><span class="st">&quot;Log 10&quot;</span>); <span class="fu">qqline</span>(log10inc, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(loginc, <span class="at">main =</span> <span class="st">&quot;Natural Log&quot;</span>); <span class="fu">qqline</span>(loginc, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(xincome, <span class="at">main=</span><span class="st">&quot;-1/cuberoot(income)&quot;</span>); <span class="fu">qqline</span>(xincome, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data_prep_files/figure-html/unnamed-chunk-18-1.png" width="960" /></p>
</div>
</div>
</div>
<div id="saving-your-changes" class="section level2 hasAnchor" number="1.4">
<h2 class="hasAnchor"><span class="header-section-number">1.4</span> Saving your changes<a href="#saving-your-changes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You’ve just made a ton of changes!</p>
<ul>
<li>Save or export the new data set to your computer.</li>
<li>Edit the codebook to reflect the changes that you made.</li>
<li>In a production situation, or when changes aren’t being made on a rapid basis, it is common to include the date in the file name.</li>
<li>Keep the data, codebook and data management file in the same folder.</li>
</ul>
<p>The <code>Sys.Date()</code> function takes the current date from your computer. The value is then formatted nicely for human consumption and added (pasted) to the file name before written to the working directory as a new text file.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>depress_clean <span class="ot">&lt;-</span> depress <span class="sc">%&gt;%</span> <span class="fu">select</span>(var1, var2, var3)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%m%d%y&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;depress_&quot;</span>, date, <span class="st">&quot;.txt&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(depress_clean, filename, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>SPSS users commonly save cleaned data as a <code>.sav</code> format.</p>
<pre><code>SAVE outfile=&#39;FilePath\depress_sysdate.sav&#39;
/KEEP = Variable_Name1 Variable_Name2.
EXECUTE.</code></pre>
<p><strong>Saving only selected variables</strong></p>
<ul>
<li>In SPSS the <code>/KEEP</code> statement demonstrated above only writes the variable names listed to the saved data set. This can be very useful when dealing with data sets with a large number of variables.</li>
<li>For R users, using <code>dplyr</code> select is generally the fastest.</li>
</ul>
</div>
<div id="wide-long" class="section level2 hasAnchor" number="1.5">
<h2 class="hasAnchor"><span class="header-section-number">1.5</span> Wide vs. Long data<a href="#wide-long" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The data on Lung function originally was recorded in <em>wide</em> format, with separate variables for mother’s and father’s FEV1 score (<code>MFEV1</code> and <code>FFEV</code>). In this format, the data is one record per family.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fev <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;https://norcalbiostat.netlify.com/data/Lung_081217.txt&quot;</span>, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fev)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   ID AREA FSEX FAGE FHEIGHT FWEIGHT FFVC FFEV1 MSEX MAGE MHEIGHT MWEIGHT MFVC</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  1    1    1   53      61     161  391  3.23    2   43      62     136  370</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  2    1    1   40      72     198  441  3.95    2   38      66     160  411</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  3    1    1   26      69     210  445  3.47    2   27      59     114  309</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  4    1    1   34      68     187  433  3.74    2   36      58     123  265</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  5    1    1   46      61     121  354  2.90    2   39      62     128  245</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  6    1    1   44      72     153  610  4.91    2   36      66     125  349</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   MFEV1 OCSEX OCAGE OCHEIGHT OCWEIGHT OCFVC OCFEV1 MCSEX MCAGE MCHEIGHT</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  3.31     2    12       59      115   296   2.79    NA    NA       NA</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  3.47     1    10       56       66   323   2.39    NA    NA       NA</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  2.65     1     8       50       59   114   1.11    NA    NA       NA</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  2.06     2    11       57      106   256   1.85     1     9       49</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  2.33     1    16       61       88   260   2.47     2    12       60</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  3.06     1    15       67      100   389   3.55     1    13       57</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   MCWEIGHT MCFVC MCFEV1 YCSEX YCAGE YCHEIGHT YCWEIGHT YCFVC YCFEV1</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       NA    NA     NA    NA    NA       NA       NA    NA     NA</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       NA    NA     NA    NA    NA       NA       NA    NA     NA</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       NA    NA     NA    NA    NA       NA       NA    NA     NA</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       56   159   1.30    NA    NA       NA       NA    NA     NA</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 5       85   268   2.34     2    10       50       53   154   1.43</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 6       87   276   2.37     2    10       55       72   195   1.69</span></span></code></pre></div>
<p>To analyze the effect of gender on FEV, the data need to be in <em>long</em> format, with a single variable for <code>fev</code> and a separate variable for gender. The following code chunk demonstrates one method of combining data on height, gender, age and FEV1 for both males and females.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fev2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gender =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FSEX, fev<span class="sc">$</span>MSEX), </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rev =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FFEV1, fev<span class="sc">$</span>MFEV1), </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ht =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FHEIGHT, fev<span class="sc">$</span>MHEIGHT), </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">age =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FAGE, fev<span class="sc">$</span>MAGE))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>fev2<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(fev2<span class="sc">$</span>gender, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fev2)  </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender  rev ht age</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      M 3.23 61  53</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      M 3.95 72  40</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      M 3.47 69  26</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      M 3.74 68  34</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      M 2.90 61  46</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      M 4.91 72  44</span></span></code></pre></div>
<p>Nearly all analysis procedures and most graphing procedures require the data to be in long format. There are several <code>R</code> packages that can help with this including <code>reshape2</code> and <code>tidyr</code>.</p>
</div>
<div id="dealing-with-missing-data-post-analysis" class="section level2 hasAnchor" number="1.6">
<h2 class="hasAnchor"><span class="header-section-number">1.6</span> Dealing with missing data post-analysis<a href="#dealing-with-missing-data-post-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Case when: you want to add model predictions to the data set, but you have missing data that was automatically dropped prior to analysis.</li>
</ul>
<p>If your original data had missing values, here is one way to get the factor scores for available data back onto the data set. Alternatively you can look into methods to conduct factor analysis with missing data (FactomineR)</p>
<ol style="list-style-type: decimal">
<li>If no ID column exists, create one: <code>id = 1:NROW(data)</code></li>
<li>Use <code>select()</code> to extract ID and all variables used in the factor analysis</li>
<li>Do <code>na.omit()</code></li>
<li>Conduct factor analysis on this subsetted data set</li>
<li>Use <code>bind_cols()</code> to add columns containing factor scores to this subsetted data set as described above</li>
<li>Use <code>select()</code> to only keep the ID and the factor score variables</li>
<li>Then <code>left_join()</code> the factor scores back to the original data, using the ID variable as the joining key.</li>
</ol>
<!--chapter:end:data_prep.Rmd-->
</div>
</div>
<div id="data_viz" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Visualizing Data<a href="#data_viz" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Visualizing your data is hands down the most important thing you can learn to do. There are links to additional resources at the end of this document for additional learning.</p>
<p>There are two audiences in mind when creating data visualizations:</p>
<ol style="list-style-type: decimal">
<li>For your eyes only (FYEO). These are quick and dirty plots, without annotation. Meant to be looked at once or twice.</li>
<li>To share with others. These need to completely stand on their own. Axes labels, titles, colors as needed, possibly captions.</li>
</ol>
<p>You will see, and slowly learn, how to add these annotations and how to clean up your graphics to make them sharable. <code>ggplot2</code> already does a lot of this work for you.</p>
<p>We will also use the two most common methods used to create plots. 1) Base graphics, 2) the <code>ggplot2</code> package. Each have their own advantages and disadvantages. If you have not done so already, go ahead and install the <code>ggplot2</code> package now.</p>
<p>For <strong>almost</strong> every plot discussed we will create two types of plots</p>
<ol style="list-style-type: decimal">
<li>FYEO - using base graphics. (Base == Comes with R) Very powerful, but can be technical.</li>
<li>FYEO - using <code>ggplot2</code>. Each have their own advantages and disadvantages.</li>
</ol>
<p>As time permits I will update each section with a third type of plot -</p>
<ol start="3" style="list-style-type: decimal">
<li>Sharable - Contains all bells and whistles needed to make it presentable to others.</li>
</ol>
<p>Your task, should you choose to accept, is to follow along through this tutorial and at each step try to reproduce the plot shown. You can accomplish this by simply copying and pasting the syntax into a new R code (or R Markdown) document.</p>
<div id="the-syntax-of-ggplot" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> The syntax of <code>ggplot</code><a href="#the-syntax-of-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The reason we use the functions in <code>ggplot2</code> is for consistency in the structure
of it’s arguments. Here is a bare bones generic plotting function:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">col=</span>col, <span class="at">fill=</span>fill, <span class="at">group=</span>group)) <span class="sc">+</span>  <span class="fu">geom_THING</span>() </span></code></pre></div>
<div id="required-arguments" class="section level3 hasAnchor" number="2.1.1">
<h3 class="hasAnchor"><span class="header-section-number">2.1.1</span> Required arguments<a href="#required-arguments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><code>data</code>: What data set is this plot using? This is ALWAYS the first argument.</li>
<li><code>aes()</code>: This is the <em>aestetics</em> of the plot. What’s variable is on the x, what is on
the y? Do you want to color by another variable, perhaps fill some box by the value
of another variable, or group by a variable.</li>
<li><code>geom_THING()</code>: Every plot has to have a geometry. What is the shape of the thing you
want to plot? Do you want to plot points - use <code>geom_points()</code>. Want to connect those
points with a line? Use <code>geom_lines()</code>. We will see many varieties in this lab.</li>
</ul>
</div>
<div id="optional-but-helpful-arguments" class="section level3 hasAnchor" number="2.1.2">
<h3 class="hasAnchor"><span class="header-section-number">2.1.2</span> Optional but helpful arguments<a href="#optional-but-helpful-arguments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><code>ggtitle</code>: This is the overall plot title</li>
<li><code>xlab()</code> and <code>ylab()</code> axis titles.</li>
<li>scale_xy_blah to extend limits</li>
<li>scale_fill_blah to specifying a fixed color, and change auto legend title</li>
<li>themes</li>
</ul>
<p>For a <strong>full</strong> , and comprehensive tutorial and reference guide on how to do nearly anything in ggplot – this is by far my favorite reference <a href="http://www.cookbook-r.com/Graphs/" class="uri">http://www.cookbook-r.com/Graphs/</a> I reference things in there (like how to remove or change the title of a legend) constantly.</p>
</div>
</div>
<div id="the-data" class="section level2 hasAnchor" number="2.2">
<h2 class="hasAnchor"><span class="header-section-number">2.2</span> The Data<a href="#the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will use a subset of the <code>diamonds</code> dataset that comes with the <code>ggplot2</code> package. This dataset contains the prices and other attributes of almost 54,000 diamonds. Review <code>?diamonds</code> to learn about the variables we will be using.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;diamonds&quot;</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1410</span>) <span class="co"># Make the sample reproducible</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>dsmall <span class="ot">&lt;-</span> diamonds[<span class="fu">sample</span>(<span class="fu">nrow</span>(diamonds), <span class="dv">1000</span>), ]</span></code></pre></div>
</div>
<div id="univariate-visualizations" class="section level2 hasAnchor" number="2.3">
<h2 class="hasAnchor"><span class="header-section-number">2.3</span> Univariate Visualizations<a href="#univariate-visualizations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="categorical-variables" class="section level3 hasAnchor" number="2.3.1">
<h3 class="hasAnchor"><span class="header-section-number">2.3.1</span> Categorical variables<a href="#categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Both Nominal and Ordinal data types can be visualized using the same methods: tables, barcharts and pie charts.</p>
<div id="tables" class="section level4 hasAnchor" number="2.3.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.1</span> Tables<a href="#tables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Tables are the most common way to get summary statistics of a categorical variable. The <code>table()</code> function produces a frequency table, where each entry represents the number of records in the data set holding the corresponding labeled value.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dsmall<span class="sc">$</span>cut)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      Fair      Good Very Good   Premium     Ideal </span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="do">##        34        99       220       257       390</span></span></code></pre></div>
<p>There are 27 Fair quality diamonds, 83 good quality and 387 Ideal quality diamonds in this sample.</p>
</div>
<div id="barcharts-barplots" class="section level4 hasAnchor" number="2.3.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.2</span> Barcharts / Barplots<a href="#barcharts-barplots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A Barchart or barplot takes these frequencies, and draws bars along the X-axis where the height of the bars is determined by the frequencies seen in the table.</p>
<p><strong>base</strong>
To create a barplot/barchart in base graphics requires the data to be in summarized in a table form first. Then the result of the table is plotted. The first argument is the table to be plotted, the <code>main</code> argument controls the title.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">table</span>(dsmall<span class="sc">$</span>cut)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(dc, <span class="at">main=</span><span class="st">&quot;Barchart using base graphics&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><strong>ggplot</strong>
The geometry needed to draw a barchart in ggplot is <code>geom_bar()</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>cut)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p><strong>pretty</strong>
The biggest addition to a barchart is the numbers on top of the bars. This isn’t mandatory, but it does make it nice.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>cut)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..count..)) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Frequnency of diamonds by cut type&quot;</span>) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y=</span>..count.. <span class="sc">+</span> <span class="dv">10</span>, <span class="at">label=</span>..count..), <span class="at">stat=</span><span class="st">&#39;count&#39;</span>, <span class="at">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="plotting-proportions" class="section level4 hasAnchor" number="2.3.1.3">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.3</span> Plotting Proportions<a href="#plotting-proportions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Often you don’t want to compare counts but percents. To accomplish this, we have to aggregate the data to calculate the proportions first, then plot the aggregated data using <code>geom_col</code> to create the columns.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cut.props <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(dsmall<span class="sc">$</span>cut)))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cut.props <span class="co"># what does this data look like? </span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="do">##        Var1  Freq</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      Fair 0.034</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      Good 0.099</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Very Good 0.220</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4   Premium 0.257</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5     Ideal 0.390</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cut.props, <span class="fu">aes</span>(<span class="at">x=</span>Var1, <span class="at">y=</span>Freq)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Cut type&quot;</span>) <span class="sc">+</span> </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Proportion of diamonds by cut type&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="cleveland-dot-plots" class="section level4 hasAnchor" number="2.3.1.4">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.4</span> Cleveland Dot Plots<a href="#cleveland-dot-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another way to visualize categorical data that takes up less ink than bars is a Cleveland dot plot. Here again we are plotting summary data instead of the raw data. This uses the <code>geom_segment</code> that draws the lines from x=0 to the value of the proportion (named <code>Freq</code> because of the way <code>data.frame</code> works).</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cut.props, <span class="fu">aes</span>(<span class="at">x=</span>Freq, <span class="at">y=</span>Var1)) <span class="sc">+</span>  </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Proportion of diamonds&quot;</span>) <span class="sc">+</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Cut Type&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">xend=</span>Freq, <span class="at">y=</span>Var1, <span class="at">yend=</span>Var1), <span class="at">color=</span><span class="st">&#39;grey50&#39;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="pie-chart" class="section level4 hasAnchor" number="2.3.1.5">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.5</span> Pie Chart<a href="#pie-chart" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Just like <code>barplot()</code>, <code>pie()</code> takes a table object as it’s argument.</p>
<p><strong>base</strong></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">table</span>(dsmall<span class="sc">$</span>cut)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(dc)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Pie charts are my <em>least</em> favorite plotting type. Human eyeballs can’t distinguish between angles as well as we can with heights. A mandatory piece needed to make the wedges readable is to add the percentages of each wedge.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(dc, <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">names</span>(dc), <span class="st">&#39; (&#39;</span>, <span class="fu">prop.table</span>(dc)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;%)&quot;</span>))</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><strong>ggplot</strong></p>
<p>And here I thought pie charts couldn’t get worse… i’m not a fan at all of the ggplot version. So i’m not even going to show it. Here’s a link to another great tutorial that does show you how to make one.</p>
<p><a href="http://www.sthda.com/english/wiki/ggplot2-pie-chart-quick-start-guide-r-software-and-data-visualization" class="uri">http://www.sthda.com/english/wiki/ggplot2-pie-chart-quick-start-guide-r-software-and-data-visualization</a></p>
<p>However – Never say never. Here’s an example of a <em>good</em> use of pie charts.
<a href="http://www.storytellingwithdata.com/blog/2019/8/8/forty-five-pie-charts-never-say-never" class="uri">http://www.storytellingwithdata.com/blog/2019/8/8/forty-five-pie-charts-never-say-never</a></p>
</div>
<div id="waffle-chart" class="section level4 hasAnchor" number="2.3.1.6">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.6</span> Waffle Chart<a href="#waffle-chart" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This type of chart is not natively found in the <code>ggplot2</code> package, but it’s own <code>waffle</code> package. These are great for infographics.</p>
<p>Reference: <a href="https://www.r-bloggers.com/making-waffle-charts-in-r-with-the-new-waffle-package/" class="uri">https://www.r-bloggers.com/making-waffle-charts-in-r-with-the-new-waffle-package/</a></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(waffle)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">waffle</span>(dc<span class="sc">/</span><span class="dv">10</span>, <span class="at">rows=</span><span class="dv">5</span>, <span class="at">size=</span><span class="fl">0.5</span>, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Cut quality of diamond&quot;</span>, </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;1 square == 10 diamonds&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="continuous-measures" class="section level3 hasAnchor" number="2.3.2">
<h3 class="hasAnchor"><span class="header-section-number">2.3.2</span> Continuous Measures<a href="#continuous-measures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we can look at the price, carat, and depth of the diamonds.</p>
<div id="dotplot" class="section level4 hasAnchor" number="2.3.2.1">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.1</span> Dotplot<a href="#dotplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsmall<span class="sc">$</span>depth)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>The base function <code>plot()</code> creates a <strong>dotplot</strong> for a continuous variable. The value of the variable is plotted on the y axis, and the index, or row number, is plotted on the x axis. This gives you a nice, quick way to see the values of the data.</p>
<p>Often you are not interested in the individual values of each data point, but the <em>distribution</em> of the data. In other words, where is the majority of the data? Does it look symmetric around some central point? Around what values do the bulk of the data lie?</p>
</div>
<div id="histograms" class="section level4 hasAnchor" number="2.3.2.2">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.2</span> Histograms<a href="#histograms" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Rather than showing the value of each observation, we prefer to think of the value as belonging to a . <strong>The height of the bars in a histogram display the frequency of values that fall into those of those bins.</strong> For example if we cut the poverty rates into 7 bins of equal width, the frequency table would look like this:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">cut</span>(dsmall<span class="sc">$</span>depth, <span class="dv">7</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (55.3,57.6] (57.6,59.8] (59.8,62.1] (62.1,64.4] (64.4,66.7] (66.7,68.9] </span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="do">##           6          79         536         351          23           3 </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="do">## (68.9,71.2] </span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="do">##           2</span></span></code></pre></div>
<p>In a histogram, the binned counts are plotted as bars into a histogram. Note that the x-axis is continuous, so the bars touch. This is unlike the barchart that has a categorical x-axis, and vertical bars that are separated.</p>
<p><strong>base</strong>
You can make a histogram in base graphics super easy.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dsmall<span class="sc">$</span>depth)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>And it doesn’t take too much to clean it up. Here you can specify the number of bins by specifying how many <code>breaks</code> should be made in the data (the number of breaks controls the number of bins, and bin width) and use <code>col</code> for the fill color.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dsmall<span class="sc">$</span>depth, <span class="at">xlab=</span><span class="st">&quot;depth&quot;</span>, <span class="at">main=</span><span class="st">&quot;Histogram of diamond depth&quot;</span>, <span class="at">col=</span><span class="st">&quot;cyan&quot;</span>, <span class="at">breaks=</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p><strong>ggplot</strong></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>depth)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">2.2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The binwidth here is set by looking at the cut points above that were used to create 7 bins. Notice that darkgrey is the default fill color, but makes it hard to differentiate between the bars. So we’ll make the outline black using <code>colour</code>, and <code>fill</code> the bars with white.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>depth)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Distribution of diamond depth&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Note I did <strong>not</strong> specify the <code>binwidth</code> argument here. The size of the bins can hide features from your graph, the default value for ggplot2 is range/30 and usually is a good choice.</p>
</div>
<div id="density-plots" class="section level4 hasAnchor" number="2.3.2.3">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.3</span> Density plots<a href="#density-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To get a better idea of the true shape of the distribution we can “smooth” out the bins and create what’s called a <code>density</code> plot or curve. Notice that the shape of this distribution curve is much more… “wigglier” than the histogram may have implied.</p>
<p><strong>base</strong></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(dsmall<span class="sc">$</span>depth))</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Awesome title huh? (NOT)</p>
<p><strong>ggplot2</strong></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>depth)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="histograms-density" class="section level4 hasAnchor" number="2.3.2.4">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.4</span> Histograms + density<a href="#histograms-density" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Often is is more helpful to have the density (or kernel density) plot <em>on top of</em> a histogram plot.</p>
<p><strong>Base</strong>
Since the height of the bars in a histogram default to showing the frequency of records in the data set within that bin, we need to 1) scale the height so that it’s a <em>relative frequency</em>, and then use the <code>lines()</code> function to add a <code>density()</code> line on top.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dsmall<span class="sc">$</span>depth, <span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(dsmall<span class="sc">$</span>depth), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p><strong>ggplot</strong>
The syntax starts the same, we’ll add a new geom, <code>geom_density</code> and color the line blue. Then we add the histogram geom using <code>geom_histogram</code> but must specify that the y axis should be on the density, not frequency, scale. Note that this has to go inside the aesthetic statement <code>aes()</code>. I’m also going to get rid of the fill by using <code>NA</code> so it doesn’t plot over the density line.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>depth)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">col=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..), <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="boxplots" class="section level4 hasAnchor" number="2.3.2.5">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.5</span> Boxplots<a href="#boxplots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another very common way to visualize the distribution of a continuous variable is using a boxplot. Boxplots are useful for quickly identifying where the bulk of your data lie. R specifically draws a “modified” boxplot where values that are considered outliers are plotted as dots.</p>
<p><strong>base</strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(dsmall<span class="sc">$</span>depth)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Notice that the only axis labeled is the y=axis. Like a dotplot the x axis, or “width”, of the boxplot is meaningless here. We can make the axis more readable by flipping the plot on it’s side.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(dsmall<span class="sc">$</span>depth, <span class="at">horizontal =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">&quot;Distribution of diamond prices&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Dollars&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Horizontal is a bit easier to read in my opinion.</p>
<p><strong>ggplot</strong>
What about ggplot? ggplot doesn’t really like to do univariate boxplots. We can get around that by specifying that we want the box placed at a specific x value.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span>depth)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>To flip it horizontal you may think to simply swap x and y? Good thinking. Of course it wouldn’t be that easy. So let’s just flip the whole darned plot on it’s coordinate axis.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span>depth)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="violin-plots" class="section level4 hasAnchor" number="2.3.2.6">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.6</span> Violin plots<a href="#violin-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span>depth)) <span class="sc">+</span> <span class="fu">geom_violin</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="boxplot-violin-plots" class="section level4 hasAnchor" number="2.3.2.7">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.7</span> Boxplot + Violin plots<a href="#boxplot-violin-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Overlaying a boxplot and a violin plot serves a similar purpose to Histograms + Density plots.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span>depth)) <span class="sc">+</span> <span class="fu">geom_violin</span>() <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Better appearance - different levels of transparency of the box and violin.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span>depth)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_violin</span>(<span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_boxplot</span>(<span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">width=</span>.<span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme</span>(<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="normal-qq-plots" class="section level4 hasAnchor" number="2.3.2.8">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.8</span> Normal QQ plots<a href="#normal-qq-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The last useful plot that we will do on a single continuous variable is to assess the <em>normality</em> of the distribution. Basically how close the data follows a normal distribution.</p>
<p><strong>base</strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(dsmall<span class="sc">$</span>price)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(dsmall<span class="sc">$</span>price, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>The line I make red because it is a reference line. The closer the points are to following this line, the more “normal” the shape of the distribution is. Price has some pretty strong deviation away from that line. Below I have plotted what a normal distribution looks like as an example of a “perfect” fit.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(z)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(z, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p><strong>ggplot</strong>
qq (or qnorm) plots specifically plot the data against a theoretical distribution. That means in the <code>aes()</code> aesthetic argument we don’t specify either x or y, but instead the <code>sample=</code> is the variable we want to plot.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">sample=</span>price)) <span class="sc">+</span> <span class="fu">stat_qq</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Additional references on making qqplots in ggplot: <a href="http://www.sthda.com/english/wiki/ggplot2-qq-plot-quantile-quantile-graph-quick-start-guide-r-software-and-data-visualization" class="uri">http://www.sthda.com/english/wiki/ggplot2-qq-plot-quantile-quantile-graph-quick-start-guide-r-software-and-data-visualization</a></p>
</div>
</div>
</div>
<div id="bivariate-visualizations" class="section level2 hasAnchor" number="2.4">
<h2 class="hasAnchor"><span class="header-section-number">2.4</span> Bivariate Visualizations<a href="#bivariate-visualizations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="categorical-v.-categorical" class="section level3 hasAnchor" number="2.4.1">
<h3 class="hasAnchor"><span class="header-section-number">2.4.1</span> Categorical v. Categorical<a href="#categorical-v.-categorical" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="two-way-frequency-tables" class="section level4 hasAnchor" number="2.4.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.4.1.1</span> Two-way Frequency tables<a href="#two-way-frequency-tables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cross-tabs, cross-tabulations and two-way tables (all the same thing, different names) can be created by using the <code>table()</code> function.</p>
<p>The frequency table is constructed using the <code>table()</code> function.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dsmall<span class="sc">$</span>cut, dsmall<span class="sc">$</span>color)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="do">##            </span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="do">##              D  E  F  G  H  I  J</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Fair       5  6  7  4  5  4  3</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Good      18 23 11 16 17  7  7</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Very Good 26 37 46 40 33 25 13</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Premium   34 53 43 49 41 24 13</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Ideal     54 63 79 92 53 34 15</span></span></code></pre></div>
<p>There are 4 Fair diamonds with color D, and 21 Ideal quality diamonds with color J.</p>
</div>
<div id="two-way-proprtion-tables" class="section level4 hasAnchor" number="2.4.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.4.1.2</span> Two-way Proprtion tables<a href="#two-way-proprtion-tables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Choose your percentages depending on your research question. What are you wanting to compare?</p>
<p>Best practices:</p>
<ul>
<li>Explanatory variable on the rows</li>
<li>Response variable on the columns</li>
<li>Calculate row %’s as the % of the response for each explanatory group.</li>
</ul>
<p>Here are demonstrations of how the interpretation of the percents change depending on what the denominator is.</p>
<p><strong>Cell proportions</strong></p>
<p>Wrapping <code>prop.table()</code> around a table gives you the <strong>cell</strong> proportions.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(dsmall<span class="sc">$</span>cut, dsmall<span class="sc">$</span>color))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">##            </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                 D     E     F     G     H     I     J</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Fair      0.005 0.006 0.007 0.004 0.005 0.004 0.003</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Good      0.018 0.023 0.011 0.016 0.017 0.007 0.007</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Very Good 0.026 0.037 0.046 0.040 0.033 0.025 0.013</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Premium   0.034 0.053 0.043 0.049 0.041 0.024 0.013</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Ideal     0.054 0.063 0.079 0.092 0.053 0.034 0.015</span></span></code></pre></div>
<p>0.4% of all diamonds are D color and Fair cut, 2.1% are J color and Ideal cut.</p>
<p><strong>Row proportions</strong></p>
<p>To get the <strong>row</strong> proportions, you specify <code>margin=1</code>. The percentages now add up to 1 across the rows.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(dsmall<span class="sc">$</span>cut, dsmall<span class="sc">$</span>color), <span class="at">margin=</span><span class="dv">1</span>),<span class="dv">3</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="do">##            </span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                 D     E     F     G     H     I     J</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Fair      0.147 0.176 0.206 0.118 0.147 0.118 0.088</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Good      0.182 0.232 0.111 0.162 0.172 0.071 0.071</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Very Good 0.118 0.168 0.209 0.182 0.150 0.114 0.059</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Premium   0.132 0.206 0.167 0.191 0.160 0.093 0.051</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Ideal     0.138 0.162 0.203 0.236 0.136 0.087 0.038</span></span></code></pre></div>
<p>14.8% of all Fair quality diamonds are color D. 5.4% of all Ideal quality diamonds have color J.</p>
<p><strong>Column proportions</strong></p>
<p>To get the <strong>column</strong> proportions, you specify <code>margin=2</code>. The percentages now add up to 1 down the columns.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(dsmall<span class="sc">$</span>cut, dsmall<span class="sc">$</span>color), <span class="at">margin=</span><span class="dv">2</span>),<span class="dv">3</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="do">##            </span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                 D     E     F     G     H     I     J</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Fair      0.036 0.033 0.038 0.020 0.034 0.043 0.059</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Good      0.131 0.126 0.059 0.080 0.114 0.074 0.137</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Very Good 0.190 0.203 0.247 0.199 0.221 0.266 0.255</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Premium   0.248 0.291 0.231 0.244 0.275 0.255 0.255</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Ideal     0.394 0.346 0.425 0.458 0.356 0.362 0.294</span></span></code></pre></div>
<p>2.7% of all D color diamonds are of Fair quality. 44.7% of all J color diamonds are of Ideal quality.</p>
</div>
<div id="grouped-bar-charts" class="section level4 hasAnchor" number="2.4.1.3">
<h4 class="hasAnchor"><span class="header-section-number">2.4.1.3</span> Grouped bar charts<a href="#grouped-bar-charts" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To compare proportions of one categorical variable within the same level of another, is to use grouped barcharts.</p>
<p><strong>base</strong>
As before, the object to be plotted needs to be the result of a table.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">table</span>(dsmall<span class="sc">$</span>cut, dsmall<span class="sc">$</span>color)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(cc)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Stacked bars can be difficult to interpret, and very difficult to compare values between groups. A side by side barchart is preferable.
The <code>beside=TRUE</code> is what controls the placement of the bars.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(cc, <span class="at">main=</span><span class="st">&quot;quick side by side barchart using base graphics&quot;</span>, <span class="at">beside=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p><strong>ggplot</strong>
Again plot the cut on the x axis, but then <code>fill</code> using the second categorical variable. This has the effect of visualizing the <strong>row</strong> percents from the table above. The percent of color, within each type of cut.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>cut, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Again the default is a stacked barchart. So we just specify <code>position=dodge</code> to put the bars side by side.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>cut, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>And look, an automatic legend. What if I wanted to better compare cut within color group? This is the <strong>column</strong> percentages. Just switch which variable is the x axis and which one is used to fill the colors!</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>color, <span class="at">fill=</span>cut)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>For more than 2 colors I do not recommend choosing the colors yourself. I know little about color theory so I use the built-in color palettes. Here is a <a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf">great cheatsheet</a> about using color palettes.</p>
<p>And this easy change is why we love <code>ggplot2</code>.</p>
</div>
</div>
<div id="grouped-bar-charts-with-percentages" class="section level3 hasAnchor" number="2.4.2">
<h3 class="hasAnchor"><span class="header-section-number">2.4.2</span> Grouped bar charts with percentages<a href="#grouped-bar-charts-with-percentages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Not as easy as one would hope, but the solution is to calculate the desired percentages first and then plot the summary data using either <code>geom_bar(stat='identity')</code> or <code>geom_col()</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>calc.props <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(color, cut) <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">pct=</span><span class="fu">round</span>(count<span class="sc">/</span><span class="fu">sum</span>(count),<span class="dv">3</span>))</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>calc.props</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 35 × 4</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   color [7]</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    color cut       count   pct</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;ord&gt; &lt;ord&gt;     &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 D     Fair        163 0.024</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 D     Good        662 0.098</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 D     Very Good  1513 0.223</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 D     Premium    1603 0.237</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 D     Ideal      2834 0.418</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 E     Fair        224 0.023</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 E     Good        933 0.095</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 E     Very Good  2400 0.245</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 E     Premium    2337 0.239</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 E     Ideal      3903 0.398</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 25 more rows</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Since we’re plotting summary data, the height of the bars is specified using <code>y=pct</code>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(calc.props, <span class="fu">aes</span>(<span class="at">x=</span>color, <span class="at">fill=</span>cut, <span class="at">y=</span>pct)) <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() </span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>Now set some options to the y axis using <code>scale_y_continuous()</code> to make the graph more accurate and readable. The <code>labels=percent</code> comes from the <code>scales</code> package.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(calc.props, <span class="fu">aes</span>(<span class="at">x=</span>color, <span class="at">fill=</span>cut, <span class="at">y=</span>pct)) <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels=</span>percent)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<div id="sjplot" class="section level4 hasAnchor" number="2.4.2.1">
<h4 class="hasAnchor"><span class="header-section-number">2.4.2.1</span> <code>sjPlot</code><a href="#sjplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>sjPlot does a very nice job of being able to cleanly show not only n’s but percents.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_xtab</span>(dsmall<span class="sc">$</span>color, dsmall<span class="sc">$</span>cut, <span class="at">margin=</span><span class="st">&quot;row&quot;</span>, <span class="at">coord.flip =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
</div>
<div id="mosaic-plots" class="section level4 hasAnchor" number="2.4.2.2">
<h4 class="hasAnchor"><span class="header-section-number">2.4.2.2</span> Mosaic plots<a href="#mosaic-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>But what if you want to know how two categorical variables are related and you don’t want to look at two different barplots? Mosaic plots are a way to visualize the proportions in a table. So here’s the two-way table we’ll be plotting.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dsmall<span class="sc">$</span>cut, dsmall<span class="sc">$</span>color)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="do">##            </span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="do">##              D  E  F  G  H  I  J</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Fair       5  6  7  4  5  4  3</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Good      18 23 11 16 17  7  7</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Very Good 26 37 46 40 33 25 13</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Premium   34 53 43 49 41 24 13</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Ideal     54 63 79 92 53 34 15</span></span></code></pre></div>
<p>The syntax for a mosaic plot uses <em>model notation</em>, which is basically y ~ x where the ~ is read as “twiddle” or “tilde”. It’s to the left of your <strong>1</strong> key.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(cut<span class="sc">~</span>color, <span class="at">data=</span>dsmall)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Helpful, ish. Here are two very useful options. In reverse obviousness, <code>color</code> applies shades of gray to one of the factor levels, and <code>shade</code> applies a color gradient scale to the cells in order of what is less than expected (red) to what is more than expected (blue) if these two factors were completely independent.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co"># display the plots in 1 row and 2 columns</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(cut<span class="sc">~</span>color, <span class="at">data=</span>dsmall, <span class="at">color=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(cut<span class="sc">~</span>color, <span class="at">data=</span>dsmall, <span class="at">shade=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-47-1.png" width="960" /></p>
<p>For example, there are fewer ‘Very Good’ cut diamonds that are color ‘G’, and fewer ‘Premium’ cut diamonds that are color ‘H’. As you can see, knowing what your data means when trying to interpret what the plots are telling you is essential.</p>
<p>That’s about all the ways you can plot categorical variables.
If you are wondering why there was no 3D barcharts demonstrated see<br />
<a href="http://faculty.atu.edu/mfinan/2043/section31.pdf">here</a>,
<a href="http://www.bbc.co.uk/schools/gcsebitesize/maths/statistics/representingdata2rev5.shtml">here</a>, and
<a href="https://en.wikipedia.org/wiki/Misleading_graph">here</a> for other ways you can really screw up your visualization.</p>
</div>
</div>
<div id="continuous-v.-continuous" class="section level3 hasAnchor" number="2.4.3">
<h3 class="hasAnchor"><span class="header-section-number">2.4.3</span> Continuous v. Continuous<a href="#continuous-v.-continuous" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="scatterplot" class="section level4 hasAnchor" number="2.4.3.1">
<h4 class="hasAnchor"><span class="header-section-number">2.4.3.1</span> Scatterplot<a href="#scatterplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The most common method of visualizing the relationship between two continuous variables is by using a scatterplot.</p>
<p><strong>base</strong>
Back to the <code>plot()</code> command. Here we use model notation again, so it’s <span class="math inline">\(y~x\)</span>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(price<span class="sc">~</span>carat, <span class="at">data=</span>dsmall)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>Looks like for the most part as the carat value increases so does price. That makes sense.</p>
<p><strong>ggplot</strong>
With ggplot we specify both the x and y variables, and add a point.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p><strong>Other Resources</strong></p>
<ul>
<li><a href="http://www.statmethods.net/graphs/scatterplot.html" class="uri">http://www.statmethods.net/graphs/scatterplot.html</a><br />
</li>
<li><a href="https://www.r-bloggers.com/scatterplot-matrices/" class="uri">https://www.r-bloggers.com/scatterplot-matrices/</a></li>
</ul>
</div>
<div id="adding-lines-to-the-scatterplots" class="section level4 hasAnchor" number="2.4.3.2">
<h4 class="hasAnchor"><span class="header-section-number">2.4.3.2</span> Adding lines to the scatterplots<a href="#adding-lines-to-the-scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Two most common trend lines added to a scatterplots are the “best fit” straight line and the “lowess” smoother line.</p>
<p><strong>base</strong>
The best fit line (in blue) gets added by using the <code>abline()</code> function wrapped around the linear model function <code>lm()</code>. Note it uses the same model notation syntax and the <code>data=</code> statement as the <code>plot()</code> function does. The lowess line is added using the <code>lines()</code> function, but the <code>lowess()</code> function itself doesn’t allow for the <code>data=</code> statement so we have to use <code>$</code> sign notation.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(price<span class="sc">~</span>carat, <span class="at">data=</span>dsmall)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(price<span class="sc">~</span>carat, <span class="at">data=</span>dsmall), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(dsmall<span class="sc">$</span>price<span class="sc">~</span>dsmall<span class="sc">$</span>carat), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p><strong>ggplot</strong>
With ggplot, we just add a <code>geom_smooth()</code> layer.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>() </span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>Here the point-wise confidence interval for this lowess line is shown in grey. If you want to turn the confidence interval off, use <code>se=FALSE</code>. Also notice that the smoothing geom uses a different function or window than the <code>lowess</code> function used in base graphics.</p>
<p>Here it is again using the <code>ggplot</code> plotting function and adding another <code>geom_smooth()</code> layer for the <code>lm</code> (linear model) line in blue, and the lowess line (by not specifying a method) in red.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
</div>
<div id="line-plots" class="section level4 hasAnchor" number="2.4.3.3">
<h4 class="hasAnchor"><span class="header-section-number">2.4.3.3</span> Line plots<a href="#line-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Line plots connect each dot with a straight line. This is most often done when measuring trends of the response as the value of x increases (such as a time series)</p>
<p>We saw earlier that <code>carat</code> and <code>price</code> seemed possibly linear. Let see how the average price changes with carat.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>price.per.carat <span class="ot">&lt;-</span> dsmall <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(carat) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(price))</span></code></pre></div>
<p><strong>base</strong>
For base graphics, type=‘b’ means both points and lines, ‘l’ gives you just lines and ‘p’ gives you only points. You can find more plotting character options under <code>?pch</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mean<span class="sc">~</span>carat, <span class="at">data=</span>price.per.carat, <span class="at">type=</span><span class="st">&#39;l&#39;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p><strong>ggplot</strong>
With ggplot we specify that we want a line geometry only.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(price.per.carat, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>mean)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>How does this relationship change with cut of the diamond? First lets
get the average price per combination of carat and cut.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>ppc2 <span class="ot">&lt;-</span> dsmall <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cut, carat) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(price))</span></code></pre></div>
<p><strong>base</strong>
This plot can be created in base graphics, but it takes an advanced
knowledge of the graphics system to do so. So I do not show it here.</p>
<p><strong>ggplot</strong>
This is where ggplot starts to excel in it’s ease of creating more
complex plots. All we have to do is specify that we want the lines
colored by the cut variable.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ppc2, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>mean, <span class="at">col=</span>cut)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<p>And we get one line per cut.</p>
</div>
</div>
<div id="continuous-v.-categorical" class="section level3 hasAnchor" number="2.4.4">
<h3 class="hasAnchor"><span class="header-section-number">2.4.4</span> Continuous v. Categorical<a href="#continuous-v.-categorical" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create an appropriate plot for a continuous variable, and plot it for each
level of the categorical variable.</p>
<div id="dotplotstrip-chart" class="section level4 hasAnchor" number="2.4.4.1">
<h4 class="hasAnchor"><span class="header-section-number">2.4.4.1</span> Dotplot/strip chart<a href="#dotplotstrip-chart" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Dotplots can be very useful when plotting dots against several categories. They can also be called stripcharts.</p>
<p><strong>base</strong></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stripchart</span>(carat <span class="sc">~</span> cut, <span class="at">data=</span>dsmall)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>Doesn’t look to pretty, but kinda gets the point across. Few fair quality diamonds in the data set, pretty spread out across the carat range except one high end outlier.</p>
<p><strong>ggplot</strong>
We can reproduce the same thing by plotting one continuous variable against one categorical variable, and adding a layer of points. I’d argue that horizontal looks better due to the axis-labels.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">y=</span>carat, <span class="at">x=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">y=</span>cut, <span class="at">x=</span>carat)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(a, b, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
</div>
<div id="grouped-boxplots" class="section level4 hasAnchor" number="2.4.4.2">
<h4 class="hasAnchor"><span class="header-section-number">2.4.4.2</span> Grouped boxplots<a href="#grouped-boxplots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>base</strong>
Base graphics plots grouped boxplots with also just the addition of a twiddle (tilde) <code>~</code>.
Another example of where model notation works.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(carat<span class="sc">~</span>color, <span class="at">data=</span>dsmall)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p><strong>ggplot</strong>
A simple addition, just define your x and y accordingly.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>color, <span class="at">y=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p><strong>Adding violins</strong>
Violin plots can be overlaid here as well.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>color, <span class="at">y=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_violin</span>(<span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">width=</span>.<span class="dv">2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
</div>
<div id="grouped-histograms" class="section level4 hasAnchor" number="2.4.4.3">
<h4 class="hasAnchor"><span class="header-section-number">2.4.4.3</span> Grouped histograms<a href="#grouped-histograms" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>base</strong>
There is no easy way to create grouped histograms in base graphics we will skip it.</p>
<p><strong>ggplot</strong>
By default ggplot wants to overlay all plots on the same grid. This doesn’t look to good with histograms. Instead you can overlay density plots</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(a,b, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-63-1.png" width="960" /></p>
<p>The solid fills are still difficult to read, so we can either turn down the alpha (turn up the transparency) or only color the lines and not the fill.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">col=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(c,d, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-64-1.png" width="960" /></p>
</div>
</div>
<div id="joy-plots-ridgelines" class="section level3 hasAnchor" number="2.4.5">
<h3 class="hasAnchor"><span class="header-section-number">2.4.5</span> Joy plots / Ridgelines<a href="#joy-plots-ridgelines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Somewhat new (2017), joylines have not been added to the base distribution of <code>ggplot2</code> yet. For now it’s available in the <code>ggjoy</code> package. Really good way to visualize density plots without the overlapping issue.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggjoy)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>color)) <span class="sc">+</span> <span class="fu">geom_joy</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-65-1.png" width="960" /></p>
</div>
</div>
<div id="faceting-paneling" class="section level2 hasAnchor" number="2.5">
<h2 class="hasAnchor"><span class="header-section-number">2.5</span> Faceting / paneling<a href="#faceting-paneling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is a good place to introduce a term called <code>faceting</code>. The definition is <em>a particular aspect or feature of something</em>, or <em>one side of something many-sided, especially of a cut gem</em>. Basically instead of plotting the grouped graphics on the same plotting area, we let each group have it’s own plot, or facet.</p>
<p>We add a <code>facet_wrap()</code> and specify that we want to panel on the color group. Note the twiddle in front of color.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>color)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>The grid placement can be semi-controlled by using the <code>ncol</code> argument in the <code>facet_wrap()</code> statement.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>color, <span class="at">ncol=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>It is important to compare distributions across groups on the same scale, and our eyes can compare items vertically better than horizontally. So let’s force <code>ncol=1</code>.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>color, <span class="at">ncol=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="multiple-plots-per-window" class="section level2 hasAnchor" number="2.6">
<h2 class="hasAnchor"><span class="header-section-number">2.6</span> Multiple plots per window<a href="#multiple-plots-per-window" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>base</strong>
I use <code>par(mfrow=c(r,c))</code> for base graphics, where <code>r</code> is the number of rows and <code>c</code> the number of columns.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsmall<span class="sc">$</span>carat)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsmall<span class="sc">$</span>color)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsmall<span class="sc">$</span>price <span class="sc">~</span> dsmall<span class="sc">$</span>carat)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Other resources including learning about <code>layouts</code>. Multipanel plotting with base graphics <a href="http://seananderson.ca/courses/11-multipanel/multipanel.pdf" class="uri">http://seananderson.ca/courses/11-multipanel/multipanel.pdf</a></p>
<p><strong>ggplot</strong>
Use the <code>grid.arrange</code> function in the <code>gridExtra</code> package. I’ve done it several times above. You assign the output of a ggplot object to an object (here it’s <code>plot1</code> and <code>plot2</code>). Then you use <code>grid.arrange()</code> to arrange them either side by side or top and bottom.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">col=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(a,b, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="multivariate-3-variables" class="section level2 hasAnchor" number="2.7">
<h2 class="hasAnchor"><span class="header-section-number">2.7</span> Multivariate (3+ variables)<a href="#multivariate-3-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is not much more complicated than taking an appropriate bivariate plot and adding a third variable through paneling, coloring, or changing a shape.</p>
<p>This is trivial to do in ggplot, not trivial in base graphics. So I won’t show those examples.</p>
<div id="three-continuous" class="section level3 hasAnchor" number="2.7.1">
<h3 class="hasAnchor"><span class="header-section-number">2.7.1</span> Three continuous<a href="#three-continuous" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Continuous variables can also be mapped to the size of the point. Here I set the alpha on the points so we could see the overplotting (many points on a single spot). So the darker the spot the more data points on that spot.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">size=</span>depth)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="scatterplot-matrix" class="section level3 hasAnchor" number="2.7.2">
<h3 class="hasAnchor"><span class="header-section-number">2.7.2</span> Scatterplot matrix<a href="#scatterplot-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A scatterplot matrix allows you to look at the bivariate comparison of multiple pairs of variables simultaneously. First we need to trim down the data set to only include the variables we want to plot, then we use the <code>pairs()</code> function.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>c.vars <span class="ot">&lt;-</span> dsmall[,<span class="fu">c</span>(<span class="st">&#39;carat&#39;</span>, <span class="st">&#39;depth&#39;</span>, <span class="st">&#39;price&#39;</span>, <span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;z&#39;</span>)]</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(c.vars)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-72-1.png" width="672" />
We can see price has a non-linear relationship with X, Y and Z and x &amp; y have a near perfect linear relationship.</p>
</div>
<div id="two-categorical-and-one-continuous" class="section level3 hasAnchor" number="2.7.3">
<h3 class="hasAnchor"><span class="header-section-number">2.7.3</span> Two categorical and one continuous<a href="#two-categorical-and-one-continuous" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is very similar to side by side boxplots, one violin plot per <code>cut</code>, within each level of color. This is difficult to really see due to the large number of categories each factor has.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>color, <span class="at">y=</span>price, <span class="at">fill=</span>cut)) <span class="sc">+</span> <span class="fu">geom_violin</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Best bet here would be to panel on color and change the x axis to cut.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>cut, <span class="at">y=</span>price, <span class="at">fill=</span>cut)) <span class="sc">+</span> <span class="fu">geom_violin</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>color)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="two-continuous-and-one-categorical" class="section level3 hasAnchor" number="2.7.4">
<h3 class="hasAnchor"><span class="header-section-number">2.7.4</span> Two continuous and one categorical<a href="#two-continuous-and-one-categorical" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">color=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Colored by cut&quot;</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">color=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Lowess line per cut&quot;</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(a, d, <span class="at">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Change the shape</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">shape=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Shape by cut&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>Or we just panel by the third variable</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>cut)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
</div>
<div id="paneling-on-two-variables" class="section level2 hasAnchor" number="2.8">
<h2 class="hasAnchor"><span class="header-section-number">2.8</span> Paneling on two variables<a href="#paneling-on-two-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Who says we’re stuck with only faceting on one variable? A variant on <code>facet_wrap</code> is <code>facet_grid</code>. Here we can specify multiple variables to panel on.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">fill=</span>color)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(cut<span class="sc">~</span>color)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-78-1.png" width="960" /></p>
<p>How about plotting price against caret, for all combinations of color and clarity, with the points further separated by cut?</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">color=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(clarity<span class="sc">~</span>color)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>And lastly let’s look back at how we can play with scatterplots of using a third categorical variable (using <code>ggplot2</code> only). We can color the points by cut,</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">color=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>We could add a smoothing lowess line for each cut separately,</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">color=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>We could change the color by clarity, and shape by cut.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dsmall, <span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price, <span class="at">color=</span>clarity, <span class="at">shape=</span>cut)) <span class="sc">+</span> <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>That’s pretty hard to read. So note that just because you <strong>can</strong> change an aesthetic, doesn’t mean you should. And just because you can plot things on the same axis, doesn’t mean you have to.</p>
<p>Before you share your plot with any other eyes, always take a step back and try to explain what it is telling you. If you have to take more than a minute to get to the point then it may be too complex and simpler graphics are likely warranted.</p>
<hr />
</div>
<div id="troubleshooting" class="section level2 hasAnchor" number="2.9">
<h2 class="hasAnchor"><span class="header-section-number">2.9</span> Troubleshooting<a href="#troubleshooting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Problem:</strong> Missing data showing up as a category in ggplot?</p>
<p>Get rid of that far right bar!</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(NCbirths, <span class="fu">aes</span>(<span class="at">x=</span>marital)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<p><strong>Solution:</strong> Use <code>dplyr</code> to select only the variables you are going to plot, then pipe in the <code>na.omit()</code> at the end. It will create a temporary data frame (e.g) <code>plot.data</code> that you then provide to <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>plot.data <span class="ot">&lt;-</span> NCbirths <span class="sc">%&gt;%</span> <span class="fu">select</span>(marital) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data, <span class="fu">aes</span>(<span class="at">x=</span>marital)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p><strong>Problem:</strong> Got numerical binary 0/1 data but want to plot it as categorical?
&gt; Other related error messages:
&gt; * Continuous x aesthetic – did you forget aes(group=…)?</p>
<p>Consider a continuous variable for the number of characters in an email <code>num_char</code>, and a 0/1 binary variable <code>spam</code>.</p>
<p><strong>Solution:</strong> Create a second variable <code>var_factor</code> for plotting and keep the binary <code>var</code> as 0/1 for analysis.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>email<span class="sc">$</span>spam_cat <span class="ot">&lt;-</span> <span class="fu">factor</span>(email<span class="sc">$</span>spam, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Ham&quot;</span>, <span class="st">&quot;Spam&quot;</span>))</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(email, <span class="fu">aes</span>(<span class="at">y=</span>num_char, <span class="at">x=</span>spam_cat)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p><strong>Problem:</strong> You want to change the legend title for a <code>fill</code> or <code>color</code> scale.</p>
<p><strong>Solution:</strong> Add the <code>name=</code> argument to whatever layer you added that created the legend. Here I speciefied a <code>fill</code>, and it was a <code>discrete</code> variable. So I use the <code>scale_fill_discrete()</code> layer.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(email, <span class="fu">aes</span>(<span class="at">y=</span>num_char, <span class="at">x=</span>spam_cat, <span class="at">fill=</span>spam_cat)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name=</span><span class="st">&quot;Ya like Spam?&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>Here, I <code>col</code>ored the points by a discrete variable, so the layer is <code>scale_color_discrete()</code>.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(email, <span class="fu">aes</span>(<span class="at">x=</span>num_char, <span class="at">y=</span>line_breaks, <span class="at">col=</span>spam_cat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Ya like Spam?&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p><strong>Problem:</strong> You want to add means to boxplots.
Boxplots are great. Even better with violin overlays. Know what makes them even better than butter? Adding a point for the mean. <code>stat_summary</code> is the layer you want to add. Check out <a href="https://stackoverflow.com/questions/23942959/ggplot2-show-separate-mean-values-in-box-plot-for-grouped-data">this stack overflow post</a> for more context.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(email, <span class="fu">aes</span>(<span class="at">x=</span>spam_cat, <span class="at">y=</span>num_char, <span class="at">fill=</span>spam_cat)) <span class="sc">+</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y=</span><span class="st">&quot;mean&quot;</span>, <span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">17</span>,<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data_viz_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>I suggest playing around with <code>size</code> and plotting character <code>pch</code> to get a feel for how these work. You can also look at <code>?pch</code> (and scroll down in the help file) to see the 25 default plotting characters.</p>
</div>
<div id="but-what-about" class="section level2 hasAnchor" number="2.10">
<h2 class="hasAnchor"><span class="header-section-number">2.10</span> But what about…<a href="#but-what-about" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Legend adjustment: remove it, move it to another side, rename it</li>
<li>Custom specified colors and shapes</li>
</ul>
<p>Go here <a href="http://www.cookbook-r.com/Graphs/" class="uri">http://www.cookbook-r.com/Graphs/</a> for these.</p>
<div id="other-plots-not-mentioned" class="section level3 hasAnchor" number="2.10.1">
<h3 class="hasAnchor"><span class="header-section-number">2.10.1</span> Other plots not mentioned<a href="#other-plots-not-mentioned" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Heat maps <a href="https://www.r-bloggers.com/how-to-make-a-simple-heatmap-in-ggplot2/" class="uri">https://www.r-bloggers.com/how-to-make-a-simple-heatmap-in-ggplot2/</a></li>
<li>Word clouds <a href="https://rpubs.com/brandonkopp/creating-word-clouds-in-r" class="uri">https://rpubs.com/brandonkopp/creating-word-clouds-in-r</a> , simpler: <a href="http://dangoldin.com/2016/06/06/word-clouds-in-r/" class="uri">http://dangoldin.com/2016/06/06/word-clouds-in-r/</a></li>
<li>Interactive plots - Look into <code>plotly()</code> and <code>ggplotly()</code></li>
<li>the circle type plots</li>
</ul>
</div>
</div>
<div id="additional-resources" class="section level2 hasAnchor" number="2.11">
<h2 class="hasAnchor"><span class="header-section-number">2.11</span> Additional Resources<a href="#additional-resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For any Google Search - be sure to limit searches to within the past year or so. R packages get updated very frequently, and many functions change or become obsolete.</p>
<ul>
<li>R Graphics: <a href="https://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html" class="uri">https://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html</a> The best book about using base graphics</li>
<li>R Graphics Cookbook: <a href="http://www.cookbook-r.com/Graphs/" class="uri">http://www.cookbook-r.com/Graphs/</a> or <a href="http://amzn.com/1449316956" class="uri">http://amzn.com/1449316956</a> The best book for using ggplot2</li>
<li>STHDA: Statisical tools for high-throughput data analysis. <a href="http://www.sthda.com/english/" class="uri">http://www.sthda.com/english/</a></li>
<li>Quick-R: <a href="http://www.statmethods.net/graphs/index.html">Basic Graphs</a></li>
<li>Quick-R: <a href="http://www.statmethods.net/advgraphs/ggplot2.html">ggplot2</a></li>
<li>Books
<ul>
<li>ggplot2 <a href="http://ggplot2.org/book/" class="uri">http://ggplot2.org/book/</a> or <a href="http://amzn.com/0387981403" class="uri">http://amzn.com/0387981403</a></li>
<li>qplot <a href="http://ggplot2.org/book/qplot.pdf" class="uri">http://ggplot2.org/book/qplot.pdf</a></li>
</ul></li>
<li>Help lists
<ul>
<li>ggplot2 mailing list <a href="http://groups.google.com/group/ggplot2" class="uri">http://groups.google.com/group/ggplot2</a></li>
<li>stackoverflow <a href="http://stackoverflow.com/tags/ggplot2" class="uri">http://stackoverflow.com/tags/ggplot2</a></li>
<li>Chico R users group</li>
</ul></li>
</ul>
<!--chapter:end:data_viz.Rmd-->
</div>
</div>
<div id="select_analysis" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Selecting Appropriate Analyses<a href="#select_analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>In Progress</em>
This section covers how to choose appropriate analyses for any number and type of measurements.
Think like, flow chart.</p>
<p><strong>Considerations:</strong></p>
<ul>
<li>Purpose of analysis.<br />
</li>
<li>Types of variables in data set.<br />
</li>
<li>Data used in analysis.<br />
</li>
<li>Assumptions needed; satisfied?<br />
</li>
<li>Choice of analyses is often arbitrary: consider several</li>
</ul>
<p><strong>Example:</strong></p>
<p>5 independent variables: 3 interval, 1 ordinal, 1 nominal</p>
<p>1 dependent variable: interval</p>
<p>Analysis options</p>
<ul>
<li>Multiple regression: pretend independent ordinal variable is an
interval variable use dummy (0 /1) variables for nominal variables</li>
<li>Analysis of variance: categorize all independent variables</li>
<li>Analysis of covariance: leave variables as is, check assumptions</li>
<li>Logistic regression: Categorize dependent variable: high, low</li>
<li>Survival analysis: IF dependent variable is time to an event</li>
</ul>
<p>Unsure? Do several and compare results.</p>
<!--chapter:end:select_analysis.Rmd-->
</div>
<div id="part-statistical-inference" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART) Statistical Inference<a href="#part-statistical-inference" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="bv-intro" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Foundations for Inference<a href="#bv-intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>Add a section prior to this on foundations for inference.</p>
</blockquote>
<!--chapter:end:bivariate_intro.Rmd-->
</div>
<div id="bivariate-analysis" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Bivariate Analysis<a href="#bivariate-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>So far we have been concerned with making inference about a single population parameter.
Many problems deal with comparing a parameter across two or more groups. Research
questions include questions like:</p>
<ul>
<li>Does the average life span differ across subspecies of a particular turtle?</li>
<li>Who has a higher percentage of the female vote - Democrats or Republicans?</li>
</ul>
<p>A good way to think about all statistical models is that the observed data comes from some true model with some random error.</p>
<blockquote>
<p>DATA = MODEL + RESIDUAL</p>
</blockquote>
<p>The <code>MODEL</code> is a mathematical formula (like <span class="math inline">\(y = f(x)\)</span>).
The formulation of the <code>MODEL</code> will change depending on the number of, and data types of explanatory variables. One goal of inferential analysis is to explain the variation in our data, using information contained in other measures.</p>
<div id="assumption-of-independent-observations" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Assumption of Independent Observations<a href="#assumption-of-independent-observations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The primary assumption of most standard statistical procedures is that observations are
independent of each other. That is, the value of one observation does not change or affect another observation.
However, there are many examples where measurements are made
on subjects before and after a certain exposure or treatment (pre-post), or an
experiment to compare two cell phone packages might use pairs of subjects that
are the same age, sex and income level. One subject would be randomly assigned
to the first phone package, the other in the pair would get the second phone package.
This chapter only deals with non-correlated analyses, leaving that topic for a later chapter.</p>
</div>
<div id="choosing-appropriate-bivariate-analysis" class="section level2 hasAnchor" number="5.2">
<h2 class="hasAnchor"><span class="header-section-number">5.2</span> Choosing appropriate bivariate analysis<a href="#choosing-appropriate-bivariate-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Choosing which statistical analyses procedure is appropriate completely depending on the data types of the explanatory and response variable. This is a simplified table, only covering the common/standard types of bivariate analysis.</p>
<blockquote>
<p>figure out how to get table here.</p>
</blockquote>
<p>For this set of notes, the variable types are referred to using the first letter,
e.g. <em>Q</em> for quantitative, <em>B</em> for binary, and <em>C</em> for categorical.
Thus a T-test is a (Q <span class="math inline">\(\sim\)</span> B) analysis, and a correlation analysis is (Q <span class="math inline">\(\sim\)</span> Q) analysis.</p>
<p>Links to the example data used in this chapter.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://norcalbiostat.netlify.com/data/addhealth_clean.Rdata&quot;</span>))</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>county <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://norcalbiostat.netlify.com/data/countyComplete.csv&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<hr />
</div>
<div id="bv-ttest" class="section level2 hasAnchor" number="5.3">
<h2 class="hasAnchor"><span class="header-section-number">5.3</span> (Q~B) Two means: T-Test<a href="#bv-ttest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is common to compare means from different samples. For instance, we
might investigate the effectiveness of a certain educational intervention
by looking for evidence of greater reading ability in the treatment group
against a control group. That is, our research hypothesis is that reading
ability of a child is associated with an educational intervention.</p>
<p>The null hypothesis states that there is no relationship, or no effect, of
the educational intervention (binary explanatory variable) on the reading ability
of the child (quantitative response variable). This can be written in symbols as follows:</p>
<p><span class="math display">\[H_{0}: \mu_{1} = \mu_{2}\mbox{ or }\qquad  H_{0}: \mu_{1} -\mu_{2}=0\]</span></p>
<p>where <span class="math inline">\(\mu_{1}\)</span> is the average reading score for students in the control group (no intervention)
and <span class="math inline">\(\mu_{2}\)</span> be the average reading score for students in the intervention group. Notice it can be written as one mean equals the other, but also as the difference between two means equaling zero.
The alternative hypothesis <span class="math inline">\(H_{A}\)</span> states that there is a relationship:</p>
<p><span class="math display">\[H_{A}: \mu_{1} \neq \mu_{2} \qquad \mbox{ or } \qquad H_{A}: \mu_{1}-\mu_{2} \neq 0\]</span></p>
<div id="assumptions" class="section level3 hasAnchor" number="5.3.1">
<h3 class="hasAnchor"><span class="header-section-number">5.3.1</span> Assumptions<a href="#assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The data distribution for each group is approximately normal.</li>
<li>The scores are independent within each group.</li>
<li>The scores from the two groups are independent of each other (i.e. the two samples are independent).</li>
</ul>
</div>
<div id="sampling-distribution-for-the-difference" class="section level3 hasAnchor" number="5.3.2">
<h3 class="hasAnchor"><span class="header-section-number">5.3.2</span> Sampling Distribution for the difference<a href="#sampling-distribution-for-the-difference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We use <span class="math inline">\(\bar{x}_1 - \bar{x}_2\)</span> as a point estimate for <span class="math inline">\(\mu_1 - \mu_2\)</span>, which has a standard error of</p>
<p><span class="math display">\[
SE_{\bar{x}_1 - \bar{x}_2}
   = \sqrt{SE_{\bar{x}_1}^2 + SE_{\bar{x}_2}^2}
     = \sqrt{\frac{\sigma^{2}_{1}}{n_1} + \frac{\sigma^{2}_{2}}{n_2}}
\]</span></p>
<p>So the equations for a Confidence Interval is,</p>
<p><span class="math display">\[
  \left( \bar{x}_{1} - \bar{x}_{2} \right) \pm t_{\frac{\alpha}{2}, df}
    \sqrt{ \frac{\sigma^{2}_{1}}{n_{1}} + \frac{\sigma^{2}_{2}}{n_{2}} }
\]</span></p>
<p>and Test Statistic is,</p>
<p><span class="math display">\[
  t^{*} =  \frac{\left( \bar{x}_{1} - \bar{x}_{2} \right) - d_{0}}
       {\left( \sqrt{ \frac{\sigma^{2}_{1}}{n_{1}} + \frac{\sigma^{2}_{2}}{n_{2}} }
       \right )}
\]</span></p>
<p>Typically it is unlikely that the population variances <span class="math inline">\(\sigma^{2}_{1}\)</span> and <span class="math inline">\(\sigma^{2}_{2}\)</span> are known so we will use sample variances <span class="math inline">\(s^{2}_{1}\)</span> and <span class="math inline">\(s^{2}_{2}\)</span> as estimates.</p>
<p>While you may never hand calculate these equations, it is important to see the format, or structure, of the equations. Equation <span class="math inline">\(\ref{2sampCImean}\)</span> has the same format of</p>
<p><span class="math display">\[ \mbox{point estimate} \pm 2*\mbox{standard error}\]</span></p>
<p>regardless what it is we’re actually trying to estimate. Thus in a pinch, you can calculate approximate confidence intervals for whatever estimate you are trying to understand, given only the estimate and standard error, even if the computer program does not give it to you easily or directly.</p>
</div>
<div id="example-smoking-and-bmi" class="section level3 hasAnchor" number="5.3.3">
<h3 class="hasAnchor"><span class="header-section-number">5.3.3</span> Example: Smoking and BMI<a href="#example-smoking-and-bmi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We would like to know, is there convincing evidence that the average BMI differs between those who have ever smoked a cigarette in their life compared to those who have never smoked? This example uses the Addhealth dataset.</p>
<p><strong>1. Identify response and explanatory variables.</strong></p>
<ul>
<li>The quantitative response variable is BMI (variable )</li>
<li>The binary explanatory variable is whether the person has ever smoked a cigarette (variable )</li>
</ul>
<p><strong>2. Visualize and summarize bivariate relationship.</strong></p>
<p>⚠️ Using <code>na.omit()</code> is dangerous! This will remove ALL rows with ANY missing data in it. Regardless if the missing values are contained in the variables you are interested in.
The example below employs a trick/work around to not have NA values show in the output.
We take the data set <code>addhealth</code> <em>and then</em> <code>select</code> the variables we want to plot, <em>and then</em> we use <code>na.omit()</code> to delete all rows with missing data. Then that is saved as a new, temporary data frame specifically named for this case (<code>plot.bmi.smoke</code>).</p>
<blockquote>
<p>note for later. Move this explanation into data viz section.</p>
</blockquote>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>plot.bmi.smoke <span class="ot">&lt;-</span> addhealth <span class="sc">%&gt;%</span> <span class="fu">select</span>(eversmoke_c, BMI) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.bmi.smoke, <span class="fu">aes</span>(<span class="at">x=</span>eversmoke_c, <span class="at">y=</span>BMI, <span class="at">fill=</span>eversmoke_c)) <span class="sc">+</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width=</span>.<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">geom_violin</span>(<span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Smoking status&quot;</span>) <span class="sc">+</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis_d</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_summary</span>(<span class="at">fun.y=</span><span class="st">&quot;mean&quot;</span>, <span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">17</span>,</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.75</span>))</span></code></pre></div>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>plot.bmi.smoke <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(eversmoke_c) <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(BMI, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sd =</span> <span class="fu">sd</span>(BMI, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">IQR =</span> <span class="fu">IQR</span>(BMI, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 4</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   eversmoke_c  mean    sd   IQR</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Non Smoker   29.7  7.76  9.98</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Smoker       28.8  7.32  9.02</span></span></code></pre></div>
<p>Smokers have an average BMI of 28.8, smaller than the average BMI of non-smokers at 29.7. Nonsmokers have more variation in their BMIs (sd 7.8 v. 7.3 and IQR 9.98 v. 9.02), but the distributions both look normal, if slightly skewed right.</p>
<p><strong>3. Write the relationship you want to examine in the form of a research question.</strong></p>
<ul>
<li>Null Hypothesis: There is no relationship between BMI and smoking status.</li>
<li>Alternate Hypothesis: There is a relationship between BMI and smoking status.</li>
</ul>
<p><strong>4. Perform an appropriate statistical analysis.</strong></p>
<p>I. Let <span class="math inline">\(\mu_1\)</span> denote the average BMI for nonsmokers, and <span class="math inline">\(\mu_2\)</span> the average BMI for smokers.</p>
<ol start="2" style="list-style-type: upper-roman">
<li><p><span class="math inline">\(\mu_1 - \mu_2 = 0\)</span> There is no difference in the average BMI between smokers and nonsmokers.
<span class="math inline">\(\mu_1 - \mu_2 \neq 0\)</span> There is a difference in the average BMI between smokers and nonsmokers.</p></li>
<li><p>We are comparing the means between two independent samples. A Two-Sample T-Test for a difference in means will be conducted. The assumptions that the groups are independent is upheld because each individual can only be either a smoker or nonsmoker. The difference in sample means <span class="math inline">\(\bar{x_1} - \bar{x_2}\)</span> is normally distributed – this is a valid assumption due to the large sample size and that differences typically are normally distributed. The observations are independent, and the variability is roughly equal (IQR 9.9 v. 9.0).</p></li>
<li><p>We use the <code>t.test</code> function, but use model notation of the format <code>outcome</code> <span class="math inline">\(\sim\)</span> <code>category</code>. Here, <code>BMI</code> is our continuous outcome that we’re testing across the (binary) categorical predictor <code>eversmoke_c</code>.</p></li>
</ol>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(BMI <span class="sc">~</span> eversmoke_c, <span class="at">data=</span>addhealth)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Welch Two Sample t-test</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  BMI by eversmoke_c</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="do">## t = 3.6937, df = 3395.3, p-value = 0.0002245</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true difference in means between group Non Smoker and group Smoker is not equal to 0</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.3906204 1.2744780</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="do">## mean in group Non Smoker     mean in group Smoker </span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                 29.67977                 28.84722</span></span></code></pre></div>
<p>We have very strong evidence against the null hypothesis, <span class="math inline">\(p = 0.0002\)</span>.</p>
<p><strong>5. Write a conclusion in the context of the problem.</strong></p>
<p>On average, nonsmokers have a significantly higher BMI by 0.83 (0.39, 1.27) compared to nonsmokers (<span class="math inline">\(p = 0.0002\)</span>).</p>
<p>⚠️ Always check the output against the direction you are testing. R always will calculate a difference as group 1 - group 2, and it defines the groups alphabetically. For example, for a factor variable that has groups A and B, R will automatically calculate the difference as A-B. In this example it is Nonsmoker - Smoker.</p>
<hr />
</div>
</div>
<div id="bv-anova" class="section level2 hasAnchor" number="5.4">
<h2 class="hasAnchor"><span class="header-section-number">5.4</span> (Q~C) Multiple means: ANOVA<a href="#bv-anova" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Frequently, a researcher wants to compare the means of an outcome across three or more treatments in a single experiment. We might initially think to do pairwise comparisons (1v2, 1v3, 2v3) for a total of three comparisons. However, this strategy can be treacherous. If we have many groups and do many comparisons, it is likely that we will eventually find a difference just by chance, even if there is no difference in the populations.</p>
<p>When we analyze a conventional two-treatment experiment, we are prepared to run a 1 in 20 risk of an apparently significant result arising purely by accident (the 5% chance of a Type I error). We regard such a risk as being fairly unlikely and feel justified in accepting with confidence any significant results we obtain.</p>
<p>Analyzing a single experiment as a series of 10 treatment pairs is a very different proposition. The chance of an apparently significant result arising purely by chance somewhere in the 10 analyses increases dramatically. Using a 5% error rate, the chance of NOT making at Type I error is .95. To not make a Type I error 10 times is <span class="math inline">\(.95^{10} = .6\)</span>. That means there is a 40% of making a Type I error! </p>
<div id="example-visual-comparison" class="section level4 hasAnchor" number="5.4.0.1">
<h4 class="hasAnchor"><span class="header-section-number">5.4.0.1</span> Example: Visual Comparison<a href="#example-visual-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Examine the figure below. Compare groups I, II, and III. Can you visually determine if the differences in the group centers is due to chance or not? What about groups IV, V, and VI?</p>
<div class="figure">
<img src="images/toyANOVA.png" alt="" />
<p class="caption">Side-by-side dot plot for the outcomes for six groups.</p>
</div>
<p>So we need some method of comparing treatments for more than two groups at a time.
This is done using an Analysis of Variance (ANOVA) model.
### Terminology</p>
<ul>
<li><strong>Response Variable</strong>: The response variable in the ANOVA setting is the quantitative (continuous) variable that we want to compare among the different treatments.</li>
<li><strong>Factor/Treatment</strong>: A property or characteristic (categorical variable) that allows us to distinguish the different populations from one another. An independent variable to be studied in an investigation such as temperature, type of plant, color of flower, location.</li>
<li><strong>Factor/Treatment level</strong>: Factors have different levels, such as 3 temperatures, 5 locations, 3 colors, etc.</li>
<li><strong>Within-sample Variation</strong>: Variation within a sample from one population. Individuals who receive the same treatment will experience identical experimental conditions. The variation within each of the treatment groups must therefore be a consequence of solely random variation.</li>
<li><strong>Between-sample Variation</strong>: Variation between samples. This is the difference between the group means. If some treatments are genuinely more effective than others, then we would expect to see relatively large differences between the treatment means and a relatively large between-treatments variation.</li>
</ul>
</div>
<div id="formulation-of-the-one-way-anova-model" class="section level3 hasAnchor" number="5.4.1">
<h3 class="hasAnchor"><span class="header-section-number">5.4.1</span> Formulation of the One-way ANOVA model<a href="#formulation-of-the-one-way-anova-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ANOVA is a mathematical technique which uses a model based approach to partition the variance in an experiment into different sources of variance. This technique enables us to test if most the variation in the treatment means is due to differences between the groups.</p>
<p>Starting with our generic conceptual understanding of statistical models:</p>
<blockquote>
<p>DATA = MODEL + RESIDUAL</p>
</blockquote>
<p>our MODEL for this situation is the group membership. Does knowing what group an observation is in tell you about the location of the data? The one-way (or one-factor) ANOVA model is</p>
<p><span class="math display">\[
y_{ij} = \mu_{i} + \epsilon_{ij} \qquad \qquad
\epsilon_{ij} \overset{iid}{\sim} \mathcal{N}(0,\sigma^{2})
\]</span></p>
<p>for <span class="math inline">\(i=1, \ldots, I\)</span> factor levels and <span class="math inline">\(j = 1, \ldots, n_{i}\)</span> subjects within each factor level. The random error terms are independently and identically distributed (iid) normally with common variance.</p>
<p>The null and alternative hypotheses are always phrased as follows:</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: The mean outcome is the same across all groups. <span class="math inline">\(\mu_1 = \mu_2 = \cdots = \mu_k\)</span></li>
<li><span class="math inline">\(H_A\)</span>: At least one mean is different.</li>
</ul>
<p>How do we compare means using an <strong>AN</strong>alysis <strong>O</strong>f <strong>VA</strong>riance? By comparing the portion of the variance in the outcome that is explained by the groups, to the portion that’s leftover due to unexplained randomness. Essentially we’re comparing the ratio of <code>MODEL</code> to <code>RESIDUAL</code>.</p>
<p>The total variation of the observed data is broken down into 2 parts:</p>
<blockquote>
<p>Total Variation = Between Group Variation + Within Group Variation</p>
</blockquote>
<p>Variation is measured using the Sum of Squares (SS): The sum of the squares within a group (SSE), the sum of squares between groups (SSG), and the total sum of squares (SST).</p>
<p><strong>SSG (Between groups)</strong>: Measures the variation of the <span class="math inline">\(I\)</span> group means around the overall mean.
<span class="math display">\[
  SSG = \sum_{i=1}^{I}n_{i}(\bar{y}_{i.}-\bar{y}..)^{2} = n_{1}(\bar{y}_{1.}-\bar{y}..)^{2} + n_{2}(\bar{y}_{2.}-\bar{y}..)^{2} + n_{3}(\bar{y}_{3.}-\bar{y}..)^{2}
\]</span></p>
<p><strong>SSE (Within group)</strong>: Measures the variation of each observation around its group mean.
<span class="math display">\[
SSE = \sum_{i=1}^{I}\sum_{j=1}^{n_{i}}(y_{ij}-\bar{y}_{i.})^{2} = \sum_{i=1}^{I}(n_{i}-1)Var(Y_{i})
\]</span></p>
<p><strong>SST (Total)</strong>: Measures the variation of the <span class="math inline">\(N\)</span> data points around the overall mean.
<span class="math display">\[
SST =  \sum_{i=1}^{I}\sum_{j=1}^{n_{i}}(y_{ij}-\bar{y}..)^{2} = (N-1)Var(Y)
\]</span></p>
</div>
<div id="analysis-of-variance-table" class="section level3 hasAnchor" number="5.4.2">
<h3 class="hasAnchor"><span class="header-section-number">5.4.2</span> Analysis of Variance Table*:<a href="#analysis-of-variance-table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The results of an analysis of variance test are always summarized in an ANOVA table. The format of an ANOVA table is as follows:</p>
<table style="width:96%;">
<colgroup>
<col width="13%" />
<col width="11%" />
<col width="10%" />
<col width="35%" />
<col width="25%" />
</colgroup>
<tbody>
<tr class="odd">
<td rowspan="2">Source
:=========
Groups</td>
<td rowspan="2">SS
:======:
SSG</td>
<td rowspan="2">df
:=====:
<span class="math inline">\(I-1\)</span></td>
<td rowspan="2">MS
:=========================:
MSG = <span class="math inline">\(\frac{SSG}{I-1}\)</span></td>
<td rowspan="2">F |
:=====:+
<span class="math inline">\(\frac{MSG}{MSE}\)</span></td>
</tr>
<tr class="even">
</tr>
<tr class="odd">
<td>Error</td>
<td>SSE</td>
<td><span class="math inline">\(N-I\)</span></td>
<td>MSE = <span class="math inline">\(\frac{MSG}{N-I}\)</span></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Total</strong></td>
<td><strong>SST</strong></td>
<td><span class="math inline">\(N-1\)</span></td>
<td colspan="2"><pre><code>  |</code></pre></td>
</tr>
</tbody>
</table>
</div>
<div id="the-f-distribution" class="section level3 hasAnchor" number="5.4.3">
<h3 class="hasAnchor"><span class="header-section-number">5.4.3</span> The F-distribution<a href="#the-f-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <span class="math inline">\(p\)</span>-value of the test is the <strong>area to the right</strong> of the F statistic density curve. This is always to the right because the F-distribution is not symmetric, truncated at 0 and skewed right. This is true regardless of the <span class="math inline">\(df\)</span>.</p>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="assumptions-1" class="section level3 hasAnchor" number="5.4.4">
<h3 class="hasAnchor"><span class="header-section-number">5.4.4</span> Assumptions<a href="#assumptions-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generally we must check three conditions on the data before performing ANOVA:</p>
<ul>
<li>The observations are independent within and across groups</li>
<li>The data within each group are nearly normal</li>
<li>The variability across the groups is about equal.</li>
</ul>
<p>When these three conditions are met, we may perform an ANOVA to determine whether the data provide strong evidence against the null hypothesis that all the <span class="math inline">\(\mu_i\)</span> are equal.</p>
</div>
<div id="example-a-comparison-of-plant-species-under-low-water-conditions" class="section level3 hasAnchor" number="5.4.5">
<h3 class="hasAnchor"><span class="header-section-number">5.4.5</span> Example: A comparison of plant species under low water conditions<a href="#example-a-comparison-of-plant-species-under-low-water-conditions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>PLANTS1</code> data file gives the percent of nitrogen in four different species of plants grown in a laboratory. The researchers collected these data in parts of the country where there is very little rainfall. To examine the effect of water, they varied the amount per day from 50mm to 650mm in 100mm increments. There were 9 plants per species-by-water combination. Because the plants are to be used primarily for animal food, with some parts that can be consumed by people, a high nitrogen content is very desirable. Let’s formally test to see if the nitrogen content in the plants differ across species.</p>
<p><strong>1. Identify response and explanatory variables.</strong></p>
<ul>
<li>The quantitative response variable is % nitrogen (<code>pctnit</code>)</li>
<li>The categorical explanatory variable is species (<code>species</code>)</li>
</ul>
<p><strong>2. Visualize and summarize bivariate relationship.</strong></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>plot.nitrogen.species <span class="ot">&lt;-</span> plants1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(species, pctnit) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.nitrogen.species, <span class="fu">aes</span>(<span class="at">x=</span>species, <span class="at">y =</span> pctnit, <span class="at">fill=</span>species)) <span class="sc">+</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width=</span>.<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">geom_violin</span>(<span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Species&quot;</span>) <span class="sc">+</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis_d</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_summary</span>(<span class="at">fun.y=</span><span class="st">&quot;mean&quot;</span>, <span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">17</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.75</span>))</span></code></pre></div>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>plot.nitrogen.species <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(pctnit, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sd =</span> <span class="fu">sd</span>(pctnit, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">IQR =</span> <span class="fu">IQR</span>(pctnit, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
IQR
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
3.039810
</td>
<td style="text-align:right;">
0.2506118
</td>
<td style="text-align:right;">
0.2690
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2.092841
</td>
<td style="text-align:right;">
0.2377523
</td>
<td style="text-align:right;">
0.2725
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3.284365
</td>
<td style="text-align:right;">
0.3218599
</td>
<td style="text-align:right;">
0.5065
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
1.195587
</td>
<td style="text-align:right;">
0.2342217
</td>
<td style="text-align:right;">
0.3125
</td>
</tr>
</tbody>
</table>
<p>While the standard deviations are relatively similar across all species, the means are different (3.04 v. 2.09 v. 3.28 v. 1.20), with species 3 having the largest mean nitrogen content and species 4 the smallest. Species 3 has the highest IQR and species 1 has the lowest 0.506 v. 0.269).</p>
<p><strong>3. Write the relationship you want to examine in the form of a research question.</strong></p>
<ul>
<li>Null Hypothesis: There is no difference in the average nitrogen content among plant species 1 through 4.</li>
<li>Alternative Hypothesis: There is a difference in the average nitrogen content among plant species 1 through 4.</li>
</ul>
<p><strong>4. Perform an appropriate statistical analysis.</strong></p>
<p>I. Let <span class="math inline">\(\mu_{1}\)</span>, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(\mu_{4}\)</span> be the mean nitrogen content in plant species 1 through 4 respectively.</p>
<ol start="2" style="list-style-type: upper-roman">
<li><p><span class="math inline">\(H_{0}: \mu_{1} = \mu_{2} = \mu_{3} = \mu_{4}\)</span><br />
<span class="math inline">\(H_{A}:\)</span> At least one mean is different.</p></li>
<li><p>We are comparing means from multiple groups, so an ANOVA is the appropriate procedure. We need to check for independence, approximate normality and approximately equal variances across groups.</p></li>
</ol>
<p><strong>Independence:</strong> We are assuming that each plant was sampled independently of each other, and that the species themselves are independent of each other.</p>
<p><strong>Normality:</strong> With grouped data it’s easier to look at the histograms than qqplots.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plants1, <span class="fu">aes</span>(<span class="at">x=</span>pctnit, <span class="at">fill=</span>species)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(species<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">scale_fill_viridis_d</span>()</span></code></pre></div>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-9-1.png" width="288" /></p>
<p>The distributions per group tend to follow an approximate normal distribution.</p>
<p><strong>Equal variances:</strong> One way to assess if the groups have approximately equal variances is by comparing the IQR across groups.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>plants1 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">IQR =</span> <span class="fu">IQR</span>(pctnit), <span class="at">SD =</span> <span class="fu">sd</span>(pctnit)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:right;">
IQR
</th>
<th style="text-align:right;">
SD
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.2690
</td>
<td style="text-align:right;">
0.2506118
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.2725
</td>
<td style="text-align:right;">
0.2377523
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.5065
</td>
<td style="text-align:right;">
0.3218599
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.3125
</td>
<td style="text-align:right;">
0.2342217
</td>
</tr>
</tbody>
</table>
<p>The IQRs are similar so assumption of equal variances is not grossly violated. We can proceed with the ANOVA procedure.</p>
<ol start="4" style="list-style-type: upper-roman">
<li>We use the <code>aov(response $\sim$ predictor)</code> function on the relationship between the nitrogen levels and tree species. We then pipe in <code>summary()</code> to make the output display nicely.</li>
</ol>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(pctnit<span class="sc">~</span>species, <span class="at">data=</span>plants1) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="do">## species       3 172.39   57.46   827.5 &lt;2e-16 ***</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals   248  17.22    0.07                   </span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
<p><strong>5. Write a conclusion in the context of the problem.</strong>
The results of the ANOVA test indicate that at least one species has a different average nitrogen content than the other varieties (<span class="math inline">\(p&lt;\)</span>.001).</p>
</div>
<div id="coefficient-of-determination-r2" class="section level3 hasAnchor" number="5.4.6">
<h3 class="hasAnchor"><span class="header-section-number">5.4.6</span> Coefficient of determination <span class="math inline">\(R^{2}\)</span><a href="#coefficient-of-determination-r2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The coefficient of determination is defined as <span class="math inline">\(R^{2} = \frac{SSG}{SST}\)</span> and can be interpreted as the % of the variation seen in the outcome that is due to subject level variation within each of the treatment groups. The strength of this measure can be thought of in a similar manner as the correlation coefficient <span class="math inline">\(r\)</span>: <span class="math inline">\(&lt; .3\)</span> indicates a poor fit, <span class="math inline">\(&lt; .5\)</span> indicates a medium fit, and <span class="math inline">\(&gt; .7\)</span> indicates a good fit.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fl">172.39</span><span class="sc">/</span>(<span class="fl">172.39+17.22</span>)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 90.9182</span></span></code></pre></div>
<p>A large amount (91%) of the variation seen in nitrogen content in the plant can be explained by the species of plant.</p>
</div>
<div id="multiple-comparisons" class="section level3 hasAnchor" number="5.4.7">
<h3 class="hasAnchor"><span class="header-section-number">5.4.7</span> Multiple Comparisons<a href="#multiple-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose that an ANOVA test reveals that there is a difference in at least one of the means. How can we determine which groups are significantly different without increasing our chance of a Type I error?</p>
<p>Simple! We perform all the pairwise comparisons but using a test statistic that retains a <strong>family-wise error rate</strong> of 0.05 (or our chosen <span class="math inline">\(\alpha\)</span>). There are different methods to adjust for multiple comparisons, we will be using the <strong>Tukey HSD (honest significant difference) test</strong>. Continuing on with the analysis of nitrogen across plant species.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(<span class="fu">aov</span>(pctnit<span class="sc">~</span>species, <span class="at">data=</span>plants1))</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   Tukey multiple comparisons of means</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     95% family-wise confidence level</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit: aov(formula = pctnit ~ species, data = plants1)</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $species</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="do">##           diff        lwr        upr   p adj</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2-1 -0.9469683 -1.0684156 -0.8255209 0.0e+00</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3-1  0.2445556  0.1231082  0.3660029 2.4e-06</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4-1 -1.8442222 -1.9656696 -1.7227748 0.0e+00</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3-2  1.1915238  1.0700764  1.3129712 0.0e+00</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 4-2 -0.8972540 -1.0187014 -0.7758066 0.0e+00</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 4-3 -2.0887778 -2.2102252 -1.9673304 0.0e+00</span></span></code></pre></div>
<p>The results from Tukey’s HSD for all pairwise comparisons indicate that the average
nitrogen content in one species is significantly different from each of the three other
species. The nice benefit of this procedure is that the difference between the means
of the two groups are compared, and a 95confidence interval for each difference
is included. So specifically, species 2 has on average 0.94 (0.82, 1.09) lower percent
nitrogen compared to species 1 (<span class="math inline">\(p&lt;.0001\)</span>). Also, species 3 has on average 1.19 (1.07, 1.31)
higher percent nitrogen compared to species 2 (<span class="math inline">\(p&lt;.0001\)</span>).</p>
<hr />
</div>
</div>
<div id="bv-chisq" class="section level2 hasAnchor" number="5.5">
<h2 class="hasAnchor"><span class="header-section-number">5.5</span> (C~C) Multiple Proportions: <span class="math inline">\(\chi^{2}\)</span><a href="#bv-chisq" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Recall that the point estimates for the proportion of an event occurring is <span class="math inline">\(\frac{x}{n}\)</span>,
where <span class="math inline">\(x\)</span> is the number of times the event occurs out of <span class="math inline">\(n\)</span> records.
In this section we we would like to make conclusions about the difference in two
population proportions: <span class="math inline">\(p_1 - p_2\)</span>. In other words we’re testing the hypothesis that <span class="math inline">\(p_{1}-p_{2}=0\)</span>.</p>
<p>Our estimate for the difference in proportions based on the sample is <span class="math inline">\(\hat{p}_1 - \hat{p}_2\)</span>.
No surprise there. What is slightly different is that we use a <strong>pooled proportion</strong> to check the condition
of normality, and to calculate the standard error of the estimate.
This pooled proportion is calculated by pooling the number of events in both groups, divided by the effective
sample size for those groups.</p>
<p><span class="math display">\[ \hat{p} = \frac{x_{1} + x_{2}}{n_{1}+n_{2}} \]</span></p>
<p>Then the standard error of the point estimate is calculated as</p>
<p><span class="math display">\[ \sqrt{\frac{\hat{p}(1-\hat{p})}{n_1} + \frac{\hat{p}(1-\hat{p})}{n_2}} \]</span></p>
<p>So the equations for the Confidence Interval for the difference in proportions is,</p>
<p><span class="math display">\[
\left( \hat{p}_{1} - \hat{p}_{2} \right) \pm t_{\frac{\alpha}{2}, df}
\sqrt{\frac{\hat{p}(1-\hat{p})}{n_1} + \frac{\hat{p}(1-\hat{p})}{n_2}}
\]</span></p>
<p>with test statistic,
<span class="math display">\[
t^{*} =  \frac{\left( \hat{p}_{1} - \hat{p}_{2} \right) - d_{0}}
        {\left( \sqrt{\frac{\hat{p}(1-\hat{p})}{n_1} + \frac{\hat{p}(1-\hat{p})}{n_2}}
        \right )}
\]</span></p>
<div id="conditions-for-the-sampling-distribution-to-be-normal." class="section level3 hasAnchor" number="5.5.1">
<h3 class="hasAnchor"><span class="header-section-number">5.5.1</span> Conditions for the sampling distribution to be normal.<a href="#conditions-for-the-sampling-distribution-to-be-normal." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The difference <span class="math inline">\(\hat{p}_1 - \hat{p}_2\)</span> tends to follow a normal model when 1) each proportion separately follows a normal model, and 2) the two samples are independent of each other. #1 can be verified by checking the <strong>success-failure condition</strong> for each group.</p>
<p>That means:</p>
<ul>
<li><span class="math inline">\(\hat{p}n_{1} \geq 10\)</span>, AND</li>
<li><span class="math inline">\(\hat{p}n_{2} \geq 10\)</span>, AND</li>
<li><span class="math inline">\(\hat{q}n_{1} \geq 10\)</span>, AND</li>
<li><span class="math inline">\(\hat{q}n_{1} \geq 10\)</span>.</li>
</ul>
<p>Where, if I’ve forgotten to mention it yet, <span class="math inline">\(q = 1-p\)</span>.</p>
<p>When sample sizes are below 10, but still not <em>super</em> small, say like 5, we turn to the non-parameteric version of this test called a <strong>Fisher’s Exact Test</strong>.</p>
</div>
<div id="example-are-mammograms-effective" class="section level3 hasAnchor" number="5.5.2">
<h3 class="hasAnchor"><span class="header-section-number">5.5.2</span> Example: Are Mammograms effective?<a href="#example-are-mammograms-effective" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This example comes from the <a href="https://www.openintro.org/stat/textbook.php?stat_book=os">OpenIntro Statistics</a> textbook (3rd ed).</p>
<p>A 30-year study was conducted with nearly 90,000 female participants.
<a href="Twenty%20five%20year%20follow-up%20for%20breast%20cancer%20incidence%20and%20mortality%20of%20the%20Canadian%20National%20Breast%20Screening%20Study:%20randomized%20screening%20trial.%20BMJ%202014;348:g366.">(Miller AB. 2014)</a> During a 5-year
screening period, each woman was randomized to one of two groups: in the
first group, women received regular mammograms to screen for breast cancer,
and in the second group, women received regular non-mammogram breast cancer
exams. No intervention was made during the following 25 years of the study,
and we’ll consider death resulting from breast cancer over the full 30-year
period. Results from the study are summarized in the following table.</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Alive
</th>
<th style="text-align:right;">
Dead
</th>
<th style="text-align:right;">
Sum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
44405
</td>
<td style="text-align:right;">
505
</td>
<td style="text-align:right;">
44910
</td>
</tr>
<tr>
<td style="text-align:left;">
Mammogram
</td>
<td style="text-align:right;">
44425
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
44925
</td>
</tr>
<tr>
<td style="text-align:left;">
Sum
</td>
<td style="text-align:right;">
88830
</td>
<td style="text-align:right;">
1005
</td>
<td style="text-align:right;">
89835
</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>The independent/explanatory variable is treatment (additional mammograms), and
the dependent/response variable is death from breast cancer. Are these measures
associated?</p>
<p>If mammograms are much more effective than non-mammogram breast cancer exams,
then we would expect to see additional deaths from breast cancer in the control
group (there is a relationship). On the other hand, if mammograms are not as
effective as regular breast cancer exams, we would expect to see no difference
in breast cancer deaths in the two groups (there is no relationship).</p>
<p>What we need to do is to figure out how many deaths would be <strong>expected</strong>,
if there was no relationship between treatment death by breast cancer, and then
examine the <strong>residuals</strong> - the difference between the observed (<span class="math inline">\(O_{ij}\)</span>) and
expected (<span class="math inline">\(E_{ij}\)</span>).</p>
<p>In our DATA = MODEL + RESIDUAL framework, the DATA is the observed counts <span class="math inline">\(O_{ij}\)</span>,
and the MODEL is the expected counts <span class="math inline">\(E_{ij}\)</span>.</p>
<p>To see how the expected counts are calculated, we need to define a few more symbols,
so we can find our way around the cells of a table.
Just like rows and columns in a matrix, rows are indexed first (as <span class="math inline">\(i\)</span> and columns indexed as <span class="math inline">\(j\)</span>).
So the cell in the top left is <span class="math inline">\(i=1\)</span> and <span class="math inline">\(j=1\)</span>.</p>
<table style="width:58%;">
<colgroup>
<col width="15%" />
<col width="13%" />
<col width="15%" />
<col width="1%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><span class="math inline">\(O_{ij}\)</span></th>
<th align="center">Alive</th>
<th align="center">Dead</th>
<th colspan="2" align="center">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mammo</td>
<td align="center"><span class="math inline">\(n_{11}\)</span></td>
<td colspan="3" align="center"><span class="math inline">\(n_{12}\)</span> | <span class="math inline">\(n_{1.}\)</span></td>
</tr>
<tr class="even">
<td align="left">Control</td>
<td align="center"><span class="math inline">\(n_{21}\)</span></td>
<td colspan="3" align="center"><span class="math inline">\(n_{22}\)</span> | <span class="math inline">\(n_{2.}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="center"><span class="math inline">\(n_{.1}\)</span></td>
<td align="center"><span class="math inline">\(n_{.2}\)</span></td>
<td colspan="2" align="center"><span class="math inline">\(N\)</span></td>
</tr>
</tbody>
</table>
<p>The expected count for each cell is calculated as the row total times the column total for that cell, divided by the overall total. Yes this will end up as a fraction.</p>
<p><span class="math display">\[E_{ij} = \frac{n_{i.}n_{.j}}{N}\]</span></p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Alive
</th>
<th style="text-align:right;">
Dead
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
44407.58
</td>
<td style="text-align:right;">
502.4161
</td>
</tr>
<tr>
<td style="text-align:left;">
Mammogram
</td>
<td style="text-align:right;">
44422.42
</td>
<td style="text-align:right;">
502.5839
</td>
</tr>
</tbody>
</table>
<p>The residuals are calculated as
<span class="math display">\[ RESIDUALS = (O_{ij} - E_{ij})\]</span></p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Alive
</th>
<th style="text-align:right;">
Dead
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
-0.0122616
</td>
<td style="text-align:right;">
0.1152775
</td>
</tr>
<tr>
<td style="text-align:left;">
Mammogram
</td>
<td style="text-align:right;">
0.0122596
</td>
<td style="text-align:right;">
-0.1152583
</td>
</tr>
</tbody>
</table>
<p>Examining the residuals can tell us which combinations had counts more or less observations than expected. If mammograms were not associated with survival, there were 0.01 fewer people still alive than expected, and 0.11 more people dead. This is trivially small (2 x 2) example with very large sample sizes. There will be another example provided later.</p>
<p>The <span class="math inline">\(\chi^2\)</span> test statistic is defined as the sum of the squared residuals, divided by the expected counts, and follows a <span class="math inline">\(\chi^2\)</span> distribution with degrees of freedom (#rows -1)(#cols -1).</p>
<p><span class="math display">\[ \sum_{ij}\frac{(O_{ij}-E_{ij})^{2}}{E_{ij}} \]</span></p>
<p>Like every other statistical test, large values of test statistics correspond to low p-values.</p>
<p>Below is a picture of the distribution for the current example. The p-value is reported on the left (vertically), the purple shaded area denotes the rejection region if we were using a hard cutoff of 0.05. (The rejection region is the area where the test statistic had to be at for a p-value to be smaller than .05.). For this example the test statistic was 0.017, which corresponds to a p-value of 0.895. Thus, this study does not provide enough evidence to support the claim that mammograms decrease the rate of deaths by breast cancer.</p>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="example-smoking-and-general-health" class="section level3 hasAnchor" number="5.5.3">
<h3 class="hasAnchor"><span class="header-section-number">5.5.3</span> Example: Smoking and General Health<a href="#example-smoking-and-general-health" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>More often than not, we will have the full data available. That is, data at each individual record not just a summary table like in the previous example. Let’s work through an example.</p>
<p>Using the Addhealth data set, what can we say about the relationship between smoking and a person’s perceived general level of general health?</p>
<p><strong>1. Identify response and explanatory variables.</strong></p>
<ul>
<li>The binary explanatory variable is whether the person has ever smoked an entire cigarette (<code>eversmoke_c</code>)</li>
<li>The categorical explanatory variable is the person’s general health (<code>genhealth</code>) and has levels “Excellent”, “Very Good”, “Good”, “Fair”, and “Poor”.</li>
</ul>
<p><strong>2. Visualize and summarise bivariate relationship.</strong></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_xtab</span>(<span class="at">grp=</span>addhealth<span class="sc">$</span>eversmoke_c, <span class="at">x=</span>addhealth<span class="sc">$</span>genhealth, </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show.total =</span> <span class="cn">FALSE</span>, <span class="at">margin=</span><span class="st">&quot;row&quot;</span>, <span class="at">legend.title=</span><span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-18-1.png" width="768" /></p>
<p>The percentage of smokers seems to increase as the general health status decreases. Almost three-quarters (73%, n=40) of those reporting poor health have smoked an entire cigarette at least once in their life compared to 59% (n=573) of those reporting excellent health.</p>
<p><strong>3. Write the relationship you want to examine in the form of a research question.</strong></p>
<p>Is the proportion of those who have ever smoked equal across all levels of general health?</p>
<ul>
<li>Null Hypothesis: The proportion of smokers in each general health category is the same.</li>
<li>Alternate Hypothesis: At least one proportion is different.</li>
</ul>
<p><strong>4. Perform an appropriate statistical analysis.</strong></p>
<p>I. Define the parameters under consideration.</p>
<ul>
<li>Let <span class="math inline">\(p_{1}\)</span> be the true proportion of smokers within the ``Excellent” health category.</li>
<li>Let <span class="math inline">\(p_{2}\)</span> be the true proportion of smokers within the ``Very good” health category.</li>
<li>Let <span class="math inline">\(p_{3}\)</span> be the true proportion of smokers within ``Good” health category.</li>
<li>Let <span class="math inline">\(p_{4}\)</span> be the true proportion of smokers within ``Fair” health category.</li>
<li>Let <span class="math inline">\(p_{5}\)</span> be the true proportion of smokers within ``Poor” health category.</li>
</ul>
<ol start="2" style="list-style-type: upper-roman">
<li><p><span class="math inline">\(H_{0}: p_{1} = p_{2} = p_{3} = p_{4} = p_{5}\)</span><br />
<span class="math inline">\(H_{A}:\)</span> At least one proportion is different.</p></li>
<li><p>I will conduct a <span class="math inline">\(\chi\)</span>-squared test of association. There is at least 10 observations in each combination of smoking status and general health.</p></li>
<li><p>Conduct the test.</p></li>
</ol>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>health.smoke.model <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(addhealth<span class="sc">$</span>genhealth, addhealth<span class="sc">$</span>eversmoke_c)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>health.smoke.model</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s Chi-squared test</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  addhealth$genhealth and addhealth$eversmoke_c</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="do">## X-squared = 30.795, df = 4, p-value = 3.371e-06</span></span></code></pre></div>
<p>We have strong evidence against the null; the <span class="math inline">\(p\)</span>-value is less than .0001.</p>
<p><strong>5. Write a conclusion in context of the problem.</strong>
We can conclude that there is an association between ever smoking a cigarette in their life and perceived general health (<span class="math inline">\(\chi^2\)</span> = 30.8, df=4, <span class="math inline">\(p&lt;.0001\)</span>).</p>
</div>
<div id="multiple-comparisons-1" class="section level3 hasAnchor" number="5.5.4">
<h3 class="hasAnchor"><span class="header-section-number">5.5.4</span> Multiple Comparisons<a href="#multiple-comparisons-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Just like with ANOVA, if we find that the chi-squared test indicates that at least one proportion is different from the others, it’s our job to figure out which ones might be different! We will analyze the residuals to accomplish this. Not by hand! Never again! You’re not learning how to code for nothing.</p>
<p>The residuals are automatically stored in the model output. You can either print them out and look at the values directly:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>health.smoke.model<span class="sc">$</span>residuals</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                    addhealth$eversmoke_c</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="do">## addhealth$genhealth Non Smoker     Smoker</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="do">##           Excellent  3.4461139 -2.5168277</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="do">##           Very good  0.4810893 -0.3513578</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="do">##           Good      -2.4431255  1.7843072</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="do">##           Fair      -1.0556365  0.7709714</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="do">##           Poor      -0.9446378  0.6899048</span></span></code></pre></div>
<p>Or you can extract them and save them as a data frame. Then use ggplot with <code>geom_raster</code> to fill in your squares.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>plot.residuals <span class="ot">&lt;-</span> health.smoke.model<span class="sc">$</span>residuals <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.residuals, <span class="fu">aes</span>(<span class="at">x=</span>addhealth.genhealth, <span class="at">y=</span>addhealth.eversmoke_c)) <span class="sc">+</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Freq)) <span class="sc">+</span>  <span class="fu">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The proportion of those who have never smoked and report being in Excellent health is higher than expected if these two measures were independent (high positive residual means observed is greater than expected). A lower percent of people reporting Good health never smoked, which is lower than expected if smoking and health status were independent. So these two categories are likely to be the groups that have a different proportion of lifetime smoker <span class="math inline">\(p_{i}\)</span> compared to the other groups.</p>
</div>
</div>
<div id="bv-corr" class="section level2 hasAnchor" number="5.6">
<h2 class="hasAnchor"><span class="header-section-number">5.6</span> (Q~Q) Correlation<a href="#bv-corr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>correlation coefficient</strong> is designated by <span class="math inline">\(r\)</span> for the sample correlation, and <span class="math inline">\(\rho\)</span> for the population correlation. The correlation is a measure of the strength and direction of a <em>linear relationship</em> between two variables.</p>
<p>The correlation ranges from +1 to -1. A correlation of +1 means that there is a perfect, positive linear relationship between the two variables. A correlation of -1 means there is a perfect, negative linear relationship between the two variables.
In both cases, knowing the value of one variable, you can perfectly predict the value of the second.</p>
<div id="strength-of-the-correlation" class="section level3 hasAnchor" number="5.6.1">
<h3 class="hasAnchor"><span class="header-section-number">5.6.1</span> Strength of the correlation<a href="#strength-of-the-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here are rough estimates for interpreting the strengths of correlations based on the magnitude of <span class="math inline">\(r\)</span>.</p>
<ul>
<li><span class="math inline">\(|r| \geq 0.7\)</span>: Very strong relationship</li>
<li><span class="math inline">\(0.4 \leq |r| &lt; 0.7\)</span>: Strong relationship</li>
<li><span class="math inline">\(0.3 \leq |r| &lt; 0.4\)</span>: Moderate relationship</li>
<li><span class="math inline">\(0.2 \leq |r| &lt; 0.3:\)</span> Weak relationship</li>
<li><span class="math inline">\(|r| &lt; 0.2:\)</span> Negligible or no relationship</li>
</ul>
</div>
<div id="example-federal-spending-per-capita-and-poverty-rate" class="section level3 hasAnchor" number="5.6.2">
<h3 class="hasAnchor"><span class="header-section-number">5.6.2</span> Example: Federal spending per capita and poverty rate<a href="#example-federal-spending-per-capita-and-poverty-rate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(county, <span class="fu">aes</span>(<span class="at">x=</span>poverty, <span class="at">y=</span>fed_spend00)) <span class="sc">+</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;federal spending per capita&quot;</span>) <span class="sc">+</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;poverty rate&quot;</span>)</span></code></pre></div>
<p><img src="bivariate_analysis_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(county<span class="sc">$</span>poverty, county<span class="sc">$</span>fed_spend00, <span class="at">use=</span><span class="st">&quot;complete.obs&quot;</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.03484461</span></span></code></pre></div>
<ul>
<li>There is a negligible, positive, linear relationship between poverty rate and per capita federal spending (<span class="math inline">\(r = 0.03\)</span>).</li>
<li>Let <span class="math inline">\(\rho\)</span> denote the true correlation between poverty rate and federal spending per capita.</li>
<li>Our null hypothesis is that there is no correlation between poverty rate and federal spending (<span class="math inline">\(\rho = 0\)</span>), and the alternative hypothesis is that they are correlated (<span class="math inline">\(\rho \neq 0\)</span>).</li>
<li>We can use the <code>cor.test()</code> function to analyze the evidence in favor of this alternative hypothesis.</li>
</ul>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(county<span class="sc">$</span>poverty, county<span class="sc">$</span>fed_spend00)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s product-moment correlation</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  county$poverty and county$fed_spend00</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="do">## t = 1.9444, df = 3110, p-value = 0.05194</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  -0.0002922843  0.0698955658</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="do">##        cor </span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.03484461</span></span></code></pre></div>
<p>We conclude from this that there was a non-statistically significant, negligible correlation
between poverty and federal spending (<span class="math inline">\(r = 0.03 (-0.0003, .069), p = 0.05\)</span>).</p>
<!--chapter:end:bivariate_analysis.Rmd-->
</div>
</div>
</div>
<div id="part-regression-modeling" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART) Regression Modeling<a href="#part-regression-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="reg-intro" class="section level1 hasAnchor" number="6">
<h1 class="hasAnchor"><span class="header-section-number">6</span> Introduction<a href="#reg-intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The general purpose of regression is to learn more about the relationship between several independent or predictor variables and a quantitative dependent variable. Multiple regression procedures are very widely used in research. In general, this inferential tool allows us to ask (and hopefully answer) the general question “<em>what is the best predictor of</em>…”, and does “<em>additional variable A</em>” or “<em>additional variable B” confound the relationship between my explanatory and response variable?</em>”</p>
<blockquote>
<ul>
<li>Educational researchers might want to learn about the best predictors of success in high-school.</li>
<li>Sociologists may want to find out which of the multiple social indicators best predict whether or not a new immigrant group will adapt to their new country of residence.</li>
<li>Biologists may want to find out which factors (i.e. temperature, barometric pressure, humidity, etc.) best predict caterpillar reproduction.</li>
</ul>
</blockquote>
<p>This chapter starts by recapping notation and topics for simple linear regression, when there is only one predictor. Then we move into generalization of these concepts to many predictors, and model building topics such as stratification, interactions, and categorical predictors.</p>
<div id="opening-remarks" class="section level2 hasAnchor" number="6.1">
<h2 class="hasAnchor"><span class="header-section-number">6.1</span> Opening Remarks<a href="#opening-remarks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The PMA6 textbook (Chapter 7) goes into great detail on this topic, since regression is typically the basis for all advanced models.</p>
<p>The book also distinguishes between a “fixed-x” case, where the values of the explanatory variable <span class="math inline">\(x\)</span> only take on pre-specified values, and a “variable-x” case, where the values of <span class="math inline">\(x\)</span> are observations from a population distribution of X’s.</p>
<p>This latter case is what we will be concerning ourselves with.</p>
<!--chapter:end:reg_intro.Rmd-->
</div>
</div>
<div id="slr" class="section level1 hasAnchor" number="7">
<h1 class="hasAnchor"><span class="header-section-number">7</span> Simple Linear Regression<a href="#slr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The goal of linear regression is to describe the relationship between an independent variable X and a continuous dependent variable <span class="math inline">\(Y\)</span> as a straight line.</p>
<p>Data for this type of model can arise in two ways;</p>
<ul>
<li>Fixed-<span class="math inline">\(X\)</span>: values of <span class="math inline">\(X\)</span> are preselected by investigator</li>
<li>Variable-<span class="math inline">\(X\)</span>: have random sample of <span class="math inline">\((X,Y)\)</span> values</li>
</ul>
<p>Both Regression and Correlation can be used for two main purposes:</p>
<ul>
<li><strong>Descriptive</strong>: Draw inferences regarding the relationship</li>
<li><strong>Predictive</strong>: Predict value of <span class="math inline">\(Y\)</span> for a given value of <span class="math inline">\(X\)</span></li>
</ul>
<p>Simple Linear Regression is an example of a Bivariate analysis since there is only one covariate (explanatory variable) under consideration.</p>

<div class="rmdnote">
This section uses functions from the <code>gridExtra</code>, <code>sjPlot</code>, <code>broom</code>, <code>performance</code> and <code>ggdist</code> packages to help tidy and visualize results from regression models.
</div>
<div id="example" class="section level2 hasAnchor" number="7.1">
<h2 class="hasAnchor"><span class="header-section-number">7.1</span> Example<a href="#example" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lung function data were obtained from an epidemiological study of households living in four areas with different amounts and types of air pollution. The data set used in this book is a subset of the total data. In this chapter we use only the data taken on the fathers, all of whom are nonsmokers (see PMA6 Appendix A for more details).</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the data from a version stored online. </span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>fev <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;https://norcalbiostat.netlify.com/data/Lung_081217.txt&quot;</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>One of the major early indicators of reduced respiratory function is FEV1 or forced expiratory volume in the first second (amount of air exhaled in 1 second). Since it is known that taller males tend to have higher FEV1, we wish to determine the relationship between height and FEV1. We can use regression analysis for both a descriptive and predictive purpose.</p>
<ul>
<li><strong>Descriptive</strong>: Describing the relationship between FEV1 and height</li>
<li><strong>Predictive</strong>: Use the equation to determine expected or normal FEV1 for a given height</li>
</ul>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">y=</span>FFEV1, <span class="at">x=</span>FHEIGHT)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Height&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;FEV1&quot;</span>) <span class="sc">+</span> </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Scatterplot and Regression line of FEV1 Versus Height for Males.&quot;</span>) <span class="sc">+</span> </span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>) </span></code></pre></div>
<p><img src="slr_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>In this graph, height is given on the horizontal axis since it is the independent or predictor variable and FEV1 is given on the vertical axis since it is the dependent or outcome variable.</p>
<p><strong>Interpretation</strong>: There does appear to be a tendency for taller men to have higher FEV1. The <strong>regression line</strong> is also added to the graph. The line is tilted upwards, indicating that we expect larger values of FEV1 with larger values of height.</p>
<p>Specifically the equation of the regression line is
<span class="math display">\[
Y = -4.087 + 0.118 X
\]</span></p>
<p>The quantity 0.118 in front of <span class="math inline">\(X\)</span> is greater than zero, indicating that as we increase <span class="math inline">\(X, Y\)</span> will increase. For example, we would expect a father who is 70 inches tall to have an FEV1 value of</p>
<p><span class="math display">\[\mbox{FEV1} = -4.087 + (0.118) (70) = 4.173\]</span></p>
<p>If the height was 66 inches then we would expect an FEV1 value of only 3.70.</p>
<div id="caution-on-out-of-range-predictions" class="section level3 hasAnchor" number="7.1.1">
<h3 class="hasAnchor"><span class="header-section-number">7.1.1</span> Caution on out of range predictions<a href="#caution-on-out-of-range-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To take an extreme example, suppose a father was 2 feet tall. Then the equation would predict a negative value of FEV1 (<span class="math inline">\(-1.255\)</span>).</p>
<p>A safe policy is to restrict the use of the equation to the range of the <span class="math inline">\(X\)</span> observed in the sample.</p>
</div>
</div>
<div id="mathematical-model" class="section level2 hasAnchor" number="7.2">
<h2 class="hasAnchor"><span class="header-section-number">7.2</span> Mathematical Model<a href="#mathematical-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The mathematical model that we use for regression has three features.</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(Y\)</span> values are normally distributed at any given <span class="math inline">\(X\)</span></li>
<li>The mean of <span class="math inline">\(Y\)</span> values at any given <span class="math inline">\(X\)</span> follows a straight line <span class="math inline">\(Y = \beta_{0} + \beta_{1} X\)</span>.</li>
<li>The variance of <span class="math inline">\(Y\)</span> values at any <span class="math inline">\(X\)</span> is <span class="math inline">\(\sigma^2\)</span> (same for all X). This is known as <em>homoscedasticity</em>, or <em>homogeneity of variance</em>.</li>
</ol>
<p>Mathematically this is written as:</p>
<p><span class="math display">\[
Y|X \sim N(\mu_{Y|X}, \sigma^{2}) \\
\mu_{Y|X} = \beta_{0} + \beta_{1} X \\
Var(Y|X) = \sigma^{2}
\]</span></p>
<p>and can be visualized as:</p>
<div class="figure">
<img src="images/slr_graph.png" alt="" />
<p class="caption">Figure 6.2</p>
</div>
<div id="unifying-model-framework" class="section level3 hasAnchor" number="7.2.1">
<h3 class="hasAnchor"><span class="header-section-number">7.2.1</span> Unifying model framework<a href="#unifying-model-framework" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The mathematical model above describes the theoretical relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>. So in our unifying model framework to describe observed data,</p>
<blockquote>
<p>DATA = MODEL + RESIDUAL</p>
</blockquote>
<p>Our observed data values <span class="math inline">\(y_{i}\)</span> can be modeled as being centered on <span class="math inline">\(\mu_{Y|X}\)</span>, with normally distributed residuals.</p>
<p><span class="math display">\[
y_{i} = \beta_{0} + \beta_{1} X + \epsilon_{i} \\
\epsilon_{i} \sim N(0, \sigma^{2})
\]</span></p>
</div>
</div>
<div id="parameter-estimates" class="section level2 hasAnchor" number="7.3">
<h2 class="hasAnchor"><span class="header-section-number">7.3</span> Parameter Estimates<a href="#parameter-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimate the slope <span class="math inline">\(\beta_{1}\)</span> and intercept <span class="math inline">\(\beta_{0}\)</span> using a method called <strong>Least Squares</strong>.</li>
<li>The residual mean squared error (RMSE) is an estimate of the variance <span class="math inline">\(s^{2}\)</span>
<ul>
<li>RMSE can also refer to the root mean squared error.</li>
</ul></li>
</ul>
<p>The <strong>Least Squares</strong> method finds the estimates for the intercept <span class="math inline">\(b_{0}\)</span> and slope <span class="math inline">\(b_{1}\)</span> that minimize the SSE (Sum of squared errors). Let’s explore that visually:</p>
<p>See <a href="https://paternogbc.shinyapps.io/SS_regression/" class="uri">https://paternogbc.shinyapps.io/SS_regression/</a></p>
<p><strong>Initial Setup</strong></p>
<ul>
<li>Set the sample size to 50</li>
<li>Set the regression slope to 1</li>
<li>Set the standard deviation to 5</li>
</ul>
<p>The method of Least Squares finds the best estimates for <span class="math inline">\(\beta_{0}\)</span> and <span class="math inline">\(\beta_{1}\)</span> that minimized the sum of the squared residuals:</p>
<p><span class="math display">\[ \sum_{i=1}^{n} \epsilon_{i} \]</span></p>
<p>For simple linear regression the regression coefficient estimates that minimize the sum of squared errors can be calculated as:</p>
<p><span class="math display">\[ \hat{\beta_{0}} = \bar{y} - \hat{\beta_{1}}\bar{x} \quad \mbox{  and  } \quad  \hat{\beta_{1}} = r\frac{s_{y}}{s_{x}} \]</span></p>
<div id="sum-of-squares" class="section level3 hasAnchor" number="7.3.1">
<h3 class="hasAnchor"><span class="header-section-number">7.3.1</span> Sum of Squares<a href="#sum-of-squares" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Partitioning the Variance using the Sum of Squares:</p>
<ul>
<li>SS Total- how far are the points away from <span class="math inline">\(\bar{y}\)</span>? (one sample mean)</li>
<li>SS Regression - how far away is the regression line from <span class="math inline">\(\bar{y}\)</span>?.</li>
<li>SS Error - how far are the points away from the estimated regression line?</li>
</ul>
<p>Looking at it this way, we are asking “If I know the value of <span class="math inline">\(x\)</span>, how much better will I be at predicting <span class="math inline">\(y\)</span> than if I were just to use <span class="math inline">\(\bar{y}\)</span>?</p>
<p><em>This is the same partitioning of variance that is happens with ANOVA!</em></p>

<div class="rmdnote">
Increase the standard deviation to 30. What happens to SSReg? What about SSE?
</div>
<p>Here is a <a href="https://ryansafner.shinyapps.io/ols_estimation_by_min_sse/">link</a> to another interactive app where you can try to fit your own line to minimize the SSE.</p>
<p><strong>RMSE</strong> is the Root Mean Squared Error. In the PMA textbook this is denoted as <span class="math inline">\(S\)</span>, which is an estimate for <span class="math inline">\(\sigma\)</span>.</p>
<p><span class="math display">\[ S = \sqrt{\frac{SSE}{N-2}}\]</span></p>
</div>
</div>
<div id="assumptions-2" class="section level2 hasAnchor" number="7.4">
<h2 class="hasAnchor"><span class="header-section-number">7.4</span> Assumptions<a href="#assumptions-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many of the assumptions for regression are on the form of the residuals, which can’t be assessed until <em>after</em> the model has been fit.</p>
<p><strong>Assumptions to check before modeling</strong></p>
<ul>
<li>Randomness / Independence
<ul>
<li>Very serious</li>
<li>Can use hierarchical models for clustered samples</li>
<li>No real good way to “test” for independence. Need to know how the sample was obtained.</li>
</ul></li>
<li>Linear relationship
<ul>
<li>Slight departures OK</li>
<li>Can use transformations to achieve it</li>
<li>Graphical assessment: Simple scatterplot of <span class="math inline">\(y\)</span> vs <span class="math inline">\(x\)</span>.
Looking for linearity in the relationship.
Should be done prior to any analysis.</li>
</ul></li>
</ul>
<p><strong>Assumptions to check after modeling</strong></p>
<ul>
<li>Homogeneity of variance (same <span class="math inline">\(\sigma^{2}\)</span>)
<ul>
<li>Not extremely serious</li>
<li>Can use transformations to achieve it</li>
<li>Graphical assessment: Plot the residuals against the x variable, add a lowess line.
This assumption is upheld if there is no relationship/trend between the residuals and
the predictor.</li>
</ul></li>
<li>Normal residuals
<ul>
<li>Slight departures OK</li>
<li>Can use transformations to achieve it</li>
<li>Graphical assessment: normal qqplot of the model residuals.</li>
</ul></li>
</ul>
</div>
<div id="slr-fev" class="section level2 hasAnchor" number="7.5">
<h2 class="hasAnchor"><span class="header-section-number">7.5</span> Example<a href="#slr-fev" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Returning to the Lung function data set from PMA6, lets analyze the relationship between height and FEV for fathers in this data set.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">y=</span>FFEV1, <span class="at">x=</span>FHEIGHT)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Height&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;FEV1&quot;</span>) <span class="sc">+</span> </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Scatter Diagram with Regression (blue) and Lowess (red) Lines </span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="st">      of FEV1 Versus Height for Fathers.&quot;</span>) <span class="sc">+</span> </span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>) </span></code></pre></div>
<p><img src="slr_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>There does appear to be a tendency for taller men to have higher FEV1. The trend is linear, the red lowess trend line follows the blue linear fit line quite well.</p>
<p>Let’s fit a linear model and report the regression parameter estimates.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fev.dad.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(FFEV1 <span class="sc">~</span> FHEIGHT, <span class="at">data=</span>fev)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(fev.dad.model) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-4.087
</td>
<td style="text-align:right;">
1.152
</td>
<td style="text-align:right;">
-3.548
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
FHEIGHT
</td>
<td style="text-align:right;">
0.118
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
7.106
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
</tbody>
</table>
<p>The least squares equation is <span class="math inline">\(Y = -4.09 + 0.118X\)</span>. We can calculate the confidence interval for that estimate using the <code>confint</code> function.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fev.dad.model) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
2.5 %
</th>
<th style="text-align:right;">
97.5 %
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-6.363
</td>
<td style="text-align:right;">
-1.810
</td>
</tr>
<tr>
<td style="text-align:left;">
FHEIGHT
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:right;">
0.151
</td>
</tr>
</tbody>
</table>
<p>For ever inch taller a father is, his FEV1 measurement significantly increases by .12 (95%CI: .09, .15, p&lt;.0001).</p>
</div>
<div id="model-diagnostics" class="section level2 hasAnchor" number="7.6">
<h2 class="hasAnchor"><span class="header-section-number">7.6</span> Model Diagnostics<a href="#model-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>See PMA6 Section 7.8</p>
</blockquote>
<p>Lastly, we need to check assumptions on the residuals to see if the model results are valid. We can use the <a href="https://easystats.github.io/performance/reference/check_model.html"><code>check_model</code></a> function from the <a href="https://easystats.github.io/performance/"><code>performance</code></a> package to do the heavy lifting.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(fev.dad.model)</span></code></pre></div>
<p><img src="slr_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>No major deviations away from what is expected.</p>
</div>
<div id="prediction" class="section level2 hasAnchor" number="7.7">
<h2 class="hasAnchor"><span class="header-section-number">7.7</span> Prediction<a href="#prediction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>predict</code> function is used to create model based predictions.</p>
<div id="predict-the-average-value-of-y-haty-based-on-the-model" class="section level3 hasAnchor" number="7.7.1">
<h3 class="hasAnchor"><span class="header-section-number">7.7.1</span> Predict the <em>average</em> value of Y (<span class="math inline">\(\hat{y}\)</span>) based on the model<a href="#predict-the-average-value-of-y-haty-based-on-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create predictions for all observations in the data based on the model, and then take the mean of those <span class="math inline">\(n\)</span> predictions.</p>
<p><span class="math display">\[
\hat{y_{i}} = b_{0} + b_{1}x_{i} \\
\hat{\mu} = \frac{1}{n}\hat{y_{i}}
\]</span></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fev.dad.model) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.093267</span></span></code></pre></div>
</div>
<div id="confidence-intervals-for-the-predicted-mean" class="section level3 hasAnchor" number="7.7.2">
<h3 class="hasAnchor"><span class="header-section-number">7.7.2</span> Confidence intervals for the predicted mean<a href="#confidence-intervals-for-the-predicted-mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can leverage the <code>t.test()</code> function to give us the confidence interval for <span class="math inline">\(\hat{\mu}\)</span></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">predict</span>(fev.dad.model))</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  One Sample t-test</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  predict(fev.dad.model)</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="do">## t = 152.73, df = 149, p-value &lt; 2.2e-16</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true mean is not equal to 0</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4.040309 4.146225</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a><span class="do">## mean of x </span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4.093267</span></span></code></pre></div>
<p>This model predicts that fathers will have FEV1 measurements of 4.09 (95% CI 4.04, 4.14) on average.</p>
</div>
<div id="predict-the-average-value-of-y-haty_i-for-a-certain-value-of-x" class="section level3 hasAnchor" number="7.7.3">
<h3 class="hasAnchor"><span class="header-section-number">7.7.3</span> Predict the <em>average</em> value of Y <span class="math inline">\((\hat{y_{i}})\)</span> for a certain value of <span class="math inline">\(x^{*}\)</span><a href="#predict-the-average-value-of-y-haty_i-for-a-certain-value-of-x" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is also called the <em>fitted</em> value.</p>
<p><span class="math display">\[\hat{y_{i}} = b_{0} + b_{1}x^{*}_{i}\]</span></p>
<p>We create a new <code>data.frame</code> that holds the values of the data we want to predict. <span class="math inline">\(x^{*}=60\)</span> in the first example, <span class="math inline">\(x^{*}=65\)</span> and <span class="math inline">\(68\)</span> in the second example.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fev.dad.model, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">FHEIGHT =</span> <span class="dv">60</span>))</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        1 </span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.999612</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fev.dad.model, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">FHEIGHT =</span> <span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">68</span>)))</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="do">##        1        2 </span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3.590138 3.944454</span></span></code></pre></div>
<p>The confidence interval for the fitted value <span class="math inline">\(\hat{y_{i}}\)</span> is</p>
<p><span class="math display">\[
\hat{Y} \pm t_{\frac{\alpha}{2}}S \bigg[ \frac{1}{N} + \sqrt{\frac{(X^* - \bar{X})^{2}}{\sum(X - \bar{X})^{2}}} \quad  \bigg]
\]</span></p>
<p>where <span class="math inline">\(S\)</span> is the sample estimated variance (RMSE). We can use the <code>interval</code> argument to <code>predict</code> to calculate this interval.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fev.dad.model, </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">FHEIGHT =</span> <span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">68</span>)),</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="do">##        fit      lwr      upr</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 3.590138 3.423257 3.757019</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 3.944454 3.844515 4.044393</span></span></code></pre></div>
</div>
<div id="predict-a-new-value-of-y-haty_i-for-a-certain-value-of-x" class="section level3 hasAnchor" number="7.7.4">
<h3 class="hasAnchor"><span class="header-section-number">7.7.4</span> Predict a <em>new</em> value of Y <span class="math inline">\(\hat{y_{i}}\)</span> for a certain value of <span class="math inline">\(x^{*}\)</span><a href="#predict-a-new-value-of-y-haty_i-for-a-certain-value-of-x" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The point estimate of <span class="math inline">\(\hat{y_{i}}\)</span> is calculated the same, but the prediction interval is wider. This is because individual <span class="math inline">\(y\)</span>’s are more variable than the average. This is the same concept that we saw when studying sampling distributions. The standard deviation of the mean <span class="math inline">\(\mu_{Y}\)</span>, is smaller than the standard deviation of the individual data points <span class="math inline">\(y_{i}\)</span>.</p>
<p><span class="math display">\[
\hat{Y} \pm t_{\frac{\alpha}{2}}S \bigg[ 1+  \frac{1}{N} + \sqrt{\frac{(X^* - \bar{X})^{2}}{\sum(X - \bar{X})^{2}}} \quad  \bigg]
\]</span></p>
<p>This is obtained in R by modifying the value of the <code>interval</code> argument.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fev.dad.model, </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">FHEIGHT =</span> <span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">68</span>)),</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="do">##        fit      lwr      upr</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 3.590138 2.463568 4.716709</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 3.944454 2.825839 5.063069</span></span></code></pre></div>
<p>If we set the <code>se</code> argument in <code>geom_smooth</code> to TRUE, the shaded region is the confidence band for the mean. To get the prediction interval, we have use the <code>predict</code> function to calculate the prediction interval, and then we can add that onto the plot as additional <code>geom_lines</code>.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>pred.int <span class="ot">&lt;-</span> <span class="fu">predict</span>(fev.dad.model, <span class="at">interval=</span><span class="st">&quot;predict&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">y=</span>FFEV1, <span class="at">x=</span>FHEIGHT)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>pred.int<span class="sc">$</span>lwr), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>pred.int<span class="sc">$</span>upr), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="slr_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
</div>
<div id="anova-for-regression" class="section level2 hasAnchor" number="7.8">
<h2 class="hasAnchor"><span class="header-section-number">7.8</span> ANOVA for regression<a href="#anova-for-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Since an ANOVA is an analysis of the variance due to a model, compared to the unexplained variance, it can be used to test the overall model fit. This will give us the same general answer to the question of “is there an association between X and Y” that testing for a non-zero slope (<span class="math inline">\(\beta \neq 0\)</span>). If the mean squared value for the regression is much larger than the mean squared value for the residual error, then the line fits the data better than the simple mean, and thus, the slope of the line is not zero.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(fev.dad.model) <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span></code></pre></div>
<table style="width:87%;">
<caption>Analysis of Variance Model</caption>
<colgroup>
<col width="22%" />
<col width="8%" />
<col width="12%" />
<col width="13%" />
<col width="13%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Df</th>
<th align="center">Sum Sq</th>
<th align="center">Mean Sq</th>
<th align="center">F value</th>
<th align="center">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>FHEIGHT</strong></td>
<td align="center">1</td>
<td align="center">16.05</td>
<td align="center">16.05</td>
<td align="center">50.5</td>
<td align="center">4.677e-11</td>
</tr>
<tr class="even">
<td align="center"><strong>Residuals</strong></td>
<td align="center">148</td>
<td align="center">47.05</td>
<td align="center">0.3179</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="correlation-coefficient" class="section level2 hasAnchor" number="7.9">
<h2 class="hasAnchor"><span class="header-section-number">7.9</span> Correlation Coefficient<a href="#correlation-coefficient" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The correlation coefficient <span class="math inline">\(\rho\)</span> (Section @ref(bv-corr)) measures the strength of association between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> in the <em>population</em>.</p>
<p>It also has a second interpretation as the <strong>Coefficient of Determination</strong>: <span class="math inline">\(100\rho^{2}\)</span> = % of variance of <span class="math inline">\(Y\)</span> associated with <span class="math inline">\(\mathbf{X}\)</span> or explained by <span class="math inline">\(\mathbf{X}\)</span> (the model).</p>
<p>In other words, <span class="math inline">\(\rho^{2}\)</span> is reduction in variance of Y associated with knowledge of <span class="math inline">\(\mathbf{X}\)</span>.</p>
<!--chapter:end:slr.Rmd-->
</div>
</div>
<div id="mod-strat" class="section level1 hasAnchor" number="8">
<h1 class="hasAnchor"><span class="header-section-number">8</span> Moderation and Stratification<a href="#mod-strat" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Sometimes the relationship between X and Y may change depending on the value of a third variable. This section provides some motivation for why we need a single model formation that can accommodate more than a single predictor.</p>
<div id="moderation" class="section level2 hasAnchor" number="8.1">
<h2 class="hasAnchor"><span class="header-section-number">8.1</span> Moderation<a href="#moderation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Moderation occurs when the relationship between two variables depends on a third variable.</p>
<ul>
<li>The third variable is referred to as the moderating variable or simply the moderator.</li>
<li>The moderator affects the direction and/or strength of the relationship between the explanatory (<span class="math inline">\(x\)</span>) and response (<span class="math inline">\(y\)</span>) variable.
<ul>
<li>This tends to be an important</li>
</ul></li>
<li>When testing a potential moderator, we are asking the question whether there is an association between two constructs, <strong>but separately for different subgroups within the sample.</strong>
<ul>
<li>This is also called a <em>stratified</em> model, or a <em>subgroup analysis</em>.</li>
</ul></li>
</ul>
<div id="example-1-simpsons-paradox" class="section level3 hasAnchor" number="8.1.1">
<h3 class="hasAnchor"><span class="header-section-number">8.1.1</span> Example 1: Simpson’s Paradox<a href="#example-1-simpsons-paradox" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes moderating variables can result in what’s known as <em>Simpson’s Paradox</em>. This has had legal consequences in the past at UC Berkeley.</p>
<p><a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox" class="uri">https://en.wikipedia.org/wiki/Simpson%27s_paradox</a></p>
</div>
<div id="example-2-sepal-vs-petal-length-in-iris-flowers" class="section level3 hasAnchor" number="8.1.2">
<h3 class="hasAnchor"><span class="header-section-number">8.1.2</span> Example 2: Sepal vs Petal Length in Iris flowers<a href="#example-2-sepal-vs-petal-length-in-iris-flowers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s explore the relationship between the length of the sepal in an iris flower, and the length (cm) of it’s petal.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length)) <span class="sc">+</span> </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">theme_bw</span>()</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>by_spec <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length, <span class="at">col=</span>Species)) <span class="sc">+</span> </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;top&quot;</span>)</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(overall, by_spec , <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="moderation_stratification_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>The points are clearly clustered by species, the slope of the lowess line between virginica and versicolor appear similar in strength, whereas the slope of the line for setosa is closer to zero. This would imply that petal length for Setosa may not be affected by the length of the sepal.</p>
</div>
</div>
<div id="stratification" class="section level2 hasAnchor" number="8.2">
<h2 class="hasAnchor"><span class="header-section-number">8.2</span> Stratification<a href="#stratification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Stratified models fit the regression equations (or any other bivariate analysis) for each subgroup of the population.</p>
<p>The mathematical model describing the relationship between Petal length (<span class="math inline">\(Y\)</span>), and Sepal length (<span class="math inline">\(X\)</span>) for each of the species separately would be written as follows:</p>
<p><span class="math display">\[ Y_{is} \sim \beta_{0s} + \beta_{1s}*x_{i} + \epsilon_{is} \qquad \epsilon_{is} \sim \mathcal{N}(0,\sigma^{2}_{s})\]</span>
<span class="math display">\[ Y_{iv} \sim \beta_{0v} + \beta_{1v}*x_{i} + \epsilon_{iv} \qquad \epsilon_{iv} \sim \mathcal{N}(0,\sigma^{2}_{v}) \]</span>
<span class="math display">\[ Y_{ir} \sim \beta_{0r} + \beta_{1r}*x_{i} + \epsilon_{ir} \qquad \epsilon_{ir} \sim \mathcal{N}(0,\sigma^{2}_{r}) \]</span></p>
<p>where <span class="math inline">\(s, v, r\)</span> indicates species <em>setosa, versicolor</em> and <em>virginica</em> respectively.</p>
<p>In each model, the intercept, slope, and variance of the residuals can all be different. This is the unique and powerful feature of stratified models. The downside is that each model is only fit on the amount of data in that particular subset. Furthermore, each model has 3 parameters that need to be estimated: <span class="math inline">\(\beta_{0}, \beta_{1}\)</span>, and <span class="math inline">\(\sigma^{2}\)</span>, for a total of 9 for the three models. The more parameters that need to be estimated, the more data we need.</p>
</div>
<div id="identifying-a-moderator" class="section level2 hasAnchor" number="8.3">
<h2 class="hasAnchor"><span class="header-section-number">8.3</span> Identifying a moderator<a href="#identifying-a-moderator" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here are 3 scenarios demonstrating how a third variable can modify the relationship between the original two variables.</p>
<p><strong>Scenario 1</strong> - Significant relationship at bivariate level (saying expect the effect to exist in the entire population) then when test for moderation the third variable is a moderator if the strength (i.e., p-value is Non-Significant) of the relationship changes. Could just change strength for one level of third variable, not necessarily all levels of the third variable.</p>
<p><strong>Scenario 2</strong> - Non-significant relationship at bivariate level (saying do not expect the effect to exist in the entire population) then when test for moderation the third variable is a moderator if the relationship becomes significant (saying expect to see it in at least one of the sub-groups or levels of third variable, but not in entire population because was not significant before tested for moderation). Could just become significant in one level of the third variable, not necessarily all levels of the third variable.</p>
<p><strong>Scenario 3</strong> - Significant relationship at bivariate level (saying expect the effect to exist in the entire population) then when test for moderation the third variable is a moderator if the direction (i.e., means change order/direction) of the relationship changes. Could just change direction for one level of third variable, not necessarily all levels of the third variable.</p>
<div id="what-to-look-for-in-each-type-of-analysis" class="section level3 hasAnchor" number="8.3.1">
<h3 class="hasAnchor"><span class="header-section-number">8.3.1</span> What to look for in each type of analysis<a href="#what-to-look-for-in-each-type-of-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>ANOVA</strong> - look at the <span class="math inline">\(p\)</span>-value, <span class="math inline">\(r\)</span>-squared, means, and the graph of the ANOVA and compare to those values in the Moderation (i.e., each level of third variable) output to determine if third variable is moderator or not.</li>
<li><strong>Chi-Square</strong> - look at the <span class="math inline">\(p\)</span>-value, the percents for the columns in the crosstab table, and the graph for the Chi-Square and compare to those values in the Moderation (i.e., each level of third variable) output to determine if third variable is a moderator or not.</li>
<li><strong>Correlation and Linear Regression</strong> - look at the correlation coefficient (<span class="math inline">\(r\)</span>), <span class="math inline">\(p\)</span>-value, regression coefficients, <span class="math inline">\(r\)</span>-squared, and the scatterplot. Compare to those values in the Moderation (i.e., each level of third variable) output to determine if third variable is a moderator or not.</li>
</ul>
</div>
</div>
<div id="example-2-cont.-correlation-regression" class="section level2 hasAnchor" number="8.4">
<h2 class="hasAnchor"><span class="header-section-number">8.4</span> Example 2 (cont.) Correlation &amp; Regression<a href="#example-2-cont.-correlation-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="images/q.png" alt="q" /> Is the relationship between sepal length and petal length the same within each species?</p>
<p>Let’s look at the correlation between these two continuous variables</p>
<p><strong>overall</strong></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Petal.Length)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.8717538</span></span></code></pre></div>
<p><strong>stratified by species</strong></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(iris, iris<span class="sc">$</span>Species, <span class="cf">function</span>(x) <span class="fu">cor</span>(x<span class="sc">$</span>Sepal.Length, x<span class="sc">$</span>Petal.Length))</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: setosa</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.2671758</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: versicolor</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.754049</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: virginica</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.8642247</span></span></code></pre></div>
<p>There is a strong, positive, linear relationship between the sepal length of the flower and the petal length when ignoring the species. The correlation coefficient <span class="math inline">\(r\)</span> for virginica and veriscolor are similar to the overall <span class="math inline">\(r\)</span> value, 0.86 and 0.75 respectively compared to 0.87. However the correlation between sepal and petal length for species setosa is only 0.26.</p>
<p><img src="images/q.png" alt="q" /> How does the species change the regression equation?</p>
<p><strong>overall</strong></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(iris<span class="sc">$</span>Petal.Length <span class="sc">~</span> iris<span class="sc">$</span>Sepal.Length) <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 5</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   term              estimate std.error statistic  p.value</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)          -7.10    0.507      -14.0 6.13e-29</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 iris$Sepal.Length     1.86    0.0859      21.6 1.04e-47</span></span></code></pre></div>
<p><strong>stratified by species</strong></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(iris, iris<span class="sc">$</span>Species, <span class="cf">function</span>(x) {</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(x<span class="sc">$</span>Petal.Length <span class="sc">~</span> x<span class="sc">$</span>Sepal.Length) <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: setosa</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 5</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   term           estimate std.error statistic p.value</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)       0.803    0.344       2.34  0.0238</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 x$Sepal.Length    0.132    0.0685      1.92  0.0607</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: versicolor</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 5</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   term           estimate std.error statistic  p.value</span></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)       0.185    0.514      0.360 7.20e- 1</span></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 x$Sepal.Length    0.686    0.0863     7.95  2.59e-10</span></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: virginica</span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 5</span></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   term           estimate std.error statistic  p.value</span></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)       0.610    0.417       1.46 1.50e- 1</span></span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 x$Sepal.Length    0.750    0.0630     11.9  6.30e-16</span></span></code></pre></div>
<ul>
<li>Overall: -7.1 + 1.86x, significant positive slope p = 1.04x10-47</li>
<li>Setosa: 0.08 + 0.13x, non-significant slope, p=.06</li>
<li>Versicolor: 0.19 + 0.69x, significant positive slope p=2.6x10-10</li>
<li>Virginica: 0.61 + 0.75x, significant positive slope p= 6.3x10-16</li>
</ul>
<p>So we can say that iris specis <strong>moderates</strong> the relationship between sepal and petal length.</p>
</div>
<div id="example-3-anova" class="section level2 hasAnchor" number="8.5">
<h2 class="hasAnchor"><span class="header-section-number">8.5</span> Example 3: ANOVA<a href="#example-3-anova" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Is the relationship between flipper length and species the same for each sex of penguin?</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pen, <span class="fu">aes</span>(<span class="at">x=</span>flipper_length_mm, <span class="at">y=</span>species, <span class="at">fill=</span>species)) <span class="sc">+</span> </span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_slab</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">justification =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width =</span> .<span class="dv">2</span>,  <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_summary</span>(<span class="at">fun=</span><span class="st">&quot;mean&quot;</span>, <span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">pch=</span><span class="dv">17</span>) <span class="sc">+</span> </span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Flipper Length (mm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Species&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Overall&quot;</span>) <span class="sc">+</span> </span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="moderation_stratification_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>pen <span class="sc">%&gt;%</span> <span class="fu">select</span>(flipper_length_mm, species, sex) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>flipper_length_mm, <span class="at">y=</span>species, <span class="at">fill=</span>species)) <span class="sc">+</span> </span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_slab</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">justification =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width =</span> .<span class="dv">2</span>,  <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_summary</span>(<span class="at">fun=</span><span class="st">&quot;mean&quot;</span>, <span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">pch=</span><span class="dv">17</span>) <span class="sc">+</span> </span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Flipper Length (mm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Species&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Overall&quot;</span>) <span class="sc">+</span> </span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sex)</span></code></pre></div>
<p><img src="moderation_stratification_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The pattern of distributions of flipper length by species seems the same for both sexes of penguin. Sex is likely not a moderator. Let’s check the ANOVA anyhow</p>
<p><strong>Overall</strong></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(pen<span class="sc">$</span>flipper_length_mm <span class="sc">~</span> pen<span class="sc">$</span>species) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="do">## pen$species   2  52473   26237   594.8 &lt;2e-16 ***</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals   339  14953      44                   </span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 observations deleted due to missingness</span></span></code></pre></div>
<p><strong>By Sex</strong></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(pen, pen<span class="sc">$</span>sex, <span class="cf">function</span>(x) {</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(x<span class="sc">$</span>flipper_length_mm <span class="sc">~</span> x<span class="sc">$</span>species) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="do">## x$species     2 21415.6   10708  411.79 &lt; 2.2e-16 ***</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals   162  4212.6      26                      </span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a><span class="do">## x$species     2 29098.4 14549.2  384.37 &lt; 2.2e-16 ***</span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals   165  6245.6    37.9                      </span></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
<p>Sex is <strong>not</strong> a modifier, the relationship between species and flipper length is the same within male and female penguins.</p>
</div>
<div id="example-4-chi-squared" class="section level2 hasAnchor" number="8.6">
<h2 class="hasAnchor"><span class="header-section-number">8.6</span> Example 4: Chi-Squared<a href="#example-4-chi-squared" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Identify response, explanatory, and moderating variables</strong></p>
<ul>
<li>Categorical response variable = Ever smoked (variable <code>eversmoke_c</code></li>
<li>Categorical explanatory variable = General Health (variable <code>genhealth</code></li>
<li>Categorical Potential Moderator = Gender (variable <code>female5_c</code></li>
</ul>
<p><strong>Visualize the relationship between smoking and general health across the entire sample.</strong></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_xtab</span>(addhealth<span class="sc">$</span>genhealth, addhealth<span class="sc">$</span>eversmoke_c, </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.total =</span> <span class="cn">FALSE</span>, <span class="at">margin =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">+</span> </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Overall&quot;</span>)</span></code></pre></div>
<p><img src="moderation_stratification_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>fem <span class="ot">&lt;-</span> addhealth <span class="sc">%&gt;%</span> <span class="fu">filter</span>(female_c <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>mal <span class="ot">&lt;-</span> addhealth <span class="sc">%&gt;%</span> <span class="fu">filter</span>(female_c <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>fem.plot <span class="ot">&lt;-</span> <span class="fu">plot_xtab</span>(fem<span class="sc">$</span>genhealth, fem<span class="sc">$</span>eversmoke_c, </span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.total =</span> <span class="cn">FALSE</span>, <span class="at">margin =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">+</span> </span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Females only&quot;</span>)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>mal.plot <span class="ot">&lt;-</span> <span class="fu">plot_xtab</span>(mal<span class="sc">$</span>genhealth, mal<span class="sc">$</span>eversmoke_c, </span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.total =</span> <span class="cn">FALSE</span>, <span class="at">margin =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">+</span> </span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Males only&quot;</span>)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(fem.plot, mal.plot)</span></code></pre></div>
<p><img src="moderation_stratification_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>A general pattern is seen where the proportion of smokers increases as the level of general health decreases. This pattern is similar within males and females, but it is noteworthy that a higher proportion of non smokers are female.</p>
<p><img src="images/q.png" alt="q" /> Does being female change the relationship between smoking and general health? Is the distribution of smoking status (proportion of those who have ever smoked) equal across all levels of general health, for both males and females?</p>
<p><strong>Fit both the original, and stratified models.</strong></p>
<p><strong>original</strong></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(addhealth<span class="sc">$</span>eversmoke_c, addhealth<span class="sc">$</span>genhealth)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s Chi-squared test</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  addhealth$eversmoke_c and addhealth$genhealth</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="do">## X-squared = 30.795, df = 4, p-value = 3.371e-06</span></span></code></pre></div>
<p><strong>stratified</strong></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(addhealth, addhealth<span class="sc">$</span>female_c, <span class="cf">function</span>(x) <span class="fu">chisq.test</span>(x<span class="sc">$</span>eversmoke_c, x<span class="sc">$</span>genhealth))</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="do">## addhealth$female_c: Male</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s Chi-squared test</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  x$eversmoke_c and x$genhealth</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="do">## X-squared = 19.455, df = 4, p-value = 0.0006395</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="do">## addhealth$female_c: Female</span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s Chi-squared test</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  x$eversmoke_c and x$genhealth</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="do">## X-squared = 19.998, df = 4, p-value = 0.0004998</span></span></code></pre></div>
<p><strong>Determine if the Third Variable is a moderator or not.</strong></p>
<p>The relationship between smoking status and general health is significant in both the main effects and the stratified model. The distribution of smoking status across general health categories does not differ between females and males. Gender is <strong>not</strong> a moderator for this analysis.</p>
<!--chapter:end:moderation_stratification.Rmd-->
</div>
</div>
<div id="mlr" class="section level1 hasAnchor" number="9">
<h1 class="hasAnchor"><span class="header-section-number">9</span> Multiple Linear Regression<a href="#mlr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Hopefully by now you have some motivation for why we need to have a robust model that can incorporate information from multiple variables at the same time. Multiple linear regression is our tool to expand our MODEL to better fit the DATA.</p>
<ul>
<li>Extends simple linear regression.</li>
<li>Describes a linear relationship between a single continuous <span class="math inline">\(Y\)</span> variable, and several <span class="math inline">\(X\)</span> variables.</li>
<li>Predicts <span class="math inline">\(Y\)</span> from <span class="math inline">\(X_{1}, X_{2}, \ldots , X_{P}\)</span>.</li>
<li>X’s can be continuous or discrete (categorical)</li>
<li>X’s can be transformations of other X’s, e.g., <span class="math inline">\(log(x), x^{2}\)</span>.</li>
</ul>
<p>Now it’s no longer a 2D regression <em>line</em>, but a <span class="math inline">\(p\)</span> dimensional regression plane.</p>
<p><img src="images/regression_plane.png" /></p>

<div class="rmdnote">
This section uses functions from the <code>dotwhisker</code> and <code>gtsummary</code> visualize results from multiple regression models.
</div>
<div id="mlr-math-model" class="section level2 hasAnchor" number="9.1">
<h2 class="hasAnchor"><span class="header-section-number">9.1</span> Mathematical Model<a href="#mlr-math-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The mathematical model for multiple linear regression equates the value of the continuous outcome <span class="math inline">\(y_{i}\)</span> to a <strong>linear combination</strong> of multiple predictors <span class="math inline">\(x_{1} \ldots x_{p}\)</span> each with their own slope coefficient <span class="math inline">\(\beta_{1} \ldots \beta_{p}\)</span>.</p>
<p><span class="math display">\[ y_{i} = \beta_{0} + \beta_{1}x_{1i} + \ldots + \beta_{p}x_{pi} + \epsilon_{i}\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes the observations <span class="math inline">\(i = 1 \ldots n\)</span>, and <span class="math inline">\(j\)</span> indexes the number of parameters <span class="math inline">\(j=1 \ldots p\)</span>. This linear combination is often written using <em>summation notation</em>: <span class="math inline">\(\sum_{i=1}^{p}X_{ij}\beta_{j}\)</span>.</p>
<p>The assumptions on the residuals <span class="math inline">\(\epsilon_{i}\)</span> still hold:</p>
<ul>
<li>They have mean zero<br />
</li>
<li>They are homoscedastic, that is all have the same finite variance: <span class="math inline">\(Var(\epsilon_{i})=\sigma^{2}&lt;\infty\)</span><br />
</li>
<li>Distinct error terms are uncorrelated: (Independent) <span class="math inline">\(\text{Cov}(\epsilon_{i},\epsilon_{j})=0,\forall i\neq j.\)</span></li>
</ul>
<p>In matrix notation the linear combination of <span class="math inline">\(X\)</span>’s and <span class="math inline">\(\beta\)</span>’s is written as <span class="math inline">\(\mathbf{x}_{i}^{&#39;}\mathbf{\beta}\)</span>, (the inner product between the vectors <span class="math inline">\(\mathbf{x}_{i}\)</span> and <span class="math inline">\(\mathbf{\beta}\)</span>). Then the model is written as:</p>
<p><span class="math display">\[ \textbf{y} = \textbf{X} \mathbf{\beta} + \mathbf{\epsilon} ,\]</span></p>
<p>and we say the regression model relates <span class="math inline">\(y\)</span> to a function of <span class="math inline">\(\textbf{X}\)</span> and <span class="math inline">\(\mathbf{\beta}\)</span>, where <span class="math inline">\(\textbf{X}\)</span> is a <span class="math inline">\(nxp\)</span> matrix of <span class="math inline">\(p\)</span> covariates on <span class="math inline">\(n\)</span> observations and <span class="math inline">\(\mathbf{\beta}\)</span> is a length <span class="math inline">\(p\)</span> vector of regression coefficients.</p>
<p><em>Note: Knowledge of Matricies or Linear Algebra is not required to conduct or understand multiple regression, but it is foundational and essential for Statistics and Data Science majors to understand the theory behind linear models.</em></p>
<p><em>Learners in other domains should attempt to understand matricies at a high level, as some of the places models can fail is due to problems doing math on matricies.</em></p>
</div>
<div id="parameter-estimation" class="section level2 hasAnchor" number="9.2">
<h2 class="hasAnchor"><span class="header-section-number">9.2</span> Parameter Estimation<a href="#parameter-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Recall the goal of regression analysis is to minimize the unexplained/residual error. That is, to minimize the difference between the value of the dependent variable predicted by the model and the true value of the dependent variable.</p>
<p><span class="math display">\[ \hat{y_{i}} - y_{i}, \]</span></p>
<p>where the predicted values <span class="math inline">\(\hat{y}_{i}\)</span> are calculated as</p>
<p><span class="math display">\[\hat{y}_{i}  = \sum_{i=1}^{p}X_{ij}\beta_{j}\]</span></p>
<p>The sum of the squared residual errors (the distance between the observed point <span class="math inline">\(y_{i}\)</span> and the fitted value) now has the following form:</p>
<p><span class="math display">\[ \sum_{i=1}^{n} |y_{i} - \sum_{i=1}^{p}X_{ij}\beta_{j}|^{2}\]</span></p>
<p>Or in matrix notation</p>
<p><span class="math display">\[ || \mathbf{Y} - \mathbf{X}\mathbf{\beta} ||^{2} \]</span></p>
<p>Solving this least squares problem for multiple regression requires knowledge of multivariable calculus and linear algebra, and so is left to a course in mathematical statistics.</p>
</div>
<div id="fitting-the-model" class="section level2 hasAnchor" number="9.3">
<h2 class="hasAnchor"><span class="header-section-number">9.3</span> Fitting the model<a href="#fitting-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The analysis in example @ref(slr-fev) concluded that FEV1 in fathers significantly increases by 0.12 (95% CI:0.09, 0.15) liters per additional inch in height (p&lt;.0001). Looking at the multiple <span class="math inline">\(R^{2}\)</span> (correlation of determination), this simple model explains 25% of the variance seen in the outcome <span class="math inline">\(y\)</span>.</p>
<p>However, FEV tends to decrease with age for adults, so we should be able to predict it better if we use both height and age as independent variables in a multiple regression equation.</p>

<div class="rmdnote">
What direction do you expect the slope coefficient for age to be? For height?
</div>
<p>Fitting a regression model in R with more than 1 predictor is done by adding each variable to the right hand side of the model notation connected with a <code>+</code>.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(FFEV1 <span class="sc">~</span> FAGE <span class="sc">+</span> FHEIGHT, <span class="at">data=</span>fev)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = FFEV1 ~ FAGE + FHEIGHT, data = fev)</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)         FAGE      FHEIGHT  </span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    -2.76075     -0.02664      0.11440</span></span></code></pre></div>
</div>
<div id="interpreting-coefficients" class="section level2 hasAnchor" number="9.4">
<h2 class="hasAnchor"><span class="header-section-number">9.4</span> Interpreting Coefficients<a href="#interpreting-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Similar to simple linear regression, each <span class="math inline">\(\beta_{j}\)</span> coefficient is considered a slope. That is, the amount <span class="math inline">\(Y\)</span> will change for every 1 unit increase in <span class="math inline">\(X_{j}\)</span>. In a multiple variable regression model, <span class="math inline">\(\b_{j}\)</span> is the estimated change in <span class="math inline">\(Y\)</span> <em>after controlling for other predictors in the model</em>.</p>
<div id="continuous-predictors" class="section level3 hasAnchor" number="9.4.1">
<h3 class="hasAnchor"><span class="header-section-number">9.4.1</span> Continuous predictors<a href="#continuous-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>mlr.dad.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(FFEV1 <span class="sc">~</span> FAGE <span class="sc">+</span> FHEIGHT, <span class="at">data=</span>fev)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlr.dad.model)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = FFEV1 ~ FAGE + FHEIGHT, data = fev)</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min       1Q   Median       3Q      Max </span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -1.34708 -0.34142  0.00917  0.37174  1.41853 </span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="do">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) -2.760747   1.137746  -2.427   0.0165 *  </span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="do">## FAGE        -0.026639   0.006369  -4.183 4.93e-05 ***</span></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="do">## FHEIGHT      0.114397   0.015789   7.245 2.25e-11 ***</span></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 0.5348 on 147 degrees of freedom</span></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.3337, Adjusted R-squared:  0.3247 </span></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 36.81 on 2 and 147 DF,  p-value: 1.094e-13</span></span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mlr.dad.model)</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a><span class="do">##                   2.5 %      97.5 %</span></span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) -5.00919751 -0.51229620</span></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a><span class="do">## FAGE        -0.03922545 -0.01405323</span></span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a><span class="do">## FHEIGHT      0.08319434  0.14559974</span></span></code></pre></div>
<ul>
<li>Holding height constant, a father who is one year older is expected to have a FEV value 0.03 (0.01, 0.04) liters less than another man (p&lt;.0001).</li>
<li>Holding age constant, a father who is 1cm taller than another man is expected to have a FEV value of 0.11 (.08, 0.15) liter greater than the other man (p&lt;.0001).</li>
</ul>
<p>For the model that includes age, the coefficient for height is now 0.11, which is interpreted as the rate of change of FEV1 as a function of height <strong>after adjusting for age</strong>. This is also called the <strong>partial regression coefficient</strong> of FEV1 on height after adjusting for age.</p>
</div>
<div id="binary-predictors" class="section level3 hasAnchor" number="9.4.2">
<h3 class="hasAnchor"><span class="header-section-number">9.4.2</span> Binary predictors<a href="#binary-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Binary predictors (categorical variables with only 2 levels) get converted to a numeric <em>binary indicator</em> variable which only has the values 0 and 1. Whichever level gets assigned to be 0 is called the <em>reference</em> group or level. The regression estimate <span class="math inline">\(b\)</span> then is the effect of being in group (<span class="math inline">\(x=1\)</span>) <em>compared to</em> being in the reference (<span class="math inline">\(x=0\)</span>) group.</p>
<p>Does gender also play a roll in FEV? Let’s look at how gender may impact or change the relationship between FEV and either height or age.</p>
<blockquote>
<p>Note, the <code>fev</code> data set is in <em>wide</em> form right now, with different columns for mothers and fathers. First I need to reshape the data into <em>long</em> format, so gender is it’s own variable.</p>
</blockquote>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a pivot_longer() probably would have worked here as well</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>fev_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gender =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FSEX, fev<span class="sc">$</span>MSEX), </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fev1 =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FFEV1, fev<span class="sc">$</span>MFEV1), </span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ht =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FHEIGHT, fev<span class="sc">$</span>MHEIGHT), </span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">age =</span> <span class="fu">c</span>(fev<span class="sc">$</span>FAGE, fev<span class="sc">$</span>MAGE), </span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">area =</span> <span class="fu">c</span>(fev<span class="sc">$</span>AREA, fev<span class="sc">$</span>AREA))</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>fev_long<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(fev_long<span class="sc">$</span>gender, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>))</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>fev_long<span class="sc">$</span>area   <span class="ot">&lt;-</span> <span class="fu">factor</span>(fev_long<span class="sc">$</span>area, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Burbank&quot;</span>, <span class="st">&quot;Lancaster&quot;</span>, <span class="st">&quot;Long Beach&quot;</span>, <span class="st">&quot;Glendora&quot;</span>))</span></code></pre></div>
<p>So the model being fit looks like:</p>
<p><span class="math display">\[ y_{i} = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} + \epsilon_{i}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(x_{1}\)</span>: Age</li>
<li><span class="math inline">\(x_{2}\)</span>: height</li>
<li><span class="math inline">\(x_{3}\)</span>: 0 if Male, 1 if Female</li>
</ul>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(fev1 <span class="sc">~</span> age <span class="sc">+</span> ht <span class="sc">+</span> gender, <span class="at">data=</span>fev_long)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = fev1 ~ age + ht + gender, data = fev_long)</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)          age           ht      genderF  </span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    -2.24051     -0.02354      0.10509     -0.63775</span></span></code></pre></div>
<p>In this model gender is a binary categorical variable, with reference group “Male”. This is detected because the variable that shows up in the regression model output is <code>genderF</code>. So the estimate shown is for males, compared to females.</p>
<p>Note that I <strong>DID NOT</strong> have to convert the categorical variable <code>gender</code> to a binary numeric variable before fitting it into the model. R (and any other software program) will do this for you already.</p>
<p>The regression equation for the model with gender is</p>
<p><span class="math display">\[ y = -2.24 - 0.02 age + 0.11 height - 0.64genderF \]</span></p>
<ul>
<li><span class="math inline">\(b_{0}:\)</span> For a male who is 0 years old and 0 cm tall, their FEV is -2.24L.</li>
<li><span class="math inline">\(b_{1}:\)</span> For every additional year older an individual is, their FEV1 decreases by 0.02L.</li>
<li><span class="math inline">\(b_{2}:\)</span> For every additional cm taller an individual is, their FEV1 increases by 0.16L.</li>
<li><span class="math inline">\(b_{3}:\)</span> Females have 0.64L lower FEV compared to males.</li>
</ul>
<p><strong>Note</strong>: The interpretation of categorical variables still falls under the template language of “for every one unit increase in <span class="math inline">\(X_{p}\)</span>, <span class="math inline">\(Y\)</span> changes by <span class="math inline">\(b_{p}\)</span>”. Here, <span class="math inline">\(X_{3}=0\)</span> for males, and 1 for females. So a 1 “unit” change is females <em>compared to</em> males.</p>
</div>
<div id="cat-predictors" class="section level3 hasAnchor" number="9.4.3">
<h3 class="hasAnchor"><span class="header-section-number">9.4.3</span> Categorical Predictors<a href="#cat-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s continue to model the FEV for individuals living in Southern California, but now we also consider the effect of city they live in. For those unfamiliar with the region, these cities represent very different environmental profiles.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(fev_long<span class="sc">$</span>area)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Burbank  Lancaster Long Beach   Glendora </span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="do">##         48         98         38        116</span></span></code></pre></div>
<p>Let’s fit a model with <code>area</code>, notice again I do not do anything to the variable <code>area</code> itself aside from add it into the model.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(fev1 <span class="sc">~</span> age <span class="sc">+</span> ht <span class="sc">+</span> gender <span class="sc">+</span> area, <span class="at">data=</span>fev_long) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = fev1 ~ age + ht + gender + area, data = fev_long)</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min       1Q   Median       3Q      Max </span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="do">## -1.32809 -0.29573  0.00578  0.31588  1.37041 </span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="do">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)    -2.250564   0.752414  -2.991  0.00302 ** </span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="do">## age            -0.022801   0.004151  -5.493 8.59e-08 ***</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ht              0.103866   0.010555   9.841  &lt; 2e-16 ***</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="do">## genderF        -0.642168   0.078400  -8.191 8.10e-15 ***</span></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a><span class="do">## areaLancaster   0.031549   0.084980   0.371  0.71072    </span></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a><span class="do">## areaLong Beach  0.061963   0.104057   0.595  0.55199    </span></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a><span class="do">## areaGlendora    0.121589   0.082097   1.481  0.13967    </span></span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 0.4777 on 293 degrees of freedom</span></span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.6529, Adjusted R-squared:  0.6458 </span></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 91.86 on 6 and 293 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>Examine the coefficient names, <code>areaLancaster</code>, <code>areaLong Beach</code> and <code>areaGlendora</code>. Again R automatically take a categorical variable and turn it into a series of binary indicator variables where a 1 indicates if a person is from that area. Notice how someone from Burbank has 0’s for all of the three indicator variables, someone from Lancaster only has a 1 in the <code>areaLancaster</code> variable and 0 otherwise. And etc for each other area.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
areaLancaster
</th>
<th style="text-align:right;">
areaLong.Beach
</th>
<th style="text-align:right;">
areaGlendora
</th>
<th style="text-align:left;">
area
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Burbank
</td>
</tr>
<tr>
<td style="text-align:left;">
51
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Lancaster
</td>
</tr>
<tr>
<td style="text-align:left;">
75
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
Long Beach
</td>
</tr>
<tr>
<td style="text-align:left;">
101
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Glendora
</td>
</tr>
</tbody>
</table>
<ul>
<li>Most commonly known as “Dummy coding”. Not an informative term to use.</li>
<li>Better used term: Indicator variable</li>
<li>Math notation: <strong>I(gender == “Female”)</strong>.</li>
<li>A.k.a “reference coding” or “one hot encoding”</li>
<li>For a nominal X with K categories, define K indicator variables.
<ul>
<li>Choose a reference (referent) category:</li>
<li>Leave it out</li>
<li>Use remaining K-1 in the regression.</li>
<li>Often, the largest category is chosen as the reference category.</li>
</ul></li>
</ul>
<p>Interpreting the regression coefficients are going to be <strong>compared to the reference group</strong>. In this case, it is the Burbank area. Why Burbank? Because that is what R sees as the first level. If you want something different, you need to change the factor ordering.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(fev_long<span class="sc">$</span>area)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Burbank&quot;    &quot;Lancaster&quot;  &quot;Long Beach&quot; &quot;Glendora&quot;</span></span></code></pre></div>
<p>The mathematical model is now written as follows,</p>
<p><span class="math display">\[ Y_{i} = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} + \beta_{4}x_{4i} + \beta_{5}x_{5i} +\beta_{6}x_{6i}\epsilon_{i}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(x_{1}\)</span>: Age</li>
<li><span class="math inline">\(x_{2}\)</span>: height</li>
<li><span class="math inline">\(x_{3}\)</span>: 0 if Male, 1 if Female</li>
<li><span class="math inline">\(x_{4}\)</span>: 1 if living in Lancaster, 0 otherwise</li>
<li><span class="math inline">\(x_{5}\)</span>: 1 if living in Long Beach, 0 otherwise</li>
<li><span class="math inline">\(x_{6}\)</span>: 1 if living in Glendora, 0 otherwise</li>
</ul>
<p>For someone living in Burbank, <span class="math inline">\(x_{4}=x_{5}=x_{6} =0\)</span> so the model then is</p>
<p><span class="math display">\[Y_{i} = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} + \epsilon_{i}\]</span></p>
<p>For someone living in Lancaster, <span class="math inline">\(x_{4}=1, x_{5}=0, x_{6} =0\)</span> so the model then is</p>
<p><span class="math display">\[
Y_{i} = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} + \beta_{4}(1) \\
Y_{i} \sim (\beta_{0} + \beta_{4}) + \beta_{1}x_{i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} \epsilon_{i}
\]</span></p>
<p>For someone living in Long Beach, <span class="math inline">\(x_{4}=0, x_{5}=1, x_{6} =0\)</span> so the model then is</p>
<p><span class="math display">\[
Y_{i} = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} + \beta_{5}(1) \\
Y_{i} \sim (\beta_{0} + \beta_{5}) + \beta_{1}x_{i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} \epsilon_{i}
\]</span></p>
<p>and the model for someone living in Glendora <span class="math inline">\(x_{4}=0, x_{5}=0, x_{6} =1\)</span> is</p>
<p><span class="math display">\[
Y_{i} = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} + \beta_{6}(1) \\
Y_{i} \sim (\beta_{0} + \beta_{6}) + \beta_{1}x_{i} + \beta_{2}x_{2i} +\beta_{3}x_{3i} \epsilon_{i}
\]</span></p>
<p>In summary, each area gets it’s own intercept, but still has a common slope for all other variables.</p>
<p><span class="math display">\[
y_{i.Burbank} = -2.25 - 0.023(age) + 0.10(ht) -0.64(female) \\
y_{i.Lancaster} = -2.22 - 0.023(age) + 0.10(ht) -0.64(female)\\
y_{i.Long.Beach} = -2.19 - 0.023(age) + 0.10(ht) -0.64(female) \\
y_{i.Glendora} = -2.13 - 0.023(age) + 0.10(ht) -0.64(female)
\]</span></p>
<p>Let’s look interpret the regression coefficients and their 95% confidence intervals from the main effects model again.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(fev1 <span class="sc">~</span> age <span class="sc">+</span> ht <span class="sc">+</span> gender <span class="sc">+</span> area, <span class="at">data=</span>fev_long) <span class="sc">|&gt;</span> <span class="fu">tbl_regression</span>()</span></code></pre></div>
<div id="iydbaessff" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#iydbaessff .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iydbaessff .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iydbaessff .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iydbaessff .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iydbaessff .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iydbaessff .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iydbaessff .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iydbaessff .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iydbaessff .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iydbaessff .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iydbaessff .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iydbaessff .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#iydbaessff .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iydbaessff .gt_from_md > :first-child {
  margin-top: 0;
}

#iydbaessff .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iydbaessff .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iydbaessff .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#iydbaessff .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#iydbaessff .gt_row_group_first td {
  border-top-width: 2px;
}

#iydbaessff .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iydbaessff .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#iydbaessff .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#iydbaessff .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iydbaessff .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iydbaessff .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iydbaessff .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#iydbaessff .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iydbaessff .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iydbaessff .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iydbaessff .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iydbaessff .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iydbaessff .gt_left {
  text-align: left;
}

#iydbaessff .gt_center {
  text-align: center;
}

#iydbaessff .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iydbaessff .gt_font_normal {
  font-weight: normal;
}

#iydbaessff .gt_font_bold {
  font-weight: bold;
}

#iydbaessff .gt_font_italic {
  font-style: italic;
}

#iydbaessff .gt_super {
  font-size: 65%;
}

#iydbaessff .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#iydbaessff .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#iydbaessff .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#iydbaessff .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#iydbaessff .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#iydbaessff .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">age</td>
<td class="gt_row gt_center">-0.02</td>
<td class="gt_row gt_center">-0.03, -0.01</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">ht</td>
<td class="gt_row gt_center">0.10</td>
<td class="gt_row gt_center">0.08, 0.12</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">gender</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">M</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">F</td>
<td class="gt_row gt_center">-0.64</td>
<td class="gt_row gt_center">-0.80, -0.49</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">area</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Burbank</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Lancaster</td>
<td class="gt_row gt_center">0.03</td>
<td class="gt_row gt_center">-0.14, 0.20</td>
<td class="gt_row gt_center">0.7</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Long Beach</td>
<td class="gt_row gt_center">0.06</td>
<td class="gt_row gt_center">-0.14, 0.27</td>
<td class="gt_row gt_center">0.6</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Glendora</td>
<td class="gt_row gt_center">0.12</td>
<td class="gt_row gt_center">-0.04, 0.28</td>
<td class="gt_row gt_center">0.14</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<ul>
<li><span class="math inline">\(b_{4}\)</span>: After controlling for age, height and gender, those that live in Lancaster have 0.03 (-0.14, 0.20) higher FEV1 compared to someone living in Burbank (p=0.7).</li>
<li><span class="math inline">\(b_{5}\)</span>: After controlling for age, height and gender, those that live in Long Beach have 0.06 (-0.14, 0.27) higher FEV1 compared to someone living in Burbank (p=0.6).</li>
<li><span class="math inline">\(b_{6}\)</span>: After controlling for age, height and gender, those that live in Glendora have 0.12 (-0.04, 0.28) higher FEV1 compared to someone living in Burbank (p=0.14).</li>
</ul>
<blockquote>
<p>Beta coefficients for categorical variables are always interpreted as the difference between that particular level and the reference group</p>
</blockquote>
</div>
</div>
<div id="presenting-results" class="section level2 hasAnchor" number="9.5">
<h2 class="hasAnchor"><span class="header-section-number">9.5</span> Presenting results<a href="#presenting-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The direct software output always tells you more information than what you are wanting to share with an audience. Here are some ways to “prettify” your regression output.</p>
<ul>
<li>Using <code>tidy</code> and <code>kable</code></li>
</ul>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mlr.dad.model) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-2.761
</td>
<td style="text-align:right;">
1.138
</td>
<td style="text-align:right;">
-2.427
</td>
<td style="text-align:right;">
0.016
</td>
</tr>
<tr>
<td style="text-align:left;">
FAGE
</td>
<td style="text-align:right;">
-0.027
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
-4.183
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
FHEIGHT
</td>
<td style="text-align:right;">
0.114
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
7.245
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
</tbody>
</table>
<ul>
<li>Using <a href="https://www.danieldsjoberg.com/gtsummary/"><code>gtsummary</code></a></li>
</ul>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(mlr.dad.model)</span></code></pre></div>
<div id="yfsnkzzheh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yfsnkzzheh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yfsnkzzheh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yfsnkzzheh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yfsnkzzheh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yfsnkzzheh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yfsnkzzheh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yfsnkzzheh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yfsnkzzheh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yfsnkzzheh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yfsnkzzheh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yfsnkzzheh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yfsnkzzheh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yfsnkzzheh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yfsnkzzheh .gt_from_md > :first-child {
  margin-top: 0;
}

#yfsnkzzheh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yfsnkzzheh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yfsnkzzheh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yfsnkzzheh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yfsnkzzheh .gt_row_group_first td {
  border-top-width: 2px;
}

#yfsnkzzheh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yfsnkzzheh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yfsnkzzheh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yfsnkzzheh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yfsnkzzheh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yfsnkzzheh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yfsnkzzheh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yfsnkzzheh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yfsnkzzheh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yfsnkzzheh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yfsnkzzheh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yfsnkzzheh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yfsnkzzheh .gt_left {
  text-align: left;
}

#yfsnkzzheh .gt_center {
  text-align: center;
}

#yfsnkzzheh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yfsnkzzheh .gt_font_normal {
  font-weight: normal;
}

#yfsnkzzheh .gt_font_bold {
  font-weight: bold;
}

#yfsnkzzheh .gt_font_italic {
  font-style: italic;
}

#yfsnkzzheh .gt_super {
  font-size: 65%;
}

#yfsnkzzheh .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#yfsnkzzheh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#yfsnkzzheh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yfsnkzzheh .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#yfsnkzzheh .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#yfsnkzzheh .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">FAGE</td>
<td class="gt_row gt_center">-0.03</td>
<td class="gt_row gt_center">-0.04, -0.01</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">FHEIGHT</td>
<td class="gt_row gt_center">0.11</td>
<td class="gt_row gt_center">0.08, 0.15</td>
<td class="gt_row gt_center"><0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<ul>
<li>Using <code>dwplot</code> from the <a href="https://cran.r-project.org/web/packages/dotwhisker/vignettes/dotwhisker-vignette.html"><code>dotwhisker</code></a> package to create a <em>forest plot</em>.</li>
</ul>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dotwhisker)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dwplot</span>(mlr.dad.model)</span></code></pre></div>
<p><img src="mlr_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<ul>
<li>Improvement on <code>dwplot</code> - extract the point estimate &amp; CI into a data table, then add it as a <code>geom_text</code> layer.</li>
</ul>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(                               <span class="co"># create a data frame</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="fu">coef</span>(mlr.dad.model),                 <span class="co"># by extracting the coefficients,</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI.low =</span> <span class="fu">confint</span>(mlr.dad.model)[,<span class="dv">1</span>],            <span class="co"># with their lower</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI.high =</span> <span class="fu">confint</span>(mlr.dad.model)[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span>       <span class="co"># and upper confidence interval values</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)                                        <span class="co"># round digits</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create the string for the label</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>text<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(text<span class="sc">$</span>estimate, <span class="st">&quot;(&quot;</span>, text<span class="sc">$</span>CI.low, <span class="st">&quot;, &quot;</span> , text<span class="sc">$</span>CI.high, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>text                                              <span class="co"># view the results to check for correctness</span></span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="do">##             estimate CI.low CI.high               label</span></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)    -2.76  -5.01   -0.51 -2.76(-5.01, -0.51)</span></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a><span class="do">## FAGE           -0.03  -0.04   -0.01 -0.03(-0.04, -0.01)</span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a><span class="do">## FHEIGHT         0.11   0.08    0.15    0.11(0.08, 0.15)</span></span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> text[<span class="sc">-</span><span class="dv">1</span>, ]                                <span class="co"># drop the intercept row</span></span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- create plot ------</span></span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>mlr.dad.model <span class="sc">%&gt;%</span>                                  <span class="co"># start with a model</span></span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span>                                       <span class="co"># tidy up the output</span></span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relabel_predictors</span>(<span class="st">&quot;(Intercept)&quot;</span> <span class="ot">=</span> <span class="st">&quot;Intercept&quot;</span>,  <span class="co"># convert to sensible names</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FAGE =</span> <span class="st">&quot;Age&quot;</span>, </span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FHEIGHT =</span> <span class="st">&quot;Height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">&quot;Intercept&quot;</span>) <span class="sc">%&gt;%</span>                  <span class="co"># drop the intercept </span></span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dwplot</span>() <span class="sc">+</span>                                       <span class="co"># create the ggplot </span></span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>text<span class="sc">$</span>estimate, <span class="at">y =</span> term,         <span class="co"># add the estimates and CI&#39;s</span></span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> text<span class="sc">$</span>label), </span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_y =</span> .<span class="dv">1</span>) <span class="sc">+</span>                        <span class="co"># move it up a smidge</span></span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>,         <span class="co"># add a reference line at 0</span></span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span>           <span class="co"># make it dashed and a little larger</span></span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">15</span>, .<span class="dv">15</span>))        <span class="co"># expand the x axis limits for readability</span></span></code></pre></div>
<p><img src="mlr_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="confounding" class="section level2 hasAnchor" number="9.6">
<h2 class="hasAnchor"><span class="header-section-number">9.6</span> Confounding<a href="#confounding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One primary purpose of a multivariable model is to assess the relationship between a particular explanatory variable <span class="math inline">\(x\)</span> and your response variable <span class="math inline">\(y\)</span>, <em>after controlling for other factors</em>.</p>
<div class="figure">
<img src="images/confounder.png" alt="" />
<p class="caption">All the ways covariates can affect response variables</p>
</div>
<p>Credit: <a href="https://significantlystatistical.wordpress.com/2014/12/12/confounders-mediators-moderators-and-covariates/">A blog about statistical musings</a></p>

<div class="rmdnote">
Easy to read short article from a Gastroenterology journal on how to control confounding effects by statistical analysis. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4017459/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4017459/</a>
</div>
<p>Other factors (characteristics/variables) could also be explaining part of the variability seen in <span class="math inline">\(y\)</span>.</p>
<blockquote>
<p>If the relationship between <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(y\)</span> is bivariately significant, but then no longer significant once <span class="math inline">\(x_{2}\)</span> has been added to the model, then <span class="math inline">\(x_{2}\)</span> is said to explain, or <strong>confound</strong>, the relationship between <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(y\)</span>.</p>
</blockquote>
<p>Steps to determine if a variable <span class="math inline">\(x_{2}\)</span> is a confounder.</p>
<ol style="list-style-type: decimal">
<li>Fit a regression model on <span class="math inline">\(y \sim x_{1}\)</span>.</li>
<li>If <span class="math inline">\(x_{1}\)</span> is not significantly associated with <span class="math inline">\(y\)</span>, STOP. Re-read the “IF” part of the definition of a confounder.</li>
<li>Fit a regression model on <span class="math inline">\(y \sim x_{1} + x_{2}\)</span>.</li>
<li>Look at the p-value for <span class="math inline">\(x_{1}\)</span>. One of two things will have happened.
<ul>
<li>If <span class="math inline">\(x_{1}\)</span> is still significant, then <span class="math inline">\(x_{2}\)</span> does NOT confound (or explain) the relationship between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_{1}\)</span>.</li>
<li>If <span class="math inline">\(x_{1}\)</span> is NO LONGER significantly associated with <span class="math inline">\(y\)</span>, then <span class="math inline">\(x_{2}\)</span> IS a confounder.</li>
</ul></li>
</ol>
<p>This means that the third variable is explaining the relationship between the explanatory variable and the response variable.</p>
<p>Note that this is a two way relationship. The order of <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> is invaraiant. If you were to add <span class="math inline">\(x_{2}\)</span> to the model before <span class="math inline">\(x_{1}\)</span> you may see the same thing occur. That is - both variables are explaining the same portion of the variance in <span class="math inline">\(y\)</span>.</p>
<!---
### Example: Does smoking affect pulse rate? 

Prior studies have indicate that smoking is associated with high blood pressure. Is smoking also associated with your pulse rate? 



First we consider the bivariate relationship between pulse rate (`H4PR`) and cigarette smoking as measured by the quantity of cigarettes smoked each day during the past 30 days (`H4TO6`). 

```r
lm(H4PR ~ H4TO6 , data=addhealth) %>% summary()
## 
## Call:
## lm(formula = H4PR ~ H4TO6, data = addhealth)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -30.826  -8.548  -0.687   7.258 120.841 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  73.7702     0.4953 148.936  < 2e-16 ***
## H4TO6         0.1389     0.0396   3.507 0.000464 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 12.56 on 1761 degrees of freedom
##   (4741 observations deleted due to missingness)
## Multiple R-squared:  0.006936,   Adjusted R-squared:  0.006372 
## F-statistic:  12.3 on 1 and 1761 DF,  p-value: 0.0004644
```

As the number of cigarettes smoked each day increases by one, a persons pulse rate significantly increases by 0.13. 

However, there are more ways to assess the amount someone smokes. Consider a different measure of smoking, "during the past 30 days, on how many days did you smoke cigarettes?" (`H4TO5`). So here we are measuring the # of days smoked, not the # of cigarettes per day. If we include both in the model, we note that the earlier measure of smoking `H4TO6` is no longer significant (at the 0.05 level). 


```r
lm(H4PR ~ H4TO5 +  H4TO6 , data=addhealth) %>% summary()
## 
## Call:
## lm(formula = H4PR ~ H4TO5 + H4TO6, data = addhealth)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -31.682  -8.509  -1.014   7.302 120.320 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 72.78932    0.68037 106.985   <2e-16 ***
## H4TO5        0.06870    0.03271   2.101   0.0358 *  
## H4TO6        0.08292    0.04769   1.739   0.0822 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 12.55 on 1760 degrees of freedom
##   (4741 observations deleted due to missingness)
## Multiple R-squared:  0.00942,    Adjusted R-squared:  0.008294 
## F-statistic: 8.368 on 2 and 1760 DF,  p-value: 0.0002415
```

Thus, the number of days smoked _confounds_ the relationship between the number of cigarettes smoked per day, and the person's pulse rate. 


--->
</div>
<div id="model-diagnostics-1" class="section level2 hasAnchor" number="9.7">
<h2 class="hasAnchor"><span class="header-section-number">9.7</span> Model Diagnostics<a href="#model-diagnostics-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The same set of regression diagnostics can be examined to identify any potential influential points, outliers or other problems with the linear model.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(mlr.dad.model)</span></code></pre></div>
<p><img src="mlr_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>More about these model diagnostics can be found in Section (<span class="citation">(<a href="#ref-model-diagnostics" role="doc-biblioref"><strong>model-diagnostics?</strong></a>)</span>)</p>
</div>
<div id="what-to-watch-out-for" class="section level2 hasAnchor" number="9.8">
<h2 class="hasAnchor"><span class="header-section-number">9.8</span> What to watch out for<a href="#what-to-watch-out-for" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Representative sample</li>
<li>Range of prediction should match observed range of X in sample</li>
<li>Use of nominal or ordinal, rather than interval or ratio data</li>
<li>Errors-in-variables</li>
<li>Correlation does not imply causation</li>
<li>Violation of assumptions</li>
<li>Influential points</li>
<li>Appropriate model</li>
<li>Multicollinearity</li>
</ul>
<!--chapter:end:mlr.Rmd-->
</div>
</div>
<div id="model-building" class="section level1 hasAnchor" number="10">
<h1 class="hasAnchor"><span class="header-section-number">10</span> Model Building<a href="#model-building" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Model building methods are used mainly in exploratory situations where many independent variables have been measured, but a final model explaining the dependent variable has not been reached. You want to build a model that contains enough covariates to explain the model well, but still be parsimonious such that the model is still interpretable.</p>
<p>This chapter introduces how to use and interpret different types of covariates, how to choose covariates, and then cover some methods to compare between competing models using measures of model fit.</p>

<div class="rmdnote">
This section uses functions from the <code>gtsummary</code>, <code>performance</code>, and <code>survey</code> packages to help tidy and visualize results from regression models.
</div>
<div id="interactions" class="section level2 hasAnchor" number="10.1">
<h2 class="hasAnchor"><span class="header-section-number">10.1</span> Interactions<a href="#interactions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this <em>main effects</em> model, Species only changes the intercept. The effect of species is not multiplied by Sepal length. Reviewing the scatterplot below, do you think this is a reasonable model to fit the observed relationship?</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="model_building_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>If we care about how species <em>changes</em> the relationship between petal and sepal length, we can fit a model with an <strong>interaction</strong> between sepal length (<span class="math inline">\(x_{1}\)</span>) and species. For this first example let <span class="math inline">\(x_{2}\)</span> be an indicator for when <code>species == setosa</code>. Note that both <em>main effects</em> of sepal length, and setosa species are also included in the model. Interactions are mathematically represented as a multiplication between the two variables that are interacting.</p>
<p><span class="math display">\[ Y_{i} \sim \beta_{0} + \beta_{1}x_{i} + \beta_{2}x_{2i} + \beta_{3}x_{1i}x_{2i}\]</span></p>
<p>If we evaluate this model for both levels of <span class="math inline">\(x_{2}\)</span>, the resulting models are the same as the stratified models.</p>
<p>When <span class="math inline">\(x_{2} = 0\)</span>, the record is on an iris not from the <em>setosa</em> species.</p>
<p><span class="math display">\[ Y_{i} \sim \beta_{0} + \beta_{1}x_{i} + \beta_{2}(0) + \beta_{3}x_{1i}(0)\]</span>
which simplifies to
<span class="math display">\[ Y_{i} \sim \beta_{0} + \beta_{1}x_{i}\]</span></p>
<p>When <span class="math inline">\(x_{2} = 1\)</span>, the record is on an iris of the <em>setosa</em> species.</p>
<p><span class="math display">\[ Y_{i} \sim \beta_{0} + \beta_{1}x_{i} + \beta_{2}(1) + \beta_{3}x_{1i}(1)\]</span>
which simplifies to
<span class="math display">\[ Y_{i} \sim (\beta_{0} + \beta_{2}) + (\beta_{1} + \beta_{3})x_{i}\]</span></p>
<p>Each subgroup model has a different intercept and slope, but we had to estimate 4 parameters in the interaction model, and 6 for the fully stratified model.</p>
<div id="fitting-interaction-models-interpreting-coefficients" class="section level3 hasAnchor" number="10.1.1">
<h3 class="hasAnchor"><span class="header-section-number">10.1.1</span> Fitting interaction models &amp; interpreting coefficients<a href="#fitting-interaction-models-interpreting-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Interactions are fit in <code>R</code> by simply multiplying <code>*</code> the two variables together in the model statement.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>setosa <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(iris<span class="sc">$</span>Species <span class="sc">==</span> <span class="st">&quot;setosa&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Petal.Length <span class="sc">~</span> Sepal.Length <span class="sc">+</span> setosa <span class="sc">+</span> Sepal.Length<span class="sc">*</span>setosa, <span class="at">data=</span>iris) <span class="sc">|&gt;</span> <span class="fu">tbl_regression</span>()</span></code></pre></div>
<div id="lsebiubemv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lsebiubemv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lsebiubemv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lsebiubemv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lsebiubemv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lsebiubemv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lsebiubemv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lsebiubemv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lsebiubemv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lsebiubemv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lsebiubemv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lsebiubemv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lsebiubemv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lsebiubemv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lsebiubemv .gt_from_md > :first-child {
  margin-top: 0;
}

#lsebiubemv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lsebiubemv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lsebiubemv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lsebiubemv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lsebiubemv .gt_row_group_first td {
  border-top-width: 2px;
}

#lsebiubemv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lsebiubemv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lsebiubemv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lsebiubemv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lsebiubemv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lsebiubemv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lsebiubemv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lsebiubemv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lsebiubemv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lsebiubemv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lsebiubemv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lsebiubemv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lsebiubemv .gt_left {
  text-align: left;
}

#lsebiubemv .gt_center {
  text-align: center;
}

#lsebiubemv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lsebiubemv .gt_font_normal {
  font-weight: normal;
}

#lsebiubemv .gt_font_bold {
  font-weight: bold;
}

#lsebiubemv .gt_font_italic {
  font-style: italic;
}

#lsebiubemv .gt_super {
  font-size: 65%;
}

#lsebiubemv .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#lsebiubemv .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#lsebiubemv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lsebiubemv .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#lsebiubemv .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#lsebiubemv .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Sepal.Length</td>
<td class="gt_row gt_center">1.0</td>
<td class="gt_row gt_center">0.91, 1.1</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">setosa</td>
<td class="gt_row gt_center">2.4</td>
<td class="gt_row gt_center">0.61, 4.1</td>
<td class="gt_row gt_center">0.008</td></tr>
    <tr><td class="gt_row gt_left">Sepal.Length * setosa</td>
<td class="gt_row gt_center">-0.90</td>
<td class="gt_row gt_center">-1.2, -0.56</td>
<td class="gt_row gt_center"><0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<p>The coefficient <span class="math inline">\(b_{3}\)</span> for the interaction term is significant, confirming that species changes the relationship between sepal length and petal length. Thus, species is a <strong>moderator</strong> (Chapter @ref(mod-strat)).</p>
<p><strong>Interpreting Coefficients</strong></p>
<ul>
<li>If <span class="math inline">\(x_{2}=0\)</span>, then the effect of <span class="math inline">\(x_{1}\)</span> on <span class="math inline">\(Y\)</span> simplifies to: <span class="math inline">\(\beta_{1}\)</span>
<ul>
<li><span class="math inline">\(b_{1}\)</span> The effect of sepal length on petal length <strong>for non-setosa species of iris</strong> (<code>setosa=0</code>)</li>
<li>For non-setosa species, the petal length increases 1.03cm for every additional cm of sepal length.</li>
</ul></li>
<li>If <span class="math inline">\(x_{2}=1\)</span>, then the effect of <span class="math inline">\(x_{1}\)</span> on <span class="math inline">\(Y\)</span> model simplifies to: <span class="math inline">\(\beta_{1} + \beta_{3}\)</span>
<ul>
<li>For setosa species, the petal length increases by <code>1.03-0.9=0.13</code> cm for every additional cm of sepal length.</li>
</ul></li>
</ul>

<div class="rmdcaution">
The main effects (<span class="math inline">\(b_{1}\)</span>, <span class="math inline">\(b_{2}\)</span>) cannot be interpreted by themselves when there is an interaction in the model.
</div>
</div>
<div id="interactions-catvars" class="section level3 hasAnchor" number="10.1.2">
<h3 class="hasAnchor"><span class="header-section-number">10.1.2</span> Categorical Interaction variables<a href="#interactions-catvars" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s up the game now and look at the full interaction model with a categorical version of species.
Recall <span class="math inline">\(x_{1}\)</span> is Sepal Length, <span class="math inline">\(x_{2}\)</span> is the indicator for <em>versicolor</em>, and <span class="math inline">\(x_{3}\)</span> the indicator for <em>virginica</em> . Refer to @ref(cat-predictors) for information on how to interpret categorical predictors as main effects.</p>
<p><span class="math display">\[ Y_{i} \sim \beta_{0} + \beta_{1}x_{i} + \beta_{2}x_{2i} + \beta_{3}x_{3i} + \beta_{4}x_{1i}x_{2i} + \beta_{5}x_{1i}x_{3i}+\epsilon_{i}\]</span></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(Petal.Length <span class="sc">~</span> Sepal.Length <span class="sc">+</span> Species <span class="sc">+</span> Sepal.Length<span class="sc">*</span>Species, <span class="at">data=</span>iris))</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = Petal.Length ~ Sepal.Length + Species + Sepal.Length * </span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     Species, data = iris)</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min       1Q   Median       3Q      Max </span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.68611 -0.13442 -0.00856  0.15966  0.79607 </span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                                Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)                      0.8031     0.5310   1.512    0.133    </span></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length                     0.1316     0.1058   1.244    0.216    </span></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Speciesversicolor               -0.6179     0.6837  -0.904    0.368    </span></span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Speciesvirginica                -0.1926     0.6578  -0.293    0.770    </span></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length:Speciesversicolor   0.5548     0.1281   4.330 2.78e-05 ***</span></span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length:Speciesvirginica    0.6184     0.1210   5.111 1.00e-06 ***</span></span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb190-20"><a href="#cb190-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb190-21"><a href="#cb190-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb190-22"><a href="#cb190-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 0.2611 on 144 degrees of freedom</span></span>
<span id="cb190-23"><a href="#cb190-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.9789, Adjusted R-squared:  0.9781 </span></span>
<span id="cb190-24"><a href="#cb190-24" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic:  1333 on 5 and 144 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>The slope of the relationship between sepal length and petal length is calculated as follows, for each species:</p>
<ul>
<li><em>setosa</em> <span class="math inline">\((x_{2}=0, x_{3}=0): b_{1}=0.13\)</span></li>
<li><em>versicolor</em> <span class="math inline">\((x_{2}=1, x_{3}=0): b_{1} + b_{2} + b_{4} = 0.13+0.55 = 0.68\)</span></li>
<li><em>virginica</em> <span class="math inline">\((x_{2}=0, x_{3}=1): b_{1} + b_{3} + b_{5} = 0.13+0.62 = 0.75\)</span></li>
</ul>
<p>Compare this to the estimates gained from the stratified model:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(iris, iris<span class="sc">$</span>Species, <span class="cf">function</span>(x){</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Petal.Length <span class="sc">~</span> Sepal.Length, <span class="at">data=</span>x) <span class="sc">%&gt;%</span> <span class="fu">coef</span>()</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: setosa</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  (Intercept) Sepal.Length </span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    0.8030518    0.1316317 </span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: versicolor</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  (Intercept) Sepal.Length </span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    0.1851155    0.6864698 </span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------ </span></span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a><span class="do">## iris$Species: virginica</span></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  (Intercept) Sepal.Length </span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a><span class="do">##    0.6104680    0.7500808</span></span></code></pre></div>
<p>They’re the same! Proof that an interaction is equivalent to stratification.</p>
</div>
<div id="example-2" class="section level3 hasAnchor" number="10.1.3">
<h3 class="hasAnchor"><span class="header-section-number">10.1.3</span> Example 2<a href="#example-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What if we now wanted to include other predictors in the model? How does sepal length relate to petal length after controlling for petal width? We add the variable for petal width into the model</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(Petal.Length <span class="sc">~</span> Sepal.Length <span class="sc">+</span> setosa <span class="sc">+</span> Sepal.Length<span class="sc">*</span>setosa <span class="sc">+</span> Petal.Width, <span class="at">data=</span>iris))</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = Petal.Length ~ Sepal.Length + setosa + Sepal.Length * </span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     setosa + Petal.Width, data = iris)</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min       1Q   Median       3Q      Max </span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.83519 -0.18278 -0.01812  0.17004  1.06968 </span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                     Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)         -0.86850    0.27028  -3.213  0.00162 ** </span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length         0.66181    0.05179  12.779  &lt; 2e-16 ***</span></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="do">## setosa               1.83713    0.62355   2.946  0.00375 ** </span></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Petal.Width          0.97269    0.07970  12.204  &lt; 2e-16 ***</span></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length:setosa -0.61106    0.12213  -5.003 1.61e-06 ***</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 0.2769 on 145 degrees of freedom</span></span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.9761, Adjusted R-squared:  0.9754 </span></span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic:  1478 on 4 and 145 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>So far, petal width, and the combination of species and sepal length are both significantly associated with petal length.</p>
<p><em>Note of caution: Stratification implies that the stratifying variable interacts with all other variables.</em>
So if we were to go back to the stratified model where we fit the model of petal length on sepal length AND petal width, stratified by species, we would be implying that species interacts with both sepal length and petal width.</p>
<p>E.g. the following stratified model</p>
<ul>
<li><span class="math inline">\(Y = A + B + C + D + C*D\)</span>, when D=1</li>
<li><span class="math inline">\(Y = A + B + C + D + C*D\)</span>, when D=0</li>
</ul>
<p>is the same as the following interaction model:</p>
<ul>
<li><span class="math inline">\(Y = A + B + C + D + A*D + B*D + C*D\)</span></li>
</ul>
</div>
<div id="example-3" class="section level3 hasAnchor" number="10.1.4">
<h3 class="hasAnchor"><span class="header-section-number">10.1.4</span> Example 3:<a href="#example-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s explore the relationship between income, employment status and depression.
This example follows a logistic regression example from section @ref(mlogreg).</p>
<p>Here I create the binary indicators of <code>lowincome</code> (annual income &lt;$10k/year) and underemployed (part time or unemployed).</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>lowincome <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(depress<span class="sc">$</span>income <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>lowincome, depress<span class="sc">$</span>income, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="do">##       </span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="do">##         2  4  5  6  7  8  9 11 12 13 15 16 18 19 20 23 24 25 26 27 28 31 32 35</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   0     0  0  0  0  0  0  0 17  2 18 24  1  1 25  3 25  2  1  1  1 19  1  1 24</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   1     7  8 10 12 18 14 22  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;NA&gt;  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="do">##       </span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="do">##        36 37 42 45 55 65 &lt;NA&gt;</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   0     1  1  1 15  9 10    0</span></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   1     0  0  0  0  0  0    0</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;NA&gt;  0  0  0  0  0  0    0</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>depress<span class="sc">$</span>underemployed <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(depress<span class="sc">$</span>employ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;PT&quot;</span>, <span class="st">&quot;Unemp&quot;</span>), <span class="dv">1</span>, <span class="dv">0</span> )</span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(depress<span class="sc">$</span>underemployed, depress<span class="sc">$</span>employ, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a><span class="do">##       </span></span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a><span class="do">##         FT Houseperson In School Other  PT Retired Unemp &lt;NA&gt;</span></span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   0    167          27         2     4   0      38     0    0</span></span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   1      0           0         0     0  42       0    14    0</span></span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;NA&gt;   0           0         0     0   0       0     0    0</span></span></code></pre></div>
<p>The <strong>Main Effects</strong> model assumes that the effect of income on depression is independent of employment status, and the effect of employment status on depression is independent of income.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>me_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(cases <span class="sc">~</span> lowincome <span class="sc">+</span> underemployed, <span class="at">data=</span>depress, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(me_model)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = cases ~ lowincome + underemployed, family = &quot;binomial&quot;, </span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     data = depress)</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals: </span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.9085  -0.5843  -0.5279  -0.5279   2.0197  </span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="do">##               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)    -1.9003     0.2221  -8.556  &lt; 2e-16 ***</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="do">## lowincome       0.2192     0.3353   0.654  0.51322    </span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="do">## underemployed   1.0094     0.3470   2.909  0.00363 ** </span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 268.12  on 293  degrees of freedom</span></span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 259.93  on 291  degrees of freedom</span></span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 265.93</span></span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>To formally test whether an interaction term is necessary, we add the interaction term into the model and assess whether the coefficient for the interaction term is significantly different from zero.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>me_intx_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(cases <span class="sc">~</span> lowincome <span class="sc">+</span> underemployed <span class="sc">+</span> lowincome<span class="sc">*</span>underemployed, <span class="at">data=</span>depress, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>) </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(me_intx_model)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = cases ~ lowincome + underemployed + lowincome * </span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     underemployed, family = &quot;binomial&quot;, data = depress)</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals: </span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a><span class="do">## -1.3537  -0.5790  -0.5790  -0.4717   2.1219  </span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                         Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)              -1.7011     0.2175  -7.822 5.21e-15 ***</span></span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a><span class="do">## lowincome                -0.4390     0.4324  -1.015  0.31005    </span></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a><span class="do">## underemployed             0.2840     0.4501   0.631  0.52802    </span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a><span class="do">## lowincome:underemployed   2.2615     0.7874   2.872  0.00408 ** </span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 268.12  on 293  degrees of freedom</span></span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 251.17  on 290  degrees of freedom</span></span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 259.17</span></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
</div>
</div>
<div id="wald-test" class="section level2 hasAnchor" number="10.2">
<h2 class="hasAnchor"><span class="header-section-number">10.2</span> Wald test<a href="#wald-test" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Wald test is used for simultaneous tests of <span class="math inline">\(Q\)</span> variables in a model. This is used primarily in two situations:</p>
<ol style="list-style-type: decimal">
<li>Testing if a categorical variable (with more than 2 levels) as a whole improves model fit.</li>
<li>Testing whether or not the regression model is helpful in predicting values of Y at all.</li>
</ol>
<p>Consider a model with <span class="math inline">\(P\)</span> variables and you want to test if <span class="math inline">\(Q\)</span> additional variables are useful.</p>
<ul>
<li><span class="math inline">\(H_{0}: Q\)</span> additional variables are useless, i.e., their <span class="math inline">\(\beta\)</span>’s all = 0<br />
</li>
<li><span class="math inline">\(H_{A}: Q\)</span> additional variables are useful to explain/predict <span class="math inline">\(Y\)</span></li>
</ul>
<p>The traditional test statistic that we’ve seen since Intro stats is
<span class="math inline">\(\frac{\hat{\theta}-\theta}{\sqrt{Var(\hat{\theta})}}\)</span>, and generally has a <span class="math inline">\(Z\)</span> or <span class="math inline">\(T\)</span> distribution.</p>
<p>The Wald test generalizes this test <em>any</em> linear combination of predictors.</p>
<p><span class="math display">\[
(R\hat{\theta}_{n}-r)^{&#39;}[R({\hat{V}}_{n}/n)R^{&#39;}]^{-1}
(R\hat{\theta}_{n}-r)
\quad \xrightarrow{\mathcal{D}}  \quad F(Q,n-P)
\]</span></p>
<p>Where <span class="math inline">\(\mathbf{R}\)</span> is the vector of coefficients for the <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\hat{V}_{n}\)</span> is a consistent estimator of the covariance matrix. Instead of a normal distribution, this test statistic has an <span class="math inline">\(F\)</span> distribution with <span class="math inline">\(Q\)</span> and <span class="math inline">\(n-P\)</span> degrees of freedom.</p>
<p><strong>Example</strong>
Consider the following model, where <span class="math inline">\(X_{1}\)</span> and <span class="math inline">\(X_{2}\)</span> are continuous predictors and <span class="math inline">\(X_{3}, X_{4}, X_{5}\)</span> are binary indicators from a 4 level categorical variable.</p>
<p><span class="math display">\[
Y = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}X_{3} + \beta_{4}x_{4} + \beta_{5}X_{5}+\epsilon_{i}
\]</span></p>
<p>If you wanted to test (1) whether or not the categorical variable as a whole improves model fit, then
<span class="math inline">\(\mathbf{R} = \begin{bmatrix} 0 , 0 ,1,1,1 \end{bmatrix}\)</span></p>
<p>If we want to test (2) that the regression plane is useful to predict <span class="math inline">\(Y\)</span>, then we are testing <span class="math inline">\(\beta_{1}=\beta_{2}=...\beta_{5}=0\)</span>, then
<span class="math inline">\(\mathbf{R} = \begin{bmatrix} 1 , 1 ,1,1,1 \end{bmatrix}\)</span>.</p>
<div id="example-modeling-depression-score" class="section level3 hasAnchor" number="10.2.1">
<h3 class="hasAnchor"><span class="header-section-number">10.2.1</span> Example: Modeling depression score<a href="#example-modeling-depression-score" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a model to predict depression using age, employment status and whether or not the person was chronically ill in the past year as covariates. This example uses the cleaned depression data set.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>employ.depression.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(cesd <span class="sc">~</span> age <span class="sc">+</span> chronill <span class="sc">+</span> employ, <span class="at">data=</span>depress)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(employ.depression.model)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = cesd ~ age + chronill + employ, data = depress)</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -16.665  -5.843  -1.705   3.155  33.576 </span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)       11.48255    1.50174   7.646 3.19e-13 ***</span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a><span class="do">## age               -0.13300    0.03514  -3.785 0.000187 ***</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="do">## chronill           2.68759    1.02368   2.625 0.009121 ** </span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a><span class="do">## employHouseperson  6.75036    1.79661   3.757 0.000208 ***</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a><span class="do">## employIn School    1.96663    5.99549   0.328 0.743138    </span></span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="do">## employOther        4.89731    4.27848   1.145 0.253320    </span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a><span class="do">## employPT           3.25937    1.47240   2.214 0.027645 *  </span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a><span class="do">## employRetired      3.23316    1.88602   1.714 0.087565 .  </span></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a><span class="do">## employUnemp        7.63163    2.33915   3.263 0.001238 ** </span></span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 8.385 on 285 degrees of freedom</span></span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.1217, Adjusted R-squared:  0.09704 </span></span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 4.936 on 8 and 285 DF,  p-value: 9.86e-06</span></span></code></pre></div>
<p>The results of this model show that age and chronic illness are statistically associated with CESD (each p&lt;.006). However employment status shows mixed results. Some employment statuses are significantly different from the reference group, some are not. So overall, is employment status associated with depression?</p>
<p><strong>(1) Testing if a categorical variable as a whole improves model fit</strong></p>
<p>Since employment is a categorical variable, all the coefficient estimates shown are the effect of being in that income category has on depression <em>compared to</em> being employed full time. For example, the coefficient for PT employment is greater than zero, so they have a higher CESD score compared to someone who is fully employed.</p>
<p>To test that employment status affects CESD we need to do a global test that all <span class="math inline">\(\beta\)</span>’s related to employment status are 0.</p>
<p><span class="math inline">\(H_{0}: \beta_{3} = \beta_{4} = \beta_{5} = \beta_{6} = \beta_{7} = \beta_{8} = 0\)</span><br />
<span class="math inline">\(H_{A}\)</span>: At least one <span class="math inline">\(\beta_{j}\)</span> is not 0.</p>
<p>ANOVA to the rescue! Since ANOVA partitions the variance in our outcome <span class="math inline">\(Y\)</span> into amounts due to each variable, we get an ANOVA table that has one row per term:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(employ.depression.model) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df Sum Sq Mean Sq F value   Pr(&gt;F)    </span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="do">## age           1    615   614.6   8.743 0.003368 ** </span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="do">## chronill      1    409   409.2   5.821 0.016469 *  </span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="do">## employ        6   1752   292.0   4.154 0.000509 ***</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals   285  20036    70.3                     </span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
<ul>
<li>The last row for <code>employ</code> is what we are interested in here.</li>
<li>First confirm that the degrees of freedom are correct. It should equal the # of categories in the variable you are testing, minus 1.
<ul>
<li>Employment has 7 levels, so <span class="math inline">\(df=6\)</span>.</li>
<li>Or equivalently, the degrees of freedom are the number of <span class="math inline">\(beta\)</span>’s you are testing to be 0.</li>
</ul></li>
</ul>
<p>The p-value of this Wald test is significant, thus not <span class="math inline">\(beta\)</span>’s are equal to zero, which implies employment status significantly predicts CESD score.</p>

<div class="rmdcaution">
Note the p-values for the individual coefficients <code>age</code> and <code>chronill</code> are not the same as in the regression model. ANOVA models are order dependent as they describe a “reduction” in variance in the outcome due to that variable. A deeper explanation of this is not included in these notes at this time.
</div>
<p><strong>(2) Testing that the regression plane is useful to predict <span class="math inline">\(Y\)</span></strong></p>
<p>This information is provided to us directly in the last line of the summary output from a linear model.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(employ.depression.model)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = cesd ~ age + chronill + employ, data = depress)</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="do">## -16.665  -5.843  -1.705   3.155  33.576 </span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="do">##                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)       11.48255    1.50174   7.646 3.19e-13 ***</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="do">## age               -0.13300    0.03514  -3.785 0.000187 ***</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a><span class="do">## chronill           2.68759    1.02368   2.625 0.009121 ** </span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="do">## employHouseperson  6.75036    1.79661   3.757 0.000208 ***</span></span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a><span class="do">## employIn School    1.96663    5.99549   0.328 0.743138    </span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a><span class="do">## employOther        4.89731    4.27848   1.145 0.253320    </span></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a><span class="do">## employPT           3.25937    1.47240   2.214 0.027645 *  </span></span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a><span class="do">## employRetired      3.23316    1.88602   1.714 0.087565 .  </span></span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a><span class="do">## employUnemp        7.63163    2.33915   3.263 0.001238 ** </span></span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 8.385 on 285 degrees of freedom</span></span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.1217, Adjusted R-squared:  0.09704 </span></span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 4.936 on 8 and 285 DF,  p-value: 9.86e-06</span></span></code></pre></div>
</div>
<div id="testing-for-a-moderation-effect-in-a-multiple-regression-model." class="section level3 hasAnchor" number="10.2.2">
<h3 class="hasAnchor"><span class="header-section-number">10.2.2</span> Testing for a moderation effect in a multiple regression model.<a href="#testing-for-a-moderation-effect-in-a-multiple-regression-model." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Moderation is introduced in Chapter @ref(mod-strat), and helps to set the motivation for stratified models. Later, in Chapter @ref(interactions-catvars), we show that an interaction term in a regression model is equivelant to stratification.</p>
<p>Well what if you have other predictors in the model, not just the ones that you have an interaction on? We can use the Wald test to assess if a measure is a significant moderator without stratifying.</p>
<p>Continuing with the depression example we saw that employment affects CESD depression score. What if we think that the effect (slope) of age on CESD may be different depending on their employment? That is, is the effect of age on depression different for those that are employed versus retired?</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>emp.dep.intx <span class="ot">&lt;-</span> <span class="fu">lm</span>(cesd <span class="sc">~</span> age <span class="sc">+</span> chronill <span class="sc">+</span> employ <span class="sc">+</span> age<span class="sc">*</span>employ, <span class="at">data=</span>depress)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(emp.dep.intx)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = cesd ~ age + chronill + employ + age * employ, data = depress)</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -18.728  -5.499  -1.900   3.251  33.973 </span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)            10.514408   2.027479   5.186 4.14e-07 ***</span></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a><span class="do">## age                    -0.108148   0.050325  -2.149  0.03250 *  </span></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a><span class="do">## chronill                2.716041   1.035393   2.623  0.00919 ** </span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a><span class="do">## employHouseperson      13.136141   5.279521   2.488  0.01343 *  </span></span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a><span class="do">## employIn School       -39.366285  42.218614  -0.932  0.35192    </span></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a><span class="do">## employOther             5.099073  18.815341   0.271  0.78659    </span></span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a><span class="do">## employPT                2.742451   3.850676   0.712  0.47694    </span></span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a><span class="do">## employRetired          -2.851372  12.739350  -0.224  0.82306    </span></span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a><span class="do">## employUnemp            13.820668   5.677595   2.434  0.01555 *  </span></span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employHouseperson  -0.130545   0.102421  -1.275  0.20351    </span></span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employIn School     1.988808   1.989220   1.000  0.31828    </span></span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employOther        -0.009316   0.386657  -0.024  0.98080    </span></span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employPT            0.008960   0.085254   0.105  0.91638    </span></span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employRetired       0.073942   0.182591   0.405  0.68582    </span></span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employUnemp        -0.174615   0.146179  -1.195  0.23328    </span></span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 8.408 on 279 degrees of freedom</span></span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.1354, Adjusted R-squared:  0.09201 </span></span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 3.121 on 14 and 279 DF,  p-value: 0.0001511</span></span></code></pre></div>
<p>Let’s revisit our list of beta coefficients:</p>
<ul>
<li><span class="math inline">\(\beta_{1}\)</span>: Age</li>
<li><span class="math inline">\(\beta_{2}\)</span>: Chronic illness</li>
<li><span class="math inline">\(\beta_{3} \ldots \beta_{7}\)</span>: Effects of different levels of employment (Houseperson to Unemployed)</li>
<li><span class="math inline">\(\beta_{8} \ldots \beta_{12}\)</span>: Multiplicative effect that levels of employment have on the slope of age.</li>
</ul>
<p>To see if the interaction term <code>age*employ</code> is significant, we run an F test via <code>aov()</code> and interpret the p-value for the interaction term <code>age:employ</code>. Here the pvalue is very large, so there is no reason to believe that employment moderates the relationship between age and CESD score. This is a two way relationship. There is also no reason to believe that age moderates the relationship between employment and CESD score.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(emp.dep.intx) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df Sum Sq Mean Sq F value   Pr(&gt;F)    </span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="do">## age           1    615   614.6   8.694 0.003462 ** </span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="do">## chronill      1    409   409.2   5.789 0.016781 *  </span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="do">## employ        6   1752   292.0   4.131 0.000541 ***</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="do">## age:employ    6    313    52.1   0.737 0.620089    </span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals   279  19723    70.7                     </span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
</div>
</div>
<div id="multicollinearity" class="section level2 hasAnchor" number="10.3">
<h2 class="hasAnchor"><span class="header-section-number">10.3</span> Multicollinearity<a href="#multicollinearity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Occurs when some of the X variables are highly intercorrelated.</li>
<li>Computed estimates of regression coefficients are unstable and have large standard errors.</li>
</ul>
<p>For example, the squared standard error of the <span class="math inline">\(i\)</span>th slope coefficient (<span class="math inline">\([SE(\beta_{i})]^2\)</span>) can be written as:</p>
<p><span class="math display">\[
[SE(\beta_{i})]^2 = \frac{S^{2}}{(N-1)(S_{i}^{2})}*\frac{1}{1 - (R_{i})^2}
\]</span></p>
<p>where <span class="math inline">\(S^{2}\)</span> is the residual mean square, <span class="math inline">\(S_{i}\)</span> the standard deviation of <span class="math inline">\(X_{i}\)</span>, and <span class="math inline">\(R_{i}\)</span> the multiple correlation between <span class="math inline">\(X_{i}\)</span> and all other <span class="math inline">\(X\)</span>’s.</p>
<p>When <span class="math inline">\(R_{i}\)</span> is close to 1 (very large), <span class="math inline">\(1 - (R_{i})^2\)</span> becomes close to 0, which makes <span class="math inline">\(\frac{1}{1 - (R_{i})^2}\)</span> very large.</p>
<p>This fraction is called the <strong>variance inflation factor</strong> and is available in most model diagnostics.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>big.pen.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm, <span class="at">data=</span>pen) </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_collinearity</span>(big.pen.model) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="model_building_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ul>
<li>Solution: use variable selection to delete some X variables.</li>
<li>Alternatively, use dimension reduction techniques such as Principal Components (Chapter @ref(pca)).</li>
</ul>
</div>
<div id="variable-selection-process" class="section level2 hasAnchor" number="10.4">
<h2 class="hasAnchor"><span class="header-section-number">10.4</span> Variable Selection Process<a href="#variable-selection-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Ref: PMA6 CH 9</p>
</blockquote>
<p>Variable selection methods such as the ones described in this section, are most often used when performing an <em>Exploratory</em> analysis, where many independent variables have been measured, but a final model to explain the variability of a dependent variable has not yet been determined.</p>
<p>When building a model, we want to choose a set of independent variables that both will yield a good prediction using as few variables as possible (<em>parsimony</em>). We also need to consider controlling for moderators and confounders. In many situations where regression is used, the investigator has strong justification for including certain variables in the model.</p>
<ul>
<li>previous studies</li>
<li>accepted theory</li>
</ul>
<p>The investigator may have prior justification for using certain variables but may be open to suggestions for the remaining variables.</p>
<p>The set of independent variables can be broken down into logical subsets</p>
<ol style="list-style-type: decimal">
<li><strong>Factors of primary interest</strong>. (such as an exposure or treatment)</li>
<li><strong>Potential confounders</strong>. These are measures that could be associated with both the response, and explanatory variables, and which could <em>explain</em> the relationship between the primary factor of interest and the outcome. These are typically a set of demographics such as age, gender, ethnicity, and tend to be factors found to be important in prior studies.</li>
<li><strong>Effect Modifiers (Moderators)</strong>. A set of variables that other studies have shown to change or affect the relationship between the explanatory and response variables.</li>
<li><strong>Precision variables (covariates)</strong>. Variables associated with the dependent variable, but not the primary factor of interest.</li>
</ol>
<p>How variables are chosen for inclusion into a model is heavily driven by the purpose of the model:</p>
<ul>
<li>descriptive</li>
<li>predictive</li>
</ul>
<div id="automated-selection-procedures" class="section level3 hasAnchor" number="10.4.1">
<h3 class="hasAnchor"><span class="header-section-number">10.4.1</span> Automated selection procedures<a href="#automated-selection-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Forward selection</em>: Variables are added one at a time until optimal model reached.</p>
<ol style="list-style-type: decimal">
<li>Choose the variable with the highest absolute correlation <span class="math inline">\(\mid r \mid\)</span> with the outcome.</li>
<li>Choose the next variable that maximizes the model adjusted <span class="math inline">\(R^{2}\)</span>.</li>
<li>Repeat until adding additional variables does not improve the model fit significantly.</li>
</ol>
<p><em>Backward elimination</em>: Variables are removed one at a time until optimal model reached</p>
<ol style="list-style-type: decimal">
<li>Put all variables into the model.</li>
<li>Remove the least useful variable in the model. This can be done by choosing the variable with the largest <span class="math inline">\(p\)</span>-value.</li>
<li>Repeat until removing additional variables reduces the model fit significantly.</li>
</ol>
<p><em>Stepwise selection</em>: Combination of forward and backward.</p>
<ol start="0" style="list-style-type: decimal">
<li>Start with no variables (just <span class="math inline">\(\bar{Y}\)</span>)</li>
<li>Add the variable that results in the greatest improvement in model fit.</li>
<li>Add another variable that results in the greatest improvement in model fit after controlling for the first.</li>
<li>Check to see if removing any variable currently in the model improves the fit.</li>
<li>Add another variable…</li>
<li>Check to remove variables…</li>
<li>Repeat until no variables can be added or removed.</li>
</ol>
<p>Most programs have the option to <strong>force</strong> variables to be included in the model. This is important in cases where there is a primary factor of interest such as a treatment effect.</p>

<div class="rmdcaution">
Automated versions of variable selection processes should not be used blindly.
</div>
<blockquote>
<p>“… perhaps the most serious source of error lies in letting statistical procedures make decisions for you.”
“Don’t be too quick to turn on the computer. Bypassing the brain to compute by reflex is a sure recipe for disaster.”
<em>Good and Hardin, Common Errors in Statistics (and How to Avoid Them), p. 3, p. 152</em></p>
</blockquote>
<p>Warnings:</p>
<ul>
<li>Stopping criteria and algorithm can be different for different software programs.</li>
<li>Can reject perfectly plausible models from later consideration</li>
<li>Hides relationships between variables (X3 is added and now X1 is no longer significant. X1 vs X3 should be looked at)</li>
</ul>
<p><em>Best Subsets</em></p>
<ul>
<li>Select one X with highest simple <span class="math inline">\(r\)</span> with Y</li>
<li>Select two X’s with highest multiple <span class="math inline">\(r\)</span> with Y</li>
<li>Select three X’s with highest multiple <span class="math inline">\(r\)</span> with Y
etc.</li>
<li>Compute adjusted R2, AIC or BIC each time.</li>
<li>Compare and choose among the “best subsets” of various sizes.</li>
</ul>
</div>
<div id="implementation-in-r" class="section level3 hasAnchor" number="10.4.2">
<h3 class="hasAnchor"><span class="header-section-number">10.4.2</span> Implementation in R<a href="#implementation-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Refer to the following refereces</p>
<ul>
<li>Notes maintained by <a href="https://xiaoruizhu.github.io/">Xiaorhui Zhu</a> for a data mining class at Linder College of Business: <a href="https://xiaoruizhu.github.io/Data-Mining-R/lecture/3_LinearReg.html" class="uri">https://xiaoruizhu.github.io/Data-Mining-R/lecture/3_LinearReg.html</a></li>
<li>Jupyter notebook (R kernel) Stats 191 at Stanford. This one uses cross-validation on the stepwise procedures, and demonstrates the dangers of trusting models that come out of blind use of variable selection methods. <a href="https://web.stanford.edu/class/stats191/notebooks/Selection.html" class="uri">https://web.stanford.edu/class/stats191/notebooks/Selection.html</a></li>
<li>Author and year unknown, but shows best subsets. At least 2 years old, content has not been tested recently. <a href="https://rstudio-pubs-static.s3.amazonaws.com/2897_9220b21cfc0c43a396ff9abf122bb351.html" class="uri">https://rstudio-pubs-static.s3.amazonaws.com/2897_9220b21cfc0c43a396ff9abf122bb351.html</a></li>
</ul>
</div>
<div id="lasso" class="section level3 hasAnchor" number="10.4.3">
<h3 class="hasAnchor"><span class="header-section-number">10.4.3</span> Lasso<a href="#lasso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>L</strong>east <strong>A</strong>bsolute <strong>S</strong>hrinkage and <strong>S</strong>election <strong>O</strong>perator.</p>
<p>Goal is to minimize</p>
<p><span class="math display">\[
RSS + \lambda \sum_{j}\mid \beta_{j} \ \mid
\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is a model complexity penalty parameter.</p>
<ul>
<li>Used during cross-validation and AIC/BIC</li>
<li>“Shrinks” the coefficients, setting some to exactly 0.</li>
</ul>

<div class="rmdnote">
Appropriate inference after model selection is currently under research. No unifying theory exists yet.
</div>
<ul>
<li>For now, use lasso to choose variables, then fit a model with only those selected variables in the final model.</li>
<li>Variables chosen in this manner are important, yet biased estimates.</li>
</ul>
</div>
</div>
<div id="model-fit-criteria" class="section level2 hasAnchor" number="10.5">
<h2 class="hasAnchor"><span class="header-section-number">10.5</span> Comparing between models<a href="#model-fit-criteria" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The goal: Find the subset of independent variables that optimizes (either minimize or maximize) a certain criteria. In other words, the goal is to find the optimal model.</p>
<p><img src="images/q.png" alt="q" /> How do we measure “optimal”?</p>
<p>First we need to look at two quantities:</p>
<div id="rss-residual-sum-of-squares" class="section level3 hasAnchor" number="10.5.1">
<h3 class="hasAnchor"><span class="header-section-number">10.5.1</span> RSS: Residual Sum of Squares<a href="#rss-residual-sum-of-squares" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall the method of least squares introduced in section @ref(mlr) minimizes the residual sum of squares around the regression plane. This value is central to all following model comparison. How “far away” are the model estimates from the observed?</p>
<p><span class="math display">\[
\sum(Y - \bar{Y})^{2}(1-R^{2})  
\]</span></p>
</div>
<div id="likelihood-function" class="section level3 hasAnchor" number="10.5.2">
<h3 class="hasAnchor"><span class="header-section-number">10.5.2</span> Likelihood function<a href="#likelihood-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What is the likelihood that we observed the data <span class="math inline">\(x\)</span>, given parameter values <span class="math inline">\(\theta\)</span>.
<span class="math display">\[
\mathcal{L}(\theta \mid x)=p_{\theta }(x)=P_{\theta }(X=x)
\]</span></p>
<ul>
<li>For strictly convenient mathematical matters, we tend to work with the <strong>log-likelihood</strong> (LL).<br />
</li>
<li>Great because <span class="math inline">\(log\)</span> is a monotonic increasing function, maximizing the LL = maximizing the likelihood function.<br />
</li>
<li>We can compare between models using functions based off the LL.</li>
</ul>
<p>There are several measures we can use to compare between competing models.</p>
</div>
<div id="general-F" class="section level3 hasAnchor" number="10.5.3">
<h3 class="hasAnchor"><span class="header-section-number">10.5.3</span> General F Test<a href="#general-F" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Two nested models are similar if the p-value for the General F-test is non-significant at a .15 level. <em>Nested</em>: The list of variables in one model is a subset of the list of variables from a bigger model.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full model</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>full.employ.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(cesd <span class="sc">~</span> age <span class="sc">+</span> chronill <span class="sc">+</span> employ, <span class="at">data=</span>depress)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduced model</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>reduced.employ.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(cesd <span class="sc">~</span> age, <span class="at">data=</span>depress)</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced.employ.model, full.employ.model)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Analysis of Variance Table</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Model 1: cesd ~ age</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Model 2: cesd ~ age + chronill + employ</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    </span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    292 22197                                  </span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2    285 20036  7    2161.4 4.3921 0.0001197 ***</span></span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>

<div class="rmdcaution">
Caution: this uses <code>anova()</code> not <code>aov()</code>.
</div>
<p>Other references: <a href="https://online.stat.psu.edu/stat501/lesson/6/6.2" class="uri">https://online.stat.psu.edu/stat501/lesson/6/6.2</a></p>
</div>
<div id="multiple-r2" class="section level3 hasAnchor" number="10.5.4">
<h3 class="hasAnchor"><span class="header-section-number">10.5.4</span> Multiple <span class="math inline">\(R^{2}\)</span><a href="#multiple-r2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If the model explains a large amount of variation in the outcome that’s good right? So we could consider using <span class="math inline">\(R^{2}\)</span> as a selection criteria and trying to find the model that maximizes this value.</p>
<ul>
<li>Problem: The multiple <span class="math inline">\(R^{2}\)</span> <em>always</em> increases as predictors are added to the model.
<ul>
<li>Ex. 1: N = 100, P = 1, E(<span class="math inline">\(R^{2}\)</span>) = 0.01</li>
<li>Ex. 2: N = 21, P = 10, E(<span class="math inline">\(R^{2}\)</span>) = 0.5</li>
</ul></li>
<li>Problem: <span class="math inline">\(R^{2} = 1-\frac{Model SS}{Total SS}\)</span> is biased: If population <span class="math inline">\(R^{2}\)</span> is really zero, then E(<span class="math inline">\(R^{2}\)</span>) = P/(N-1).</li>
</ul>
</div>
<div id="adjusted-r2" class="section level3 hasAnchor" number="10.5.5">
<h3 class="hasAnchor"><span class="header-section-number">10.5.5</span> Adjusted <span class="math inline">\(R^{2}\)</span><a href="#adjusted-r2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To alleviate bias use Mean squares instead of SS.</p>
<p><span class="math inline">\(R^{2} = 1-\frac{Model MS}{Total MS}\)</span></p>
<p>equivalently,</p>
<p><span class="math inline">\(R^{2}_{adj} = R^{2} - \frac{p(1-R^{2})}{n-p-1}\)</span></p>
<p>Now Adjusted <span class="math inline">\(R^{2}\)</span> is approximately unbiased and won’t inflate as <span class="math inline">\(p\)</span> increases.</p>
</div>
<div id="mallows-c_p" class="section level3 hasAnchor" number="10.5.6">
<h3 class="hasAnchor"><span class="header-section-number">10.5.6</span> Mallows <span class="math inline">\(C_{p}\)</span><a href="#mallows-c_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
    C_{p} = (N-P-1)\left(\frac{RMSE}{\hat{\sigma}^{2}} -1 \right) + (P+1)
\]</span></p>
<p>where <span class="math inline">\(RMSE = \frac{RSS}{N-P-1}\)</span>.</p>
<ul>
<li>Smaller is better</li>
<li>When all variables are chosen, <span class="math inline">\(P+1\)</span> is at it’s maximum but the other part of <span class="math inline">\(C_{p}\)</span> is zero since <span class="math inline">\(RMSE\)</span>==<span class="math inline">\(\hat{\sigma}^{2}\)</span></li>
</ul>
</div>
<div id="akaike-information-criterion-aic" class="section level3 hasAnchor" number="10.5.7">
<h3 class="hasAnchor"><span class="header-section-number">10.5.7</span> Akaike Information Criterion (AIC)<a href="#akaike-information-criterion-aic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>A penalty is applied to the deviance that increases as the number of parameters <span class="math inline">\(p\)</span> increase.</li>
<li>Tries to find a parsimonious model that is closer to the “truth”.<br />
</li>
<li>Uses an information function, e.g., the likelihood function <span class="math inline">\((LL)\)</span>.</li>
</ul>
<p><span class="math display">\[ AIC = -2LL + 2p\]</span></p>
<ul>
<li>Smaller is better</li>
<li>Can also be written as a function of the residual sum of squares (RSS) (in book)</li>
<li>Estimates the information in one model <em>relative to other models</em>
<ul>
<li>So if all models suck, your AIC will just tell you which one sucks less.</li>
</ul></li>
<li>Built in <code>AIC()</code> function in R</li>
<li>Rule of thumb: Model 1 and Model 2 are considered to have significantly different fit if the difference in AIC values is greater than 2.</li>
</ul>
<p><span class="math display">\[\mid AIC_{1} - AIC_{2}\mid &gt; 2\]</span></p>
</div>
<div id="bayesian-information-criterion-bic" class="section level3 hasAnchor" number="10.5.8">
<h3 class="hasAnchor"><span class="header-section-number">10.5.8</span> Bayesian Information Criterion (BIC)<a href="#bayesian-information-criterion-bic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Similar to AIC.</li>
<li>Built in <code>BIC()</code> function in R</li>
<li>Tries to find a parsimonious model that is more likely to be the “truth”. The smaller BIC, the better.</li>
</ul>
<p><span class="math display">\[ BIC = -2LL + ln(N)*(P+1)\]</span></p>
</div>
<div id="aic-vs-bic" class="section level3 hasAnchor" number="10.5.9">
<h3 class="hasAnchor"><span class="header-section-number">10.5.9</span> AIC vs BIC<a href="#aic-vs-bic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Both are “penalized likelihood” functions</li>
<li>Each = -2log likelihood + penalty</li>
<li>AIC: penalty = 2, BIC: penalty = ln(N)</li>
<li>For any N &gt; 7, ln(N) &gt; 2</li>
<li>Thus, BIC penalizes larger models more heavily.</li>
<li>They often agree.
<ul>
<li>When they disagree, AIC chooses a larger model than BIC.</li>
</ul></li>
</ul>
</div>
</div>
<div id="model-diagnostics" class="section level2 hasAnchor" number="10.6">
<h2 class="hasAnchor"><span class="header-section-number">10.6</span> Model Diagnostics<a href="#model-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Recall from Section (<span class="citation">(<a href="#ref-mlr-math-model" role="doc-biblioref"><strong>mlr-math-model?</strong></a>)</span>) the assumptions for linear regression model are;</p>
<ul>
<li><strong>Linearity</strong> The relationship between <span class="math inline">\(x_j\)</span> and <span class="math inline">\(y\)</span> is linear, for all <span class="math inline">\(j\)</span>.</li>
<li><strong>Normality, Homogeneity of variance</strong> The residuals are identically distributed <span class="math inline">\(\epsilon_{i} \sim N(0, \sigma^{2})\)</span></li>
<li><strong>Uncorrelated/Independent</strong> Distinct error terms are uncorrelated: <span class="math inline">\(\text{Cov}(\epsilon_{i},\epsilon_{j})=0,\forall i\neq j.\)</span></li>
</ul>
<p>There are a few ways to visually assess these assumptions. We’ll look at this using a penguin model of body mass as an example.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>pen.bmg.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> flipper_length_mm, <span class="at">data=</span>pen)</span></code></pre></div>
<div id="linearity" class="section level3 hasAnchor" number="10.6.1">
<h3 class="hasAnchor"><span class="header-section-number">10.6.1</span> Linearity<a href="#linearity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create a scatterplot with lowess AND linear regression line. See how close the lowess trend line is to the best fit line. Do this for all variables.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>bill.plot  <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pen, <span class="fu">aes</span>(<span class="at">y=</span>body_mass_g, <span class="at">x=</span>bill_length_mm)) <span class="sc">+</span> </span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>   <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span> , <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>flipper.plot  <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pen, <span class="fu">aes</span>(<span class="at">y=</span>body_mass_g, <span class="at">x=</span>flipper_length_mm)) <span class="sc">+</span> </span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>   <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span> , <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(bill.plot, flipper.plot, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="model_building_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Both variables appear to have a mostly linear relationship with body mass. For penguins with bill length over 50mm the slope may decrease, but the data is sparse in the tails.</p>
</div>
<div id="normality-of-residuals." class="section level3 hasAnchor" number="10.6.2">
<h3 class="hasAnchor"><span class="header-section-number">10.6.2</span> Normality of residuals.<a href="#normality-of-residuals." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are two common ways to assess normality.</p>
<ol style="list-style-type: decimal">
<li>A histogram or density plot with a normal distribution curve overlaid.</li>
<li>A qqplot. This is also known as a ‘normal probability plot’. It is used to compare the theoretical quantiles of the data <em>if it were to come from a normal distribution</em> to the observed quantiles. PMA6 Figure 5.4 has more examples and an explanation.</li>
</ol>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">check_normality</span>(pen.bmg.model)), </span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">check_normality</span>(pen.bmg.model), <span class="at">type =</span> <span class="st">&quot;qq&quot;</span>),</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol=</span><span class="dv">2</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="model_building_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>In both cases you want to assess how close the dots/distribution is to the reference curve/line.</p>
</div>
<div id="homogeneity-of-variance" class="section level3 hasAnchor" number="10.6.3">
<h3 class="hasAnchor"><span class="header-section-number">10.6.3</span> Homogeneity of variance<a href="#homogeneity-of-variance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The variability of the residuals should be constant, and independent of the value of the fitted value <span class="math inline">\(\hat{y}\)</span>.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_heteroskedasticity</span>(pen.bmg.model))</span></code></pre></div>
<p><img src="model_building_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>This assumption is often the hardest to be fully upheld. Here we see a slightly downward trend. However, this is not a massive violation of assumptions.</p>
</div>
<div id="posterior-predictions" class="section level3 hasAnchor" number="10.6.4">
<h3 class="hasAnchor"><span class="header-section-number">10.6.4</span> Posterior Predictions<a href="#posterior-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Not really an assumption, but we can also assess the fit of a model by how well it does to predict the outcome. Using a Bayesian sampling method, the distribution of the predictions from the model should resemble the observed distribution.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_posterior_predictions</span>(pen.bmg.model))</span></code></pre></div>
<p><img src="model_building_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>This looks like a good fit.</p>
</div>
</div>
<div id="general-advice" class="section level2 hasAnchor" number="10.7">
<h2 class="hasAnchor"><span class="header-section-number">10.7</span> General Advice<a href="#general-advice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Model selection is not a hard science.</li>
<li>Some criteria have “rules of thumb” that can guide your exploration (such as difference in AIC &lt; 2)</li>
<li><em><strong>Use common sense</strong></em>: A sub-optimal subset may make more sense than optimal one</li>
<li>p-values: When you compare two criteria, often the difference has a known distribution.
<ul>
<li>Wald F Test, the difference in RSS between the two models has a F distribution.</li>
</ul></li>
<li>All criterion should be used as guides.</li>
<li>Perform multiple methods of variable selection, find the commonalities.</li>
<li>Let science and the purpose of your model be your ultimate guide
<ul>
<li>If the purpose of the model is for explanation/interpretation, error on the side of parsimony (smaller model) than being overly complex.</li>
<li>If the purpose is prediction, then as long as you’re not overfitting the model (as checked using cross-validation techniques), use as much information as possible.</li>
</ul></li>
</ul>
</div>
<div id="what-to-watch-out-for-1" class="section level2 hasAnchor" number="10.8">
<h2 class="hasAnchor"><span class="header-section-number">10.8</span> What to watch out for<a href="#what-to-watch-out-for-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Multicollinearity</li>
<li>Missing Data</li>
<li>Use previous research as a guide</li>
<li>Variables not included can bias the results</li>
<li>Significance levels are only a guide</li>
<li>Perform model diagnostics after selection to check model fit.</li>
</ul>
<!--chapter:end:model_building.Rmd-->
</div>
</div>
<div id="glm" class="section level1 hasAnchor" number="11">
<h1 class="hasAnchor"><span class="header-section-number">11</span> Generalized Linear Models<a href="#glm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>One of the primary assumptions with linear regression, is that the error terms have a specific distribution. Namely:</p>
<p><span class="math display">\[ \epsilon_{i} \sim \mathcal{N}(0, \sigma^{2}) \qquad i=1, \ldots, n, \quad \mbox{and } \epsilon_{i} \perp \epsilon_{j}, i \neq j \]</span></p>
<p>When your outcome variable <span class="math inline">\(y\)</span> is non-continuous/non-normal, the above assumption fails dramatically.</p>
<p>Generalized Linear Models (GLM) allows for different data type outcomes by allowing the linear portion of the model (<span class="math inline">\(\mathbf{X}\beta\)</span>) to be related to the outcome variable <span class="math inline">\(y\)</span> using a <em>link</em> function, that allows the magnitude of the variance of the errors (<span class="math inline">\(\sigma\)</span>) to be related to the predicted values themselves.</p>
<p>There are a few overarching types of non-continuous outcomes that can be modeled with GLM’s.</p>
<ul>
<li>Binary data: Logistic or Probit regression (@ref(logreg))</li>
<li>Log-linear models (@ref(log-linear))</li>
<li>Multinomial/categorical data: Multinomial or Ordinal Logistic regression. (@ref(multinomial-reg))</li>
<li>Count data: Poisson regression (@ref(poisson-reg))</li>
</ul>

<div class="rmdnote">
This section uses functions from the following additional packages: <code>gtsummary</code>,<code>MKmisc</code>, <code>survey</code>.
</div>
<div id="fitting-glms" class="section level2 hasAnchor" number="11.1">
<h2 class="hasAnchor"><span class="header-section-number">11.1</span> Fitting GLMs<a href="#fitting-glms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All regression models aim to model the expected value of the response variable <span class="math inline">\(Y\)</span> given the observed data <span class="math inline">\(X\)</span>, through some link function <span class="math inline">\(C\)</span></p>
<p><span class="math display">\[E(Y|X) = C(X)\]</span></p>
<p>Depending on the data type of <span class="math inline">\(Y\)</span>, this link function takes different forms. Examples include:</p>
<ul>
<li>Linear regression: C = Identity function (no change)</li>
<li>Logistic regression: C = logit function</li>
<li>Poisson regression: C = log function</li>
</ul>
<div id="r" class="section level3 hasAnchor" number="11.1.1">
<h3 class="hasAnchor"><span class="header-section-number">11.1.1</span> R<a href="#r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The general syntax is similar to <code>lm()</code>, with the additional required <code>family=</code> argument. See <code>?family</code> for a list of options. Example for Logistic regression would be:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data=</span>DATA, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>) </span></code></pre></div>
</div>
<div id="spss" class="section level3 hasAnchor" number="11.1.2">
<h3 class="hasAnchor"><span class="header-section-number">11.1.2</span> SPSS<a href="#spss" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>File menu: <code>Regression</code> –&gt; Binary Logistic.</p>
<p>Syntax:</p>
<pre><code>logistic regression Y with x1 x2 x3
   /categorical = x2</code></pre>
<p><a href="https://www.ibm.com/support/knowledgecenter/en/SSLVMB_26.0.0/statistics_reference_project_ddita/spss/regression/syn_logistic_regression_overview.html" class="uri">https://www.ibm.com/support/knowledgecenter/en/SSLVMB_26.0.0/statistics_reference_project_ddita/spss/regression/syn_logistic_regression_overview.html</a></p>
</div>
<div id="stata" class="section level3 hasAnchor" number="11.1.3">
<h3 class="hasAnchor"><span class="header-section-number">11.1.3</span> Stata<a href="#stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>logistic Y x1 x2</code></p>
<p><a href="https://www.stata.com/features/overview/logistic-regression/" class="uri">https://www.stata.com/features/overview/logistic-regression/</a></p>
</div>
</div>
<div id="binary-outcome-data" class="section level2 hasAnchor" number="11.2">
<h2 class="hasAnchor"><span class="header-section-number">11.2</span> Binary outcome data<a href="#binary-outcome-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider an outcome variable <span class="math inline">\(Y\)</span> with two levels: Y = 1 if event, = 0 if no event.</p>
<p>Let <span class="math inline">\(p_{i} = P(y_{i}=1)\)</span>.</p>
<p>Two goals:</p>
<ul>
<li>Assess the impact selected covariates have on the probability of an outcome occurring.</li>
<li>Predict the probability of an event occurring given a certain covariate pattern. This is covered in section @ref(binary-classification)</li>
</ul>
<p>Binary data can be modeled using a <em>Logistic Model</em> or a <em>Probit Model</em>.</p>
<p>The logistic model relates the probability of an event based on a linear combination of X’s.</p>
<p><span class="math display">\[
log\left(
\frac{p_{i}}{1-p_{i}}
\right) = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} + \ldots + \beta_{p}x_{pi}
\]</span></p>
<p>Since the <em>odds</em> are defined as the probability an event occurs divided by the probability it does not occur: <span class="math inline">\((p/(1-p))\)</span>, the function <span class="math inline">\(log\left(\frac{p_{i}}{1-p_{i}}\right)\)</span> is also known as the <em>log odds</em>, or more commonly called the <strong><em>logit</em></strong>. This is the <em>link</em> function for the logistic regression model.</p>
<p>This in essence takes a binary outcome 0/1 variable, turns it into a continuous probability (which only has a range from 0 to 1) Then the logit(p) has a continuous distribution ranging from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>, which is the same form as a Multiple Linear Regression (continuous outcome modeled on a set of covariates)</p>
<p>The probit function uses the inverse CDF for the normal distribution as the link function. The effect of the transformation is very similar. For social science interpretation of the coefficients, we tend to choose the <em>logit</em> transformation and conduct a Logistic Regression. For classification purposes, often researchers will test out both transformations to see which one gives the best predictions.</p>
<p><img src="GLM_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="logreg" class="section level2 hasAnchor" number="11.3">
<h2 class="hasAnchor"><span class="header-section-number">11.3</span> Logistic Regression<a href="#logreg" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Since the link between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is no longer linear, a one unit increase in <span class="math inline">\(X_{p}\)</span> is no longer associated with a <span class="math inline">\(b_{p}\)</span> increase in <span class="math inline">\(Y\)</span>. The regression coefficients <span class="math inline">\(b_{p}\)</span> from a logistic regression must be <em>exponentiated</em> before interpretation.</p>
<p><span class="math display">\[OR = e^{b}\]</span></p>
<p>The Odds Ratio (OR) provides a directly understandable statistic for the relationship between <span class="math inline">\(y\)</span> and a specific <span class="math inline">\(x\)</span> given all other <span class="math inline">\(x\)</span>’s in the model are fixed. A later example in @ref(mlogreg) provides a numeric example of how Odds Ratios are calculated.</p>
<p>In testing for a relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, our hypothesis is that <span class="math inline">\(\beta_{p}=0\)</span>. Since <span class="math inline">\(e^{0}=1\)</span>, the reference value for the Odds Ratio that signifies no relationship, is 1, not 0.</p>
<div id="interpreting-odds-ratios" class="section level3 hasAnchor" number="11.3.1">
<h3 class="hasAnchor"><span class="header-section-number">11.3.1</span> Interpreting Odds Ratios<a href="#interpreting-odds-ratios" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a binary outcome with values YES, coded as 1, and NO, coded as 0.</p>
<ul>
<li><strong>OR = 1</strong> = equal chance of response variable being YES given any explanatory variable value. You are not able to predict participants’ responses by knowing their explanatory variable value. This would be a non significant model when looking at the p-value for the explanatory variable in the parameter estimate table.</li>
<li><strong>OR &gt; 1</strong> = as the explanatory variable value increases, the presence of a YES response is more likely. We can say that when a participant’s response to the explanatory variable is YES (1), they are more likely to have a response that is a YES (1).</li>
<li><strong>OR &lt;1</strong> = as the explanatory variable value increases, the presence of a YES response is less likely. We can say that when a participant’s response to the explanatory variable is YES (1) they are less likely to have a response that is a YES (1).</li>
</ul>
<p>For a continuous variable X with slope coefficient <span class="math inline">\(\beta\)</span>, the quantity <span class="math inline">\(e^{b}\)</span> is interpreted as the ratio of the odds for a person with value (X+1) relative to the odds for a person with value X.</p>
</div>
<div id="or-ci" class="section level3 hasAnchor" number="11.3.2">
<h3 class="hasAnchor"><span class="header-section-number">11.3.2</span> Confidence Intervals<a href="#or-ci" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Confidence intervals are a range for the population’s predicted odds ratio based on the sample data. We are 95% confident that any given population’s odds ratio would range between those two values.</p>
<p>The OR is <strong>not</strong> a linear function of the <span class="math inline">\(x&#39;s\)</span>, but <span class="math inline">\(\beta\)</span> is. This means that a CI for the OR is created by calculating a CI for <span class="math inline">\(\beta\)</span>, and then exponentiating the endpoints. A 95% CI for the OR is calculated as:</p>
<p><span class="math display">\[e^{\hat{\beta} \pm 1.96 SE_{\beta}} \]</span></p>
<p>This math holds for any <span class="math inline">\(k\)</span> unit change in x. The linearity of the confidence interval only applies at the untransformed level of the <span class="math inline">\(\beta\)</span>’s. NOT the odds ratio.</p>
</div>
<div id="logreg-dep-ex" class="section level3 hasAnchor" number="11.3.3">
<h3 class="hasAnchor"><span class="header-section-number">11.3.3</span> Example: The effect of gender on Depression<a href="#logreg-dep-ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This uses a cleaned version of the depression data set from PMAS6.</p>
<ul>
<li>Binary outcome variable: Symptoms of Depression (<code>cases</code>)</li>
<li>Binary predictor variable: Gender (<code>sex</code>) as an indicator of being female</li>
</ul>
<p>The outcome <span class="math inline">\(y\)</span> is a 0/1 Bernoulli random variable. The sum of a vector of Bernoulli’s (<span class="math inline">\(\sum_{i=1}^{n}y_{i}\)</span>) has a Binomial distribution. When we specify that <code>family = "binomial"</code> the <code>glm()</code> function auto-assigns “logit” link function.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>dep_sex_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(cases <span class="sc">~</span> sex, <span class="at">data=</span>depress, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dep_sex_model)</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = cases ~ sex, family = &quot;binomial&quot;, data = depress)</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals: </span></span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.7023  -0.7023  -0.4345  -0.4345   2.1941  </span></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  -2.3125     0.3315  -6.976 3.04e-12 ***</span></span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a><span class="do">## sex           1.0386     0.3767   2.757  0.00583 ** </span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 268.12  on 293  degrees of freedom</span></span>
<span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 259.40  on 292  degrees of freedom</span></span>
<span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 263.4</span></span>
<span id="cb210-23"><a href="#cb210-23" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb210-24"><a href="#cb210-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 5</span></span></code></pre></div>
<p>We exponentiate the coefficients to back transform the <span class="math inline">\(\beta\)</span> estimates into Odds Ratios</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(dep_sex_model))</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)         sex </span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   0.0990099   2.8251748</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(dep_sex_model))</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                  2.5 %    97.5 %</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) 0.04843014 0.1801265</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="do">## sex         1.39911056 6.2142384</span></span></code></pre></div>
<p>Females have 2.8 (1.4, 6.2) times the odds of showing signs of depression compared to males.</p>
</div>
<div id="mlogreg" class="section level3 hasAnchor" number="11.3.4">
<h3 class="hasAnchor"><span class="header-section-number">11.3.4</span> Multiple Logistic Regression<a href="#mlogreg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s continue with the depression model, but now also include age and income as potential predictors of symptoms of depression.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>mvmodel <span class="ot">&lt;-</span> <span class="fu">glm</span>(cases <span class="sc">~</span> age <span class="sc">+</span> income <span class="sc">+</span> sex, <span class="at">data=</span>depress, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mvmodel)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = cases ~ age + income + sex, family = &quot;binomial&quot;, </span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     data = depress)</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals: </span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a><span class="do">## -1.0249  -0.6524  -0.5050  -0.3179   2.5305  </span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error z value Pr(&gt;|z|)   </span></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) -0.67646    0.57881  -1.169  0.24253   </span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a><span class="do">## age         -0.02096    0.00904  -2.318  0.02043 * </span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a><span class="do">## income      -0.03656    0.01409  -2.595  0.00946 **</span></span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a><span class="do">## sex          0.92945    0.38582   2.409  0.01600 * </span></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 268.12  on 293  degrees of freedom</span></span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 247.54  on 290  degrees of freedom</span></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 255.54</span></span>
<span id="cb212-26"><a href="#cb212-26" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb212-27"><a href="#cb212-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 5</span></span></code></pre></div>
<ul>
<li>The sign of the <span class="math inline">\(\beta\)</span> coefficients can be interpreted in the same manner as with linear regression as having a positive or negative relationship.<br />
</li>
<li>The odds of being depressed are less if the respondent has a higher income and is older, and higher if the respondent is female.</li>
</ul>
<blockquote>
<p>The odds of a female being depressed are 2.53 times greater than the odds for Males after adjusting for the effects of age and income (p=.016).</p>
</blockquote>
<p><strong>Example calculation for <span class="math inline">\(OR = e^{\beta}\)</span></strong></p>
<p>The full model is:
<span class="math display">\[log(odds) = -0.676 - 0.02096*age - .03656*income + 0.92945*gender\]</span></p>
<p>We want to calculate the Odds Ratio of depression for women compared to men.
<span class="math display">\[ OR = \frac{Odds (Y=1|F)}{Odds (Y=1|M)} \]</span></p>
<p>Write out the equations for men and women separately.
<span class="math display">\[ = \frac{e^{-0.676 - 0.02096*age - .03656*income + 0.92945(1)}}
          {e^{-0.676 - 0.02096*age - .03656*income + 0.92945(0)}}\]</span></p>
<p>Applying rules of exponents to simplify.
<span class="math display">\[ = \frac{e^{-0.676}e^{- 0.02096*age}e^{- .03656*income}e^{0.92945(1)}}
          {e^{-0.676}e^{- 0.02096*age}e^{- .03656*income}e^{0.92945(0)}}\]</span></p>
<p><span class="math display">\[ = \frac{e^{0.92945(1)}}
          {e^{0.92945(0)}}\]</span></p>
<p><span class="math display">\[ = e^{0.92945} \]</span></p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(.<span class="dv">92945</span>)</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.533116</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(mvmodel)[<span class="dv">4</span>])</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="do">##      sex </span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.533112</span></span></code></pre></div>
</div>
<div id="effect-of-a-k-unit-change" class="section level3 hasAnchor" number="11.3.5">
<h3 class="hasAnchor"><span class="header-section-number">11.3.5</span> Effect of a k unit change<a href="#effect-of-a-k-unit-change" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Sometimes a 1 unit change in a continuous variable is not meaningful.</li>
<li><span class="math inline">\(exp(kb)\)</span> is the incremental odds ratio corresponding to an increase of <span class="math inline">\(k\)</span> units in the variable X, assuming that the values of all other X variables remain unchanged.</li>
</ul>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(mvmodel, <span class="at">exponentiate=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<div id="swvnyhdtxt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#swvnyhdtxt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#swvnyhdtxt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#swvnyhdtxt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#swvnyhdtxt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#swvnyhdtxt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#swvnyhdtxt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#swvnyhdtxt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#swvnyhdtxt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#swvnyhdtxt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#swvnyhdtxt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#swvnyhdtxt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#swvnyhdtxt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#swvnyhdtxt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#swvnyhdtxt .gt_from_md > :first-child {
  margin-top: 0;
}

#swvnyhdtxt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#swvnyhdtxt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#swvnyhdtxt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#swvnyhdtxt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#swvnyhdtxt .gt_row_group_first td {
  border-top-width: 2px;
}

#swvnyhdtxt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#swvnyhdtxt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#swvnyhdtxt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#swvnyhdtxt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#swvnyhdtxt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#swvnyhdtxt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#swvnyhdtxt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#swvnyhdtxt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#swvnyhdtxt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#swvnyhdtxt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#swvnyhdtxt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#swvnyhdtxt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#swvnyhdtxt .gt_left {
  text-align: left;
}

#swvnyhdtxt .gt_center {
  text-align: center;
}

#swvnyhdtxt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#swvnyhdtxt .gt_font_normal {
  font-weight: normal;
}

#swvnyhdtxt .gt_font_bold {
  font-weight: bold;
}

#swvnyhdtxt .gt_font_italic {
  font-style: italic;
}

#swvnyhdtxt .gt_super {
  font-size: 65%;
}

#swvnyhdtxt .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#swvnyhdtxt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#swvnyhdtxt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#swvnyhdtxt .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#swvnyhdtxt .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#swvnyhdtxt .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>OR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">age</td>
<td class="gt_row gt_center">0.98</td>
<td class="gt_row gt_center">0.96, 1.00</td>
<td class="gt_row gt_center">0.020</td></tr>
    <tr><td class="gt_row gt_left">income</td>
<td class="gt_row gt_center">0.96</td>
<td class="gt_row gt_center">0.94, 0.99</td>
<td class="gt_row gt_center">0.009</td></tr>
    <tr><td class="gt_row gt_left">sex</td>
<td class="gt_row gt_center">2.53</td>
<td class="gt_row gt_center">1.23, 5.66</td>
<td class="gt_row gt_center">0.016</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<ul>
<li>The Adjusted odds ratio (AOR) for increase of 1 year of age is 0.98 (95%CI .96, 1.0)</li>
<li>How about a 10 year increase in age? <span class="math inline">\(e^{10*\beta_{age}} = e^{-.21} = .81\)</span></li>
</ul>
<p>In generalized linear models, the assumptions on <span class="math inline">\(\beta\)</span> having a normal distribution</p>
<p>Refer back to equation @ref(or-ci), the linearity of the relationship is on the <span class="math inline">\(\beta\)</span> level, not the odds ratio. Do all transformations on the <span class="math inline">\(\beta\)</span>’s, then the last step is the non-linear transformation of exponentiation.</p>
<p>So the mathmatical order of operations is important! First use <code>coef</code> to extract the coefficients out of the model object (here named <code>mvmodel</code>), then pull the 2nd item out <code>coef(mvmodel)[2]</code>, then multiply it by 10, then lastly exponentiate this value.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">10</span><span class="sc">*</span><span class="fu">coef</span>(mvmodel)[<span class="dv">2</span>])</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="do">##       age </span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.8109285</span></span></code></pre></div>
<p>Do the same to calculate the confidence interval for a 10 year time span.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="dv">10</span><span class="sc">*</span><span class="fu">confint</span>(mvmodel)[<span class="dv">2</span>,]),<span class="dv">3</span>)</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  2.5 % 97.5 % </span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.676  0.965</span></span></code></pre></div>
<p>Controlling for gender and income, an individual has 0.81 (95% CI 0.68, 0.97) times the odds of being depressed compared to someone who is 10 years younger than them.</p>
</div>
<div id="example-predictors-of-smoking-status" class="section level3 hasAnchor" number="11.3.6">
<h3 class="hasAnchor"><span class="header-section-number">11.3.6</span> Example: Predictors of smoking status<a href="#example-predictors-of-smoking-status" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a logistic model on smoking status (0= never smoked, 1=has smoked) using gender, income, and blood pressure class (<code>bp_class</code>) as predictors.</p>
<p><span class="math display">\[
logit(Y) = \beta_{0} + \beta_{1}\mbox{(female)} + \beta_{2}\mbox{(income)} + \beta_{3}\mbox{(Pre-HTN)}
+ \beta_{4}\mbox{(HTN-I)} + \beta_{5}\mbox{(HTN-II)}
\]</span></p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>bp.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(smoke <span class="sc">~</span> female_c <span class="sc">+</span> income <span class="sc">+</span> bp_class, <span class="at">data=</span>addhealth, <span class="at">family=</span><span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(bp.mod, <span class="at">exponentiate=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<div id="vlzpibhdwv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vlzpibhdwv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vlzpibhdwv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vlzpibhdwv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vlzpibhdwv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vlzpibhdwv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlzpibhdwv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vlzpibhdwv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vlzpibhdwv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vlzpibhdwv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vlzpibhdwv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vlzpibhdwv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vlzpibhdwv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vlzpibhdwv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vlzpibhdwv .gt_from_md > :first-child {
  margin-top: 0;
}

#vlzpibhdwv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vlzpibhdwv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vlzpibhdwv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzpibhdwv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vlzpibhdwv .gt_row_group_first td {
  border-top-width: 2px;
}

#vlzpibhdwv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzpibhdwv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vlzpibhdwv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vlzpibhdwv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlzpibhdwv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzpibhdwv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vlzpibhdwv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vlzpibhdwv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlzpibhdwv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vlzpibhdwv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzpibhdwv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vlzpibhdwv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzpibhdwv .gt_left {
  text-align: left;
}

#vlzpibhdwv .gt_center {
  text-align: center;
}

#vlzpibhdwv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vlzpibhdwv .gt_font_normal {
  font-weight: normal;
}

#vlzpibhdwv .gt_font_bold {
  font-weight: bold;
}

#vlzpibhdwv .gt_font_italic {
  font-style: italic;
}

#vlzpibhdwv .gt_super {
  font-size: 65%;
}

#vlzpibhdwv .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#vlzpibhdwv .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vlzpibhdwv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vlzpibhdwv .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#vlzpibhdwv .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#vlzpibhdwv .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>OR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">female_c</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Female</td>
<td class="gt_row gt_center">0.54</td>
<td class="gt_row gt_center">0.46, 0.63</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">income</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">1.00, 1.00</td>
<td class="gt_row gt_center">0.005</td></tr>
    <tr><td class="gt_row gt_left">bp_class</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Normal</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Pre-HTN</td>
<td class="gt_row gt_center">1.08</td>
<td class="gt_row gt_center">0.92, 1.26</td>
<td class="gt_row gt_center">0.4</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">HTN-I</td>
<td class="gt_row gt_center">0.98</td>
<td class="gt_row gt_center">0.79, 1.21</td>
<td class="gt_row gt_center">0.8</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">HTN-II</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.71, 1.50</td>
<td class="gt_row gt_center">0.9</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<p>It is unlikely that blood pressure is associated with smoking status, all groups are not statistically significantly different from the reference group (all p-values are large). Let’s test that hypothesis formally using a Wald Test.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>survey<span class="sc">::</span><span class="fu">regTermTest</span>(bp.mod, <span class="st">&quot;bp_class&quot;</span>)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Wald test for bp_class</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  in glm(formula = smoke ~ female_c + income + bp_class, family = &quot;binomial&quot;, </span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="do">##     data = addhealth)</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="do">## F =  0.428004  on  3  and  3723  df: p= 0.73294</span></span></code></pre></div>
<p>The Wald Test has a large p-value of 0.73, thus blood pressure classification is not associated with smoking status.</p>
<ul>
<li>This means blood pressure classification should not be included in a model to explain smoking status.</li>
</ul>
</div>
<div id="model-fit" class="section level3 hasAnchor" number="11.3.7">
<h3 class="hasAnchor"><span class="header-section-number">11.3.7</span> Model Fit<a href="#model-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>📖 PMA6 12.8</p>
<div id="pseudo-r2" class="section level4 hasAnchor" number="11.3.7.1">
<h4 class="hasAnchor"><span class="header-section-number">11.3.7.1</span> Pseudo <span class="math inline">\(R^{2}\)</span><a href="#pseudo-r2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recall in linear regression, the coefficient of determination <span class="math inline">\(R^{2}\)</span> could be used as a measure of model fit, as it represents the proportion of variance in the outcome explained by the model. This statistic can’t be calculated for Logistic regression, but several versions of a <em>Pseudo <span class="math inline">\(R^{2}\)</span></em> have been proposed, and are printed as part of the output for many statistical packages such as Stata.</p>
</div>
<div id="goodness-of-fit" class="section level4 hasAnchor" number="11.3.7.2">
<h4 class="hasAnchor"><span class="header-section-number">11.3.7.2</span> Goodness of Fit<a href="#goodness-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another way to assess model fit for the entire model is to perform a <em>goodness-of-fit</em> test. The one developed by Hosmer and Lemeshow (1980) is the most commonly used GoF test. In this approach,</p>
<ol style="list-style-type: decimal">
<li>the predicted probability of belonging to the event group (y=1) is calculated for every observation.</li>
<li>these probabilities are sorted in ascending order, then divided into <span class="math inline">\(j\)</span> equal sized subgroups, typically deciles to create 10 ‘bins’.</li>
<li>For each ‘bin’, or range of probabilities, count the observed number of individuals with the event (y=1) (<span class="math inline">\(O_{j}\)</span>).</li>
<li>For each ‘bin’, calculate the expected number of events by adding the predicted probabilities in that bin. (<span class="math inline">\(E_{j}\)</span>)</li>
</ol>
<p>The goodness of fit statistic is then calculated as follows:</p>
<p><span class="math display">\[ GoF \chi^{2} = \sum_{j} \frac{(O_{j}-E_{j})^2}{E_{j}} \]</span></p>
<p>which approximately follows a <span class="math inline">\(\chi_{J-2}^{2}\)</span> distribution under relatively large sample sizes.</p>
<blockquote>
<p>A large GoF statistic (or small p-value) indicate that the fit may <em>NOT</em> be good</p>
</blockquote>
<p>R package: <code>MKmisc</code>, function <code>HLgof.test</code>.</p>
<pre><code>Mkmisc::HLgof.test(fit=fitted(model), obs=model$y)</code></pre>
</div>
<div id="accurate-predictions" class="section level4 hasAnchor" number="11.3.7.3">
<h4 class="hasAnchor"><span class="header-section-number">11.3.7.3</span> Accurate predictions<a href="#accurate-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Since the logistic regression is all about modeling the probability of an event occurring, we can use that model to create predicted probabilities. The next chapter discusses how to use a logistic regression model for prediction, and what measures of fit are used to assess how “accurate” the model is.</p>
</div>
</div>
</div>
<div id="log-linear" class="section level2 hasAnchor" number="11.4">
<h2 class="hasAnchor"><span class="header-section-number">11.4</span> Log-linear models<a href="#log-linear" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A <em>log-linear</em> model is when the log of the response variable is modeled using a linear combination of predictors.</p>
<p><span class="math display">\[ln(Y) \sim XB +\epsilon\]</span></p>
<p>Recall that in statistics, when we refer to the <em>log</em>, we mean the natural log <em>ln</em>.</p>
<p>This type of model is often use to model count data using the Poisson distribution (Section @ref(poisson-reg)).</p>
<p>Why are we transforming the outcome? Typically to achieve normality when the response variable is highly skewed.</p>
<p><strong>Interpreting results</strong></p>
<p>Since we transformed our outcome before performing the regression, we have to back-transform the coefficient before interpretation. Similar to logistic regression, we need to <em>exponentiate</em> the regression coefficient before interpreting.</p>
<p>When using log transformed outcomes, the effect on Y becomes <strong>multiplicative</strong> instead of additive.</p>
<ul>
<li><strong>Additive</strong> For every 1 unit increase in X, y increases by b1</li>
<li><strong>Multiplicative</strong> For every 1 unit increase in X, y is multiplied by <span class="math inline">\(e^{b1}\)</span></li>
</ul>
<p>Example, let <span class="math inline">\(b_{1} = 0.2\)</span>.</p>
<ul>
<li><strong>Additive</strong> For every 1 unit increase in X, y increases by 0.2 units.</li>
<li><strong>Multiplicative</strong> For every 1 unit increase in X, y changes by <span class="math inline">\(e^{0.2} = 1.22\)</span> = 22%</li>
</ul>
<p>Thus we interpret the coefficient as a <strong>percentage</strong> change in <span class="math inline">\(Y\)</span> for a unit increase in <span class="math inline">\(x_{j}\)</span>.</p>
<ul>
<li><strong><span class="math inline">\(b_{j}&lt;1\)</span></strong> : The expected value of <span class="math inline">\(Y\)</span> for when <span class="math inline">\(x=0\)</span> is <span class="math inline">\(1 - e^{b_{j}}\)</span> percent <em>lower</em> than when <span class="math inline">\(x=1\)</span></li>
<li><strong><span class="math inline">\(b_{j} \geq 1\)</span></strong> : The expected value of <span class="math inline">\(Y\)</span> for when <span class="math inline">\(x=0\)</span> is <span class="math inline">\(e^{b_{j}}\)</span> percent <em>higher</em> than when <span class="math inline">\(x=1\)</span></li>
</ul>

<div class="rmdtip">
<p>This UCLA resource is my “go-to” reference on how to interpret the results when your response, predictor, or both variables are log transformed.</p>
<a href="https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-do-i-interpret-a-regression-model-when-some-variables-are-log-transformed/" class="uri">https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-do-i-interpret-a-regression-model-when-some-variables-are-log-transformed/</a>
</div>
<div id="example-1" class="section level3 hasAnchor" number="11.4.1">
<h3 class="hasAnchor"><span class="header-section-number">11.4.1</span> Example<a href="#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are going to analyze personal income from the AddHealth data set. First I need to clean up, and log transform the variable for personal earnings <code>H4EC2</code> by following the steps below <em>in order</em>.</p>
<ol style="list-style-type: decimal">
<li>Remove values above 999995 (structural missing).</li>
<li>Create a new variable called <code>income</code>, that sets all values of personal income to be NA if below the federal poverty line.
<ul>
<li>First set <code>income= H4EC2</code></li>
<li>Then set income to missing, if <code>H4EC2 &lt; 10210</code> (the federal poverty limit from 2008)</li>
</ul></li>
<li>Then create a new variable: <code>logincome</code> that is the natural log (<em>ln</em>) of income. e.g. <code>addhealth$logincome = log(addhealth$income)</code></li>
</ol>
<p>Why are we transforming income? To achieve normality.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(addhealth<span class="sc">$</span>income, <span class="at">probability =</span> <span class="cn">TRUE</span>); <span class="fu">lines</span>(<span class="fu">density</span>(addhealth<span class="sc">$</span>income, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(addhealth<span class="sc">$</span>logincome, <span class="at">probability =</span> <span class="cn">TRUE</span>); <span class="fu">lines</span>(<span class="fu">density</span>(addhealth<span class="sc">$</span>logincome, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(addhealth<span class="sc">$</span>income); <span class="fu">qqline</span>(addhealth<span class="sc">$</span>income, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(addhealth<span class="sc">$</span>logincome); <span class="fu">qqline</span>(addhealth<span class="sc">$</span>logincome, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="GLM_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p><strong>Identify variables</strong></p>
<ul>
<li>Quantitative outcome that has been log transformed: Income (variable <code>logincome</code>)</li>
<li>Binary predictor: Ever smoked a cigarette (variable <code>eversmoke_c</code>)</li>
<li>Binary confounder: Gender (variable <code>female_c</code>)</li>
</ul>
<p>The mathematical multivariable model looks like:</p>
<p><span class="math display">\[ln(Y) \sim \beta_{0} + \beta_{1}x_{1} + \beta_{2}x_{2}\]</span></p>
<p><strong>Fit a linear regression model</strong></p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>ln.mod<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(logincome<span class="sc">~</span>wakeup <span class="sc">+</span> female_c, <span class="at">data=</span>addhealth)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ln.mod<span class="fl">.2</span>) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code></pre></div>
<table style="width:93%;">
<colgroup>
<col width="29%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">t value</th>
<th align="center">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">10.65</td>
<td align="center">0.026</td>
<td align="center">409.8</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><strong>wakeup</strong></td>
<td align="center">-0.01491</td>
<td align="center">0.003218</td>
<td align="center">-4.633</td>
<td align="center">3.73e-06</td>
</tr>
<tr class="odd">
<td align="center"><strong>female_cFemale</strong></td>
<td align="center">-0.1927</td>
<td align="center">0.017</td>
<td align="center">-11.34</td>
<td align="center">2.564e-29</td>
</tr>
</tbody>
</table>
<table style="width:89%;">
<caption>Fitting linear model: logincome ~ wakeup + female_c</caption>
<colgroup>
<col width="20%" />
<col width="30%" />
<col width="13%" />
<col width="23%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Observations</th>
<th align="center">Residual Std. Error</th>
<th align="center"><span class="math inline">\(R^2\)</span></th>
<th align="center">Adjusted <span class="math inline">\(R^2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">3813</td>
<td align="center">0.5233</td>
<td align="center">0.03611</td>
<td align="center">0.0356</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="fu">confint</span>(ln.mod<span class="fl">.2</span>)[<span class="sc">-</span><span class="dv">1</span>,])</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                     2.5 %      97.5 %</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="do">## wakeup         0.02099299 0.008561652</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="do">## female_cFemale 0.20231394 0.147326777</span></span></code></pre></div>
<p><strong>Interpret the results</strong></p>
<ul>
<li>For every hour later one wakes up in the morning, one can expect to earn <code>1-exp(-0.015)</code> = 1.4% less income than someone who wakes up one hour earlier. This is after controlling for gender.</li>
<li>Females have on average <code>1-exp(-0.19)</code> = 17% percent lower income than males, after controlling for the wake up time.</li>
</ul>
<p>Both gender and time one wakes up are significantly associated with the amount of personal earnings one makes. Waking up later in the morning is associated with 1.4% (95% CI 0.8%-2%, p&lt;.0001) percent lower income than someone who wakes up one hour earlier. Females have 17% (95% CI 15%-20%, p&lt;.0001) percent lower income than males.</p>
</div>
</div>
<div id="poisson-reg" class="section level2 hasAnchor" number="11.5">
<h2 class="hasAnchor"><span class="header-section-number">11.5</span> Count outcome data<a href="#poisson-reg" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lets consider modeling the distribution of the number of of occurrences of a rare event in a specified period of time
- e.g. Number of thunderstorms in a year</p>
<ul>
<li>If we assume:
<ul>
<li>Rate (<span class="math inline">\(\mu\)</span>) is fixed over time</li>
<li>Successive occurrences independent of each other</li>
</ul></li>
</ul>
<p>Then we can use the <strong>Poisson distribution</strong>.</p>
<p><span class="math display">\[
P(Y=y) = e^{-\mu}\frac{\mu^{y}}{y!}
\]</span></p>
<ul>
<li>The Poisson distribution has a distinct feature where the mean of the distribution <span class="math inline">\(\mu\)</span>, is also the variance.</li>
</ul>
<div class="figure">
<img src="images/poisson.png" alt="" />
<p class="caption">Plot of Histogram of a Poisson Distribution with a Mean of 5 and a Normal Curve</p>
</div>
<div id="poisson-regression" class="section level4 hasAnchor" number="11.5.0.1">
<h4 class="hasAnchor"><span class="header-section-number">11.5.0.1</span> Poisson Regression<a href="#poisson-regression" class="anchor-section" aria-label="Anchor link to header"></a></h4>

<div class="rmdnote">
This section is still under development
</div>
<p>Just another GLM - we use a <span class="math inline">\(ln\)</span> as the link function. This lets us model the log rates using a linear combination of covariates.</p>
<p><span class="math display">\[
  ln(\mu) = \mathbf{X}\beta
\]</span></p>
<p>Then the expected rate of events per unit of time is:</p>
<p><span class="math display">\[
  \mu = e^{\mathbf{X}\beta}
\]</span></p>
<p>This model assumes that the time of “exposure” for each record is identical.</p>
<ul>
<li>Number of cigarettes per month</li>
<li>Number of epileptic seizures per week</li>
<li>Number of people with lung cancer in four cities</li>
</ul>
<p>If this is not the case (often), then this model needs to include an <em>offset</em>.</p>
<ul>
<li>e.g. observing each patient for epileptic seizures for a different number of days</li>
<li>accounting for different sizes or structures of populations of interest (e.g. different cities with lung cancer)</li>
</ul>
<p>What actually gets fit in <code>glm</code> is the model of expected <em>counts</em>, rather than rates, with an offset for the time period <span class="math inline">\(T\)</span>.</p>
<ul>
<li>If all time periods are the same, then T is constant, and a linear combination of the intercept, thus dropped from the model.</li>
</ul>
<p><span class="math display">\[
  ln(\lambda) = \mathbf{X}\beta + ln(T)
\]</span></p>
<p>While this offset will be added to the regression model as if it were another variable, it’s not quite the same because the regression coefficient for the <span class="math inline">\(ln(T)\)</span> term is fixed at 1.</p>
<p>The generic formula for fitting a poisson model using <code>glm</code> is:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(T)), <span class="at">family=</span><span class="st">&#39;poisson&#39;</span>)</span></code></pre></div>
<p>or alternatively as an argument</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">offset =</span> <span class="fu">log</span>(T),  <span class="at">family=</span><span class="st">&#39;poisson&#39;</span>)</span></code></pre></div>
<p>The interpretation of the <span class="math inline">\(\beta\)</span> regression coefficients are differences in the log rate (or the log rate-ratio). So, just like with a logistic regression often we back-transform the coefficients by exponentiating before interpreting. So <span class="math inline">\(e^{\beta}\)</span> is now the rate-ratio.</p>
<ul>
<li>The intercept term is not a ratio, but a baseline rate when all covariates are 0</li>
<li>For other covariates, the coefficient is the relative change <em>per unit</em> change in the covariate.
<ul>
<li>one year older</li>
<li>males vs females</li>
</ul></li>
</ul>
<p>Also, similar to logistic regression, since the outcome was transformed, the standard errors are not useful or interpretable as is. To calculate confidence intervals for the rate ratios,</p>
<ol style="list-style-type: decimal">
<li>calculate the CI for <span class="math inline">\(\beta\)</span></li>
<li>exponentiate each end point.</li>
</ol>
</div>
<div id="example-modeling-counts-from-the-add-health-wave-iv-dataset." class="section level4 hasAnchor" number="11.5.0.2">
<h4 class="hasAnchor"><span class="header-section-number">11.5.0.2</span> Example: Modeling counts from the Add Health Wave IV dataset.<a href="#example-modeling-counts-from-the-add-health-wave-iv-dataset." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s model the number of siblings someone has, based off their age at Wave 1 (2008).</p>
<p>Visualize</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(addhealth, <span class="fu">aes</span>(<span class="at">x=</span>nsib)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of siblings&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="GLM_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>nsib.model <span class="ot">&lt;-</span> <span class="fu">glm</span>(nsib <span class="sc">~</span> agew1 <span class="sc">+</span> female, <span class="at">data=</span>addhealth, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(nsib.model, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="nbrxuexyhc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nbrxuexyhc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nbrxuexyhc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nbrxuexyhc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nbrxuexyhc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nbrxuexyhc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nbrxuexyhc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nbrxuexyhc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nbrxuexyhc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nbrxuexyhc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nbrxuexyhc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nbrxuexyhc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nbrxuexyhc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nbrxuexyhc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nbrxuexyhc .gt_from_md > :first-child {
  margin-top: 0;
}

#nbrxuexyhc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nbrxuexyhc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nbrxuexyhc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nbrxuexyhc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nbrxuexyhc .gt_row_group_first td {
  border-top-width: 2px;
}

#nbrxuexyhc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbrxuexyhc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nbrxuexyhc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nbrxuexyhc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nbrxuexyhc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbrxuexyhc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nbrxuexyhc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nbrxuexyhc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nbrxuexyhc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nbrxuexyhc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbrxuexyhc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nbrxuexyhc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbrxuexyhc .gt_left {
  text-align: left;
}

#nbrxuexyhc .gt_center {
  text-align: center;
}

#nbrxuexyhc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nbrxuexyhc .gt_font_normal {
  font-weight: normal;
}

#nbrxuexyhc .gt_font_bold {
  font-weight: bold;
}

#nbrxuexyhc .gt_font_italic {
  font-style: italic;
}

#nbrxuexyhc .gt_super {
  font-size: 65%;
}

#nbrxuexyhc .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#nbrxuexyhc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#nbrxuexyhc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nbrxuexyhc .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#nbrxuexyhc .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#nbrxuexyhc .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>IRR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">agew1</td>
<td class="gt_row gt_center">1.05</td>
<td class="gt_row gt_center">1.03, 1.06</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">female</td>
<td class="gt_row gt_center">1.10</td>
<td class="gt_row gt_center">1.06, 1.14</td>
<td class="gt_row gt_center"><0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> IRR = Incidence Rate Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<div id="multinomial-reg" class="section level2 hasAnchor" number="11.6">
<h2 class="hasAnchor"><span class="header-section-number">11.6</span> Categorical outcome data<a href="#multinomial-reg" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div class="rmdnote">
This section is still under development
</div>
<p>If you want to keep the response variable as a categorical variable with more than two levels, the following regression model types are available:</p>
<ul>
<li><a href="https://stats.oarc.ucla.edu/r/dae/ordinal-logistic-regression/">Ordinal Logistic Regression</a></li>
<li><a href="https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/">Multinomial Regression</a></li>
</ul>
<!--chapter:end:GLM.Rmd-->
</div>
</div>
<div id="binary-classification" class="section level1 hasAnchor" number="12">
<h1 class="hasAnchor"><span class="header-section-number">12</span> Classification of Binary outcomes<a href="#binary-classification" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>This section will be expanded to discuss classification for more than two groups.</p>
</blockquote>
<div id="predicted-probabilities" class="section level2 hasAnchor" number="12.1">
<h2 class="hasAnchor"><span class="header-section-number">12.1</span> Predicted Probabilities<a href="#predicted-probabilities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Sometimes Odds Ratios can be difficult to interpret or understand.</li>
<li>Sometimes you just want to report the probability of the event occurring.</li>
<li>Or sometimes you want to predict whether or not a new individual is going to have the event.</li>
</ul>
<p>For all of these, we need to calculate <span class="math inline">\(p_{i} = P(y_{i}=1)\)</span>, the probability of the event.</p>
<p>Back solving the logistic model for <span class="math inline">\(p_{i} = e^{\beta X} / (1+e^{\beta X})\)</span> gives us the probability of an event.</p>
<p><span class="math display">\[
p_{i} = \frac{e^{\beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} + \ldots + \beta_{p}x_{pi}}}
{1 + e^{\beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} + \ldots + \beta_{p}x_{pi}}}
\]</span></p>
<p>Consider the main effects model of depression on age, income and gender from section @ref(logreg-dep-ex)</p>
<table style="width:89%;">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">-2.313</td>
<td align="center">0.3315</td>
<td align="center">-6.976</td>
<td align="center">3.044e-12</td>
</tr>
<tr class="even">
<td align="center"><strong>sex</strong></td>
<td align="center">1.039</td>
<td align="center">0.3767</td>
<td align="center">2.757</td>
<td align="center">0.005831</td>
</tr>
</tbody>
</table>
<p>(Dispersion parameter for binomial family taken to be 1 )</p>
<table style="width:68%;">
<colgroup>
<col width="29%" />
<col width="38%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="center">Null deviance:</td>
<td align="center">268.1 on 293 degrees of
freedom</td>
</tr>
<tr class="even">
<td align="center">Residual deviance:</td>
<td align="center">259.4 on 292 degrees of
freedom</td>
</tr>
</tbody>
</table>
<p>The predicted probability of depression is calculated as:
<span class="math display">\[
P(depressed) = \frac{e^{-0.676 - 0.02096*age - .03656*income + 0.92945*gender}}
{1 + e^{-0.676 - 0.02096*age - .03656*income + 0.92945*gender}}
\]</span></p>
<p>Notice you can’t get a “generic” probability for all individuals. It entirely depends on their <em>covariate profile</em>. In other words, what value X take on for each record.</p>
<p>Let’s compare the probability of being depressed for males and females separately, while holding age and income constant at their average value.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>depress <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">age=</span><span class="fu">mean</span>(age), <span class="at">income=</span><span class="fu">mean</span>(income))</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        age   income</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 44.41497 20.57483</span></span></code></pre></div>
<p>Plug the coefficient estimates and the values of the variables into the equation and calculate.
<span class="math display">\[
P(depressed|Female) = \frac{e^{-0.676 - 0.02096(44.4) - .03656(20.6) + 0.92945(1)}}
{1 + e^{-0.676 - 0.02096(44.4) - .03656(20.6) + 0.92945(1)}}
\]</span></p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>XB.f <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.676</span> <span class="sc">-</span> <span class="fl">0.02096</span><span class="sc">*</span>(<span class="fl">44.4</span>) <span class="sc">-</span> .<span class="dv">03656</span><span class="sc">*</span>(<span class="fl">20.6</span>) <span class="sc">+</span> <span class="fl">0.92945</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(XB.f) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(XB.f))</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.1930504</span></span></code></pre></div>
<p><span class="math display">\[
P(depressed|Male) = \frac{e^{-0.676 - 0.02096(44.4) - .03656(20.6) + 0.92945(0)}}
{1 + e^{-0.676 - 0.02096(44.4) - .03656(20.6) + 0.92945(0)}}
\]</span></p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>XB.m <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.676</span> <span class="sc">-</span> <span class="fl">0.02096</span><span class="sc">*</span>(<span class="fl">44.4</span>) <span class="sc">-</span> .<span class="dv">03656</span><span class="sc">*</span>(<span class="fl">20.6</span>)</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(XB.m) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(XB.m))</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.08629312</span></span></code></pre></div>
<p>The probability for a 44.4 year old female who makes $20.6k annual income has a 0.19 probability of being depressed. The probability of depression for a male of equal age and income is 0.86.</p>
</div>
<div id="predicted-class-outcome" class="section level2 hasAnchor" number="12.2">
<h2 class="hasAnchor"><span class="header-section-number">12.2</span> Predicted Class (outcome)<a href="#predicted-class-outcome" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So what if you want to get the model predicted probability of the event for all individuals in the data set? There’s no way I’m doing that calculation for every person in the data set.</p>
<p>We can use the <code>predict()</code> command to generate a vector of predictions for each row used in the model.</p>

<div class="rmdcaution">
Any row with missing data on any variable used in the model will be dropped, and so NOT get a predicted value. So the tactic is to use the data stored in the model object.
</div>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>mvmodel <span class="ot">&lt;-</span> <span class="fu">glm</span>(cases <span class="sc">~</span> age <span class="sc">+</span> income <span class="sc">+</span> sex, <span class="at">data=</span>depress, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>model.pred.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mvmodel, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span></code></pre></div>
<p>The <code>model.pred.prob</code> is a vector of individual predicted probabilities of the outcome (being depressed). To classify individual <span class="math inline">\(i\)</span> as being depressed or not, we draw a binary value (<span class="math inline">\(x_{i} = 0\)</span> or <span class="math inline">\(1\)</span>), with probability <span class="math inline">\(p_{i}\)</span> by using the <code>rbinom</code> function, with a <code>size=1</code>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#reminder: change the combo on my luggage</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>plot.mpp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.prob =</span> model.pred.prob, </span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pred.class =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">length</span>(model.pred.prob), </span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p =</span> model.pred.prob),</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">truth =</span> mvmodel<span class="sc">$</span>y)</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plot.mpp)</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    pred.prob pred.class truth</span></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 0.21108906          0     0</span></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 0.08014012          0     0</span></span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 0.15266203          0     0</span></span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 0.24527840          1     0</span></span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 0.15208679          0     0</span></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 0.17056409          0     0</span></span></code></pre></div>
<p>Applying class labels and creating a cross table of predicted vs truth:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>plot.mpp <span class="ot">&lt;-</span> plot.mpp <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">pred.class =</span> <span class="fu">factor</span>(pred.class, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Not Depressed&quot;</span>, <span class="st">&quot;Depressed&quot;</span>)), </span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">truth =</span> <span class="fu">factor</span>(truth, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Not Depressed&quot;</span>, <span class="st">&quot;Depressed&quot;</span>)))</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(plot.mpp<span class="sc">$</span>pred.class, plot.mpp<span class="sc">$</span>truth)</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                </span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="do">##                 Not Depressed Depressed</span></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Not Depressed           195        35</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   Depressed                49        15</span></span></code></pre></div>
<p>The model correctly identified 195 individuals as not depressed and 15 as depressed.
The model got it wrong 49 + 25 times.</p>
<p>The <strong>accuracy</strong> of the model is calculated as the fraction of times the model prediction matches the observed category:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">195</span><span class="sc">+</span><span class="dv">15</span>)<span class="sc">/</span>(<span class="dv">195</span><span class="sc">+</span><span class="dv">35</span><span class="sc">+</span><span class="dv">49</span><span class="sc">+</span><span class="dv">15</span>)</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.7142857</span></span></code></pre></div>
<p>This model has a 71.4% accuracy.</p>
<p><img src="images/q.png" /> Is this good? What if death were the event?</p>
<div id="distribution-of-predicted-probabilities" class="section level4 hasAnchor" number="12.2.0.1">
<h4 class="hasAnchor"><span class="header-section-number">12.2.0.1</span> Distribution of Predicted probabilities<a href="#distribution-of-predicted-probabilities" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another important feature to look at is to see how well the model discriminates between the two groups in terms of predicted probabilities. Let’s look at a plot:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.mpp, <span class="fu">aes</span>(<span class="at">x=</span>truth, <span class="at">y=</span>pred.prob, <span class="at">fill=</span>truth)) <span class="sc">+</span> </span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">width=</span>.<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_violin</span>(<span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="classification_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><img src="images/q.png" /></p>
<ul>
<li>What do you notice in this plot?</li>
<li>What can you infer?</li>
</ul>
</div>
</div>
<div id="confusion-matrix" class="section level2 hasAnchor" number="12.3">
<h2 class="hasAnchor"><span class="header-section-number">12.3</span> Confusion Matrix<a href="#confusion-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A confusion Matrix is the 2x2 table that compares the predicted classes to the true classes.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(plot.mpp<span class="sc">$</span>pred.class, plot.mpp<span class="sc">$</span>truth)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                </span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                 Not Depressed Depressed</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Not Depressed           195        35</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Depressed                49        15</span></span></code></pre></div>
<p>This table was generated by drawing a random Bernoulli variable with probability <span class="math inline">\(p_{i}\)</span>. This assumes that probabilities can range from [0,1], but if you look at the plots above, the predicted probabilities max out around 0.5.</p>
<p>Often we adjust the cutoff value to improve accuracy. This is where we have to put our gut feeling of what probability constitutes “high risk”. For some models, this could be as low as 30%. It’s whatever the probability is that optimally separates the classes. This is an important tuning parameter because since the models we build are only based on data we measured, often there are other unmeasured confounding factors that affect the predicted probability. So our predictions don’t span the full range from [0,1].</p>
<p><img src="images/q.png" /> Using the above plots, where should we put the cutoff value? At what probability should we classify a record as “depressed”?</p>
<p>There are many different types of criteria that can be used to find the optimal cutoff value. But first we need to understand the expanded borders of a <a href="https://en.wikipedia.org/wiki/Confusion_matrix">[Confusion Matrix]</a>.</p>
<div class="figure">
<img src="images/confusion-matrix.PNG" alt="" />
<p class="caption">Confusion matrix. Credit: Wikipedia</p>
</div>
<p>Using the <code>confusionMatrix</code> function inside the <code>caret</code> package performs all these calculations for us.</p>

<div class="rmdcaution">
You must specify what the ‘event’ is.
This is also another place where the factor ordering of binary variables can cause headache. Another reason to control your factors!
</div>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(plot.mpp<span class="sc">$</span>pred.class, plot.mpp<span class="sc">$</span>truth, <span class="at">positive=</span><span class="st">&quot;Depressed&quot;</span>)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Confusion Matrix and Statistics</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="do">##                Reference</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction      Not Depressed Depressed</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Not Depressed           195        35</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Depressed                49        15</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                                          </span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                Accuracy : 0.7143         </span></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                  95% CI : (0.659, 0.7652)</span></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     No Information Rate : 0.8299         </span></span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="do">##     P-Value [Acc &gt; NIR] : 1.0000         </span></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                                          </span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                   Kappa : 0.0892         </span></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="do">##                                          </span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  Mcnemar&#39;s Test P-Value : 0.1561         </span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a><span class="do">##                                          </span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a><span class="do">##             Sensitivity : 0.30000        </span></span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a><span class="do">##             Specificity : 0.79918        </span></span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a><span class="do">##          Pos Pred Value : 0.23438        </span></span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a><span class="do">##          Neg Pred Value : 0.84783        </span></span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a><span class="do">##              Prevalence : 0.17007        </span></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a><span class="do">##          Detection Rate : 0.05102        </span></span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a><span class="do">##    Detection Prevalence : 0.21769        </span></span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a><span class="do">##       Balanced Accuracy : 0.54959        </span></span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a><span class="do">##                                          </span></span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a><span class="do">##        &#39;Positive&#39; Class : Depressed      </span></span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span></code></pre></div>
<ul>
<li>195 people were correctly predicted to not be depressed (True Negative)</li>
<li>49 people were incorrectly predicted to be depressed (False Positive)</li>
<li>10 people were incorrectly predicted to not be depressed (False Negative)</li>
<li>15 people were correctly predicted to be depressed (True Positive)</li>
</ul>
</div>
<div id="vocabulary-terms" class="section level2 hasAnchor" number="12.4">
<h2 class="hasAnchor"><span class="header-section-number">12.4</span> Vocabulary terms<a href="#vocabulary-terms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Also other names for the same term, and formulas.</p>
<ul>
<li><p>True positive (<span class="math inline">\(n_{11}\)</span>)</p></li>
<li><p>True negative (<span class="math inline">\(n_{22}\)</span>)</p></li>
<li><p>False positive, Type I error (<span class="math inline">\(n_{12}\)</span>)</p></li>
<li><p>False negative, Type II error (<span class="math inline">\(n_{21}\)</span>)</p></li>
<li><p>True positive rate (TPR), Recall, Sensitivity, probability of detection, power.
<span class="math inline">\(\frac{\# True Positive}{\#Condition Positive}\)</span></p></li>
<li><p>False positive rate (FPR), fall-out, probability of false alarm.
<span class="math inline">\(\frac{\# False Positive}{\# Condition Negative}\)</span></p></li>
<li><p>False negative rate (FNR), miss rate.
<span class="math inline">\(\frac{\# False Negative}{\# Condition Positive}\)</span></p></li>
<li><p>True negative rate (TNR), Specificity, selectivity.
<span class="math inline">\(\frac{\# True Negative}{\# Condition Negative}\)</span></p></li>
<li><p>Prevalence.
<span class="math inline">\(\frac{\# Condition Positive}{\# Total Population}\)</span></p></li>
<li><p>Accuracy.
<span class="math inline">\(\frac{\# True Positive + \# True Negative}{\# Total Population}\)</span></p></li>
<li><p>Positive Predictive Value (PPV), Precision.
<span class="math inline">\(\frac{\# True Positive}{\# Predicted Condition Positive}\)</span></p></li>
<li><p>False discovery rate (FDR).
<span class="math inline">\(\frac{\# False Positive}{\# Predicted Condition Positive}\)</span></p></li>
<li><p>False omission rate (FOR).
<span class="math inline">\(\frac{\# False Negative}{\# Predicted Condition Negative}\)</span></p></li>
<li><p>Negative predictive value (NPV).
<span class="math inline">\(\frac{\# True Negative}{\# Predicted Condition Negative}\)</span></p></li>
<li><p>F1 score. <span class="math inline">\(\frac{2 * (Precision * Recall)}{Precision + Recall}\)</span></p></li>
</ul>
<!---
Other terminology: 

* **Sensitivity/Recall/True positive rate**: P(predicted positive | total positive) = `40/(10+40) = .8`
* **Specificity/true negative rate**: P(predicted negative | total negative) = `123/(123+121) = .504`
* **Precision/positive predicted value**: P(true positive | predicted positive) = `40/(121+40) = .2484`
* **Accuracy**: (TP + TN)/ Total: `(40 + 123)/(40+123+121+10) = .5544`
* **Balanced Accuracy**: $[(n_{11}/n_{.1}) + (n_{22}/n_{.2})]/2$ - This is to adjust for class size imbalances (like in this example)
* **F1 score**: the harmonic mean of precision and recall. This ranges from 0 (bad) to 1 (good): $2*\frac{precision*recall}{precision + recall}$ = `2*(.2484*.8)/(.2484+.8) = .38`
---->
</div>
<div id="roc-curves" class="section level2 hasAnchor" number="12.5">
<h2 class="hasAnchor"><span class="header-section-number">12.5</span> ROC Curves<a href="#roc-curves" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>ROC curves show the balance between sensitivity and specificity.</li>
<li>We’ll use the <a href="https://rocr.bioinf.mpi-sb.mpg.de/">[ROCR]</a> package. It only takes 3 commands:
<ul>
<li>calculate <code>prediction()</code> using the model</li>
<li>calculate the model <code>performance()</code> on both true positive rate and true negative rate for a whole range of cutoff values.</li>
<li><code>plot</code> the curve.
<ul>
<li>The <code>colorize</code> option colors the curve according to the probability cutoff point.</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> <span class="fu">prediction</span>(model.pred.prob, mvmodel<span class="sc">$</span>y)</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr, <span class="at">measure=</span><span class="st">&quot;tpr&quot;</span>, <span class="at">x.measure=</span><span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">colorize=</span><span class="cn">TRUE</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">print.cutoffs.at=</span><span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>)))</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="classification_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>We can also use the <code>performance()</code> function to evaluate the <span class="math inline">\(f1\)</span> measure</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>perf.f1 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr,<span class="at">measure=</span><span class="st">&quot;f&quot;</span>)</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>perf.acc <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr,<span class="at">measure=</span><span class="st">&quot;acc&quot;</span>)</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf.f1)</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf.acc)</span></code></pre></div>
<p><img src="classification_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>We can dig into the <code>perf.acc</code> object to get the maximum accuracy value (<code>y.value</code>), then find the row where that value occurs, and link it to the corresponding cutoff value of x.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>(max.f1 <span class="ot">&lt;-</span> <span class="fu">max</span>(perf.acc<span class="sc">@</span>y.values[[<span class="dv">1</span>]], <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.8333333</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>(row.with.max <span class="ot">&lt;-</span> <span class="fu">which</span>(perf.acc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]<span class="sc">==</span>max.f1))</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2 8</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>(cutoff.value <span class="ot">&lt;-</span> perf.acc<span class="sc">@</span>x.values[[<span class="dv">1</span>]][row.with.max])</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="do">##       124       256 </span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.4508171 0.3946273</span></span></code></pre></div>
<p>A cutoff of 0.42 provides the maximum accuracy measure.</p>
<p>You can do the same process with other measures of optimization such as the <span class="math inline">\(f1\)</span> score.</p>
<p>ROC curves:</p>
<ul>
<li>Can also be used for model comparison: <a href="http://yaojenkuo.io/diamondsROC.html" class="uri">http://yaojenkuo.io/diamondsROC.html</a></li>
<li>The Area under the Curve (auc) also gives you a measure of overall model accuracy.</li>
</ul>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr, <span class="at">measure=</span><span class="st">&#39;auc&#39;</span>)</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>auc<span class="sc">@</span>y.values</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.695041</span></span></code></pre></div>
</div>
<div id="model-performance" class="section level2 hasAnchor" number="12.6">
<h2 class="hasAnchor"><span class="header-section-number">12.6</span> Model Performance<a href="#model-performance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Say we decide that a value of 0.15 is our optimal cutoff value to predict depression using this model.</li>
<li>We can use this probability to classify each row into groups.
<ul>
<li>The assigned class values must match the data type and levels of the true value.</li>
<li>It also has to be in the same order, so the <code>0</code> group needs to come first.</li>
<li>I want this matrix to show up like the one in Wikipedia, so I’m leveraging the forcats package to reverse my factor level ordering.</li>
</ul></li>
<li>We can calculate a confusion matrix using the similarly named function from the <code>caret</code> package.</li>
</ul>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>plot.mpp<span class="sc">$</span>pred.class2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(plot.mpp<span class="sc">$</span>pred.prob <span class="sc">&lt;</span><span class="fl">0.15</span>, <span class="dv">0</span>,<span class="dv">1</span>) </span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>plot.mpp<span class="sc">$</span>pred.class2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot.mpp<span class="sc">$</span>pred.class2, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Not Depressed&quot;</span>, <span class="st">&quot;Depressed&quot;</span>)) <span class="sc">%&gt;%</span>   </span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>                        forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(plot.mpp<span class="sc">$</span>pred.class2, forcats<span class="sc">::</span><span class="fu">fct_rev</span>(plot.mpp<span class="sc">$</span>truth), <span class="at">positive=</span><span class="st">&quot;Depressed&quot;</span>)</span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Confusion Matrix and Statistics</span></span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                Reference</span></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction      Depressed Not Depressed</span></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   Depressed            40           121</span></span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   Not Depressed        10           123</span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a><span class="do">##                Accuracy : 0.5544          </span></span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a><span class="do">##                  95% CI : (0.4956, 0.6121)</span></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a><span class="do">##     No Information Rate : 0.8299          </span></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a><span class="do">##     P-Value [Acc &gt; NIR] : 1               </span></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a><span class="do">##                   Kappa : 0.1615          </span></span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  Mcnemar&#39;s Test P-Value : &lt;2e-16          </span></span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a><span class="do">##             Sensitivity : 0.8000          </span></span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a><span class="do">##             Specificity : 0.5041          </span></span>
<span id="cb241-26"><a href="#cb241-26" aria-hidden="true" tabindex="-1"></a><span class="do">##          Pos Pred Value : 0.2484          </span></span>
<span id="cb241-27"><a href="#cb241-27" aria-hidden="true" tabindex="-1"></a><span class="do">##          Neg Pred Value : 0.9248          </span></span>
<span id="cb241-28"><a href="#cb241-28" aria-hidden="true" tabindex="-1"></a><span class="do">##              Prevalence : 0.1701          </span></span>
<span id="cb241-29"><a href="#cb241-29" aria-hidden="true" tabindex="-1"></a><span class="do">##          Detection Rate : 0.1361          </span></span>
<span id="cb241-30"><a href="#cb241-30" aria-hidden="true" tabindex="-1"></a><span class="do">##    Detection Prevalence : 0.5476          </span></span>
<span id="cb241-31"><a href="#cb241-31" aria-hidden="true" tabindex="-1"></a><span class="do">##       Balanced Accuracy : 0.6520          </span></span>
<span id="cb241-32"><a href="#cb241-32" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb241-33"><a href="#cb241-33" aria-hidden="true" tabindex="-1"></a><span class="do">##        &#39;Positive&#39; Class : Depressed       </span></span>
<span id="cb241-34"><a href="#cb241-34" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span></code></pre></div>
<ul>
<li>123 people were correctly predicted to not be depressed (True Negative, <span class="math inline">\(n_{11}\)</span>)</li>
<li>121 people were incorrectly predicted to be depressed (False Positive, <span class="math inline">\(n_{21}\)</span>)</li>
<li>10 people were incorrectly predicted to not be depressed (False Negative, <span class="math inline">\(n_{12}\)</span>)</li>
<li>40 people were correctly predicted to be depressed (True Positive, <span class="math inline">\(n_{22}\)</span>)</li>
</ul>
<p>Other terminology:</p>
<ul>
<li><strong>Sensitivity/Recall/True positive rate</strong>: P(predicted positive | total positive) = <code>40/(10+40) = .8</code></li>
<li><strong>Specificity/true negative rate</strong>: P(predicted negative | total negative) = <code>123/(123+121) = .504</code></li>
<li><strong>Precision/positive predicted value</strong>: P(true positive | predicted positive) = <code>40/(121+40) = .2484</code></li>
<li><strong>Accuracy</strong>: (TP + TN)/ Total: <code>(40 + 123)/(40+123+121+10) = .5544</code></li>
<li><strong>Balanced Accuracy</strong>: <span class="math inline">\([(n_{11}/n_{.1}) + (n_{22}/n_{.2})]/2\)</span> - This is to adjust for class size imbalances (like in this example)</li>
<li><strong>F1 score</strong>: the harmonic mean of precision and recall. This ranges from 0 (bad) to 1 (good): <span class="math inline">\(2*\frac{precision*recall}{precision + recall}\)</span> = <code>2*(.2484*.8)/(.2484+.8) = .38</code></li>
</ul>
<!--chapter:end:classification.Rmd-->
</div>
</div>
<div id="part-multivariate-analysis" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART) Multivariate Analysis<a href="#part-multivariate-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="mv-intro" class="section level1 hasAnchor" number="13">
<h1 class="hasAnchor"><span class="header-section-number">13</span> Introduction<a href="#mv-intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>There is an important distinction between <em>multivariable</em> and <em>multivariate</em> models.</p>
<ul>
<li><em>multivariable</em> : Multiple predictor variables (<span class="math inline">\(\mathbf{x}\)</span>).</li>
<li><em>multivariate</em>: Multiple response variables (<span class="math inline">\(\mathbf{Y}\)</span>).</li>
</ul>
<p>Often analysts will misuse <em>multivariate</em> when they really mean <em>multivariable</em>.</p>
<p>Multivariate techniques are</p>
<ul>
<li>Primarily used as an exploratory technique</li>
<li>Restructure interrelated variables</li>
<li>Simplify description</li>
<li>Reduce dimensionality</li>
<li>Avoid multicollinearity problems in regression</li>
</ul>
<p>We will discuss two different, but related techniques: Principal Component Analysis and Factor Analysis.</p>
<!--chapter:end:multivariate_intro.Rmd-->
</div>
<div id="fa" class="section level1 hasAnchor" number="14">
<h1 class="hasAnchor"><span class="header-section-number">14</span> Factor Analysis<a href="#fa" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Observed events tend to co-occur for a reason. Consider physical symptoms such as a fever, cough, sore through etc. These are often observed characteristics of an underlying event such as a viral infection. Now, not all individuals express the same symptoms, or event the same severity of symptoms, but we would say that there is a strong correlation between symptoms and underlying disease.</p>
<p>Factor analysis aims to understand the patterns of correlations between the underlying disease, and observed symptoms.</p>
<div id="introduction" class="section level2 hasAnchor" number="14.1">
<h2 class="hasAnchor"><span class="header-section-number">14.1</span> Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This intro comes from <a href="https://assessingpsyche.wordpress.com/2014/01/13/a-gentle-non-technical-introduction-to-factor-analysis/">A gentle non-technical introduction to factor analysis</a></p>
<p>No attempt will be made to present a comprehensive treatment of this subject. For more detail see the references mentioned in PMA6 Chapter 15.2 and the links in the <a href="#help">Additional Resources</a> section for more information.</p>
<div id="latent-constructs" class="section level3 hasAnchor" number="14.1.1">
<h3 class="hasAnchor"><span class="header-section-number">14.1.1</span> Latent Constructs<a href="#latent-constructs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Latent variables are ones that cannot be measured directly; e.g. Depression, Anxiety, Mathematical ability. They drive how we would respond to various tasks and questions that <em>can</em> be measured; vocabulary, arithmetic, statistical reasoning.</p>
<p>Factor Analysis aims to</p>
<ul>
<li>Generalize of principal components analysis</li>
<li>Explain interrelationships among a set of variables</li>
<li>Where we select a small number of factors to convey essential information</li>
<li>Can perform additional analyses to improve interpretation</li>
</ul>
</div>
<div id="comparison-with-pca" class="section level3 hasAnchor" number="14.1.2">
<h3 class="hasAnchor"><span class="header-section-number">14.1.2</span> Comparison with PCA<a href="#comparison-with-pca" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Similar in that no dependent variable</li>
<li>PCA:
<ul>
<li>Select a number of components that explain as much of the total variance as possible.</li>
</ul></li>
<li>FA: Factors selected mainly to explain the interrelationships among the original variables.
<ul>
<li>Ideally, the number of factors expected is known in advance.</li>
<li>Major emphasis is placed on obtaining easily understandable factors that convey the
essential information contained in the original set of variables.</li>
</ul></li>
</ul>
<div class="figure">
<img src="images/fa_vs_pca_concept.png" alt="" />
<p class="caption"><a href="https://www.researchgate.net/figure/Conceptual-distinction-between-factor-analysis-and-principal-component-analysis-ote-An_fig1_47386956" class="uri">https://www.researchgate.net/figure/Conceptual-distinction-between-factor-analysis-and-principal-component-analysis-ote-An_fig1_47386956</a></p>
</div>
<ul>
<li>Mirror image of PCA
<ul>
<li>Each PC is expressed as a linear combination of X’s</li>
<li>Each <span class="math inline">\(X\)</span> is expressed as a linear combination of Factors</li>
</ul></li>
</ul>
</div>
<div id="efa-vs-cfa" class="section level3 hasAnchor" number="14.1.3">
<h3 class="hasAnchor"><span class="header-section-number">14.1.3</span> EFA vs CFA<a href="#efa-vs-cfa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Exploratory Factor Analysis</strong></p>
<ul>
<li>Explore the possible underlying factor structure of a set of observed variables</li>
<li>Does not impose a preconceived structure on the outcome.</li>
</ul>
<p><strong>Confirmatory Factor Analysis</strong></p>
<ul>
<li>Verifies the theoretical factor structure of a set of observed variables</li>
<li>Test the relationship between observed variables and theoretical underlying latent constructs</li>
<li>Variable groupings are determined ahead of time.</li>
</ul>
</div>
</div>
<div id="factor-model" class="section level2 hasAnchor" number="14.2">
<h2 class="hasAnchor"><span class="header-section-number">14.2</span> Factor Model<a href="#factor-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Start with P <strong>standardized</strong> variables. That is <span class="math inline">\(\frac{(x_{i}-\bar{x})}{s_{i}}\)</span>.
<ul>
<li>So for the rest of these FA notes, understand that each <span class="math inline">\(X\)</span> written has already been standardized.</li>
</ul></li>
<li>Express each variable as (its own) linear combination of <span class="math inline">\(m\)</span> common factors plus a unique factor <span class="math inline">\(e\)</span>.</li>
</ul>
<p><span class="math display">\[
X_{1} = l_{11}F_{1} + l_{12}F_{2} + \ldots + l_{1m}F_{m} + e_{1} \\
X_{2} = l_{21}F_{1} + l_{22}F_{2} + \ldots + l_{2m}F_{m} + e_{1} \\
\vdots  \\
X_{P} = l_{P1}F_{1} + l_{P2}F_{2} + \ldots + l_{Pm}F_{m} + e_{P}
\]</span></p>
<ul>
<li><span class="math inline">\(m\)</span> is the number of common factors, typicall <span class="math inline">\(m &lt;&lt; P\)</span>. Somemtimes, <span class="math inline">\(m\)</span> is known in advance.</li>
<li><span class="math inline">\(X_{i} = \sum l_{ij} F_{j}+ \epsilon_{i}\)</span></li>
<li><span class="math inline">\(F_{j}\)</span> = common or latent factors.
<ul>
<li>They are uncorreclated and each having mean 0 and variance 1</li>
</ul></li>
<li><span class="math inline">\(l_{ij}\)</span> = coefficients of common factors = factor loadings</li>
<li><span class="math inline">\(e_{i}\)</span> = unique factors relating to one of the original variables.
<ul>
<li><span class="math inline">\(e_{i}\)</span>’s and <span class="math inline">\(F_{j}\)</span>’s are uncorrelated</li>
</ul></li>
</ul>
<div id="components-of-variance" class="section level3 hasAnchor" number="14.2.1">
<h3 class="hasAnchor"><span class="header-section-number">14.2.1</span> Components of Variance<a href="#components-of-variance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that <span class="math inline">\(x_{i}\)</span> is standardized, so <span class="math inline">\(Var(X)=1\)</span>.</p>
<p>Since each response variable <span class="math inline">\(x_{i}\)</span> is broken into two parts, so is the variance.</p>
<ul>
<li><strong>communality</strong>: part due to common factors. Denoted as <span class="math inline">\(h^{2}_{i}\)</span>.</li>
<li><strong>specificity</strong>: part due to a unique factor. Denoted as <span class="math inline">\(u^{2}_{i}\)</span>.</li>
</ul>
<p><span class="math display">\[    
V(X_{i}) = h^{2}_{i} + u^{2}_{i}
\]</span></p>

<div class="rmdnote">
<p>If the number <span class="math inline">\(m\)</span> of common factors is not known (EFA), it is recommended that you start with the default option available in the softare program. Often this is the number of factors with eigenvalues greater than 1.</p>
Since the results are highly dependent on <span class="math inline">\(m\)</span>, you should always try several factors to gain further insight into the data.
</div>
</div>
<div id="two-big-steps" class="section level3 hasAnchor" number="14.2.2">
<h3 class="hasAnchor"><span class="header-section-number">14.2.2</span> Two big steps<a href="#two-big-steps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>The first step is to numerical find estimates of the loadings <span class="math inline">\(l_{ij}\)</span>, and the communalities <span class="math inline">\(h^{2}_{i}\)</span>.
This process is called <em>initial factor extraction</em>. There are a number of methods to solve, we will explore three: principal components, iterated components, and maximum likelihood. The mathematical details of each are left in the textbook for interested readers.</p></li>
<li><p>The second step is to obtain a new set of factors, called <em>rotated factors</em> which is done to improve interpretation.</p></li>
</ol>
<p>We will first explore these steps using simulated data.</p>
</div>
</div>
<div id="fa-example" class="section level2 hasAnchor" number="14.3">
<h2 class="hasAnchor"><span class="header-section-number">14.3</span> Example data setup<a href="#fa-example" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generate 100 data points from the following multivariate normal distribution:</p>
<p><span class="math display">\[\mathbf{\mu} =
  \left(\begin{array}
  {r}
  0.163 \\
  0.142 \\
  0.098 \\
  -0.039 \\
  -0.013
  \end{array}\right),
  \mathbf{\Sigma} =
  \left(\begin{array}
  {cc}
  1     &amp;       &amp;   &amp;   &amp;     &amp;  \\
  0.757 &amp; 1     &amp;   &amp;   &amp;     &amp;  \\
  0.047 &amp; 0.054 &amp; 1 &amp;   &amp;     &amp;  \\
  0.155 &amp; 0.176 &amp; 0.531 &amp; 1   &amp;  \\
  0.279 &amp; 0.322 &amp; 0.521 &amp; 0.942 &amp; 1
  \end{array}\right)
\]</span>.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.163</span>, <span class="fl">0.142</span>, <span class="fl">0.098</span>, <span class="sc">-</span><span class="fl">0.039</span>, <span class="sc">-</span><span class="fl">0.013</span>)</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">1.000</span>, <span class="fl">0.757</span>, <span class="fl">0.047</span>, <span class="fl">0.155</span>, <span class="fl">0.279</span>, </span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.757</span>, <span class="fl">1.000</span>, <span class="fl">0.054</span>, <span class="fl">0.176</span>, <span class="fl">0.322</span>, </span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.047</span>, <span class="fl">0.054</span>, <span class="fl">1.000</span>, <span class="fl">0.531</span>, <span class="fl">0.521</span>, </span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.155</span>, <span class="fl">0.176</span>, <span class="fl">0.531</span>, <span class="fl">1.000</span>, <span class="fl">0.942</span>, </span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>              <span class="fl">0.279</span>, <span class="fl">0.322</span>, <span class="fl">0.521</span>, <span class="fl">0.942</span>, <span class="fl">1.000</span>), </span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow=</span><span class="dv">5</span>)</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">mu=</span>m, <span class="at">Sigma=</span>s))</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<p>Standardize the <span class="math inline">\(X\)</span>’s.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>stan.dta <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(data))</span></code></pre></div>
<p>The hypothetical data model is that these 5 variables are generated from 2 underlying factors.</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}
X_{1} &amp;=  (1)*F_{1} +    (0)*F_{2} + e_{1} \\
X_{2} &amp;=  (1)*F_{1} +    (0)*F_{2} + e_{2} \\
X_{3} &amp;=  (0)*F_{1} +   (.5)*F_{2} + e_{3} \\
X_{4} &amp;=  (0)*F_{1} + (1.5)*F_{2} + e_{4} \\
X_{5} &amp;=  (0)*F_{1} +    (2)*F_{2} + e_{5} \\
\end{aligned}
\end{equation}
\]</span></p>
<p><strong>Implications</strong></p>
<ul>
<li><span class="math inline">\(F_{1}, F_{2}\)</span> and all <span class="math inline">\(e_{i}\)</span>’s are independent normal variables</li>
<li>The first two <span class="math inline">\(X\)</span>’s are inter-correlated, and the last 3 <span class="math inline">\(X\)</span>’s are inter-correlated</li>
<li>The first 2 <span class="math inline">\(X\)</span>’s are NOT correlated with the last 3 <span class="math inline">\(X\)</span>’s</li>
</ul>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(corrplot)</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">cor</span>(stan.dta), <span class="at">tl.col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="FA_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="fa-extract" class="section level2 hasAnchor" number="14.4">
<h2 class="hasAnchor"><span class="header-section-number">14.4</span> Factor Extraction Methods<a href="#fa-extract" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Methods</p>
<ol style="list-style-type: decimal">
<li>Principal Components</li>
<li>Iterated Components</li>
<li>Maximum Likelihood</li>
</ol>
<div id="principal-components-pc-factor-model" class="section level3 hasAnchor" number="14.4.1">
<h3 class="hasAnchor"><span class="header-section-number">14.4.1</span> Principal components (PC Factor model)<a href="#principal-components-pc-factor-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that <span class="math inline">\(\mathbf{C} = \mathbf{A}\mathbf{X}\)</span>, C’s are a function of X</p>
<p><span class="math display">\[ C_{1} = a_{11}X_{1} + a_{12}X_{2} + \ldots + a_{1P}X_{p} \]</span></p>
<p>We want the reverse: X’s are a function of F’s.</p>
<ul>
<li>Use the inverse! –&gt; If <span class="math inline">\(c = 5x\)</span> then <span class="math inline">\(x = 5^{-1}C\)</span></li>
</ul>
<p>The inverse PC model is <span class="math inline">\(\mathbf{X} = \mathbf{A}^{-1}\mathbf{C}\)</span>.</p>
<p>Since <span class="math inline">\(\mathbf{A}\)</span> is orthogonal, <span class="math inline">\(\mathbf{A}^{-1} = \mathbf{A}^{T} = \mathbf{A}^{&#39;}\)</span>, so</p>
<p><span class="math display">\[ X_{1} = a_{11}C_{1} + a_{21}C_{2} + \ldots + a_{P1}C_{p} \]</span></p>
<p>But there are more PC’s than Factors…</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}
X_{i} &amp;=  \sum_{j=1}^{P}a_{ji}C_{j} \\
&amp;= \sum_{j=1}^{m}a_{ji}C_{j} + \sum_{j=m+1}^{m}a_{ji}C_{j} \\
&amp;= \sum_{j=1}^{m}l_{ji}F_{j} + e_{i} \\
\end{aligned}
\end{equation}
\]</span></p>
<p><strong>Adjustment</strong></p>
<ul>
<li><span class="math inline">\(V(C_{j}) = \lambda_{j}\)</span> not 1</li>
<li>We transform: <span class="math inline">\(F_{j} = C_{j}\lambda_{j}^{-1/2}\)</span></li>
<li>Now <span class="math inline">\(V(F_{j}) = 1\)</span></li>
<li>Loadings: <span class="math inline">\(l_{ij} = \lambda_{j}^{1/2}a_{ji}\)</span></li>
</ul>

<div class="rmdnote">
<span class="math inline">\(l_{ij}\)</span> is the correlation coefficient between variable <span class="math inline">\(i\)</span> and factor <span class="math inline">\(j\)</span>
</div>
<p>This is similar to <span class="math inline">\(a_{ij}\)</span> in PCA.</p>
<div id="r-code" class="section level4 hasAnchor" number="14.4.1.1">
<h4 class="hasAnchor"><span class="header-section-number">14.4.1.1</span> R code<a href="#r-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Factor extraction via principal components can be done using the <code>principal</code> function in the <code>psych</code> package. We choose <code>nfactors=2</code> here because we know there are 2 underlying factors in the data generation model.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(psych)</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>pc.extract.norotate <span class="ot">&lt;-</span> <span class="fu">principal</span>(stan.dta, <span class="at">nfactors=</span><span class="dv">2</span>, <span class="at">rotate=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pc.extract.norotate)</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Principal Components Analysis</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Call: principal(r = stan.dta, nfactors = 2, rotate = &quot;none&quot;)</span></span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Standardized loadings (pattern matrix) based upon correlation matrix</span></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     PC1   PC2   h2    u2 com</span></span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a><span class="do">## X1 0.53  0.78 0.90 0.104 1.8</span></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="do">## X2 0.59  0.74 0.89 0.106 1.9</span></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a><span class="do">## X3 0.70 -0.39 0.64 0.360 1.6</span></span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="do">## X4 0.87 -0.38 0.90 0.099 1.4</span></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a><span class="do">## X5 0.92 -0.27 0.91 0.087 1.2</span></span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                        PC1  PC2</span></span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a><span class="do">## SS loadings           2.71 1.53</span></span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportion Var        0.54 0.31</span></span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Cumulative Var        0.54 0.85</span></span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportion Explained  0.64 0.36</span></span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Cumulative Proportion 0.64 1.00</span></span>
<span id="cb245-20"><a href="#cb245-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb245-21"><a href="#cb245-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Mean item complexity =  1.6</span></span>
<span id="cb245-22"><a href="#cb245-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Test of the hypothesis that 2 components are sufficient.</span></span>
<span id="cb245-23"><a href="#cb245-23" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb245-24"><a href="#cb245-24" aria-hidden="true" tabindex="-1"></a><span class="do">## The root mean square of the residuals (RMSR) is  0.08 </span></span>
<span id="cb245-25"><a href="#cb245-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  with the empirical chi square  12.61  with prob &lt;  0.00038 </span></span>
<span id="cb245-26"><a href="#cb245-26" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb245-27"><a href="#cb245-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit based upon off diagonal values = 0.97</span></span></code></pre></div>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}
X_{1} &amp;=  0.53F_{1} + 0.78F_{2} + e_{1} \\
X_{2} &amp;=  0.59F_{1} + 0.74F_{2} + e_{2} \\
X_{3} &amp;=  0.70F_{1} - 0.39F_{2} + e_{3} \\
X_{4} &amp;=  0.87F_{1} - 0.38F_{2} + e_{4} \\
X_{5} &amp;=  0.92F_{1} - 0.27F_{2} + e_{5} \\
\end{aligned}
\end{equation}
\]</span></p>
<p>These equations come from the top of the output, under <em>Standardized loadings</em>.</p>
</div>
</div>
<div id="iterated-components" class="section level3 hasAnchor" number="14.4.2">
<h3 class="hasAnchor"><span class="header-section-number">14.4.2</span> Iterated components<a href="#iterated-components" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Select common factors to maximize the total communality</p>
<ol style="list-style-type: decimal">
<li>Get initial communality estimates</li>
<li>Use these (instead of original variances) to get the PC’s and factor loadings</li>
<li>Get new communality estimates</li>
<li>Rinse and repeat</li>
<li>Stop when no appreciable changes occur.</li>
</ol>
<p>R code not shown, but can be obtained using the <code>factanal</code> package in R.</p>
</div>
<div id="maximum-likelihood" class="section level3 hasAnchor" number="14.4.3">
<h3 class="hasAnchor"><span class="header-section-number">14.4.3</span> Maximum Likelihood<a href="#maximum-likelihood" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Assume that all the variables are normally distributed</li>
<li>Use Maximum Likelihood to estimate the parameters</li>
</ul>
<div id="r-code-1" class="section level4 hasAnchor" number="14.4.3.1">
<h4 class="hasAnchor"><span class="header-section-number">14.4.3.1</span> R code<a href="#r-code-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>cutoff</code> argument hides loadings under that value for ease of interpretation. Here I am setting that cutoff at 0 so that all loadings are being displayed. I encourage you to adjust this cutoff value in practice to see how it can be useful in reducing cognitave load of looking through a grid of numbers.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>ml.extract.norotate <span class="ot">&lt;-</span> <span class="fu">factanal</span>(stan.dta, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml.extract.norotate, <span class="at">digits=</span><span class="dv">2</span>, <span class="at">cutoff=</span><span class="dv">0</span>)</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="do">## factanal(x = stan.dta, factors = 2, rotation = &quot;none&quot;)</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Uniquenesses:</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   X1   X2   X3   X4   X5 </span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.37 0.00 0.63 0.06 0.04 </span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Loadings:</span></span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    Factor1 Factor2</span></span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a><span class="do">## X1 -0.06    0.79  </span></span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a><span class="do">## X2 -0.07    1.00  </span></span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a><span class="do">## X3  0.58    0.19  </span></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a><span class="do">## X4  0.93    0.28  </span></span>
<span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a><span class="do">## X5  0.90    0.39  </span></span>
<span id="cb246-18"><a href="#cb246-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb246-19"><a href="#cb246-19" aria-hidden="true" tabindex="-1"></a><span class="do">##                Factor1 Factor2</span></span>
<span id="cb246-20"><a href="#cb246-20" aria-hidden="true" tabindex="-1"></a><span class="do">## SS loadings       2.02    1.88</span></span>
<span id="cb246-21"><a href="#cb246-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportion Var    0.40    0.38</span></span>
<span id="cb246-22"><a href="#cb246-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Cumulative Var    0.40    0.78</span></span>
<span id="cb246-23"><a href="#cb246-23" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb246-24"><a href="#cb246-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Test of the hypothesis that 2 factors are sufficient.</span></span>
<span id="cb246-25"><a href="#cb246-25" aria-hidden="true" tabindex="-1"></a><span class="do">## The chi square statistic is 0.2 on 1 degree of freedom.</span></span>
<span id="cb246-26"><a href="#cb246-26" aria-hidden="true" tabindex="-1"></a><span class="do">## The p-value is 0.652</span></span></code></pre></div>
<p>The factor equations now are:</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}
X_{1} &amp;=  -0.06F_{1} + 0.79F_{2} + e_{1} \\
X_{2} &amp;=  -0.07F_{1} + 1F_{2} + e_{2} \\
X_{3} &amp;=  0.58F_{1} + 0.19F_{2} + e_{3} \\
\vdots
\end{aligned}
\end{equation}
\]</span></p>
</div>
</div>
<div id="uniqueness" class="section level3 hasAnchor" number="14.4.4">
<h3 class="hasAnchor"><span class="header-section-number">14.4.4</span> Uniqueness<a href="#uniqueness" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall Factor analysis splits the variance of the observed X’s into a part due to the communality <span class="math inline">\(h_{i}^{2}\)</span> and specificity <span class="math inline">\(u_{i}^{2}\)</span>. This last term is the portion of the variance that is due to the <em>unique</em> factor. Let’s look at how those differ depending on the extraction method:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>pc.extract.norotate<span class="sc">$</span>uniquenesses</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="do">##         X1         X2         X3         X4         X5 </span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.10356406 0.10628541 0.35980869 0.09916082 0.08669813</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>ml.extract.norotate<span class="sc">$</span>uniquenesses</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="do">##         X1         X2         X3         X4         X5 </span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.37071467 0.00500000 0.62599425 0.06244190 0.03603453</span></span></code></pre></div>
<p>Here we see that the uniqueness for X2, X4 and X5 under ML is pretty low compared to the PC extraction method, but that’s almost offset by a much higher uniqueness for x1 and X3.</p>
<p>Ideally we want the variance in the X’s to be captured by the factors. So we want to see a low unique variance.</p>
</div>
<div id="resulting-factors" class="section level3 hasAnchor" number="14.4.5">
<h3 class="hasAnchor"><span class="header-section-number">14.4.5</span> Resulting factors<a href="#resulting-factors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co"># grid of 2 columns and 1 row</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>pc.load <span class="ot">&lt;-</span> pc.extract.norotate<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pc.load, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">main=</span><span class="st">&quot;PCA Extraction&quot;</span>) <span class="co"># set up the plot but don&#39;t put points down</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pc.load, <span class="at">labels=</span><span class="fu">rownames</span>(pc.load)) <span class="co"># put names instead of points</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>ml.load <span class="ot">&lt;-</span> ml.extract.norotate<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ml.load, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">main=</span><span class="st">&quot;ML Extraction&quot;</span>) </span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(ml.load, <span class="at">labels=</span><span class="fu">rownames</span>(ml.load))</span></code></pre></div>
<p><img src="FA_files/figure-html/unnamed-chunk-10-1.png" width="1152" /></p>
<p>PCA Extraction</p>
<ul>
<li>X1 and X2 load high on PC1, and low on PC1.</li>
<li>X3, 4 and 5 are negative on PC2, and moderate to high on PC1.</li>
<li>PC1 is not highly correlated with X3</li>
</ul>
<p>ML Extraction</p>
<ul>
<li>Same overall split, X3 still not loading high on Factor 1.</li>
<li>X1 loading lower on Factor 2 compared to PCA extraction method.</li>
</ul>
<blockquote>
<p>Neither extraction method reproduced our true hypothetical factor model. Rotating the factors will achieve our desired results.</p>
</blockquote>
</div>
</div>
<div id="rotating-factors" class="section level2 hasAnchor" number="14.5">
<h2 class="hasAnchor"><span class="header-section-number">14.5</span> Rotating Factors<a href="#rotating-factors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Find new factors that are easier to interpret</li>
<li>For each <span class="math inline">\(X\)</span>, we want some high/large (near 1) loadings and some low/small (near zero)</li>
<li>Two common rotation methods: Varimax rotation, and oblique rotation.</li>
</ul>
<p>Same(ish) goal as PCA, find a new set of axes to represent the factors.</p>
<div id="varimax-rotation" class="section level3 hasAnchor" number="14.5.1">
<h3 class="hasAnchor"><span class="header-section-number">14.5.1</span> Varimax Rotation<a href="#varimax-rotation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Restricts the new axes to be orthogonal to each other. (Factors are independent)</li>
<li>Maximizes the sum of the variances of the squared factor loadings within each factor <span class="math inline">\(\sum Var(l_{ij}^{2}|F_{j})\)</span></li>
<li>Interpretations slightly less clear</li>
</ul>
<p>Varimax rotation with principal components extraction.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>pc.extract.varimax <span class="ot">&lt;-</span> <span class="fu">principal</span>(stan.dta, <span class="at">nfactors=</span><span class="dv">2</span>, <span class="at">rotate=</span><span class="st">&quot;varimax&quot;</span>)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pc.extract.varimax)</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Principal Components Analysis</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call: principal(r = stan.dta, nfactors = 2, rotate = &quot;varimax&quot;)</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Standardized loadings (pattern matrix) based upon correlation matrix</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     RC1  RC2   h2    u2 com</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a><span class="do">## X1 0.07 0.94 0.90 0.104 1.0</span></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a><span class="do">## X2 0.13 0.94 0.89 0.106 1.0</span></span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a><span class="do">## X3 0.80 0.02 0.64 0.360 1.0</span></span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a><span class="do">## X4 0.94 0.11 0.90 0.099 1.0</span></span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a><span class="do">## X5 0.93 0.23 0.91 0.087 1.1</span></span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                        RC1  RC2</span></span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a><span class="do">## SS loadings           2.41 1.83</span></span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportion Var        0.48 0.37</span></span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Cumulative Var        0.48 0.85</span></span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportion Explained  0.57 0.43</span></span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Cumulative Proportion 0.57 1.00</span></span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb249-20"><a href="#cb249-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Mean item complexity =  1</span></span>
<span id="cb249-21"><a href="#cb249-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Test of the hypothesis that 2 components are sufficient.</span></span>
<span id="cb249-22"><a href="#cb249-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb249-23"><a href="#cb249-23" aria-hidden="true" tabindex="-1"></a><span class="do">## The root mean square of the residuals (RMSR) is  0.08 </span></span>
<span id="cb249-24"><a href="#cb249-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  with the empirical chi square  12.61  with prob &lt;  0.00038 </span></span>
<span id="cb249-25"><a href="#cb249-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb249-26"><a href="#cb249-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit based upon off diagonal values = 0.97</span></span></code></pre></div>
<p>Varimax rotation with maximum likelihood extraction. Here i’m using the cutoff argument to only show the values of loadings over 0.3.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>ml.extract.varimax <span class="ot">&lt;-</span> <span class="fu">factanal</span>(stan.dta, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">&quot;varimax&quot;</span>)</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml.extract.varimax, <span class="at">digits=</span><span class="dv">2</span>, <span class="at">cutoff=</span>.<span class="dv">3</span>)</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="do">## factanal(x = stan.dta, factors = 2, rotation = &quot;varimax&quot;)</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Uniquenesses:</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   X1   X2   X3   X4   X5 </span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.37 0.00 0.63 0.06 0.04 </span></span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Loadings:</span></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    Factor1 Factor2</span></span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a><span class="do">## X1         0.79   </span></span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a><span class="do">## X2         0.99   </span></span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a><span class="do">## X3 0.61           </span></span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a><span class="do">## X4 0.97           </span></span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a><span class="do">## X5 0.96           </span></span>
<span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a><span class="do">##                Factor1 Factor2</span></span>
<span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a><span class="do">## SS loadings       2.26    1.64</span></span>
<span id="cb250-21"><a href="#cb250-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportion Var    0.45    0.33</span></span>
<span id="cb250-22"><a href="#cb250-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Cumulative Var    0.45    0.78</span></span>
<span id="cb250-23"><a href="#cb250-23" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-24"><a href="#cb250-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Test of the hypothesis that 2 factors are sufficient.</span></span>
<span id="cb250-25"><a href="#cb250-25" aria-hidden="true" tabindex="-1"></a><span class="do">## The chi square statistic is 0.2 on 1 degree of freedom.</span></span>
<span id="cb250-26"><a href="#cb250-26" aria-hidden="true" tabindex="-1"></a><span class="do">## The p-value is 0.652</span></span></code></pre></div>
<p>Communalities are unchanged after varimax (part of variance due to common factors). This will always be the case for orthogonal (perpendicular) rotations.</p>
</div>
<div id="oblique-rotation" class="section level3 hasAnchor" number="14.5.2">
<h3 class="hasAnchor"><span class="header-section-number">14.5.2</span> Oblique rotation<a href="#oblique-rotation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Same idea as varimax, but drop the orthogonality requirement</li>
<li>less restrictions allow for greater flexibility</li>
<li>Factors are still correlated</li>
<li>Better interpretation</li>
<li>Methods:
<ul>
<li><em>quartimax</em> or <em>quartimin</em> minimizes the number of factors needed to explain each variable</li>
<li><em>direct oblimin</em> standard method, but results in diminished interpretability of factors</li>
<li><em>promax</em> is computationally faster than <em>direct oblimin</em>, so good for very large datasets</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>pc.extract.quartimin <span class="ot">&lt;-</span> <span class="fu">principal</span>(stan.dta, <span class="at">nfactors=</span><span class="dv">2</span>, <span class="at">rotate=</span><span class="st">&quot;quartimin&quot;</span>)</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>ml.extract.promax<span class="ot">&lt;-</span> <span class="fu">factanal</span>(stan.dta, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">&quot;promax&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pc.extract.norotate, <span class="at">title=</span><span class="st">&quot;PC + norotate&quot;</span>)</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pc.extract.varimax, <span class="at">title=</span><span class="st">&quot;PC + Varimax&quot;</span>)</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pc.extract.quartimin, <span class="at">title=</span><span class="st">&quot;PC + quartimin&quot;</span>)</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>load <span class="ot">&lt;-</span> ml.extract.norotate<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(load, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">main=</span><span class="st">&quot;ML + norotate&quot;</span>)</span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(load, <span class="at">labels=</span><span class="fu">rownames</span>(load))</span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a>load <span class="ot">&lt;-</span> ml.extract.varimax<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(load, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">main=</span><span class="st">&quot;ML + Varimax&quot;</span>) </span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(load, <span class="at">labels=</span><span class="fu">rownames</span>(load)) </span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a>load <span class="ot">&lt;-</span> ml.extract.promax<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(load, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">main=</span> <span class="st">&quot;ML + Promax&quot;</span>) </span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(load, <span class="at">labels=</span><span class="fu">rownames</span>(load)) </span></code></pre></div>
<p><img src="FA_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Varimax vs oblique here doesn’t make much of a difference, and typically this is the case. You almost always use some sort of rotation. Recall, this is a hypothetical example and we set up the variables in a distinct two-factor model. So this example will look nice.</p>
</div>
</div>
<div id="factor-scores" class="section level2 hasAnchor" number="14.6">
<h2 class="hasAnchor"><span class="header-section-number">14.6</span> Factor Scores<a href="#factor-scores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We could obtain Factor scores for an individual based on only the X’s that highly load on that factor Essentially here, FA would identify subgroups of correlated variables.</p>
<p>In our hypothetical example where after rotation x1 and x2 loaded highly on factor 2, and x3-5 loaded highly on factor 1, we could calculate factor scores as</p>
<ul>
<li>factor score 2 for person <span class="math inline">\(i\)</span> = <span class="math inline">\(x_{i1} + x_{i2}\)</span></li>
<li>factor score 3 for person <span class="math inline">\(i\)</span> = <span class="math inline">\(x_{i3} + x_{i4} + x_{i5}\)</span></li>
</ul>
<p>In some simple applications, this approach may be sufficient.</p>
<p>More commonly, we will use a <strong>regression procedure</strong> to compute factor scores. This method accounts for the correlation between the <span class="math inline">\(x_{i}\)</span>’s and uses the factor loadings <span class="math inline">\(l_{ij}\)</span> to calculate the factor scores.</p>
<ul>
<li>Can be used as dependent or independent variables in other analyses</li>
<li>Can be generated by adding the <code>scores="regression"</code> option to <code>factanal()</code>, or <code>scores=TRUE</code> in <code>principal()</code></li>
<li>Each record in the data set <em>with no missing data</em> will have a corresponding factor score.
<ul>
<li><code>principal()</code> also has a <code>missing</code> argument that if set to <code>TRUE</code> it will
impute missing values.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>fa.ml.varimax <span class="ot">&lt;-</span> <span class="fu">factanal</span>(stan.dta, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">&quot;varimax&quot;</span>, <span class="at">scores=</span><span class="st">&quot;regression&quot;</span>)</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fa.ml.varimax<span class="sc">$</span>scores)</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     Factor1            Factor2        </span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  Min.   :-2.32732   Min.   :-2.79312  </span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1st Qu.:-0.72413   1st Qu.:-0.54362  </span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  Median : 0.09196   Median :-0.02376  </span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  Mean   : 0.00000   Mean   : 0.00000  </span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3rd Qu.: 0.70603   3rd Qu.: 0.65339  </span></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Max.   : 2.43371   Max.   : 2.18992</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fa.ml.varimax<span class="sc">$</span>scores)</span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a><span class="do">##          Factor1      Factor2</span></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -1.49174313  0.003612941</span></span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] -0.26254721  1.090864733</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]  0.55516045  0.631119886</span></span>
<span id="cb253-15"><a href="#cb253-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,] -1.21028676 -1.281240452</span></span>
<span id="cb253-16"><a href="#cb253-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [5,] -0.04852211 -1.575691468</span></span>
<span id="cb253-17"><a href="#cb253-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [6,] -0.53768770  0.661138335</span></span></code></pre></div>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(ggforitfy)</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fa.ml.varimax) <span class="co"># see vignette for more info. Link at bottom</span></span></code></pre></div>
<p><img src="FA_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>To merge these scores back onto the original data set <strong>providing there is no missing data</strong> you can use the <code>bind_cols()</code> function in <code>dplyr</code>.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>data.withscores <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(data, <span class="fu">data.frame</span>(fa.ml.varimax<span class="sc">$</span>scores))</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(data.withscores))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
X1
</th>
<th style="text-align:right;">
X2
</th>
<th style="text-align:right;">
X3
</th>
<th style="text-align:right;">
X4
</th>
<th style="text-align:right;">
X5
</th>
<th style="text-align:right;">
Factor1
</th>
<th style="text-align:right;">
Factor2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0.8236763
</td>
<td style="text-align:right;">
-0.1210726
</td>
<td style="text-align:right;">
-0.5970760
</td>
<td style="text-align:right;">
-1.4752693
</td>
<td style="text-align:right;">
-1.2355056
</td>
<td style="text-align:right;">
-1.4917431
</td>
<td style="text-align:right;">
0.0036129
</td>
</tr>
<tr>
<td style="text-align:right;">
1.4013214
</td>
<td style="text-align:right;">
1.0733569
</td>
<td style="text-align:right;">
0.7681035
</td>
<td style="text-align:right;">
-0.0509857
</td>
<td style="text-align:right;">
0.0180061
</td>
<td style="text-align:right;">
-0.2625472
</td>
<td style="text-align:right;">
1.0908647
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2781468
</td>
<td style="text-align:right;">
0.7574632
</td>
<td style="text-align:right;">
0.6445954
</td>
<td style="text-align:right;">
0.6765583
</td>
<td style="text-align:right;">
0.7532815
</td>
<td style="text-align:right;">
0.5551604
</td>
<td style="text-align:right;">
0.6311199
</td>
</tr>
<tr>
<td style="text-align:right;">
0.1819544
</td>
<td style="text-align:right;">
-1.3228227
</td>
<td style="text-align:right;">
-1.0847105
</td>
<td style="text-align:right;">
-0.9574722
</td>
<td style="text-align:right;">
-1.3719843
</td>
<td style="text-align:right;">
-1.2102868
</td>
<td style="text-align:right;">
-1.2812405
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.6147171
</td>
<td style="text-align:right;">
-1.4254411
</td>
<td style="text-align:right;">
0.3519605
</td>
<td style="text-align:right;">
-0.0124497
</td>
<td style="text-align:right;">
-0.2523487
</td>
<td style="text-align:right;">
-0.0485221
</td>
<td style="text-align:right;">
-1.5756915
</td>
</tr>
<tr>
<td style="text-align:right;">
0.8251470
</td>
<td style="text-align:right;">
0.6245702
</td>
<td style="text-align:right;">
-1.2923348
</td>
<td style="text-align:right;">
-0.6345633
</td>
<td style="text-align:right;">
-0.0885945
</td>
<td style="text-align:right;">
-0.5376877
</td>
<td style="text-align:right;">
0.6611383
</td>
</tr>
</tbody>
</table>
</div>
<div id="what-to-watch-out-for-2" class="section level2 hasAnchor" number="14.7">
<h2 class="hasAnchor"><span class="header-section-number">14.7</span> What to watch out for<a href="#what-to-watch-out-for-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Number of factors should be chosen with care. Check default options.</li>
<li>There should be at least two variables with non-zero weights per factor</li>
<li>If the factors are to be correlated, try oblique factor analysis</li>
<li>Results usually are evaluated by reasonableness to investigator rather than by formal tests</li>
<li>Motivate theory, not replace it.</li>
<li>Missing data - factors will only be created using available data.</li>
</ul>
</div>
<div id="help" class="section level2 hasAnchor" number="14.8">
<h2 class="hasAnchor"><span class="header-section-number">14.8</span> Additional Resources<a href="#help" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="https://assessingpsyche.wordpress.com/2014/01/13/a-gentle-non-technical-introduction-to-factor-analysis/">A gentle non-technical introduction to factor analysis</a></li>
<li>Tutorial by a Psych 253 student at Stanford <a href="https://web.stanford.edu/class/psych253/tutorials/FactorAnalysis.html" class="uri">https://web.stanford.edu/class/psych253/tutorials/FactorAnalysis.html</a></li>
<li><code>ggfortify</code> vignette for the <code>autoplot()</code> function <a href="https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_pca.html" class="uri">https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_pca.html</a></li>
</ul>
<p>The <code>FactomineR</code> looks promising, it has some helpful graphics for determining/confirming variable groupings and aiding interpretations.</p>
<ul>
<li>FactominR: <a href="http://factominer.free.fr/" class="uri">http://factominer.free.fr/</a></li>
<li>STHDA tutorial using FactominR <a href="http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/116-mfa-multiple-factor-analysis-in-r-essentials/" class="uri">http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/116-mfa-multiple-factor-analysis-in-r-essentials/</a></li>
</ul>
<!--chapter:end:FA.Rmd-->
</div>
</div>
<div id="part-multi-level-modeling" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART) Multi-level Modeling<a href="#part-multi-level-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="introduction-1" class="section level1 hasAnchor" number="15">
<h1 class="hasAnchor"><span class="header-section-number">15</span> Introduction<a href="#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>When outcome data are expected to be more similar within subgroups than across subgroups the data are typically called <strong>Clustered outcomes</strong>. There are many ways data can be correlated:</p>
<ul>
<li>Sampling students within schools. (Within school correlation)</li>
<li>Repeatedly measuring the same tree in different places. (Within-subject correlation)</li>
<li>Repeatedly measuring the same tree over time. (Temporal correlation)</li>
<li>Poverty measurements from different, but neighboring, counties. (Spatial correlation)</li>
</ul>
<p>In these cases, the assumption of independence between observations is often violated <span class="math inline">\(Cor(\epsilon_i, \epsilon_j)\neq 0, \forall i\neq j\)</span>.</p>
<p>Analyses should take into account such correlation or else conclusions might not be valid.</p>
<p>Correlation is not limited to one level of subgroup; i.e. repeated measurements on students within schools.</p>
<p>Models that account for multiple levels of clustering are often called multi-level models.</p>

<div class="rmdnote">
Multi-level modeling can also be referred to as Hierarchical modeling
</div>
<p><span style="color:blue">Terminology: Fixed Effects vs Random Effects</span></p>
<ul>
<li><strong>Fixed Effects</strong>: The variable is thought to have it’s own specific effect on the outcome relative to some reference group. The factors are fixed by nature, there are only the levels observed in the data.
<ul>
<li>The 23 schools in the data make up the entire universe of schools, and we are interested in how one particular school fares.</li>
</ul></li>
<li><strong>Random Effects</strong>: The variable was chosen at random, and the levels observed in the data are thought of as representative of all possible levels that could be sampled. We are interested in the distribution of the effects rather than the effect of any one specific level.
<ul>
<li>The 23 schools in the data set is a sample of a larger population of schools and we are interested in the overall distribution of how school can affect the math score, not any one specific school.</li>
</ul></li>
</ul>
<div id="example-school-data" class="section level2 hasAnchor" number="15.1">
<h2 class="hasAnchor"><span class="header-section-number">15.1</span> Example School Data<a href="#example-school-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The data used in this first example comes from a publicly available data set called the National Education Longitudinal Study of 1988 (yes it’s a bit old data, but sufficient for our purposes here). In this data set math scores are recorded for 519 students from 23 schools.</p>
<p><img src="images/q.png" /> List a few characteristics that you think are associated with math performance, and at what level they are measured.</p>
<p><img src="images/multilevel.PNG" /></p>
<p>The <code>School23</code> data set contains the following variables:</p>
<ul>
<li><strong>School (macro) level variables</strong>
<ul>
<li>School type</li>
<li>class structure</li>
<li>school size</li>
<li>urbanity</li>
<li>geographic region</li>
<li>percent minority</li>
<li>student-teacher ratio</li>
</ul></li>
<li><strong>Student (micro) level variables</strong>
<ul>
<li>Gender</li>
<li>Race</li>
<li>Time spent on math homework</li>
<li>SES</li>
<li>parental education</li>
<li>math score</li>
</ul></li>
</ul>
<p>Imagine a model of math score based on school type (<span class="math inline">\(X_{1}\)</span> 1 for public, 0 for private) and SES (<span class="math inline">\(X_{2}\)</span>).</p>
<p><span class="math display">\[
Y_{i} = \beta_{0} + \beta_{1}X_{1i} + \beta_{2}X_{2i} + \epsilon_{i}, \qquad i = 1, \ldots, n=519
\]</span></p>
<p>This model does not take into the account the hierarchical nature of the data in that students are nested within schools. School type is a macro level variable, SES is a micro level variable. We could consider adding indicator variables for each of the 23 schools to create a <strong>Fixed Effects</strong> model,</p>
<p><span class="math display">\[
Y_{i} = \beta_{0} + \beta_{1}(SchoolType)_{1i} + \beta_{2}(SES)_{2i} + \beta_{3}(School2)_{i} + \ldots + \beta_{24}(School23)_{i} + \epsilon_{i}
\]</span></p>
<p>but we already are well aware of fitting models with that many parameters, and when some school only have a few students in them. So we need a different model.</p>
</div>
<div id="multi-level-models" class="section level2 hasAnchor" number="15.2">
<h2 class="hasAnchor"><span class="header-section-number">15.2</span> Multi-level models<a href="#multi-level-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we specify separate models for the the fixed micro level effect of SES and the random macro level school effect.</p>
<p><span class="math display">\[\begin{equation*}
  \begin{aligned}
  MathScore_{ij} &amp; = \beta_{0j} + \beta_{1}SES_{ij} + \epsilon_{ij}, &amp; \qquad i = 1, \ldots, n_{j}\\
  \beta_{0j} &amp; = \gamma_{00} + U_{0j}, &amp; \qquad j=1, \ldots, 23
  \end{aligned}
\end{equation*}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\gamma_{00}\)</span> is the average intercept across all schools</li>
<li><span class="math inline">\(U_{0j}\)</span> is the difference between the intercept for school <span class="math inline">\(j\)</span> and the average intercept across all schools (random effect of school)</li>
</ul>
<p>If we substitute the intercept <span class="math inline">\(\beta_{0j}\)</span> in the first model with the information from the second model,</p>
<p><span class="math display">\[
  MathScore_{ij} = \overbrace{\gamma_{00} + \beta_{1}SES_{ij}}^{^{\mbox{fixed part}}} + \overbrace{U_{0j} + \epsilon_{ij}}^{\mbox{random part}}
\]</span></p>
<p>Instead of assuming that there is an overall average of math scores (<span class="math inline">\(\beta_0\)</span>) from which each school deviates by a fixed amount, the above model assumes that the adjusted average school math scores are normally distributed and are centered at <span class="math inline">\(\gamma_{00}\)</span>.</p>
<p>Because we assume that there is a <em>distribution of intercepts</em>, this model is also called a <strong>Random intercept model</strong>.</p>
<p>We’ll look at this type of model more closely in the next section using a different example, and using the concept of <em>pooling</em> information.</p>
<p><img src="images/q.png" /> Random Slopes</p>
<p>More complex models are possible. That’s a constant theme in all of statistical modeling. Just remember that</p>
<ul>
<li>the underlying complex effects being modeled must be strong enough that a simpler model that doesn’t account for these effects will be invalid</li>
<li>you have to have enough data to estimate any additional parameters</li>
<li>you have to be able to explain the model and results to an audience</li>
</ul>
<p>We are not going to cover models that have random slopes, or interactions between fixed and random effects in this notebook.</p>
<!--chapter:end:MLM_intro.Rmd-->
</div>
</div>
<div id="RI" class="section level1 hasAnchor" number="16">
<h1 class="hasAnchor"><span class="header-section-number">16</span> Random Intercept Models<a href="#RI" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><span style="color:blue"><strong>Example Data</strong></span></p>
<p>Radon is a radioactive gas that naturally occurs in soils around the U.S. As radon decays it releases other radioactive elements, which stick to, among other things, dust particles commonly found in homes. The EPA believes <a href="https://www.epa.gov/radon">radon exposure</a> is one of the leading causes of cancer in the United States.</p>
<p>This example uses a dataset named <code>radon</code> from the <code>rstanarm</code> package. The dataset contains <span class="math inline">\(N=919\)</span> observations, each measurement taken within a home that is located within one of the <span class="math inline">\(J=85\)</span> sampled counties in Minnesota. The first six rows of the dataframe show us that the county Aitkin has variable levels of <span class="math inline">\(log(radon)\)</span>. Our goal is to build a model to predict <span class="math inline">\(log(radon)\)</span>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(radon, <span class="at">package=</span><span class="st">&quot;rstanarm&quot;</span>)</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(radon)</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   floor county  log_radon log_uranium</span></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1     1 AITKIN 0.83290912  -0.6890476</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2     0 AITKIN 0.83290912  -0.6890476</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3     0 AITKIN 1.09861229  -0.6890476</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4     0 AITKIN 0.09531018  -0.6890476</span></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5     0  ANOKA 1.16315081  -0.8473129</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6     0  ANOKA 0.95551145  -0.8473129</span></span></code></pre></div>
<div id="pooling" class="section level2 hasAnchor" number="16.1">
<h2 class="hasAnchor"><span class="header-section-number">16.1</span> Pooling<a href="#pooling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To highlight the benefits of random intercepts models we will compare three linear regression models:</p>
<ul>
<li>complete pooling</li>
<li>no pooling</li>
<li>partial pooling (the random intercept model)</li>
</ul>
<p><strong>Complete Pooling</strong></p>
<p>The complete pooling model pools all counties together to give one single estimate of the <span class="math inline">\(log(radon)\)</span> level.</p>
<p><strong>No Pooling</strong></p>
<p>No pooling refers to the fact that no information is shared among the counties. Each county is independent of the next.</p>
<p><strong>Partial Pooling</strong></p>
<p>The partial pooling model, partially shares information among the counties.</p>
<p>Each county should get a <em>unique intercept</em> such that the collection of county intercepts are randomly sampled from a normal distribution with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma^2_{\alpha}\)</span>.</p>
<p>Because all county intercepts are randomly sampled from the same theoretical population, <span class="math inline">\(N(0, \sigma^2_{\alpha})\)</span>, information is shared among the counties. This sharing of information is generally referred to as <strong>shrinkage</strong>, and should be thought of as a means to reduce variation in estimates among the counties. When a county has little information to offer, it’s estimated intercept will be shrunk towards to overall mean of all counties.</p>
<p>The plot below displays the overall mean as the complete pooling estimate (solid, horizontal line), the no pooling and partial pooling estimates for 8 randomly selected counties contained in the radon data. The amount of shrinkage from the partial pooling fit is determined by a data dependent compromise between the county level sample size, the variation among the counties, and the variation within the counties.</p>
<p><img src="random_intercept_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Generally, we can see that counties with smaller sample sizes are shrunk more towards the overall mean, while counties with larger sample sizes are shrunk less.</p>

<div class="rmdcaution">
<p>The fitted values corresponding to different observations within each county of the no-pooling model are jittered to help the eye determine approximate sample size within each county.</p>
Estimates of variation within each county should not be determined from this arbitrary jittering of points.
</div>
</div>
<div id="mathri" class="section level2 hasAnchor" number="16.2">
<h2 class="hasAnchor"><span class="header-section-number">16.2</span> Mathematical Models<a href="#mathri" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The three models considered set <span class="math inline">\(y_n=log(radon)\)</span>, and <span class="math inline">\(x_n\)</span> records floor (0=basement, 1=first floor) for homes <span class="math inline">\(n=1, \ldots, N\)</span>.</p>
<div id="complete-pooling" class="section level3 hasAnchor" number="16.2.1">
<h3 class="hasAnchor"><span class="header-section-number">16.2.1</span> Complete Pooling<a href="#complete-pooling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The complete pooling model pools all counties together to give them one single estimate of the <span class="math inline">\(log(radon)\)</span> level, <span class="math inline">\(\hat{\alpha}\)</span>.</p>
<ul>
<li>The error term <span class="math inline">\(\epsilon_n\)</span> may represent variation due to measurement error, within-house variation, and/or within-county variation.<br />
</li>
<li>Fans of the random intercept model think that <span class="math inline">\(\epsilon_n\)</span>, here, captures too many sources of error into one term, and think that this is a fault of the completely pooled model.</li>
</ul>
<p><span class="math display">\[\begin{equation*}
\begin{split}

        y_n = \alpha &amp; + \epsilon_n \\
            &amp; \epsilon_n \sim N(0, \sigma_{\epsilon}^{2})

\end{split}
\end{equation*}\]</span></p>
</div>
<div id="no-pooling" class="section level3 hasAnchor" number="16.2.2">
<h3 class="hasAnchor"><span class="header-section-number">16.2.2</span> No Pooling<a href="#no-pooling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The no pooling model gives each county an independent estimate of <span class="math inline">\(log(radon\)</span>), <span class="math inline">\(\hat{\alpha}_{j[n]}\)</span>.<br />
</li>
<li>Read the subscript <span class="math inline">\(j[n]\)</span> as home <span class="math inline">\(n\)</span> is nested within county <span class="math inline">\(j\)</span>. Hence, all homes in each county get their own independent estimate of <span class="math inline">\(log(radon)\)</span>.<br />
</li>
<li>This is equivalent to the fixed effects model</li>
<li>Here again, one might argue that the error term captures too much noise.</li>
</ul>
<p><span class="math display">\[\begin{equation*}
\begin{split}

        y_n = \alpha_{j[n]} &amp; + \epsilon_n \\
            \epsilon_n &amp; \sim N(0, \sigma_{\epsilon}^{2})

\end{split}
\end{equation*}\]</span></p>
</div>
<div id="partial-pooling-ri" class="section level3 hasAnchor" number="16.2.3">
<h3 class="hasAnchor"><span class="header-section-number">16.2.3</span> Partial Pooling (RI)<a href="#partial-pooling-ri" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The random intercept model, better known as the partial pooling model, gives each county an intercept term <span class="math inline">\(\alpha_j[n]\)</span> that varies according to its own error term, <span class="math inline">\(\sigma_{\alpha}^2\)</span>.<br />
</li>
<li>This error term measures within-county variation
<ul>
<li>Separating measurement error (<span class="math inline">\(\sigma_{\epsilon}^{2}\)</span>) from county level error (<span class="math inline">\(\sigma_{\alpha}^{2}\)</span>) .</li>
</ul></li>
<li>This multi-level modeling shares information among the counties to the effect that the estimates <span class="math inline">\(\alpha_{j[n]}\)</span> are a compromise between the completely pooled and not pooled estimates.<br />
</li>
<li>When a county has a relatively smaller sample size and/or the variance <span class="math inline">\(\sigma^{2}_{\epsilon}\)</span> is larger than the variance <span class="math inline">\(\sigma^2_{\alpha}\)</span>, estimates are shrunk more from the not pooled estimates towards to completely pooled estimate.</li>
</ul>
<p><span class="math display">\[\begin{equation*}
\begin{split}

        y_n = \alpha_{j[n]} &amp; + \epsilon_n \\
            \epsilon_n &amp; \sim N(0, \sigma_{\epsilon}^{2}) \\
            \alpha_j[n] &amp; \sim N(\mu_{\alpha}, \sigma_{\alpha}^2)

\end{split}
\end{equation*}\]</span></p>
</div>
</div>
<div id="components-of-variance-1" class="section level2 hasAnchor" number="16.3">
<h2 class="hasAnchor"><span class="header-section-number">16.3</span> Components of Variance<a href="#components-of-variance-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Statistics can be thought of as the study of uncertainty, and variance is a measure of uncertainty (and information). So yet again we see that we’re partitioning the variance. Recall that</p>
<ul>
<li>Measurement error: <span class="math inline">\(\sigma^{2}_{\epsilon}\)</span></li>
<li>County level error: <span class="math inline">\(\sigma^{2}_{\alpha}\)</span></li>
</ul>
<p>The <strong>intraclass correlation</strong> (ICC, <span class="math inline">\(\rho\)</span>) is interpreted as</p>
<ul>
<li>the proportion of total variance that is explained by the clusters.<br />
</li>
<li>the expected correlation between two individuals who are drawn from the same cluster.</li>
</ul>
<p><span class="math display">\[
\rho = \frac{\sigma^{2}_{\alpha}}{\sigma^{2}_{\alpha} + \sigma^{2}_{\epsilon}}
\]</span></p>
<ul>
<li>When <span class="math inline">\(\rho\)</span> is large, a lot of the variance is at the macro level
<ul>
<li>units within each group are very similar</li>
</ul></li>
<li>If <span class="math inline">\(\rho\)</span> is small enough, one may ask if fitting a multi-level model is worth the complexity.</li>
<li>No hard and fast rule to say “is it large enough?”
<ul>
<li>rules of thumb include
<ul>
<li>under 10% (0.1) then a single level analysis may still be appropriate,</li>
<li>over 10% (0.1) then a multilevel model can be justified.</li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="fitri" class="section level2 hasAnchor" number="16.4">
<h2 class="hasAnchor"><span class="header-section-number">16.4</span> Fitting models in R<a href="#fitri" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Complete Pooling</strong></p>
<p>The complete pooling model is fit with the function <code>lm</code>, and is only modeled by <code>1</code> and no covariates. This is the simple mean model, and is equivelant to estimating the mean.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>fit_completepool <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_radon <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>radon)</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>fit_completepool</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = log_radon ~ 1, data = radon)</span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  </span></span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="do">##       1.265</span></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(radon<span class="sc">$</span>log_radon)</span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.264779</span></span></code></pre></div>
<p><strong>No Pooling</strong></p>
<p>The no pooling model is also fit with the function <code>lm</code>, but gives each county a unique intercept in the model.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>fit_nopool <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_radon <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> county, <span class="at">data=</span>radon)</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>fit_nopool.withint <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_radon <span class="sc">~</span> county, <span class="at">data=</span>radon)</span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
log_radon
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
</td>
<td>
0.715<sup>*</sup> (0.383)
</td>
</tr>
<tr>
<td style="text-align:left">
countyAITKIN
</td>
<td>
0.715<sup>*</sup> (0.383)
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
countyANOKA
</td>
<td>
0.891<sup>***</sup> (0.106)
</td>
<td>
0.176 (0.398)
</td>
</tr>
<tr>
<td style="text-align:left">
countyBECKER
</td>
<td>
1.090<sup>**</sup> (0.443)
</td>
<td>
0.375 (0.585)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<ul>
<li>The first model (<code>fit_nopool</code>) is coded as <code>lm(log_radon ~ -1 + county, data=radon)</code>, and so does not have the global intercept (that’s what the <code>-1</code> does). Each <span class="math inline">\(\beta\)</span> coefficient is the estimate of the mean <code>log_radon</code> for that county.</li>
<li>The second model (<code>fit_nopool.withint</code>) is coded as <code>lm(log_radon ~ county, data=radon)</code> and is what we are typically used to fitting.
<ul>
<li>Each estimate is the difference in log(radon) for that county <em>compared to a reference county</em>.</li>
<li>Because county is alphabetical, the reference group is AITKIN.</li>
<li>Aitkin’s mean level of log(radon) shows up as the intercept or <em>Constant</em> term.</li>
</ul></li>
<li>For display purposes only, only the first 3 county estimates are being shown.</li>
</ul>
<p><strong>Partial Pooling</strong></p>
<ul>
<li>The partial pooling model is fit with the function <code>lmer()</code>, which is part of the <strong><a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf"><code>lme4</code></a></strong> package.</li>
<li>The extra notation around the input variable <code>(1|county)</code> dictates that each county should get its own unique intercept <span class="math inline">\(\alpha_{j[n]}\)</span>.</li>
</ul>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>fit_partpool <span class="ot">&lt;-</span> <span class="fu">lmer</span>(log_radon <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span>county), <span class="at">data=</span>radon)</span></code></pre></div>
<p>The fixed effects portion of the model output of <code>lmer</code> is similar to output from <code>lm</code>, except no p-values are displayed. The fact that no p-values are displayed is a much discussed topic. The author of the library <code>lme4</code>, Douglas Bates, believes that there is no “obviously correct” solution to calculating p-values for models with randomly varying intercepts (or slopes); see <strong><a href="https://stat.ethz.ch/pipermail/r-help/2006-May/094765.html">here</a></strong> for a general discussion.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_partpool)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Linear mixed model fit by REML [&#39;lmerMod&#39;]</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Formula: log_radon ~ (1 | county)</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Data: radon</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="do">## REML criterion at convergence: 2184.9</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Scaled residuals: </span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a><span class="do">## -4.6880 -0.5884  0.0323  0.6444  3.4186 </span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Random effects:</span></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  Groups   Name        Variance Std.Dev.</span></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  county   (Intercept) 0.08861  0.2977  </span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  Residual             0.58686  0.7661  </span></span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of obs: 919, groups:  county, 85</span></span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Fixed effects:</span></span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error t value</span></span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)    1.350      0.047   28.72</span></span></code></pre></div>
<ul>
<li>The random effects portion of the <code>lmer</code> output provides a point estimate of the variance of component <span class="math inline">\(\sigma^2_{\alpha} = 0.09\)</span> and the model’s residual variance, <span class="math inline">\(\sigma_\epsilon = 0.57\)</span>.</li>
<li>The fixed effect here is interpreted in the same way that we would in a normal fixed effects mean model, as the global predicted value of the outcome of <code>log_radon</code>.</li>
<li>The random intercepts aren’t automatically shown in this output. We can visualize these using a forestplot. We use the <code>plot_model()</code> function from the <code>sjPlot</code> package, on the <code>fit_partpool</code> model, we want to see the random effects (<code>type="re"</code>), and we want to sort on the name of the random variable, here it’s <code>"(Intercept)"</code>.</li>
</ul>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(fit_partpool, <span class="at">type=</span><span class="st">&quot;re&quot;</span>, <span class="at">sort.est =</span> <span class="st">&quot;(Intercept)&quot;</span>, <span class="at">y.offset =</span> .<span class="dv">4</span>)</span></code></pre></div>
<p><img src="random_intercept_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Notice that these effects are centered around 0. Refering back (<span class="citation">(<a href="#ref-mathri" role="doc-biblioref"><strong>mathri?</strong></a>)</span>), the intercept <span class="math inline">\(\beta_{0j}\)</span> was modeled equal to some average intercept across all groups <span class="math inline">\(\gamma_{00}\)</span>, plus some difference. What is plotted above is listed in a table below, showing that if you add that random effect to the fixed effect of the intercept, you get the value of the random intercept for each county.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>showri <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Random_Effect   =</span> <span class="fu">unlist</span>(<span class="fu">ranef</span>(fit_partpool)), </span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Fixed_Intercept =</span> <span class="fu">fixef</span>(fit_partpool), </span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">RandomIntercept =</span> <span class="fu">unlist</span>(<span class="fu">ranef</span>(fit_partpool))<span class="sc">+</span><span class="fu">fixef</span>(fit_partpool))</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(showri) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(fit_partpool)<span class="sc">$</span>county)</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(showri))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Random_Effect
</th>
<th style="text-align:right;">
Fixed_Intercept
</th>
<th style="text-align:right;">
RandomIntercept
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AITKIN
</td>
<td style="text-align:right;">
-0.2390574
</td>
<td style="text-align:right;">
1.34983
</td>
<td style="text-align:right;">
1.1107728
</td>
</tr>
<tr>
<td style="text-align:left;">
ANOKA
</td>
<td style="text-align:right;">
-0.4071256
</td>
<td style="text-align:right;">
1.34983
</td>
<td style="text-align:right;">
0.9427047
</td>
</tr>
<tr>
<td style="text-align:left;">
BECKER
</td>
<td style="text-align:right;">
-0.0809977
</td>
<td style="text-align:right;">
1.34983
</td>
<td style="text-align:right;">
1.2688325
</td>
</tr>
<tr>
<td style="text-align:left;">
BELTRAMI
</td>
<td style="text-align:right;">
-0.0804277
</td>
<td style="text-align:right;">
1.34983
</td>
<td style="text-align:right;">
1.2694025
</td>
</tr>
<tr>
<td style="text-align:left;">
BENTON
</td>
<td style="text-align:right;">
-0.0254506
</td>
<td style="text-align:right;">
1.34983
</td>
<td style="text-align:right;">
1.3243796
</td>
</tr>
<tr>
<td style="text-align:left;">
BIGSTONE
</td>
<td style="text-align:right;">
0.0582831
</td>
<td style="text-align:right;">
1.34983
</td>
<td style="text-align:right;">
1.4081133
</td>
</tr>
</tbody>
</table>
<div id="comparison-of-estimates" class="section level3 hasAnchor" number="16.4.1">
<h3 class="hasAnchor"><span class="header-section-number">16.4.1</span> Comparison of estimates<a href="#comparison-of-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>By allowing individuals within counties to be correlated, and at the same time let counties be correlated, we allow for some information to be shared across counties.</li>
<li>Thus we come back to that idea of shrinkage. Below is a numeric table version of the plot in Section (<span class="citation">(<a href="#ref-pool" role="doc-biblioref"><strong>pool?</strong></a>)</span>).</li>
</ul>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>cmpr.est <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Mean_Model       =</span> <span class="fu">coef</span>(fit_completepool), </span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Random_Intercept =</span> <span class="fu">unlist</span>(<span class="fu">ranef</span>(fit_partpool))<span class="sc">+</span><span class="fu">fixef</span>(fit_partpool), </span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Fixed_Effects    =</span> <span class="fu">coef</span>(fit_nopool))</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cmpr.est) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(fit_partpool)<span class="sc">$</span>county)</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(cmpr.est))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Mean_Model
</th>
<th style="text-align:right;">
Random_Intercept
</th>
<th style="text-align:right;">
Fixed_Effects
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AITKIN
</td>
<td style="text-align:right;">
1.264779
</td>
<td style="text-align:right;">
1.1107728
</td>
<td style="text-align:right;">
0.7149352
</td>
</tr>
<tr>
<td style="text-align:left;">
ANOKA
</td>
<td style="text-align:right;">
1.264779
</td>
<td style="text-align:right;">
0.9427047
</td>
<td style="text-align:right;">
0.8908486
</td>
</tr>
<tr>
<td style="text-align:left;">
BECKER
</td>
<td style="text-align:right;">
1.264779
</td>
<td style="text-align:right;">
1.2688325
</td>
<td style="text-align:right;">
1.0900084
</td>
</tr>
<tr>
<td style="text-align:left;">
BELTRAMI
</td>
<td style="text-align:right;">
1.264779
</td>
<td style="text-align:right;">
1.2694025
</td>
<td style="text-align:right;">
1.1933029
</td>
</tr>
<tr>
<td style="text-align:left;">
BENTON
</td>
<td style="text-align:right;">
1.264779
</td>
<td style="text-align:right;">
1.3243796
</td>
<td style="text-align:right;">
1.2822379
</td>
</tr>
<tr>
<td style="text-align:left;">
BIGSTONE
</td>
<td style="text-align:right;">
1.264779
</td>
<td style="text-align:right;">
1.4081133
</td>
<td style="text-align:right;">
1.5367889
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="estimation-methods" class="section level2 hasAnchor" number="16.5">
<h2 class="hasAnchor"><span class="header-section-number">16.5</span> Estimation Methods<a href="#estimation-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Similar to logistic regression, estimates from multi-level models typically aren’t estimated directly using maximum likelihood (ML) methods.</li>
<li>Iterative methods like <strong>Restricted (residual) Maximum Likelihood (REML)</strong> are used to get approximations.</li>
<li>REML is typically the default estimation method for most packages.</li>
</ul>
<p>Details of REML are beyond the scope of this class, but knowing the estimation method is important for two reasons</p>
<ol style="list-style-type: decimal">
<li>Some type of testing procedures that use the likelihood ratio may not be valid.
<ul>
<li>Comparing models with different fixed effects using a likelihood ratio test is not valid. (Must use Wald Test instead)</li>
<li>Can still use AIC/BIC as guidance (not as formal tests)</li>
</ul></li>
<li>Iterative procedures are procedures that perform estimation steps over and over until the change in estimates from one step to the next is smaller than some tolerance.
<ul>
<li>Sometimes this convergence to an answer never happens.</li>
<li>You will get some error message about the algorithm not converging.</li>
<li>The more complex the model, the higher chance this can happen</li>
<li>scaling, centering, and avoiding collinearity can alleviate these problems with convergence.</li>
</ul></li>
</ol>
<p>You can change the fitting algorithm to use the Log Likelihood anyhow, it may be slightly slower but for simple models the estimates are going to be very close to the REML estimate. Below is a table showing the estimates for the random intercepts,</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
REML
</th>
<th style="text-align:right;">
MLE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AITKIN
</td>
<td style="text-align:right;">
1.1107728
</td>
<td style="text-align:right;">
1.1143654
</td>
</tr>
<tr>
<td style="text-align:left;">
ANOKA
</td>
<td style="text-align:right;">
0.9427047
</td>
<td style="text-align:right;">
0.9438526
</td>
</tr>
<tr>
<td style="text-align:left;">
BECKER
</td>
<td style="text-align:right;">
1.2688325
</td>
<td style="text-align:right;">
1.2700351
</td>
</tr>
<tr>
<td style="text-align:left;">
BELTRAMI
</td>
<td style="text-align:right;">
1.2694025
</td>
<td style="text-align:right;">
1.2702493
</td>
</tr>
<tr>
<td style="text-align:left;">
BENTON
</td>
<td style="text-align:right;">
1.3243796
</td>
<td style="text-align:right;">
1.3245917
</td>
</tr>
<tr>
<td style="text-align:left;">
BIGSTONE
</td>
<td style="text-align:right;">
1.4081133
</td>
<td style="text-align:right;">
1.4068866
</td>
</tr>
</tbody>
</table>
<p>and the same estimates for the variance terms.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit_partpool)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  Groups   Name        Std.Dev.</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  county   (Intercept) 0.29767 </span></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  Residual             0.76607</span></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit_partpool_MLE)</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  Groups   Name        Std.Dev.</span></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  county   (Intercept) 0.29390 </span></span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  Residual             0.76607</span></span></code></pre></div>
<p>So does it matter? Yes and no. In general you want to fit the models using REML, but if you really want to use a Likelihood Ratio <strong>test</strong> to compare models then you need to fit the models using ML.</p>
</div>
<div id="including-covariates" class="section level2 hasAnchor" number="16.6">
<h2 class="hasAnchor"><span class="header-section-number">16.6</span> Including Covariates<a href="#including-covariates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A similar sort of shrinkage effect is seen with covariates included in the model.</p>
<p>Consider the covariate <span class="math inline">\(floor\)</span>, which takes on the value <span class="math inline">\(1\)</span> when the radon measurement was read within the first floor of the house and <span class="math inline">\(0\)</span> when the measurement was taken in the basement. In this case, county means are shrunk towards the mean of the response, <span class="math inline">\(log(radon)\)</span>, within each level of the covariate.</p>
<p><img src="random_intercept_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Covariates are fit using standard <code>+</code> notation outside the random effects specification, i.e. <code>(1|county)</code>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>ri.with.x <span class="ot">&lt;-</span> <span class="fu">lmer</span>(log_radon <span class="sc">~</span> floor <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span>county), <span class="at">data=</span>radon)</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(ri.with.x, <span class="at">show.r2=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
log radon
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Estimates
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.49
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.40 – 1.59
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001</strong>
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
floor [first floor]
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.66
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.80 – -0.53
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001</strong>
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Random Effects
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
σ<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.53
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>00</sub> <sub>county</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.10
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ICC
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.16
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
N <sub>county</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
85
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
919
</td>
</tr>
</table>
<p>Note that in this table format, <span class="math inline">\(\tau_{00} = \sigma^{2}_{\alpha}\)</span> and <span class="math inline">\(\sigma^{2} = \sigma^{2}_{\epsilon}\)</span>. The estimated random effects can also be easily visualized using functions from the <a href="http://www.strengejacke.de/sjPlot/">sjPlot</a> package.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(ri.with.x, <span class="at">type=</span><span class="st">&quot;re&quot;</span>, <span class="at">sort.est =</span> <span class="st">&quot;(Intercept)&quot;</span>, <span class="at">y.offset =</span> .<span class="dv">4</span>)</span></code></pre></div>
<p><img src="random_intercept_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Function enhancements –</p>
<ul>
<li>Display the fixed effects by changing <code>type="est"</code>.</li>
<li>Plot the slope of the fixed effect for each level of the random effect <code>sjp.lmer(ri.with.x, type="ri.slope")</code> – this is being depreciated in the future but works for now. Eventually I’ll figure out how to get this plot out of <code>plot_model()</code>.</li>
</ul>
</div>
<div id="more-random-effects" class="section level2 hasAnchor" number="16.7">
<h2 class="hasAnchor"><span class="header-section-number">16.7</span> More Random Effects<a href="#more-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What if you think the slope along some <span class="math inline">\(x\)</span> should vary (such as over time)?</p>
<blockquote>
<p>This section has not been built yet. Reference this set of notes in the meantime: <a href="https://m-clark.github.io/mixed-models-with-R/random_slopes.html" class="uri">https://m-clark.github.io/mixed-models-with-R/random_slopes.html</a></p>
</blockquote>
</div>
<div id="centering-terms" class="section level2 hasAnchor" number="16.8">
<h2 class="hasAnchor"><span class="header-section-number">16.8</span> Centering terms<a href="#centering-terms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Sometimes it might be better to measure the effect of a specific level relative to the average within cluster, rather than overall average.</li>
<li>The “frog pond” effect
<ul>
<li>A student with an average IQ may be more confident and excel in a group of students with less than average IQ</li>
<li>But they may be discouraged and not perform to their potential in a group of students with higher than average IQ.</li>
</ul></li>
<li>If the effect of a specific level of a factor is dependent on where the level is in reference to <em>other cluster members</em>, more so than where the level is in reference to <em>all other participants</em>, the model should be adjusted for as follows:</li>
<li>Instead of using the actual value in the regression model you would…
<ul>
<li>calculate the cluster specific average</li>
<li>calculate the difference between individual and specific cluster average</li>
<li>both cluster average (macro) and difference (micro) are included in the model.</li>
</ul></li>
</ul>
<div id="a-generic-dplyr-approach-to-centering." class="section level3 hasAnchor" number="16.8.1">
<h3 class="hasAnchor"><span class="header-section-number">16.8.1</span> A generic <code>dplyr</code> approach to centering.<a href="#a-generic-dplyr-approach-to-centering." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<pre><code>group.means &lt;- data %&gt;% group_by(cluster) %&gt;% summarise(c.ave=mean(variable))
newdata &lt;- data %&gt;% left_join(group.means) %&gt;% mutate(diff = variable - c.ave)</code></pre>
<ol style="list-style-type: decimal">
<li>Create a new data set that I call <code>group.means</code> that
<ul>
<li>takes the original <code>data</code> set and then (<code>%&gt;%</code>)…</li>
<li>groups it by the clustering variable so that all subsequent actions are done on each group</li>
<li>makes a new variable that I call <code>c.ave</code> that is the average of the <code>variable</code> of interest</li>
</ul></li>
<li>I then take the original <code>data</code> set, and then
<ul>
<li>merge onto <code>data</code>, this <code>group.means</code> data set that only contains the clustering variable, and the cluster average variable <code>c.ave</code>.</li>
<li>I also toss in a <code>mutate</code> to create a new variable that is the <code>diff</code>erence between the <code>variable</code> of interest and the group averages.</li>
<li>and assign all of this to a <code>newdata</code> set</li>
</ul></li>
</ol>
</div>
</div>
<div id="specifying-correlation-structures" class="section level2 hasAnchor" number="16.9">
<h2 class="hasAnchor"><span class="header-section-number">16.9</span> Specifying Correlation Structures<a href="#specifying-correlation-structures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p><strong>Independence:</strong> In standard linear models, the assumption on the residuals <span class="math inline">\(\epsilon_{i} \sim \mathcal{N}(0, \sigma_{\epsilon}^{2})\)</span> means that</p></li>
<li><p>The variance of each observation is <span class="math inline">\(\sigma_{\epsilon}^{2}\)</span></p></li>
<li><p>The covariance between two different observations <span class="math inline">\(0\)</span></p></li>
</ul>
<p>Consider <span class="math inline">\(n=4\)</span> observations, <span class="math inline">\(y_{1}, \ldots , y_{4}\)</span>. Visually the covariance matrix between these four observations would look like this:</p>
<p><span class="math display">\[
\begin{array}{c|cccc}
  &amp; y_{1} &amp; y_{2} &amp; y_{3} &amp; y_{4}\\
  \hline
  y_{1} &amp; \sigma_{\epsilon}^{2} &amp; 0 &amp; 0 &amp; 0\\
  y_{2} &amp; 0 &amp; \sigma_{\epsilon}^{2} &amp; 0 &amp; 0\\
  y_{3} &amp; 0 &amp; 0 &amp; \sigma_{\epsilon}^{2} &amp; 0\\
  y_{4} &amp; 0&amp; 0 &amp; 0 &amp; \sigma_{\epsilon}^{2}
\end{array}
\]</span></p>
<p>We can also write the covariance matrix as <span class="math inline">\(\sigma_{\epsilon}^{2}\)</span> times the correlation matrix.</p>
<p><span class="math display">\[
\begin{bmatrix}
  \sigma_{\epsilon}^{2} &amp; 0 &amp; 0 &amp; 0\\
  0 &amp; \sigma_{\epsilon}^{2} &amp; 0 &amp; 0\\
  0 &amp; 0 &amp; \sigma_{\epsilon}^{2} &amp; 0\\
  0&amp; 0 &amp; 0 &amp; \sigma_{\epsilon}^{2}
\end{bmatrix}
=
\sigma_{\epsilon}^2
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
&amp; 1 &amp; 0 &amp; 0 \\
&amp; &amp; 1 &amp; 0 \\
&amp; &amp; &amp; 1
\end{bmatrix}
\]</span></p>
<ul>
<li><strong>Compound Symmetry</strong> or <strong>Exchangeable:</strong> The simplest covariance structure that includes correlated errors is compound symmetry (CS). Here we see correlated errors between individuals, and note that these correlations are presumed to be the same for each pair of responses, namely <span class="math inline">\(\rho\)</span>.</li>
</ul>
<p><span class="math display">\[
\sigma_{\epsilon}^{2}
\begin{bmatrix}
1 &amp; \rho &amp; \rho &amp; \rho \\
&amp; 1 &amp; \rho &amp; \rho \\
&amp; &amp; 1 &amp; \rho \\
&amp; &amp; &amp; 1
\end{bmatrix}
\]</span></p>
<ul>
<li><strong>Autoregressive:</strong> Imagine that <span class="math inline">\(y_{1}, \ldots , y_{4}\)</span> were 4 different time points on the same person. The autoregressive (Lag 1) structure considers correlations to be highest for time adjacent times, and a systematically decreasing correlation with increasing distance between time points. This structure is only applicable for evenly spaced time intervals for the repeated measure.</li>
</ul>
<p><span class="math display">\[
\sigma_{\epsilon}^{2}
\begin{bmatrix}
1 &amp; \rho &amp; \rho^{2} &amp; \rho^{3} \\
&amp; 1 &amp; \rho &amp; \rho^{2} \\
&amp; &amp; 1 &amp; \rho \\
&amp; &amp; &amp; 1
\end{bmatrix}
\]</span></p>
<ul>
<li><strong>Unstructured:</strong> The Unstructured covariance structure (UN) is the most complex because it is estimating unique correlations for each pair of observations. It is not uncommon to find out that you are not able to use this structure simply because there are too many parameters to estimate.</li>
</ul>
<p><span class="math display">\[
\begin{bmatrix}
\sigma_{1}^{2} &amp; \rho_{12} &amp; \rho_{13} &amp; \rho_{14} \\
&amp; \sigma_{2}^{2} &amp; \rho_{23} &amp; \rho_{24} \\
&amp; &amp; \sigma_{3}^{2} &amp; \rho_{34} \\
&amp; &amp; &amp; \sigma_{4}^{2}
\end{bmatrix}
\]</span></p>
<ul>
<li>Random Intercept Model</li>
</ul>
<p>Let <span class="math inline">\(y_{1}\)</span> and <span class="math inline">\(y_{2}\)</span> be from group 1, and <span class="math inline">\(y_{3}\)</span> and <span class="math inline">\(y_{4}\)</span> be from group 2.</p>
<ul>
<li>error terms between groups are uncorrelated (groups are independent)</li>
<li>two different observations from the same group have covariance <span class="math inline">\(\sigma_{\alpha}^{2}\)</span></li>
<li>individuals now have the error associated with their own observation but also due to the group
<span class="math inline">\(\sigma_{\epsilon}^{2} + \sigma_{\alpha}^{2}\)</span></li>
</ul>
<p><span class="math display">\[
\left[
\begin{array}{cc|cc}
  \sigma_{\epsilon}^{2} + \sigma_{\alpha}^{2} &amp; \sigma_{\alpha}^{2} &amp; 0 &amp; 0\\
\sigma_{\alpha}^{2} &amp; \sigma_{\epsilon}^{2} + \sigma_{\alpha}^{2} &amp; 0 &amp; 0\\
\hline
  0 &amp; 0 &amp; \sigma_{\epsilon}^{2} + \sigma_{\alpha}^{2} &amp; \sigma_{\alpha}^{2}\\
  0 &amp; 0 &amp; \sigma_{\alpha}^{2} &amp; \sigma_{\epsilon}^{2} + \sigma_{\alpha}^{2}
\end{array}
\right]
\]</span></p>
<div id="changing-covariance-structures-in-r" class="section level3 hasAnchor" number="16.9.1">
<h3 class="hasAnchor"><span class="header-section-number">16.9.1</span> Changing covariance structures in R<a href="#changing-covariance-structures-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>This is very hard to do as the model becomes more complex.
These types of models is where Bayesian statistics has a much easier time fitting models.
this section has been commented out of the notes until figured out in a cleaner manner.</p>
</blockquote>
<!---

* Very hard (read - don't bother) to do this using `lmer()` from package `lme4`
* Can do this using `lme()` from package `nlme`. Syntax is similar. 
* The standard classes of correlation structures available in the `nlme` package can be found in [[this help file]](https://stat.ethz.ch/R-manual/R-devel/library/nlme/html/corClasses.html)


```r
library(nlme)
model_lme_cs <- lme(log_radon ~ floor,
                     random = ~ 1 | county, 
                     cor=corCompSymm(value=0.159,form=~1|county),data = radon)
```

Using a different covariance structure can have a large effect on the results. 

* `lmer` using Identity: $\sigma^{2}_{\alpha} = 0.10, \sigma^{2}_{\epsilon} = 0.53$  
* `nlme` using Identity: $\sigma^{2}_{\alpha} = 0.32^2 = 0.10, \sigma^{2}_{\epsilon} = 0.73^2 = 0.53$  
* `nlme` using CS: $\sigma^{2}_{\alpha} = 0.14^2 = 0.02, \sigma^{2}_{\epsilon} = 0.78^2 = 0.61$

\BeginKnitrBlock{rmdcaution}<div class="rmdcaution">Mis-specifying the covariance structure can also have a large effect on the results. </div>\EndKnitrBlock{rmdcaution}

#### Autoregressive 


The AR1 structure specifies that the correlations between the repeated measurements of each subject decrease with the time lag, i.e., the distance in time between the measurements. The data is assumed to be in sort order, where $y_{it}$ and $y_{i(t+1)}$ are in sequential rows. To sort by time within id in dplyr looks like: `arrange(id, time)`. 


* **Equally spaced items**
`lme(..., correlation = corAR1())` which is equivelant to `lme(..., correlation = corAR1(form = ~ 1 | id))` 

* **Not equally spaced items**
`lme(..., correlation = corAR1(form = ~ time | id))`, the `time` variable is used to determine how far apart the measurements are (the time lag). 

* **Discrete vs continuous time**
corAR1() works with discrete time. There is also corCAR1() that works with continuous time.

Ref: https://stats.stackexchange.com/questions/367957/autoregression-in-nlme-undestanding-how-to-specify-corar1


--->
</div>
</div>
<div id="additional-references" class="section level2 hasAnchor" number="16.10">
<h2 class="hasAnchor"><span class="header-section-number">16.10</span> Additional References<a href="#additional-references" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Random effects ANOVA in SAS and R <a href="http://stla.github.io/stlapblog/posts/AV1R_SASandR.html" class="uri">http://stla.github.io/stlapblog/posts/AV1R_SASandR.html</a></li>
<li>ICCs in mixed models <a href="https://www.theanalysisfactor.com/the-intraclass-correlation-coefficient-in-mixed-models/" class="uri">https://www.theanalysisfactor.com/the-intraclass-correlation-coefficient-in-mixed-models/</a></li>
<li>Very nice introduction to mixed models in R <a href="https://m-clark.github.io/mixed-models-with-R/introduction.html" class="uri">https://m-clark.github.io/mixed-models-with-R/introduction.html</a></li>
<li>Interesting blog by <a href="https://tjmahr.github.io/plotting-partial-pooling-in-mixed-effects-models/">Tristan Mahr</a> about pooling and shrinkage.</li>
<li>Derivation of the covariance structures <a href="http://www.bristol.ac.uk/cmm/learning/videos/correlation.html#matrix2" class="uri">http://www.bristol.ac.uk/cmm/learning/videos/correlation.html#matrix2</a></li>
<li>Mixed models with R - Michael Clark <a href="https://m-clark.github.io/mixed-models-with-R/" class="uri">https://m-clark.github.io/mixed-models-with-R/</a></li>
</ul>
<div id="lecture-notes-from-other-classes-found-on-the-interwebs" class="section level3 hasAnchor" number="16.10.1">
<h3 class="hasAnchor"><span class="header-section-number">16.10.1</span> Lecture notes from other classes found on the interwebs<a href="#lecture-notes-from-other-classes-found-on-the-interwebs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="https://fukamilab.github.io/BIO202/04-A-mixed-models.html">BIOL 202: Ecological Statistics from Stanford</a> This is a graduate level class.</li>
</ul>
</div>
<div id="package-vignettes" class="section level3 hasAnchor" number="16.10.2">
<h3 class="hasAnchor"><span class="header-section-number">16.10.2</span> Package Vignettes<a href="#package-vignettes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf">lme4</a> Functions to fit HLMs</li>
<li><a href="http://strengejacke.de/sjPlot/sjt.lmer/">sjPlot</a> <strong>Really</strong> nice way of printing output as tables (and plots).</li>
</ul>
<!--chapter:end:random_intercept.Rmd-->
</div>
</div>
</div>
<div id="part-other-topics" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART) Other Topics<a href="#part-other-topics" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Other important topics</p>
<!--chapter:end:other_intro.Rmd-->
</div>
<div id="mda" class="section level1 hasAnchor" number="17">
<h1 class="hasAnchor"><span class="header-section-number">17</span> Missing Data<a href="#mda" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Missing Data happens. Not always</p>
<ul>
<li>General: Item non-response. Individual pieces of data are missing.<br />
</li>
<li>Unit non-response: Records have some background data on all units, but some units don’t respond to any question.</li>
<li>Monotonone missing data: Variables can be ordered such that one block of variables more observed than the next.</li>
</ul>
<blockquote>
<p>This is a very brief, and very rough overview of identification and treatment of missing data. For more details (enough for an entire class) see Flexible Imputation of Missing Data, 2nd Ed, by Stef van Buuren: <a href="https://stefvanbuuren.name/fimd/" class="uri">https://stefvanbuuren.name/fimd/</a></p>
</blockquote>
<div id="identifying-missing-data" class="section level2 hasAnchor" number="17.1">
<h2 class="hasAnchor"><span class="header-section-number">17.1</span> Identifying missing data<a href="#identifying-missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Missing data in <code>R</code> is denoted as <code>NA</code></li>
<li>Arithmetic functions on missing data will return missing</li>
</ul>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> MASS<span class="sc">::</span>survey <span class="co"># to avoid loading the MASS library which will conflict with dplyr</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survey<span class="sc">$</span>Pulse)</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  92 104  87  NA  35  64</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(survey<span class="sc">$</span>Pulse)</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] NA</span></span></code></pre></div>
<p>The <code>summary()</code> function will always show missing.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(survey<span class="sc">$</span>Pulse)</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   35.00   66.00   72.50   74.15   80.00  104.00      45</span></span></code></pre></div>
<p>The <code>is.na()</code> function is helpful to identify rows with missing data</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(survey<span class="sc">$</span>Pulse))</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE  TRUE </span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   192    45</span></span></code></pre></div>
<p>The function <code>table()</code> will not show NA by default.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(survey<span class="sc">$</span>M.I)</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Imperial   Metric </span></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="do">##       68      141</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(survey<span class="sc">$</span>M.I, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Imperial   Metric     &lt;NA&gt; </span></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a><span class="do">##       68      141       28</span></span></code></pre></div>
<ul>
<li>What percent of the data set is missing?</li>
</ul>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">is.na</span>(survey)))<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE  TRUE </span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  96.2   3.8</span></span></code></pre></div>
<p>4% of the data points are missing.</p>
<ul>
<li>How much missing is there per variable?</li>
</ul>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>prop.miss <span class="ot">&lt;-</span> <span class="fu">apply</span>(survey, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(x))<span class="sc">/</span><span class="fu">NROW</span>(x),<span class="dv">4</span>))</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>prop.miss</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Sex Wr.Hnd NW.Hnd  W.Hnd   Fold  Pulse   Clap   Exer  Smoke Height    M.I </span></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.0042 0.0042 0.0042 0.0042 0.0000 0.1899 0.0042 0.0000 0.0042 0.1181 0.1181 </span></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    Age </span></span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.0000</span></span></code></pre></div>
<p>The amount of missing data per variable varies from 0 to 19%.</p>
<div id="visualize-missing-patterns" class="section level3 hasAnchor" number="17.1.1">
<h3 class="hasAnchor"><span class="header-section-number">17.1.1</span> Visualize missing patterns<a href="#visualize-missing-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using <code>ggplot2</code></p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>pmpv <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(survey), <span class="at">pct.miss =</span>prop.miss)</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pmpv, <span class="fu">aes</span>(<span class="at">x=</span>variable, <span class="at">y=</span>pct.miss)) <span class="sc">+</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Percent&quot;</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent, <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>pmpv, <span class="fu">aes</span>(<span class="at">label=</span><span class="fu">paste0</span>(<span class="fu">round</span>(pct.miss<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>),<span class="st">&quot;%&quot;</span>), <span class="at">y=</span>pct.miss<span class="fl">+.025</span>), <span class="at">size=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Using <code>mice</code></p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(survey)</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre><code>##     Fold Exer Age Sex Wr.Hnd NW.Hnd W.Hnd Clap Smoke Height M.I Pulse    
## 168    1    1   1   1      1      1     1    1     1      1   1     1   0
## 38     1    1   1   1      1      1     1    1     1      1   1     0   1
## 20     1    1   1   1      1      1     1    1     1      0   0     1   2
## 7      1    1   1   1      1      1     1    1     1      0   0     0   3
## 1      1    1   1   1      1      1     1    1     0      0   0     1   3
## 1      1    1   1   1      1      1     0    1     1      1   1     1   1
## 1      1    1   1   1      0      0     1    0     1      1   1     1   3
## 1      1    1   1   0      1      1     1    1     1      1   1     1   1
##        0    0   0   1      1      1     1    1     1     28  28    45 107</code></pre>
<p>This somewhat ugly output tells us that 168 records have no missing data, 38 records are missing only <code>Pulse</code> and 20 are missing both <code>Height</code> and <code>M.I</code>.</p>
<p>Using <code>VIM</code></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VIM)</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggr</span>(survey, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;chartreuse3&#39;</span>,<span class="st">&#39;mediumvioletred&#39;</span>),</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">numbers=</span><span class="cn">TRUE</span>, <span class="at">sortVars=</span><span class="cn">TRUE</span>,</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">labels=</span><span class="fu">names</span>(survey), <span class="at">cex.axis=</span>.<span class="dv">7</span>,</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">gap=</span><span class="dv">3</span>, <span class="at">ylab=</span><span class="fu">c</span>(<span class="st">&quot;Missing data&quot;</span>,<span class="st">&quot;Pattern&quot;</span>))</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-9-1.png" width="768" /></p>
<p>The plot on the left is a simplified, and ordered version of the ggplot from above, except the bars appear to be inflated because the y-axis goes up to 15% instead of 100%.</p>
<p>The plot on the right shows the missing data patterns, and indicate that 71% of the records has complete cases, and that everyone who is missing <code>M.I.</code> is also missing Height.</p>
<p>Another plot that can be helpful to identify patterns of missing data is a <code>marginplot</code> (also from <code>VIM</code>).</p>
<ul>
<li>Two continuous variables are plotted against each other.<br />
</li>
<li>Blue bivariate scatterplot and univariate boxplots are for the observations where values on both variables are observed.</li>
<li>Red univariate dotplots and boxplots are drawn for the data that is only observed on one of the two variables in question.<br />
</li>
<li>The darkred text indicates how many records are missing on both.</li>
</ul>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginplot</span>(survey[,<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">10</span>)])</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>This shows us that the observations missing pulse have the same median height, but those missing height have a higher median pulse rate.</p>
</div>
</div>
<div id="effects-of-nonresponse" class="section level2 hasAnchor" number="17.2">
<h2 class="hasAnchor"><span class="header-section-number">17.2</span> Effects of Nonresponse<a href="#effects-of-nonresponse" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Textbook example: Example reported in W.G. Cochran, Sampling Techniques, 3rd edition, 1977, ch. 13</p>
<blockquote>
<p>Consider data that come form an experimental sampling of fruit orcharts in North Carolina in 1946.
Three successive mailings of the same questionnaire were sent to growers. For one of the questions
the number of fruit trees, complete data were available for the population…</p>
</blockquote>
<p><br></p>
<table>
<colgroup>
<col width="35%" />
<col width="18%" />
<col width="18%" />
<col width="27%" />
</colgroup>
<thead>
<tr class="header">
<th>Ave. # trees</th>
<th># of growers</th>
<th>% of pop’n</th>
<th>Ave # trees/grower</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1st mailing responders</td>
<td>300</td>
<td>10</td>
<td>456</td>
</tr>
<tr class="even">
<td>2nd mailing responders</td>
<td>543</td>
<td>17</td>
<td>382</td>
</tr>
<tr class="odd">
<td>3rd mailing responders</td>
<td>434</td>
<td>14</td>
<td>340</td>
</tr>
<tr class="even">
<td>Nonresponders</td>
<td>1839</td>
<td>59</td>
<td>290</td>
</tr>
<tr class="odd">
<td></td>
<td>——–</td>
<td>——–</td>
<td>——–</td>
</tr>
<tr class="even">
<td>Total population</td>
<td>3116</td>
<td>100</td>
<td>329</td>
</tr>
</tbody>
</table>
<ul>
<li>The overall response rate was very low.</li>
<li>The rate of non response is clearly related to the average number of trees per grower.</li>
<li>The estimate of the average trees per grower can be calculated as a weighted average from responders <span class="math inline">\(\bar{Y_{1}}\)</span> and non responders <span class="math inline">\(\bar{Y_{2}}\)</span>.</li>
</ul>
<p><strong>Bias</strong>: The difference between the observed estimate <span class="math inline">\(\bar{y}_{1}\)</span> and the true parameter <span class="math inline">\(\mu\)</span>.</p>
<p><span class="math display">\[
  \begin{aligned}
  E(\bar{y}_{1}) - \mu &amp; = \bar{Y_{1}} - \bar{Y} \\
  &amp; = \bar{Y}_{1} - \left[(1-w)\bar{Y}_{1} - w\bar{Y}_{2}\right] \\
  &amp; = w(\bar{Y}_{1} - \bar{Y}_{2})
  \end{aligned}
\]</span></p>
<p>Where <span class="math inline">\(w\)</span> is the proportion of non-response.</p>
<ul>
<li>The amount of bias is the product of the proportion of non-response and the difference in the means between the responders and the non-responders.</li>
<li>The sample provides no information about <span class="math inline">\(\bar{Y_{2}}\)</span>, the size of the bias is generally unknown without information gained from external data.</li>
</ul>
</div>
<div id="missing-data-mechanisms" class="section level2 hasAnchor" number="17.3">
<h2 class="hasAnchor"><span class="header-section-number">17.3</span> Missing Data Mechanisms<a href="#missing-data-mechanisms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Process by which some units observed, some units not observed</p>
<ul>
<li><strong>Missing Completely at Random (MCAR)</strong>: The probability that a data point is missing is completely unrelated (independent) of any observed and unobserved data or parameters.
<ul>
<li>P(Y missing| X, Y) = P(Y missing)</li>
<li>Ex: Miscoding or forgetting to log in answer</li>
</ul></li>
<li><strong>Missing at Random (MAR)</strong>: The probability that a data point is missing is independent can be explained or modeled by other observed variables.
<ul>
<li>P(Y missing|x, Y) = P(Y missing | X)</li>
<li>Ex: Y = age, X = sex<br />
- Pr (Y miss| X = male) = 0.2<br />
- Pr (Y miss| X = female) = 0.3<br />
- Males people are less likely to fill out an income survey
- The missing data on income is related to gender
- After accounting for gender the missing data is unrelated to income.<br />
</li>
</ul></li>
<li><strong>Not missing at Random (NMAR)</strong>: The probability that a data point is missing depends on the value of the variable in question.
<ul>
<li>P(Y missing | X, Y) = P (Y missing|X, Y)<br />
</li>
<li>Ex: Y = income, X = immigration status
<ul>
<li>Richer person may be less willing to disclose income<br />
</li>
<li>Undocumented immigrant may be less willing to disclose income</li>
</ul></li>
</ul></li>
</ul>
<p><img src="images/q.png" /> Write down an example of each.</p>
<p>Does it matter to inferences? <span style="color:red"><strong>Yes!</strong></span></p>
<div id="demonstration-via-simulation" class="section level3 hasAnchor" number="17.3.1">
<h3 class="hasAnchor"><span class="header-section-number">17.3.1</span> Demonstration via Simulation<a href="#demonstration-via-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What follows is just <em>one</em> method of approaching this problem via code. Simulation is a frequently used technique to understand the behavior of a process over time or over repeated samples.</p>
<div id="mcar" class="section level4 hasAnchor" number="17.3.1.1">
<h4 class="hasAnchor"><span class="header-section-number">17.3.1.1</span> MCAR<a href="#mcar" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Draw a random sample of size 100 from a standard Normal distribution (Z) and calculate the mean.</li>
</ol>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>) <span class="co"># setting a seed ensures the same numbers will be drawn each time</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>mean.z <span class="ot">&lt;-</span> <span class="fu">mean</span>(z)</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>mean.z</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.1205748</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Delete data at a rate of <span class="math inline">\(p\)</span> and calculate the complete case (available) mean.
<ul>
<li>Sample 100 random Bernoulli (0/1) variables with probability <span class="math inline">\(p\)</span>.</li>
</ul>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="at">p=</span>.<span class="dv">5</span>)</span></code></pre></div>
<ul>
<li>Find out which elements are are 1’s</li>
</ul>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>delete.these <span class="ot">&lt;-</span> <span class="fu">which</span>(x<span class="sc">==</span><span class="dv">1</span>)</span></code></pre></div>
<ul>
<li>Set those elements in <code>z</code> to <code>NA</code>.</li>
</ul>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>z[delete.these] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<ul>
<li>Calculate the complete case mean</li>
</ul>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(z, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.1377305</span></span></code></pre></div></li>
<li>Calculate the bias as the sample mean minus the true mean (<span class="math inline">\(E(\hat\theta) - \theta\)</span>).</li>
</ol>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(z, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">-</span> mean.z</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.01715565</span></span></code></pre></div>
<p>How does the bias change as a function of the proportion of missing? Let <span class="math inline">\(p\)</span> range from 0% to 99% and plot the bias as a function of <span class="math inline">\(p\)</span>.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>calc.bias <span class="ot">&lt;-</span> <span class="cf">function</span>(p){ <span class="co"># create a function to handle the repeated calculations</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">ifelse</span>(<span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, p)<span class="sc">==</span><span class="dv">1</span>, <span class="cn">NA</span>, z), <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">-</span> mean.z</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,.<span class="dv">99</span>,<span class="at">by=</span>.<span class="dv">01</span>)</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Bias&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Proportion of missing&quot;</span>)</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(p, <span class="fu">sapply</span>(p, calc.bias), <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p><img src="images/q.png" /> What is the behavior of the bias as <span class="math inline">\(p\)</span> increases? Look specifically at the position/location of the bias, and the variance/variability of the bias.</p>
</div>
<div id="nmar-missing-related-to-data" class="section level4 hasAnchor" number="17.3.1.2">
<h4 class="hasAnchor"><span class="header-section-number">17.3.1.2</span> NMAR: Missing related to data<a href="#nmar-missing-related-to-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>What if the rate of missing is related to the value of the outcome? Again, let’s setup a simulation to see how this works.</p>
<ol style="list-style-type: decimal">
<li>Randomly draw 100 random data points from a Standard Normal distribution to serve as our population, and 100 uniform random values between 0 and 1 to serve as probabilities of the data being missing (<span class="math inline">\(p=P(miss)\)</span>)</li>
</ol>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Sort both in ascending order, shove into a data frame and confirm that <span class="math inline">\(p(miss)\)</span> increases along with <span class="math inline">\(z\)</span>.</li>
</ol>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>dta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Z=</span><span class="fu">sort</span>(Z), <span class="at">p=</span><span class="fu">sort</span>(p))</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dta)</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="do">##           Z           p</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -2.898122 0.003673455</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 -2.185058 0.013886146</span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 -2.076032 0.035447986</span></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 -1.938288 0.039780643</span></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 -1.930809 0.051362816</span></span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 -1.905331 0.054639596</span></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dta, <span class="fu">aes</span>(<span class="at">x=</span>p, <span class="at">y=</span>Z)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;P(missing)&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Z~Normal(0,1)&quot;</span>)</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-19-1.png" width="384" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Set <span class="math inline">\(Z\)</span> missing with probability equal to the <span class="math inline">\(p\)</span> for that row. Create a new vector <code>dta$z.miss</code> that is either 0, or the value of <code>dta$Z</code> with probability <code>1-dta$p</code>. Then change all the 0’s to <code>NA</code>.</li>
</ol>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>dta<span class="sc">$</span>Z.miss <span class="ot">&lt;-</span> dta<span class="sc">$</span>Z <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">rbinom</span>(<span class="fu">NROW</span>(dta), <span class="dv">1</span>, dta<span class="sc">$</span>p))</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dta) <span class="co"># see structure of data to understand what is going on</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="do">##           Z           p    Z.miss</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -2.898122 0.003673455 -2.898122</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 -2.185058 0.013886146 -2.185058</span></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 -2.076032 0.035447986 -2.076032</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 -1.938288 0.039780643 -1.938288</span></span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 -1.930809 0.051362816 -1.930809</span></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 -1.905331 0.054639596 -1.905331</span></span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>dta<span class="sc">$</span>Z.miss[dta<span class="sc">$</span>Z.miss<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Calculate the complete case mean and the bias</li>
</ol>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dta<span class="sc">$</span>Z.miss, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -0.7777319</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dta<span class="sc">$</span>Z) <span class="sc">-</span> <span class="fu">mean</span>(dta<span class="sc">$</span>Z.miss, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.6830372</span></span></code></pre></div>
<p><a href="images/q.png"></a> Did the complete case estimate over- or under-estimate the true mean? Is the bias positive or negative?</p>
</div>
<div id="nmar-pure-censoring" class="section level4 hasAnchor" number="17.3.1.3">
<h4 class="hasAnchor"><span class="header-section-number">17.3.1.3</span> NMAR: Pure Censoring<a href="#nmar-pure-censoring" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Consider a hypothetical blood test to measure a hormone that is normally distributed in the blood with mean 10<span class="math inline">\(\mu g\)</span> and variance 1. However the test to detect the compound only can detect levels above 10.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> z</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>y[y<span class="sc">&lt;</span><span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(z) <span class="sc">-</span> <span class="fu">mean</span>(y, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -0.6850601</span></span></code></pre></div>
<p><a href="images/q.png"></a> Did the complete case estimate over- or under-estimate the true mean?</p>

<div class="rmdnote">
When the data is not missing at random, the bias can be much greater.
</div>

<div class="rmdcaution">
Usually you don’t know the missing data mechanism.
</div>
<p><strong>Degrees of difficulty</strong></p>
<ul>
<li>MCAR: is easiest to deal with.</li>
<li>MAR: we can live with it.</li>
<li>NMAR: most difficult to handle.</li>
</ul>
<p><strong>Evidence?</strong></p>
<p>What can we learn from evidence in the data set at hand?</p>
<ul>
<li>May be evidence in the data rule out MCAR - test responders vs. nonresponders.
<ul>
<li>Example: Responders tend to have higher/lower average education than nonresponders by t-test</li>
<li>Example: Response more likely in one geographic area than another by chi-square test</li>
</ul></li>
<li>No evidence in data set to rule out MAR (although there may be evidence from an external data source)</li>
</ul>
<p><strong>What is plausible?</strong></p>
<ul>
<li>Cochran example: when human behavior is involved, MCAR must be viewed as an extremely special case that would often be violated in practice</li>
<li>Missing data may be introduced by design (e.g., measure some variables, don’t measure others for reasons of cost, response burden), in which case MCAR would apply</li>
<li>MAR is much more common than MCAR</li>
<li>We cannot be too cavalier about assuming MAR, but anecdotal evidence shows that it often is plausible when conditioning on enough information</li>
</ul>
<p><strong>Ignorable Missing</strong></p>
<ul>
<li>If missing-data mechanism is MCAR or MAR then nonresponse is said to be “ignorable”.</li>
<li>Origin of name: in likelihood-based inference, both the data model and missing-data mechanism are important but with MCAR or MAR, inference can be based solely on the data model, thus making inference much simpler<br />
</li>
<li>“<em>Ignorability</em>” is a relative assumption: missingness on income may be NMAR given only gender, but may be MAR given gender, age, occupation, region of the country</li>
</ul>
</div>
</div>
</div>
<div id="general-strategies" class="section level2 hasAnchor" number="17.4">
<h2 class="hasAnchor"><span class="header-section-number">17.4</span> General strategies<a href="#general-strategies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Strategies for handling missing data include:</p>
<ul>
<li>Complete-case/available-case analysis: drop cases that make analysis inconvenient.</li>
<li>If variables are known to contribute to the missing values, then appropriate modeling can often account for the missingness.</li>
<li>Imputation procedures: fill in missing values, then analyze completed data sets using complete-date methods</li>
<li>Weighting procedures: modify “design weights” (i.e., inverse probabilities of selection from sampling plan) to account for probability of response<br />
</li>
<li>Model-based approaches: develop model for partially missing data, base inferences on likelihood under that model</li>
</ul>
<div id="complete-cases-analysis" class="section level3 hasAnchor" number="17.4.1">
<h3 class="hasAnchor"><span class="header-section-number">17.4.1</span> Complete cases analysis<a href="#complete-cases-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If not all variables observed, delete case from analysis</p>
<ul>
<li>Advantages:
<ul>
<li>Simplicity</li>
<li>Common sample for all estimates</li>
</ul></li>
<li>Disadvantages:
<ul>
<li>Loss of valid information</li>
<li>Bias due to violation of MCAR</li>
</ul></li>
</ul>
</div>
<div id="available-case-analysis" class="section level3 hasAnchor" number="17.4.2">
<h3 class="hasAnchor"><span class="header-section-number">17.4.2</span> Available-case analysis<a href="#available-case-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Use all cases where the variable of interest is present
<ul>
<li>Potentially different sets of cases for means of X and Y</li>
<li>and complete pairs for <span class="math inline">\(r_{XY}\)</span><br />
</li>
</ul></li>
<li>Tempting to think that available-case analysis will be superior to complete-case analysis<br />
</li>
<li>But it can distort relationships between variables by not using a common base of observations for all quantities being estimated.</li>
</ul>
</div>
<div id="imputation" class="section level3 hasAnchor" number="17.4.3">
<h3 class="hasAnchor"><span class="header-section-number">17.4.3</span> Imputation<a href="#imputation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fill in missing values, analyze completed data set</p>
<ul>
<li>Advantage:
<ul>
<li>Rectangular data set easier to analyze</li>
</ul></li>
<li>Disadvantage:
<ul>
<li>“Both seductive and dangerous” (Little and Rubin)</li>
<li>Can understate uncertainty due to missing values.</li>
<li>Can induce bias if imputing under the wrong model.</li>
</ul></li>
</ul>
</div>
</div>
<div id="imputation-methods" class="section level2 hasAnchor" number="17.5">
<h2 class="hasAnchor"><span class="header-section-number">17.5</span> Imputation Methods<a href="#imputation-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Unconditional mean substitution. <span style="color:red"><strong>Never use</strong></span>
<ul>
<li>Impute all missing data using the mean of observed cases</li>
<li>Artificially decreases the variance.</li>
</ul></li>
<li>Hot deck imputation
<ul>
<li>Impute values by randomly sampling values from observed data.<br />
</li>
<li>Good for categorical data</li>
<li>Reasonable for MCAR and MAR</li>
</ul></li>
<li>Model based imputation
<ul>
<li>Conditional Mean imputation: Use regression on observed variables to estimate missing values</li>
<li>Predictive Mean Matching: Fills in a value randomly by sampling observed values whose regression-predicted values are closest to the regression-predicted value for the missing point.
<ul>
<li>Cross between hot-deck and conditional mean</li>
</ul></li>
<li>Categorical data can be imputed using classification models</li>
<li>Less biased than mean substitution</li>
<li>but SE’s could be inflated</li>
</ul></li>
<li>Adding a residual
<ul>
<li>Impute regression value <span class="math inline">\(\pm\)</span> a randomly selected residual based on estimated residual variance</li>
<li>Over the long-term, we can reduce bias, on the average</li>
</ul></li>
</ul>
<p>…but we can do better.</p>
</div>
<div id="multiple-imputation-mi" class="section level2 hasAnchor" number="17.6">
<h2 class="hasAnchor"><span class="header-section-number">17.6</span> Multiple Imputation (MI)<a href="#multiple-imputation-mi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="goals" class="section level3 hasAnchor" number="17.6.1">
<h3 class="hasAnchor"><span class="header-section-number">17.6.1</span> Goals<a href="#goals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Accurately reflect available information</li>
<li>Avoid bias in estimates of quantities of interest</li>
<li>Estimation could involve explicit or implicit model</li>
<li>Accurately reflect uncertainty due to missingness</li>
</ul>
</div>
<div id="technique" class="section level3 hasAnchor" number="17.6.2">
<h3 class="hasAnchor"><span class="header-section-number">17.6.2</span> Technique<a href="#technique" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>For each missing value, impute <span class="math inline">\(m\)</span> estimates (usually <span class="math inline">\(m\)</span> = 5)
<ul>
<li>Imputation method must include a random component</li>
</ul></li>
<li>Create <span class="math inline">\(m\)</span> complete data sets</li>
<li>Perform desired analysis on each of the <span class="math inline">\(m\)</span> complete data sets</li>
<li>Combine final estimates in a manner that accounts for the between, and within imputation variance.</li>
</ol>
<div class="figure">
<img src="https://stefvanbuuren.name/fimd/fig/ch01-miflow-1.png" alt="" />
<p class="caption">Diagram of Multiple Imputation process. Credit: <a href="https://stefvanbuuren.name/fimd/sec-nutshell.html" class="uri">https://stefvanbuuren.name/fimd/sec-nutshell.html</a></p>
</div>
</div>
<div id="mi-as-a-paradigm" class="section level3 hasAnchor" number="17.6.3">
<h3 class="hasAnchor"><span class="header-section-number">17.6.3</span> MI as a paradigm<a href="#mi-as-a-paradigm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Logic: “Average over” uncertainty, don’t assume most likely scenario (single imputation) covers all plausible scenarios</li>
<li>Principle: Want nominal 95% intervals to cover targets of estimation 95% of the time</li>
<li>Simulation studies show that, when MAR assumption holds:
<ul>
<li>Proper imputations will yield close to nominal coverage (Rubin 87)</li>
<li>Improvement over single imputation is meaningful</li>
<li>Number of imputations can be modest - even 2 adequate for many purposes, so 5 is plenty</li>
</ul></li>
</ul>
<p><em>Rubin 87: Multiple Imputation for Nonresponse in Surveys, Wiley, 1987).</em></p>
</div>
<div id="inference-on-mi" class="section level3 hasAnchor" number="17.6.4">
<h3 class="hasAnchor"><span class="header-section-number">17.6.4</span> Inference on MI<a href="#inference-on-mi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider <span class="math inline">\(m\)</span> imputed data sets. For some quantity of interest <span class="math inline">\(Q\)</span> with squared <span class="math inline">\(SE = U\)</span>, calculate <span class="math inline">\(Q_{1}, Q_{2}, \ldots, Q_{m}\)</span> and <span class="math inline">\(U_{1}, U_{2}, \ldots, U_{m}\)</span> (e.g., carry out <span class="math inline">\(m\)</span> regression analyses, obtain point estimates and SE from each).</p>
<p>Then calculate the average estimate <span class="math inline">\(\bar{Q}\)</span>, the average variance <span class="math inline">\(\bar{U}\)</span>, and the variance of the averages <span class="math inline">\(B\)</span>.</p>
<p><span class="math display">\[
  \begin{aligned}
  \bar{Q} &amp; = \sum^{m}_{i=1}Q_{i}/m \\
  \bar{U} &amp; = \sum^{m}_{i=1}U_{i}/m \\
  B &amp; = \frac{1}{m-1}\sum^{m}_{i=1}(Q_{i}-\bar{Q})^2
  \end{aligned}
\]</span></p>
<p>Then <span class="math inline">\(T = \bar{U} + \frac{m+1}{m}B\)</span> is the estimated total variance of <span class="math inline">\(\bar{Q}\)</span>.</p>
<p>Significance tests and interval estimates can be based on</p>
<p><span class="math display">\[\frac{\bar{Q}-Q}{\sqrt{T}} \sim t_{df}, \mbox{ where } df = (m-1)(1+\frac{1}{m+1}\frac{\bar{U}}{B})^2\]</span></p>
<ul>
<li>df are similar to those for comparison of normal means with unequal variances, i.e., using Satterthwaite approximation.</li>
<li>Ratio of (B = between-imputation variance) to (T = between + within-imputation variance) is known as the fraction of missing information (FMI).
<ul>
<li>The FMI has been proposed as a way to monitor ongoing data collection and estimate the potential bias resulting from survey non-responders <a href="https://academic.oup.com/poq/article-abstract/74/2/223/1936466?redirectedFrom=fulltext">Wagner, 2018</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="multiple-imputation-using-chained-equations-mice" class="section level2 hasAnchor" number="17.7">
<h2 class="hasAnchor"><span class="header-section-number">17.7</span> Multiple Imputation using Chained Equations (MICE)<a href="#multiple-imputation-using-chained-equations-mice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="images/mice.jpg" /></p>
<div id="overview" class="section level3 hasAnchor" number="17.7.1">
<h3 class="hasAnchor"><span class="header-section-number">17.7.1</span> Overview<a href="#overview" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Generates multiple imputations for incomplete multivariate data by Gibbs sampling.</li>
<li>Missing data can occur anywhere in the data.</li>
<li>Impute an incomplete column by generating ‘plausible’ synthetic values given other columns in the data.</li>
<li>For predictors that are incomplete themselves, the most recently generated imputations are used to complete the predictors prior to imputation of the target column.</li>
<li>A separate univariate imputation model can be specified for each column.</li>
<li>The default imputation method depends on the measurement level of the target column.</li>
</ul>

<div class="rmdtip">
<p>Your best reference guide to this section of the notes is the bookdown version of Flexible Imputation of Missing Data, by Stef van Buuren:</p>
<p><a href="https://stefvanbuuren.name/fimd/ch-multivariate.html" class="uri">https://stefvanbuuren.name/fimd/ch-multivariate.html</a></p>
For a more technical details about how the <code>mice</code> function works in R, see:
<a href="https://www.jstatsoft.org/article/view/v045i03" class="uri">https://www.jstatsoft.org/article/view/v045i03</a>
</div>
</div>
<div id="process-algorithm" class="section level3 hasAnchor" number="17.7.2">
<h3 class="hasAnchor"><span class="header-section-number">17.7.2</span> Process / Algorithm<a href="#process-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a data matrix with 3 variables <span class="math inline">\(y_{1}\)</span>, <span class="math inline">\(y_{2}\)</span>, <span class="math inline">\(y_{3}\)</span>, each with missing values. At iteration <span class="math inline">\((\ell)\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Fit a model on <span class="math inline">\(y_{1}^{(\ell-1)}\)</span> using current values of <span class="math inline">\(y_{2}^{(\ell-1)}, y_{3}^{(\ell-1)}\)</span></li>
<li>Impute missing <span class="math inline">\(y_{1}\)</span>, generating <span class="math inline">\(y_{1}^{(\ell)}\)</span></li>
<li>Fit a model on <span class="math inline">\(y_{2}^{(\ell-1)}\)</span> using current versions of <span class="math inline">\(y_{1}^{(\ell)}, y_{3}^{(\ell-1)}\)</span></li>
<li>Impute missing <span class="math inline">\(y_{2}\)</span>, generating <span class="math inline">\(y_{2}^{(\ell)}\)</span></li>
<li>Fit a model on <span class="math inline">\(y_{3}\)</span> using current versions of <span class="math inline">\(y_{1}^{(\ell)}, y_{2}^{(\ell)}\)</span></li>
<li>Impute missing <span class="math inline">\(y_{3}\)</span>, generating <span class="math inline">\(y_{3}^{(\ell)}\)</span></li>
<li>Start next cycle using updated values <span class="math inline">\(y_{1}^{(\ell)}, y_{2}^{(\ell)}, y_{3}^{(\ell)}\)</span></li>
</ol>
<p>where <span class="math inline">\((\ell)\)</span> cycles from 1 to <span class="math inline">\(L\)</span>, before an imputed value is drawn.</p>
</div>
<div id="convergence" class="section level3 hasAnchor" number="17.7.3">
<h3 class="hasAnchor"><span class="header-section-number">17.7.3</span> Convergence<a href="#convergence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>How many imputations (<span class="math inline">\(m\)</span>) should we create and how many iterations (<span class="math inline">\(L\)</span>) should I run between imputations?</p>
<ul>
<li>Original research from Rubin states that small amount of imputations (<span class="math inline">\(m=5\)</span>) would be sufficient.</li>
<li>Advances in computation have resulted in very efficient programs such as <code>mice</code> - so generating a larger number of imputations (say <span class="math inline">\(m=40\)</span>) are more common <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4934387/">Pan, 2016</a></li>
<li>You want the number of iterations between draws to be long enough that the Gibbs sampler has converged.</li>
<li>There is no test or direct method for determing convergence.
<ul>
<li>Plot parameter against iteration number, one line per chain.</li>
<li>These lines should be intertwined together, without showing trends.</li>
<li>Convergence can be identified when the variance between lines is smaller (or at least no larger) than the variance within the lines.</li>
</ul></li>
</ul>

<div class="rmdimportant">
<p><strong>Mandatory Reading</strong></p>
Read 6.5.2: Convergence <a href="https://stefvanbuuren.name/fimd/sec-algoptions.html" class="uri">https://stefvanbuuren.name/fimd/sec-algoptions.html</a>
</div>
</div>
<div id="imputation-methods-1" class="section level3 hasAnchor" number="17.7.4">
<h3 class="hasAnchor"><span class="header-section-number">17.7.4</span> Imputation Methods<a href="#imputation-methods-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some built-in imputation methods in the <code>mice</code> package are:</p>
<ul>
<li><em>pmm</em>: Predictive mean matching (any) <strong>DEFAULT FOR NUMERIC</strong></li>
<li><em>norm.predict</em>: Linear regression, predicted values (numeric)</li>
<li><em>mean</em>: Unconditional mean imputation (numeric)</li>
<li><em>logreg</em>: Logistic regression (factor, 2 levels) <strong>DEFAULT</strong></li>
<li><em>logreg.boot</em>: Logistic regression with bootstrap</li>
<li><em>polyreg</em>: Polytomous logistic regression (factor, &gt;= 2 levels) <strong>DEFAULT</strong></li>
<li><em>lda</em>: Linear discriminant analysis (factor, &gt;= 2 categories)</li>
<li><em>cart</em>: Classification and regression trees (any)</li>
<li><em>rf</em>: Random forest imputations (any)</li>
</ul>
</div>
</div>
<div id="diagnostics" class="section level2 hasAnchor" number="17.8">
<h2 class="hasAnchor"><span class="header-section-number">17.8</span> Diagnostics<a href="#diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Q: How do I know if the imputed values are plausible?
A: Create diagnostic graphics that plot the observed and imputed values together.</p>
<p><a href="https://stefvanbuuren.name/fimd/sec-diagnostics.html" class="uri">https://stefvanbuuren.name/fimd/sec-diagnostics.html</a></p>
</div>
<div id="example-prescribed-amount-of-missing." class="section level2 hasAnchor" number="17.9">
<h2 class="hasAnchor"><span class="header-section-number">17.9</span> Example: Prescribed amount of missing.<a href="#example-prescribed-amount-of-missing." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will demonstrate using Fisher’s Iris data (pre-built in with R) where we can artificially create a prespecified percent of the data missing. This allows us to be able to estimate the bias incurred by using these imputation methods.</p>
<p>For the <code>iris</code> data we set a seed and use the <code>prodNA()</code> function from the <code>missForest</code> package to create 10% missing values in this data set.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(missForest)</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co"># Note to self: Change the combo on my luggage</span></span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> <span class="fu">prodNA</span>(iris, <span class="at">noNA=</span><span class="fl">0.1</span>)</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">is.na</span>(iris.mis)))</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE  TRUE </span></span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   0.9   0.1</span></span></code></pre></div>
<p>Visualize missing data pattern.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VIM)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggr</span>(iris.mis, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;darkolivegreen3&#39;</span>,<span class="st">&#39;salmon&#39;</span>),</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">numbers=</span><span class="cn">TRUE</span>, <span class="at">sortVars=</span><span class="cn">TRUE</span>,</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">labels=</span><span class="fu">names</span>(iris.mis), <span class="at">cex.axis=</span>.<span class="dv">7</span>,</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">gap=</span><span class="dv">3</span>, <span class="at">ylab=</span><span class="fu">c</span>(<span class="st">&quot;Missing data&quot;</span>,<span class="st">&quot;Pattern&quot;</span>))</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre><code>## 
##  Variables sorted by number of missings: 
##      Variable      Count
##   Petal.Width 0.14000000
##  Sepal.Length 0.13333333
##       Species 0.11333333
##  Petal.Length 0.06000000
##   Sepal.Width 0.05333333</code></pre>
<p>Here’s another example of where only 10% of the data overall is missing, but it results in only 58% complete cases.</p>
<div id="multiply-impute-the-missing-data-using-mice" class="section level3 hasAnchor" number="17.9.1">
<h3 class="hasAnchor"><span class="header-section-number">17.9.1</span> Multiply impute the missing data using <code>mice()</code><a href="#multiply-impute-the-missing-data-using-mice" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>imp_iris <span class="ot">&lt;-</span> <span class="fu">mice</span>(iris.mis, <span class="at">m=</span><span class="dv">10</span>, <span class="at">maxit=</span><span class="dv">25</span>, <span class="at">meth=</span><span class="st">&quot;pmm&quot;</span>, <span class="at">seed=</span><span class="dv">500</span>, <span class="at">printFlag=</span><span class="cn">FALSE</span>)</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(imp_iris)</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Class: mids</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of multiple imputations:  10 </span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Imputation methods:</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="do">##        &quot;pmm&quot;        &quot;pmm&quot;        &quot;pmm&quot;        &quot;pmm&quot;        &quot;pmm&quot; </span></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="do">## PredictorMatrix:</span></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="do">##              Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length            0           1            1           1       1</span></span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Width             1           0            1           1       1</span></span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Petal.Length            1           1            0           1       1</span></span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Petal.Width             1           1            1           0       1</span></span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Species                 1           1            1           1       0</span></span></code></pre></div>

<div class="rmdnote">
<p>The Stack Exchange post listed below has a great explanation/description of what each of these arguments control. It is a <strong>very</strong> good idea to understand these controls.</p>
<a href="https://stats.stackexchange.com/questions/219013/how-do-the-number-of-imputations-the-maximum-iterations-affect-accuracy-in-mul/219049#219049" class="uri">https://stats.stackexchange.com/questions/219013/how-do-the-number-of-imputations-the-maximum-iterations-affect-accuracy-in-mul/219049#219049</a>
</div>
</div>
<div id="check-the-imputation-method-used-on-each-variable." class="section level3 hasAnchor" number="17.9.2">
<h3 class="hasAnchor"><span class="header-section-number">17.9.2</span> Check the imputation method used on each variable.<a href="#check-the-imputation-method-used-on-each-variable." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>imp_iris<span class="sc">$</span>meth</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="do">##        &quot;pmm&quot;        &quot;pmm&quot;        &quot;pmm&quot;        &quot;pmm&quot;        &quot;pmm&quot;</span></span></code></pre></div>
<p>Predictive mean matching was used for all variables, even <code>Species</code>. This is reasonable because PMM is a hot deck method of imputation.</p>
</div>
<div id="check-convergence" class="section level3 hasAnchor" number="17.9.3">
<h3 class="hasAnchor"><span class="header-section-number">17.9.3</span> Check Convergence<a href="#check-convergence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp_iris, <span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Sepal.Width&quot;</span>, <span class="st">&quot;Petal.Length&quot;</span>))</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>The variance across chains is no larger than the variance within chains.</p>
</div>
<div id="look-at-the-values-generated-for-imputation" class="section level3 hasAnchor" number="17.9.4">
<h3 class="hasAnchor"><span class="header-section-number">17.9.4</span> Look at the values generated for imputation<a href="#look-at-the-values-generated-for-imputation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>imp_iris<span class="sc">$</span>imp<span class="sc">$</span>Sepal.Length</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="do">##       1   2   3   4   5   6   7   8   9  10</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 12  5.4 5.2 5.3 5.0 5.4 4.9 5.1 4.9 5.4 5.4</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 13  4.7 4.4 5.0 4.4 4.6 4.4 4.9 4.9 5.0 4.9</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 14  4.4 4.4 4.7 4.5 4.4 4.9 4.4 4.4 4.4 4.4</span></span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 36  4.4 4.4 4.7 4.9 4.7 4.4 4.4 4.4 4.9 4.7</span></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 38  5.1 5.2 5.4 5.0 5.1 4.6 4.6 5.0 4.7 5.0</span></span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 40  5.2 5.0 5.4 5.4 4.6 5.0 4.8 5.0 4.6 5.1</span></span>
<span id="cb297-9"><a href="#cb297-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 46  4.9 4.4 4.4 4.9 4.7 4.4 4.7 4.7 5.0 5.5</span></span>
<span id="cb297-10"><a href="#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 51  6.9 6.4 6.8 6.8 6.7 6.3 6.5 6.4 6.8 6.9</span></span>
<span id="cb297-11"><a href="#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 56  6.0 5.8 5.4 5.8 6.1 5.4 5.4 5.9 6.0 6.0</span></span>
<span id="cb297-12"><a href="#cb297-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 62  6.3 5.8 6.3 5.8 5.7 5.7 6.8 5.8 5.8 6.2</span></span>
<span id="cb297-13"><a href="#cb297-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 74  6.7 5.4 6.4 6.1 6.9 6.8 6.5 6.1 6.4 6.7</span></span>
<span id="cb297-14"><a href="#cb297-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 75  6.2 6.2 5.6 5.8 6.2 6.0 6.7 6.7 5.8 5.7</span></span>
<span id="cb297-15"><a href="#cb297-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 86  6.4 6.0 6.5 6.9 6.1 6.3 6.9 6.8 6.3 6.5</span></span>
<span id="cb297-16"><a href="#cb297-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 90  5.2 5.6 5.5 5.2 5.2 6.0 6.2 5.2 4.9 5.8</span></span>
<span id="cb297-17"><a href="#cb297-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 91  5.6 6.2 6.2 5.6 6.1 5.8 6.0 6.2 5.8 6.2</span></span>
<span id="cb297-18"><a href="#cb297-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 106 7.7 7.9 7.7 7.3 7.9 7.7 7.3 7.7 7.7 7.7</span></span>
<span id="cb297-19"><a href="#cb297-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 124 6.7 6.2 5.7 5.7 6.2 5.7 5.6 5.7 5.6 5.7</span></span>
<span id="cb297-20"><a href="#cb297-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 142 6.2 6.1 6.0 6.1 6.9 6.6 6.1 6.5 6.6 5.8</span></span>
<span id="cb297-21"><a href="#cb297-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 145 6.3 6.4 6.4 6.7 6.3 6.3 6.4 6.3 6.7 6.5</span></span>
<span id="cb297-22"><a href="#cb297-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 148 6.4 6.5 5.6 6.4 6.7 6.0 6.4 6.5 6.4 5.6</span></span></code></pre></div>
<p>This is just for us to see what this imputed data look like. Each column is an imputed value, each row is a row where an imputation for <code>Sepal.Length</code> was needed. Notice only imputations are shown, no observed data is showing here.</p>
</div>
<div id="create-a-complete-data-set-by-filling-in-the-missing-data-using-the-imputations" class="section level3 hasAnchor" number="17.9.5">
<h3 class="hasAnchor"><span class="header-section-number">17.9.5</span> Create a complete data set by filling in the missing data using the imputations<a href="#create-a-complete-data-set-by-filling-in-the-missing-data-using-the-imputations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>iris_1 <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp_iris, <span class="at">action=</span><span class="dv">1</span>)</span></code></pre></div>
<p>Action=1 returns the first completed data set, action=2 returns the second completed data set, and so on.</p>
<div id="alternative---stack-the-imputed-data-sets-in-long-format." class="section level4 hasAnchor" number="17.9.5.1">
<h4 class="hasAnchor"><span class="header-section-number">17.9.5.1</span> Alternative - Stack the imputed data sets in <em>long</em> format.<a href="#alternative---stack-the-imputed-data-sets-in-long-format." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>iris_long <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp_iris, <span class="st">&#39;long&#39;</span>)</span></code></pre></div>
<p>By looking at the <code>names</code> of this new object we can confirm that there are indeed 10 complete data sets with <span class="math inline">\(n=150\)</span> in each.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(iris_long)</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;.imp&quot;         &quot;.id&quot;          &quot;Sepal.Length&quot; &quot;Sepal.Width&quot;  &quot;Petal.Length&quot;</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] &quot;Petal.Width&quot;  &quot;Species&quot;</span></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(iris_long<span class="sc">$</span>.imp)</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   1   2   3   4   5   6   7   8   9  10 </span></span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 150 150 150 150 150 150 150 150 150 150</span></span></code></pre></div>
</div>
</div>
<div id="visualize-imputations" class="section level3 hasAnchor" number="17.9.6">
<h3 class="hasAnchor"><span class="header-section-number">17.9.6</span> Visualize Imputations<a href="#visualize-imputations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s compare the imputed values to the observed values to see if they are indeed “plausible” We want to see that the distribution of of the magenta points (imputed) matches the distribution of the blue ones (observed).</p>
<p><strong>Univariately</strong></p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(imp_iris)</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-37-1.png" width="768" /></p>
<p><strong>Multivariately</strong></p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(imp_iris, Sepal.Length <span class="sc">~</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Petal.Width <span class="sc">|</span> Species, <span class="at">cex=</span>.<span class="dv">8</span>, <span class="at">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-38-1.png" width="768" /></p>
<p><strong>Analyze and pool</strong>
All of this imputation was done so we could actually perform an analysis!</p>
<p>Let’s run a simple linear regression on <code>Sepal.Length</code> as a function of <code>Sepal.Width</code>,
<code>Petal.Length</code> and <code>Species</code>.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">with</span>(imp_iris, <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Species))</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">pool</span>(model))</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                term   estimate  std.error statistic        df      p.value</span></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       (Intercept)  2.3291755 0.29018720  8.026458 100.48280 1.942002e-12</span></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       Sepal.Width  0.4324051 0.09212873  4.693488  88.97127 9.678996e-06</span></span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      Petal.Length  0.8165354 0.07163496 11.398560 107.17114 0.000000e+00</span></span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Speciesversicolor -1.0848839 0.24416495 -4.443242  96.69963 2.360206e-05</span></span>
<span id="cb303-8"><a href="#cb303-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  Speciesvirginica -1.6001933 0.31893115 -5.017363 103.29187 2.189018e-06</span></span></code></pre></div>
<p>Pooled parameter estimates <span class="math inline">\(\bar{Q}\)</span> and their standard errors <span class="math inline">\(\sqrt{T}\)</span> are provided, along with a significance test (against <span class="math inline">\(\beta_p=0\)</span>). Note that a 95% interval must be calculated manually.</p>
<p>Digging deeper into the object created by <code>pool(model)</code>, specifically the <code>pooled</code> list, we can pull out additional information including the number of missing values, the <em>fraction of missing information</em> (<code>fmi</code>) as defined by Rubin (1987), and <code>lambda</code>, the proportion of total variance that is attributable to the missing data (<span class="math inline">\(\lambda = (B + B/m)/T)\)</span>.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">pool</span>(model)<span class="sc">$</span>pooled[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>)], <span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
m
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
ubar
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
riv
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2.329
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
100.483
</td>
<td style="text-align:right;">
0.151
</td>
</tr>
<tr>
<td style="text-align:left;">
Sepal.Width
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.432
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
88.971
</td>
<td style="text-align:right;">
0.193
</td>
</tr>
<tr>
<td style="text-align:left;">
Petal.Length
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.817
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
107.171
</td>
<td style="text-align:right;">
0.129
</td>
</tr>
<tr>
<td style="text-align:left;">
Speciesversicolor
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-1.085
</td>
<td style="text-align:right;">
0.051
</td>
<td style="text-align:right;">
96.700
</td>
<td style="text-align:right;">
0.164
</td>
</tr>
<tr>
<td style="text-align:left;">
Speciesvirginica
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-1.600
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
103.292
</td>
<td style="text-align:right;">
0.141
</td>
</tr>
</tbody>
</table>
</div>
<div id="calculating-bias" class="section level3 hasAnchor" number="17.9.7">
<h3 class="hasAnchor"><span class="header-section-number">17.9.7</span> Calculating bias<a href="#calculating-bias" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The iris data set had no missing data to begin with. So we can calculate the “true” parameter estimates…</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>true.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Species, <span class="at">data=</span>iris)</span></code></pre></div>
<p>and find the difference in coefficients.</p>
<p>The variance of the multiply imputed estimates is larger because of the between-imputation variance.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forestplot)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>te.mean <span class="ot">&lt;-</span> <span class="fu">summary</span>(true.model)<span class="sc">$</span>coefficients[,<span class="dv">1</span>]</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>mi.mean <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">pool</span>(model))[,<span class="dv">1</span>]</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>te.ll   <span class="ot">&lt;-</span> te.mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">summary</span>(true.model)<span class="sc">$</span>coefficients[,<span class="dv">2</span>]</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>mi.ll   <span class="ot">&lt;-</span> mi.mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">summary</span>(<span class="fu">pool</span>(model))[,<span class="dv">2</span>]</span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>te.ul   <span class="ot">&lt;-</span> te.mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">summary</span>(true.model)<span class="sc">$</span>coefficients[,<span class="dv">2</span>]</span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>mi.ul   <span class="ot">&lt;-</span> mi.mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">summary</span>(<span class="fu">pool</span>(model))[,<span class="dv">2</span>]</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>names   <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(true.model))</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a><span class="fu">forestplot</span>(names, </span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;True Model&quot;</span>, <span class="st">&quot;MICE&quot;</span>),</span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">fn.ci_norm =</span> <span class="fu">c</span>(fpDrawNormalCI, fpDrawCircleCI), </span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">mean =</span> <span class="fu">cbind</span>(te.mean, mi.mean), </span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">lower =</span> <span class="fu">cbind</span>(te.ll, mi.ll),</span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">cbind</span>(te.ul, mi.ul), </span>
<span id="cb306-17"><a href="#cb306-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span><span class="fu">fpColors</span>(<span class="at">box=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkred&quot;</span>)), </span>
<span id="cb306-18"><a href="#cb306-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span><span class="st">&quot;Regression coefficients&quot;</span>,</span>
<span id="cb306-19"><a href="#cb306-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">boxsize =</span> .<span class="dv">1</span></span>
<span id="cb306-20"><a href="#cb306-20" aria-hidden="true" tabindex="-1"></a>           )</span></code></pre></div>
<p><img src="missing_data_files/figure-html/unnamed-chunk-42-1.png" width="960" /></p>
</div>
</div>
<div id="final-thoughts" class="section level2 hasAnchor" number="17.10">
<h2 class="hasAnchor"><span class="header-section-number">17.10</span> Final thoughts<a href="#final-thoughts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>“In our experience with real and artificial data…, the practical conclusion appears to be that multiple imputation, when carefully done, can be safely used with real problems even when the ultimate user may be applying models or analyses not contemplated by the imputer.” - Little &amp; Rubin (Book, p. 218)</p>
</blockquote>
<ul>
<li>Don’t ignore missing data.</li>
<li>Impute sensibly and multiple times.</li>
<li>It’s typically desirable to include many predictors in an imputation model, both to
<ul>
<li>improve precision of imputed values</li>
<li>make MAR assumption more plausible</li>
</ul></li>
<li>But the number of covariance parameters goes up as the square of the number of variables in the model,
<ul>
<li>implying practical limits on the number of variables for which parameters can be estimated well</li>
</ul></li>
<li>MI applies to subjects who have a general missingness pattern, i.e., they have measurements on some variables, but not on others.</li>
<li>But, subjects can be lost to follow up due to death or other reasons (i.e., attrition).</li>
<li>Here we have only baseline data, but not the outcome or other follow up data.</li>
<li>If attrition subjects are eliminated from the sample, they can produce non-response or attrition bias.</li>
<li>Use attrition weights.
<ul>
<li>Given a baseline profile, predict the probability that subject will
stay and use the inverse probability as weight.</li>
<li>e.g., if for a given profile all subjects stay, then the predicted probability
is 1 and the attrition weight is 1. Such a subject “counts once”.</li>
<li>For another profile, the probability may be 0.5, attrition weight is
1/.5 = 2 and that person “counts twice”.</li>
</ul></li>
<li>For differential drop-out, or self-selected treatment, you can consider using Propensity Scores.</li>
</ul>
</div>
<div id="additional-references-1" class="section level2 hasAnchor" number="17.11">
<h2 class="hasAnchor"><span class="header-section-number">17.11</span> Additional References<a href="#additional-references-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Little, R. and Rubin, D. Statistical Analysis with Missing Data, 2nd Ed., Wiley, 2002</p>
<ul>
<li>Standard reference</li>
<li>Requires some math</li>
</ul></li>
<li><p>Allison, P. Missing Data, Sage, 2001</p>
<ul>
<li>Small and cheap</li>
<li>Requires very little math</li>
</ul></li>
<li><p>Multiple Imputation.com <a href="http://www.stefvanbuuren.nl/mi/" class="uri">http://www.stefvanbuuren.nl/mi/</a></p></li>
<li><p>Applied Missing Data Analysis with SPSS and (R) Studio <a href="https://bookdown.org/mwheymans/Book_MI/" class="uri">https://bookdown.org/mwheymans/Book_MI/</a></p></li>
<li><p><a href="http://www.analyticsvidhya.com/blog/2016/03/tutorial-powerful-packages-imputing-missing-values/" class="uri">http://www.analyticsvidhya.com/blog/2016/03/tutorial-powerful-packages-imputing-missing-values/</a></p></li>
<li><p><a href="http://www.r-bloggers.com/imputing-missing-data-with-r-mice-package/" class="uri">http://www.r-bloggers.com/imputing-missing-data-with-r-mice-package/</a></p></li>
</ul>
<p>Imputation methods for complex survey data and data not missing at random is an open research topic. Read more about this here: <a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mi_sect032.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mi_sect032.htm</a></p>
<p><img src="https://shiring.github.io/netlify_images/mice_sketchnote_gxjsgc.jpg" />
<a href="https://shirinsplayground.netlify.com/2017/11/mice_sketchnotes/" class="uri">https://shirinsplayground.netlify.com/2017/11/mice_sketchnotes/</a></p>
<!--chapter:end:missing_data.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
